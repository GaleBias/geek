<p>ä½ å¥½ï¼Œæˆ‘æ˜¯Chronoã€‚</p><p>åˆ°ä»Šå¤©æˆ‘ä»¬â€œä¸­çº§ç¯‡â€çš„å­¦ä¹ ä¹Ÿå‘Šä¸€æ®µè½äº†ï¼Œåœ¨è¿™æ®µæ—¶é—´é‡Œæˆ‘ä»¬ä½¿ç”¨kubeadmæ­å»ºäº†æ›´æ¥è¿‘ç”Ÿäº§ç¯å¢ƒçš„å¤šèŠ‚ç‚¹Kubernetesé›†ç¾¤ï¼Œç„¶åå­¦ä¹ äº†Deploymentã€DaemonSetã€Serviceã€Ingressè¿™4ä¸ªéå¸¸é‡è¦çš„APIå¯¹è±¡ã€‚</p><p>è¿™èŠ‚è¯¾ä½œä¸ºå¯¹â€œä¸­çº§ç¯‡â€çš„æ€»ç»“å’Œå›é¡¾ï¼Œä»ç„¶æ˜¯è§†é¢‘çš„å½¢å¼ï¼ŒæŠŠå‰é¢å‡ èŠ‚è¯¾é‡Œçš„ä¸€äº›æ“ä½œéƒ½å®é™…æ¼”ç¤ºå‡ºæ¥ï¼Œæ–¹ä¾¿ä½ å¯¹ç…§ç€æ“ä½œä¸Šä¸‹æ–‡æ¥å­¦ä¹ ã€‚</p><p>é¦–å…ˆæˆ‘ä¼šå¸¦ä½ çœ‹çœ‹kubeadmæ­å»ºé›†ç¾¤çš„å®Œæ•´è¿‡ç¨‹ï¼Œç„¶åç¼–å†™YAMLæ–‡ä»¶ï¼Œç¤ºèŒƒDeploymentã€DaemonSetã€Serviceã€Ingressç­‰å¯¹è±¡çš„å…·ä½“ç”¨æ³•ï¼Œæœ€åæ˜¯ä½¿ç”¨è¿™äº›å¯¹è±¡æ­å»ºWordPressç½‘ç«™ã€‚</p><p>è®©æˆ‘ä»¬å¼€å§‹è§†é¢‘è¯¾ç¨‹çš„å­¦ä¹ å§ã€‚</p><blockquote>
<p>ä¸€ç‚¹è¯´æ˜ï¼šè§†é¢‘æ˜¯æˆ‘çš„æ“ä½œå®å½•ï¼Œæœ‰äº›åŒ…å®‰è£…æ¯”è¾ƒæ…¢ï¼Œå±å¹•ä¼šå‡ ç§’æ²¡æœ‰åŠ¨ä½œï¼Œåœ¨å‚è€ƒè§†é¢‘ä»¥åŠä½ è‡ªå·±æ“ä½œçš„æ—¶å€™å¯ä»¥è€å¿ƒä¸€äº›ã€‚</p>
</blockquote><hr><h3>ä¸€. å®‰è£…kubeadm</h3><p><video poster="https://static001.geekbang.org/resource/image/c2/8e/c23970e32376837de1b072c4555cb08e.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/5913313c-1825d5d7497-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/888a2275349f4051bf8cfb1138b3ab1f/7e9d11d81324427e96e54a6cce390a1b-90aa725fd1bd9ed09cac0e4931db8160-sd.m3u8" type="application/x-mpegURL"></video></p><p>æˆ‘ä»¬å…ˆæ¥å®‰è£…MasterèŠ‚ç‚¹ï¼Œå½“ç„¶åœ¨è¿™ä¹‹å‰ä½ éœ€è¦ä¿è¯å·²ç»å®‰è£…å¥½äº†Dockerï¼ˆå®‰è£…å‚è€ƒ<a href="https://time.geekbang.org/column/article/528619">ç¬¬1è®²</a>ï¼‰ã€‚</p><p>é¦–å…ˆå››æ­¥å‡†å¤‡å·¥ä½œï¼šæ”¹ä¸»æœºåã€æ”¹Dockeré…ç½®ã€æ”¹ç½‘ç»œè®¾ç½®ã€æ”¹äº¤æ¢åˆ†åŒºã€‚</p><p>ä¿®æ”¹ä¸»æœºåï¼ŒæŠŠå®ƒæ”¹æˆ <code>master</code>ï¼š</p><pre><code class="language-plain">sudo vi /etc/hostname
</code></pre><!-- [[[read_end]]] --><p>ä¿®æ”¹Dockerçš„é…ç½®æ–‡ä»¶ï¼ŒæŠŠcgroupçš„é©±åŠ¨ç¨‹åºæ”¹æˆ <code>systemd</code>ï¼Œç„¶åæ˜¯ä¿®æ”¹iptablesçš„é…ç½®ï¼Œå¯ç”¨ <code>br_netfilter</code> æ¨¡å—ï¼Œè¿˜æœ‰ä¿®æ”¹â€œ<strong>/etc/fstab</strong>â€ï¼Œå…³é—­Linuxçš„swapåˆ†åŒºã€‚</p><p>è¿™äº›æ“ä½œæ­¥éª¤éƒ½å·²ç»åˆ—åœ¨äº†<a href="https://time.geekbang.org/column/article/534762">ç¬¬17è®²</a>é‡Œäº†ï¼Œå› ä¸ºä¸€ä¸ªä¸ªæ–‡ä»¶ä¿®æ”¹å¾ˆéº»çƒ¦ï¼Œæˆ‘å°±å†™äº†ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼ŒæŠŠè¿™äº›æ“ä½œéƒ½è‡ªåŠ¨åŒ–äº†ï¼Œå¤§æ¦‚çœ‹ä¸€ä¸‹ï¼š</p><pre><code class="language-plain">vi prepare.sh
</code></pre><p>ç¬¬ä¸€éƒ¨åˆ†æ˜¯ä¿®æ”¹Dockeré…ç½®æ–‡ä»¶ç„¶åé‡å¯ï¼Œç¬¬äºŒéƒ¨åˆ†æ˜¯ä¿®æ”¹iptablesé…ç½®ï¼Œç¬¬ä¸‰éƒ¨åˆ†æ˜¯å…³é—­Linuxçš„swapåˆ†åŒºã€‚æˆ‘ä»¬æ‰§è¡Œè¿™ä¸ªè„šæœ¬ï¼Œå®‰è£…çš„å‡†å¤‡å·¥ä½œå°±åšå¥½äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œä¸‹è½½kubeadmå¯æ‰§è¡Œæ–‡ä»¶ï¼ŒåŒæ ·æˆ‘ä¹Ÿå†™æˆäº†ä¸€ä¸ªæ–¹ä¾¿çš„è„šæœ¬æ–‡ä»¶ï¼š</p><pre><code class="language-plain">vi admin.sh
</code></pre><p>åŸºæœ¬æµç¨‹å’ŒKuberneteså®˜æ–¹æ–‡æ¡£æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯æ”¹æˆäº†å›½å†…çš„è½¯ä»¶æºã€‚</p><p><strong>æ³¨æ„åœ¨ä½¿ç”¨ <code>apt install</code> çš„æ—¶å€™ï¼Œåº”è¯¥æ˜ç¡®æŒ‡å®šè¦å®‰è£…çš„ç‰ˆæœ¬å·</strong>ï¼Œåƒè¿™é‡Œæˆ‘å°±ä½¿ç”¨çš„æ˜¯Kubernetes 1.23.3ï¼Œå¦‚æœä¸æŒ‡å®šå°±ä¼šä½¿ç”¨å½“å‰çš„æœ€æ–°ç‰ˆæœ¬ï¼Œä¹Ÿå°±æ˜¯1.24ã€‚</p><p>å®‰è£…å®Œæˆä¹‹åï¼Œæˆ‘ä»¬ç”¨ <code>kubeadm version</code>ã€<code>kubectl version</code> æ¥çœ‹ä¸€ä¸‹ç‰ˆæœ¬æ˜¯å¦æ­£ç¡®ï¼š</p><pre><code class="language-plain">kubeadm version
kubectl version --client
</code></pre><p>å¯ä»¥çœ‹åˆ°ç¡®å®æ˜¯å®‰è£…äº†æˆ‘ä»¬åˆšæ‰æŒ‡å®šçš„1.23.3ç‰ˆæœ¬ã€‚</p><hr><h3>äºŒ. å®‰è£…Kubernetes</h3><p><video poster="https://static001.geekbang.org/resource/image/b6/0f/b601796a8374ef1a4b9e131854c4110f.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/1446449d-1825d5d700f-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/62112ae580e240edaf43411e89ec3fd3/015e757de1aa448a95c77c3ded922688-caf54eed1efb8b46dc5dd22ea32a5acd-sd.m3u8" type="application/x-mpegURL"></video></p><p>æœ‰äº†kubeadmï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ­£å¼å®‰è£…Kubernetesäº†ã€‚å®‰è£…æ—¶éœ€è¦ä»gcr.ioæ‹‰å–é•œåƒï¼Œæˆ‘è¿™é‡Œä»å›½å†…é•œåƒç½‘ç«™ä¸Šæå‰ä¸‹è½½å¥½äº†é•œåƒï¼Œç»™ä½ çœ‹ä¸€ä¸‹ï¼š</p><pre><code class="language-plain">docker images
</code></pre><p>è¿™äº›é•œåƒä¸­åŒ…æ‹¬Kubernetesçš„æ ¸å¿ƒç»„ä»¶ï¼Œæ¯”å¦‚etcdã€apiserverã€controller-managerã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥æ‰§è¡Œ <code>kubeadm init</code> åˆå§‹åŒ–MasterèŠ‚ç‚¹ï¼Œçœ‹ä¸€ä¸‹è„šæœ¬æ–‡ä»¶ï¼š</p><pre><code class="language-plain">vi master.sh
</code></pre><p>åˆå§‹åŒ–çš„æ—¶å€™æˆ‘ä½¿ç”¨äº†å‚æ•° <code>pod-network-cidr</code> æŒ‡å®šPodçš„IPåœ°å€èŒƒå›´æ˜¯â€œ10.10.0.0/16â€ï¼Œç„¶åKubernetesç‰ˆæœ¬ä¹ŸæŒ‡å®šä½¿ç”¨1.23.3ã€‚</p><p>ä¸ºäº†è®©kubectlåœ¨å®‰è£…å®Œæˆåèƒ½æ­£å¸¸å·¥ä½œï¼Œè„šæœ¬é‡Œè¿˜ä¼šæŠŠKubernetesçš„é…ç½®æ–‡ä»¶æ‹·è´åˆ°å½“å‰ç”¨æˆ·çš„ <code>.kube</code> ç›®å½•ä¸‹ã€‚</p><p>å¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬å°±è¿è¡Œè¿™ä¸ªè„šæœ¬ã€‚</p><p>æ³¨æ„MasterèŠ‚ç‚¹åˆå§‹åŒ–å®Œæˆåï¼Œkubeadmä¼šç»™å‡ºä¸€äº›é‡è¦çš„æç¤ºä¿¡æ¯ï¼Œä¸€ä¸ªæ˜¯æ‹·è´é…ç½®æ–‡ä»¶ï¼Œè¿™ä¸ªæˆ‘ä»¬å·²ç»åœ¨è„šæœ¬é‡Œåšè¿‡äº†ï¼Œ<strong>å¦ä¸€ä¸ªæ˜¯WorkerèŠ‚ç‚¹åŠ å…¥é›†ç¾¤çš„ <code>kubeadm join</code> å‘½ä»¤ï¼Œä¸€å®šè¦ä¿å­˜å¥½ã€‚æˆ‘ä»¬å¯ä»¥æ–°å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œæ¯”å¦‚k.txtï¼Œç„¶åæŠŠå®ƒå­˜ä¸‹æ¥ã€‚</strong></p><p>æˆ‘ä»¬å†ç”¨ <code>kubectl version</code>ã€<code>kubectl get node</code> æ¥æ£€æŸ¥Kubernetesçš„ç‰ˆæœ¬å’Œé›†ç¾¤çš„èŠ‚ç‚¹çŠ¶æ€äº†ï¼š</p><pre><code class="language-plain">kubectl version
kubectl get node
</code></pre><p>MasterèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯â€œNotReadyâ€ï¼Œæ¥ä¸‹æ¥è¿˜è¦å®‰è£…ç½‘ç»œæ’ä»¶Flannelã€‚</p><p>Flannelçš„å®‰è£…å¾ˆç®€å•ï¼Œè®°å¾—è¦ä¿®æ”¹å®ƒçš„YAMLæ–‡ä»¶ï¼Œâ€œ<strong>net-conf.json</strong>â€é‡Œçš„ç½‘ç»œèŒƒå›´å¿…é¡»å’Œ <code>kubeadm init</code> é‡Œçš„ä¸€æ ·ï¼š</p><pre><code class="language-plain">vi flannel.yml
</code></pre><p>ç°åœ¨æˆ‘ä»¬ç”¨ <code>kubectl apply</code> æ¥å®‰è£…Flannelç½‘ç»œï¼š</p><pre><code class="language-plain">kubectl apply -f kube-flannel.yml
</code></pre><p>ç¨ç­‰ä¸€å°ä¼šï¼Œæˆ‘ä»¬å†æ‰§è¡Œ <code>kubectl get node</code> æ¥çœ‹èŠ‚ç‚¹çŠ¶æ€ï¼š</p><pre><code class="language-plain">kubectl get node
</code></pre><p>å°±çœ‹åˆ°MasterèŠ‚ç‚¹çš„çŠ¶æ€æ˜¯â€œReadyâ€ï¼Œè¡¨æ˜èŠ‚ç‚¹ç½‘ç»œä¹Ÿå·¥ä½œæ­£å¸¸äº†ã€‚</p><hr><h3>ä¸‰. Kubernetesé›†ç¾¤éƒ¨ç½²</h3><p><video poster="https://static001.geekbang.org/resource/image/05/2c/0535b19a4bebfab55e2f7cb9654ab92c.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/19c4ff78-1825d5d6b2f-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/10836c6754bc42a19164ea2a9c9abc4a/71c83e906331403e9fb2b8d94ac658d3-a082fec1fac3b5d718d58dfc447d418f-sd.m3u8" type="application/x-mpegURL"></video></p><p>WorkerèŠ‚ç‚¹çš„å®‰è£…æ­¥éª¤å’ŒMasterèŠ‚ç‚¹æ˜¯å·®ä¸å¤šçš„ï¼Œå…ˆæ˜¯æ”¹ä¸»æœºåï¼Œå†ç”¨prepare.shåšå‡†å¤‡å·¥ä½œï¼Œä¿®æ”¹Dockeré…ç½®æ–‡ä»¶ã€iptablesï¼Œå…³é—­Linuxçš„swapåˆ†åŒºï¼Œç„¶åä¸‹è½½kubeadmå¯æ‰§è¡Œæ–‡ä»¶å’ŒKubernetesé•œåƒã€‚</p><p>è¿™å‡ æ­¥å’ŒMasterèŠ‚ç‚¹å®Œå…¨ä¸€æ ·ï¼Œæˆ‘å°±ä¸å±•ç¤ºè„šæœ¬æ–‡ä»¶äº†ï¼Œç›´æ¥è¿è¡Œã€‚</p><p>æœ‰äº†kubeadmä¹‹åï¼Œå› ä¸ºè¿™ä¸ªæ˜¯WorkerèŠ‚ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰§è¡Œ <code>kubeadm init</code>ï¼Œ<strong>è€Œæ˜¯è¦æ‰§è¡Œ <code>kubeadm join</code>ï¼Œä¹Ÿå°±æ˜¯ä¹‹å‰å®‰è£…MasterèŠ‚ç‚¹æ—¶æ‹·è´çš„é‚£æ¡å‘½ä»¤</strong>ã€‚å®ƒä¼šè‡ªåŠ¨è¿æ¥MasterèŠ‚ç‚¹ï¼Œç„¶åæ‹‰å–é•œåƒï¼Œå®‰è£…ç½‘ç»œæ’ä»¶ï¼Œæœ€åæŠŠèŠ‚ç‚¹åŠ å…¥é›†ç¾¤ã€‚</p><p>WorkerèŠ‚ç‚¹å®‰è£…å¥½ä¹‹åï¼Œè®©æˆ‘ä»¬åœ¨æ§åˆ¶å°æ£€æŸ¥èŠ‚ç‚¹çš„çŠ¶æ€ï¼Œæ‰§è¡Œ <code>kubectl get node</code>ï¼Œä¼šçœ‹åˆ°ä¸¤ä¸ªèŠ‚ç‚¹éƒ½æ˜¯â€œReadyâ€ã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬ç”¨ <code>kubectl run</code>ï¼Œè¿è¡ŒNginxæ¥æµ‹è¯•ä¸€ä¸‹ï¼š</p><pre><code class="language-plain">kubectl run ngx --image=nginx:alpine
kubectl get pod -o wide
</code></pre><p>ä¼šçœ‹åˆ°Podè¿è¡Œåœ¨WorkerèŠ‚ç‚¹ä¸Šï¼Œè¡¨æ˜æˆ‘ä»¬çš„Kuberneteså¤šèŠ‚ç‚¹é›†ç¾¤éƒ¨ç½²æˆåŠŸã€‚</p><hr><h3>å››. Deploymentçš„ä½¿ç”¨</h3><p><video poster="https://static001.geekbang.org/resource/image/7e/ba/7e70b11f796d73c9fa7a771b1dc5dbba.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/21c0348a-1825d5d672e-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/48554e3614d7473391d8c01d3da5cf15/dedabf40aa2e4d92a594d873bbb77824-b6a35dc15dc421a48037a5609ead77b9-sd.m3u8" type="application/x-mpegURL"></video></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥çœ‹çœ‹Deploymentçš„ç”¨æ³•ã€‚</p><p>é¦–å…ˆæ˜¯ <code>kubectl api-resources</code> æ¥æŸ¥çœ‹Deploymentçš„åŸºæœ¬ä¿¡æ¯ï¼š</p><pre><code class="language-plain">kubectl api-resources | grep deploy
</code></pre><p>å¯ä»¥çœ‹åˆ°Deploymentçš„ç®€ç§°æ˜¯â€œ<strong>deploy</strong>â€ï¼Œå®ƒçš„apiVersionæ˜¯â€œ<strong>apps/v1</strong>â€ï¼Œkindæ˜¯â€œ<strong>Deployment</strong>â€ã€‚</p><p>ç„¶åæˆ‘ä»¬æ‰§è¡Œ <code>kubectl create</code>ï¼Œè®©Kubernetesä¸ºæˆ‘ä»¬è‡ªåŠ¨ç”ŸæˆDeploymentçš„æ ·æ¿æ–‡ä»¶ã€‚</p><p>å…ˆè¦å®šä¹‰ä¸€ä¸ªç¯å¢ƒå˜é‡out:</p><pre><code class="language-plain">export out="--dry-run=client -o yaml"
</code></pre><p>ç„¶ååˆ›å»ºåå­—å«â€œngx-depâ€çš„å¯¹è±¡ï¼Œä½¿ç”¨çš„é•œåƒæ˜¯â€œnginx:alpineâ€ï¼š</p><pre><code class="language-plain">kubectl create deploy ngx-dep --image=nginx:alpine $out
</code></pre><p>æˆ‘ä»¬æŠŠè¿™ä¸ªæ ·æ¿å­˜å…¥ä¸€ä¸ªæ–‡ä»¶ngx.ymlï¼š</p><pre><code class="language-plain">kubectl create deploy ngx-dep --image=nginx:alpine $out &gt; deploy.yml
</code></pre><p>è¿™é‡Œå¯ä»¥åˆ é™¤ä¸€äº›ä¸éœ€è¦çš„å­—æ®µï¼Œè®©YAMLçœ‹èµ·æ¥æ›´å¹²å‡€ï¼Œç„¶åæŠŠreplicasæ”¹æˆ2ï¼Œæ„æ€æ˜¯å¯åŠ¨ä¸¤ä¸ªNginx Podã€‚</p><p>æŠŠDeploymentçš„YAMLå†™å¥½ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”¨ <code>kubectl apply</code> æ¥åˆ›å»ºå¯¹è±¡äº†ï¼š</p><pre><code class="language-plain">kubectl apply -f deploy.yml
</code></pre><p>ç”¨ <code>kubectl get</code> å‘½ä»¤æŸ¥çœ‹Deploymentçš„çŠ¶æ€ï¼š</p><pre><code class="language-plain">kubectl get deploy
kubectl get pod
</code></pre><p>æœ€åæ¥è¯•éªŒä¸€ä¸‹Deploymentçš„åº”ç”¨ä¼¸ç¼©åŠŸèƒ½ï¼Œä½¿ç”¨å‘½ä»¤ <code>kubectl scale</code>ï¼ŒæŠŠPodæ•°é‡æ”¹æˆ5ä¸ªï¼š</p><pre><code class="language-plain">kubectl scale --replicas=5 deploy ngx-dep
</code></pre><p>æˆ‘ä»¬å†ç”¨ <code>kubectl get</code> å‘½ä»¤æŸ¥çœ‹ï¼Œå°±ä¼šå‘ç°Podå·²ç»æˆåŠŸå˜æˆäº†5ä¸ªå‰¯æœ¬ï¼š</p><pre><code class="language-plain">kubectl get pod 
</code></pre><p>æœ€ååˆ é™¤è¿™ä¸ªDeploymentï¼š</p><pre><code class="language-plain">kubectl delete deploy ngx-dep
</code></pre><hr><h3>äº”. DaemonSetçš„ä½¿ç”¨</h3><p><video poster="https://static001.geekbang.org/resource/image/43/c7/438c9ece84b0dc35eb30ccf2d8e636c7.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/5efc73b1-1825d5d63e6-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/780d3f92f0064b0dbbd094c914da0f0f/d421db37c12f458d9d007ffb528a7f98-d5d61677df96fc4e34de948be6b49c54-sd.m3u8" type="application/x-mpegURL"></video></p><p>çœ‹å®ŒDeploymentï¼Œæˆ‘å†æ¥æ¼”ç¤ºDaemonSetã€‚</p><p>å› ä¸ºDaemonSetä¸èƒ½ä½¿ç”¨ <code>kubectl create</code> ç›´æ¥ç”Ÿæˆæ ·æ¿æ–‡ä»¶ï¼Œä½†å¤§ä½“ç»“æ„å’ŒDeploymentæ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥å…ˆç”Ÿæˆä¸€ä¸ªDeploymentï¼Œç„¶åå†ä¿®æ”¹å‡ ä¸ªå­—æ®µå°±è¡Œäº†ã€‚</p><p>è¿™é‡Œæˆ‘ä½¿ç”¨äº†<strong>Linuxç³»ç»Ÿé‡Œå¸¸ç”¨çš„å°å·¥å…·sedï¼Œç›´æ¥æ›¿æ¢Deploymenté‡Œçš„åå­—</strong>ï¼Œå†åˆ é™¤replicaså­—æ®µï¼Œè¿™æ ·å°±è‡ªåŠ¨ç”Ÿæˆäº†DaemonSetçš„æ ·æ¿æ–‡ä»¶ï¼š</p><pre><code class="language-plain">kubectl create deploy redis-ds --image=redis:5-alpine $out \
&nbsp; | sed 's/Deployment/DaemonSet/g' - \
&nbsp; | sed -e '/replicas/d' -
</code></pre><p>è¿™ä¸ªæ ·æ¿æ–‡ä»¶å› ä¸ºæ˜¯ä»Deploymentæ”¹æ¥çš„ï¼Œæ‰€ä»¥ä¸ä¼šæœ‰tolerationså­—æ®µï¼Œä¸èƒ½åœ¨MasterèŠ‚ç‚¹ä¸Šè¿è¡Œï¼Œéœ€è¦æ‰‹å·¥æ·»åŠ ã€‚</p><p>ä¸‹é¢è¿™ä¸ªå°±æ˜¯å·²ç»æ”¹å¥½çš„å®Œæ•´çš„DaemonSet YAMLæè¿°æ–‡ä»¶ï¼š</p><pre><code class="language-plain">vi ds.yml
</code></pre><p>æ³¨æ„çœ‹é‡Œé¢çš„tolerationså­—æ®µï¼Œå®ƒèƒ½å¤Ÿå®¹å¿èŠ‚ç‚¹çš„ <code>node-role.kubernetes.io/master:NoSchedule</code> è¿™ä¸ªæ±¡ç‚¹ï¼Œä¹Ÿå°±æ˜¯è¯´èƒ½å¤Ÿè¿è¡Œåœ¨MasterèŠ‚ç‚¹ä¸Šã€‚</p><p>ç°åœ¨è®©æˆ‘ä»¬éƒ¨ç½²è¿™ä¸ªåŠ ä¸Šäº†â€œå®¹å¿åº¦â€çš„DaemonSetï¼š</p><pre><code class="language-plain">kubectl apply -f ds.yml
</code></pre><p>å†ç”¨ <code>kubectl get</code> æŸ¥çœ‹å¯¹è±¡çš„çŠ¶æ€ï¼š</p><pre><code class="language-plain">kubectl get ds
kubectl get pod -o wide
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªRedis çš„DaemonSetå·²ç»è·‘åœ¨äº†Masterå’ŒWorkerèŠ‚ç‚¹ä¸Šã€‚</p><p>æœ€ååˆ é™¤è¿™ä¸ªDaemonSetï¼š</p><pre><code class="language-plain">kubectl delete -f ds.yml
</code></pre><hr><h3>å…­. Serviceçš„ä½¿ç”¨</h3><p><video poster="https://static001.geekbang.org/resource/image/84/0d/84ffb533fe65e9ceebc2dc5ebce32f0d.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/237ff5d9-1825d5ffbed-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/8ef77380c8ea42cc9ee9e0f4b4ecbe64/f69c526ea6074d0b9b486dfd7f6a4944-2becc28a8cff22f937fe7a7069997c1a-sd.m3u8" type="application/x-mpegURL"></video></p><p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹Kubernetesé‡Œçš„è´Ÿè½½å‡è¡¡å¯¹è±¡Serviceã€‚</p><p>å› ä¸ºServiceå¯¹è±¡æœåŠ¡äºPodã€Deploymentç­‰å¯¹è±¡ï¼Œæ‰€ä»¥åœ¨åˆ›å»ºå®ƒä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦å…ˆåˆ›å»ºä¸€ä¸ªDeploymentï¼š</p><pre><code class="language-plain">kubectl apply -f deploy.yml
</code></pre><p>è¿™ä¸ªDeploymentç®¡ç†äº†ä¸¤ä¸ªNginx Podï¼š</p><pre><code class="language-plain">kubectl get pod -o wide
</code></pre><p>ç„¶åæˆ‘ä»¬æˆ‘ä»¬ä½¿ç”¨ <code>kubectl expose</code> åˆ›å»ºServiceæ ·æ¿æ–‡ä»¶ï¼š</p><pre><code class="language-plain">kubectl expose deploy ngx-dep --port=80 --target-port=80 $out
</code></pre><p>ä¿®æ”¹ä¹‹åå°±æ˜¯svc.ymlï¼Œå†ç”¨ <code>kubectl apply</code> åˆ›å»ºServiceå¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl apply -f svc.yml
</code></pre><p>ç”¨ <code>kubectl get svc</code> å¯ä»¥åˆ—å‡ºServiceå¯¹è±¡ï¼Œå¯ä»¥çœ‹åˆ°å®ƒçš„è™šIPåœ°å€ï¼š</p><pre><code class="language-plain">kubectl get svc
</code></pre><p>æƒ³è¦çœ‹Serviceä»£ç†äº†å“ªäº›åç«¯çš„Podï¼Œè¦ç”¨ <code>kubectl describe</code> å‘½ä»¤ï¼š</p><pre><code class="language-plain">kubectl describe svc ngx-svc
</code></pre><p>ç”¨ <code>kubectl get pod</code> å¯ä»¥å¯¹æ¯”éªŒè¯Serviceæ˜¯å¦æ­£ç¡®ä»£ç†äº†Nginx Podï¼š</p><pre><code class="language-plain">kubectl get pod -o wide
</code></pre><p>ç°åœ¨è®©æˆ‘ä»¬ç”¨ <code>kubectl exec</code> è¿›å…¥Podï¼ŒéªŒè¯Serviceçš„åŸŸååŠŸèƒ½ï¼š</p><pre><code class="language-plain">kubectl exec -it ngx-dep-6796688696-4h6lb -- sh
</code></pre><p>ä½¿ç”¨curlï¼ŒåŠ ä¸ŠåŸŸåâ€œngx-svcâ€ï¼Œä¹Ÿå°±æ˜¯Serviceå¯¹è±¡çš„åå­—ï¼š</p><pre><code class="language-plain">curl ngx-svc
</code></pre><p>å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œå°±ä¼šçœ‹åˆ°é€šè¿‡è¿™ä¸ªåŸŸåï¼ŒServiceå¯¹è±¡å®ç°äº†å¯¹åç«¯Podçš„è´Ÿè½½å‡è¡¡ï¼ŒæŠŠæµé‡åˆ†å‘åˆ°ä¸åŒçš„Podã€‚</p><p>æˆ‘ä»¬è¿˜å¯ä»¥å†å°è¯•Serviceçš„å…¶ä»–åŸŸåå½¢å¼ï¼Œæ¯”å¦‚åŠ ä¸Šåå­—ç©ºé—´ï¼š</p><pre><code class="language-plain">curl ngx-svc.default
curl ngx-svc.default.svc.cluster.local
</code></pre><p>æœ€åçœ‹ä¸€ä¸‹Serviceä½¿ç”¨NodePortæ–¹å¼å¯¹å¤–æš´éœ²æœåŠ¡çš„ç”¨æ³•ï¼Œçœ‹ä¸€ä¸‹Serviceå¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl get svc
</code></pre><p>åœ¨PORTé‡Œæ˜¾ç¤ºå®ƒåˆ†é…äº†ä¸€ä¸ªéšæœºçš„ç«¯å£å·31980ï¼Œåªè¦è®¿é—®é›†ç¾¤é‡Œä»»æ„ä¸€ä¸ªèŠ‚ç‚¹ï¼ŒåŠ ä¸Šè¿™ä¸ªç«¯å£å·ï¼Œå°±å¯ä»¥è®¿é—®åˆ°Serviceå¯¹è±¡å’Œå®ƒåé¢çš„Podã€‚</p><p>æˆ‘ä»¬æ¥è¯•éªŒä¸€ä¸‹ï¼Œæ³¨æ„210æ˜¯MasterèŠ‚ç‚¹ï¼Œ220æ˜¯WorkerèŠ‚ç‚¹ï¼š</p><pre><code class="language-plain">curl 192.168.10.210:31980
curl 192.168.10.220:31980
</code></pre><p>æœ€ååˆ é™¤Deploymentå’ŒServiceå¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl delete -f deploy.yml
kubectl delete -f svc.yml
</code></pre><hr><h3>ä¸ƒ. Ingressçš„ä½¿ç”¨</h3><p><video poster="https://static001.geekbang.org/resource/image/84/6f/84e0da1cb5e4d365f0f045065dyy4c6f.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/1919b638-1825d5ff69c-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/e92b427476ce4360b28031d5d608205c/5bf51bd74fd943ef87def749bd3705dd-d18b9673f697c42c27bb97202f057fef-sd.m3u8" type="application/x-mpegURL"></video></p><p>å­¦ä¹ äº†Serviceä¹‹åï¼Œæˆ‘ä»¬å†æ¥çœ‹ç®¡ç†é›†ç¾¤å…¥å£æµé‡çš„Ingresså¯¹è±¡ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨Nginxå…¬å¸å¼€å‘çš„Ingress Controllerï¼Œéœ€è¦æŒ‰ç…§å®ƒçš„æ–‡æ¡£ï¼Œåˆ›å»ºåå­—ç©ºé—´ã€RBACç­‰ç›¸å…³çš„èµ„æºï¼Œè¿™é‡Œæˆ‘ä½¿ç”¨ä¸€ä¸ªç®€å•è„šæœ¬æ¥å®Œæˆï¼š</p><pre><code class="language-plain">cat setup.sh
./setup.sh
</code></pre><p>ä½¿ç”¨å‘½ä»¤ <code>kubectl get ns</code> å¯ä»¥çœ‹åˆ°å·²ç»æœ‰äº†ä¸€ä¸ªæ–°çš„åå­—ç©ºé—´ <code>nginx-ingress</code>ã€‚</p><p>ä¸ºäº†æµ‹è¯•éªŒè¯Ingresså’ŒIngress controllerçš„ç”¨æ³•ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦å…ˆåˆ›å»ºDeploymentå’ŒServiceå¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl apply -f deploy.yml
kubectl apply -f svc.yml
</code></pre><p>æ¥çœ‹ä¸€ä¸‹Ingressçš„å®šä¹‰ï¼š</p><pre><code class="language-plain">vi ingress.yml
</code></pre><p>è¿™ä¸ªYAMLé‡ŒåŒ…å«äº†ä¸¤ä¸ªAPIå¯¹è±¡ï¼Œç¬¬ä¸€ä¸ªæ˜¯Ingress Classï¼Œåå­—æ˜¯ngx-inkï¼Œæ³¨æ„åœ¨specé‡Œï¼Œcontrollerè¦æŒ‡å®šæˆNginx Ingress Controllerã€‚</p><p>ç¬¬äºŒä¸ªå¯¹è±¡å°±æ˜¯è·¯ç”±è§„åˆ™å¯¹è±¡Ingressäº†ï¼Œæˆ‘ä¸ºå®ƒæ·»åŠ äº†ä¸€ä¸ªæ³¨è§£nginx.org/lb-methodï¼ŒæŒ‡å®šä½¿ç”¨Round-Robinè´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œç„¶åæ˜¯å…³é”®å­—æ®µingressClassNameï¼Œè¿™æ ·å°±å¯ä»¥æŠŠIngresså’ŒIngress Classè”ç³»èµ·æ¥ã€‚</p><p>åé¢çš„ruleså°±æ˜¯å…·ä½“çš„è·¯ç”±è§„åˆ™ï¼Œæ¯”è¾ƒå¤æ‚ï¼Œè¦æŒ‡å®šhostã€pathï¼Œè¿˜æœ‰åç«¯è¦è½¬å‘çš„Serviceï¼Œ<strong>æœ€å¥½ç”¨kubectl createæ¥è‡ªåŠ¨ç”Ÿæˆï¼Œä¸ç„¶å¾ˆå®¹æ˜“å†™é”™</strong>ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬çœ‹çœ‹Ingress Controllerçš„å®šä¹‰ï¼Œå®ƒåœ¨kic YAML é‡Œï¼š</p><pre><code class="language-plain">vi kic.yml
</code></pre><p>å®ƒå…¶å®æ˜¯ä»Nginxå®˜æ–¹çš„ç¤ºä¾‹æ–‡ä»¶ä¿®æ”¹è€Œæ¥çš„ï¼Œæ‰€ä»¥åªéœ€è¦å…³æ³¨å‡ ä¸ªåœ°æ–¹ã€‚</p><p>ç¬¬ä¸€ä¸ªæ˜¯é•œåƒï¼Œæˆ‘æ”¹æˆäº†æ›´ç²¾ç®€çš„Alpineç‰ˆæœ¬ï¼Œ<strong>ç¬¬äºŒä¸ªæ˜¯å¯åŠ¨å‚æ•°argsï¼Œä¸€å®šè¦åŠ ä¸Š-ingress-classï¼Œå…³è”ä¸Šåˆšæ‰çš„Ingress Classå¯¹è±¡</strong>ï¼Œå¦åˆ™Ingress Controllerå°±æ— æ³•æ‰¾åˆ°è·¯ç”±è§„åˆ™Ingressã€‚</p><p>å®ƒåé¢è¿˜æœ‰å‡ ä¸ªå‚æ•°ï¼Œæ¯”å¦‚-health-statusã€-ready-statusç­‰ç­‰ï¼Œä½ å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£äº†è§£å®ƒä»¬çš„ä½œç”¨ã€‚</p><p>ç°åœ¨æˆ‘ä»¬å°±åº”ç”¨è¿™ä¸¤ä¸ªYAML æ–‡ä»¶ï¼Œåˆ›å»ºIngresså¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl apply -f ingress.yml
kubectl apply -f kic.yml
</code></pre><p>ç”¨ <code>kubectl get</code> æ¥é€ä¸ªæŸ¥çœ‹è¿™äº›å¯¹è±¡çš„çŠ¶æ€ï¼š</p><pre><code class="language-plain">kubectl get ingressclass
kubectl get ing
kubectl describe ing ngx-ing

kubectl get deploy -n nginx-ingress
kubectl get pod -n nginx-ingress
</code></pre><p>ç¡®è®¤å®ƒä»¬éƒ½å·¥ä½œæ­£å¸¸ï¼Œæˆ‘ä»¬æ¥åšä¸ªæµ‹è¯•ï¼ŒæŠŠæœ¬åœ°çš„8080ç«¯å£æ˜ å°„åˆ°Ingress Controller Podçš„80ç«¯å£ï¼š</p><pre><code class="language-plain">kubectl port-forward -n nginx-ingress ngx-kic-dep-8859b7b86-cplgp 8080:80 &amp;
</code></pre><p>å› ä¸ºåœ¨Ingressé‡Œæˆ‘ä»¬è®¾å®šçš„è·¯ç”±è§„åˆ™æ˜¯ngx.teståŸŸåï¼Œæ‰€ä»¥è¦ç”¨curlçš„resolveå‚æ•°æ¥æŠŠå®ƒå¼ºåˆ¶è§£æåˆ°127.0.0.1ï¼š</p><pre><code class="language-plain">curl --resolve ngx.test:8080:127.0.0.1 http://ngx.test:8080
</code></pre><p>å¤šæ‰§è¡Œå‡ æ¬¡ï¼Œä½ å°±ä¼šå‘ç°Nginx Ingress Controlleré€šè¿‡åŸŸåè·¯ç”±è§„åˆ™ï¼ŒæŠŠè¯·æ±‚è½¬å‘åˆ°äº†ä¸åŒçš„åç«¯Podã€‚</p><p>æœ€åæˆ‘ä»¬åˆ é™¤åˆšæ‰åˆ›å»ºçš„è¿™äº›Deploymentã€Serviceã€Ingressç­‰å¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl delete -f deploy.yml
kubectl delete -f svc.yml
kubectl delete -f ingress.yml
kubectl delete -f kic.yml
</code></pre><hr><h3>å…«. æ­å»ºWordPressç½‘ç«™</h3><p><video poster="https://static001.geekbang.org/resource/image/cd/e6/cda7ayy29504f1f7a0ba268267d7dce6.jpg" preload="none" controls=""><source src="https://media001.geekbang.org/customerTrans/7e27d07d27d407ebcc195a0e78395f55/18a7e618-1825d5ff1a1-0000-0000-01d-dbacd.mp4" type="video/mp4"><source src=" https://media001.geekbang.org/f655345af3554ac0a5a5068d36a11b39/87dbfc04224b4219b2fa7648652c56bf-87bd0b26bcbe4d5dbe3a16fd1147fc6b-sd.m3u8" type="application/x-mpegURL"></video></p><p>è¿™é‡Œæˆ‘ä»¬è¿˜æ˜¯æ¥æ­å»ºWordPressç½‘ç«™ï¼Œå®é™…æ“ä½œDeploymentã€Serviceã€Ingressè¿™äº›å¯¹è±¡çš„ç”¨æ³•ã€‚</p><p>ç¬¬ä¸€æ­¥æ˜¯éƒ¨ç½²MariaDBï¼š</p><pre><code class="language-plain">wp-maria.yml
</code></pre><p>å®ƒçš„ConfigMapæ²¡æœ‰å˜åŒ–ï¼Œè¿˜æ˜¯â€œDATABASEâ€â€œUSERâ€â€œPASSWORDâ€é‚£å‡ ä¸ªç¯å¢ƒå˜é‡ã€‚ä¸‹é¢çš„éƒ¨ç½²æ–¹å¼æ”¹æˆäº†Deploymentï¼Œç®€å•èµ·è§åªä½¿ç”¨ä¸€ä¸ªå®ä¾‹ã€‚ä¹‹ååˆä¸ºå®ƒå®šä¹‰äº†ä¸€ä¸ªServiceå¯¹è±¡ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨åŸŸåè€Œä¸æ˜¯IPåœ°å€æ¥è®¿é—®æ•°æ®åº“ã€‚</p><p>ç¬¬äºŒæ­¥æ˜¯éƒ¨ç½²WordPressåº”ç”¨ï¼š</p><pre><code class="language-plain">vi wp-dep.yml
</code></pre><p><strong>æ³¨æ„åœ¨ConfigMapé‡Œæˆ‘ä»¬ä¸å†ä½¿ç”¨å›ºå®šIPåœ°å€äº†ï¼Œè€Œæ˜¯æ”¹ç”¨äº†Serviceæä¾›çš„åŸŸåmaria-svcã€‚</strong>ç„¶ååœ¨Deploymenté‡Œï¼ŒæŠŠWordPresså®ä¾‹è®¾ç½®ä¸º2ï¼Œå¢åŠ äº†å†—ä½™åº¦ï¼Œæé«˜äº†å¯ç”¨æ€§ã€‚ä¹‹åæˆ‘ä»¬è¿˜æ˜¯ä¸ºå®ƒå®šä¹‰äº†Serviceå¯¹è±¡ï¼Œå¹¶ä¸”è®¾ç½®ä¸ºNodePortæ¨¡å¼ï¼ŒæŒ‡å®šä½¿ç”¨ç«¯å£30088ã€‚</p><p>ç¬¬ä¸‰æ­¥æ˜¯éƒ¨ç½²Ingressï¼š</p><pre><code class="language-plain">vi wp-ing.yml
</code></pre><p>Ingressçš„å®šä¹‰å’Œä¹‹å‰å·®ä¸å¤šï¼Œä½†Ingress Classçš„åå­—æ”¹æˆäº†wp-inkï¼ŒIngressè·¯ç”±çš„hostæ”¹æˆäº†wp.testã€‚</p><p>Ingress Controllerçš„å˜åŒ–ä¹Ÿä¸å¤§ï¼š</p><pre><code class="language-plain">vi wp-kic.yml
</code></pre><p><strong>å…³é”®è¿˜æ˜¯argsé‡Œçš„å‚æ•°-ingress-classï¼Œå¿…é¡»å’ŒIngress ClassåŒ¹é…ï¼Œä¹Ÿå°±æ˜¯wp-ink</strong>ã€‚è¿˜æœ‰å°±æ˜¯å­—æ®µhostNetwork: trueï¼Œè®©Podç›´æ¥ä½¿ç”¨èŠ‚ç‚¹çš„ç½‘ç»œ</p><p>çœ‹å®Œäº†è¿™äº›YAML ï¼Œè®©æˆ‘ä»¬ç”¨kubectl applyæ¥åˆ›å»ºå¯¹è±¡ï¼š</p><pre><code class="language-plain">kubectl apply&nbsp;-f wp-maria.yml
kubectl apply&nbsp;-f wp-dep.yml
kubectl apply&nbsp;-f wp-ing.yml
kubectl apply&nbsp;-f wp-kic.yml
</code></pre><p>åˆ›å»ºå®Œæˆä¹‹åï¼Œæˆ‘ä»¬å†ç”¨kubectl getçœ‹ä¸€ä¸‹å¯¹è±¡çš„çŠ¶æ€ï¼š</p><pre><code class="language-plain">kubectl get deploy
kubectl get svc
kubectl get pod -n nginx-ingress
</code></pre><p>ç°åœ¨è®©æˆ‘ä»¬æ¥åˆ°é›†ç¾¤ä¹‹å¤–ï¼Œå‡è®¾ä½ å·²ç»ä¿®æ”¹äº†æœ¬åœ°çš„hostsåŸŸåè§£ææ–‡ä»¶ï¼ŒæŠŠåŸŸåwp.testè§£æåˆ°Kubernetesçš„èŠ‚ç‚¹ï¼Œé‚£å°±å¯ä»¥ç›´æ¥åœ¨æµè§ˆå™¨é‡Œè¾“å…¥<a href="http://wp.test">http://wp.test</a>æ¥è®¿é—®Nginx Ingress Controllerï¼Œå†è®¿é—®WordPressç½‘ç«™äº†ã€‚</p><h2>è¯¾åä½œä¸š</h2><p>å¦‚æœä½ åœ¨æ“ä½œè¿‡ç¨‹ä¸­é‡åˆ°å›°éš¾ï¼Œæ¬¢è¿åœ¨ç•™è¨€åŒºç•™è¨€ï¼Œè®°å¾—æŠŠä½ çš„é—®é¢˜æè¿°æ¸…æ¥šï¼Œè¿™æ ·æˆ‘å’Œå…¶ä»–åŒå­¦ä¹Ÿèƒ½æ›´å¥½åœ°å°±é—®é¢˜è¯¦ç»†è®¨è®ºã€‚</p><p>å¸Œæœ›ä½ åœ¨è¿™æ®µæ—¶é—´çš„å­¦ä¹ è¿‡ç¨‹ä¸­æœ‰æ‰€æ”¶è·ï¼Œä¸‹èŠ‚è¯¾å°±æ˜¯æœ€åçš„é«˜çº§ç¯‡äº†ï¼Œæˆ‘ä»¬ä¸‹èŠ‚è¯¾å†è§ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/cd/ba/3a348f2d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>YueShi</span>
  </div>
  <div class="_2_QraFYR_0">1ã€æ¨èä¹‹å‰çš„è¯¾ç¨‹å…¨éƒ½è‡ªå·±å®Œæˆä¸€éï¼Œç„¶ååœ¨çœ‹è¿™ä¸ªå®æˆ˜è§†é¢‘ï¼Œå°±æœ‰ç‚¹æŸ¥æ¼è¡¥ç¼ºçš„å‘³é“äº†ï¼Œçœ‹çš„å¾ˆè½»æ¾<br>2ã€å…³äºæ¥¼ä¸ŠåŒå­¦â€œæŒ‰é“ç†åº”è¯¥æ˜¯è¿›å…¥Serviceâ€çš„å›°æƒ‘ï¼Œæœ‰æ„Ÿï¼ŒK8Sçš„åŸºæœ¬æ€æƒ³å°±æ˜¯ç»„åˆå’Œé€‚é…å™¨æ¨¡å¼ï¼Œåœ¨k8sé‡Œæ„Ÿè§‰ä¸‡ç‰©çš†å¯ç»„åˆï¼Œå¦‚æœä¸èƒ½æ»¡è¶³ï¼ŒåŸºäºç°æœ‰çš„apiåœ¨é€‚é…å‡ºä¸€ä¸ªapiå‡ºæ¥ï¼Œç»„åˆå’Œé€‚é…åœ¨k8sé‡Œæ˜¯äº’é€†çš„<br>3ã€åŒå¿—ä»¬ç»§ç»­å­¦å‘€ï¼Œåœ¨åšæŒå­¦ä¸€èŠ‚ï¼Œå°±ç”©æ‰äº†å¾ˆå¤šäººï¼ŒåŠ æ²¹ğŸ’ªğŸ’ªğŸ’ªğŸ’ª</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: very nice!</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-14 22:14:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>èŠ±èŠ±å¤§è„¸çŒ«</span>
  </div>
  <div class="_2_QraFYR_0">é‡åˆ°ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼Œåœ¨nodeèŠ‚ç‚¹æ‰§è¡Œkubeadm joinçš„æ—¶å€™ï¼Œéƒ½ä¼šå¡æ­»ï¼Œç„¶åé€šè¿‡--v=5ï¼Œå‘ç°è¿æ¥masterä¸€ç›´æ‹’ç»ï¼šI0816 23:05:48.343080    5359 token.go:217] [discovery] Failed to request cluster-info, will try again: Get &quot;https:&#47;&#47;10.0.3.15:6443&#47;api&#47;v1&#47;namespaces&#47;kube-public&#47;configmaps&#47;cluster-info?timeout=10s&quot;: dial tcp 10.0.3.15:6443: connect: connection refusedï¼Œçœ‹è§£å†³æ–¹æ¡ˆæœ‰è¯´åœ¨kubeadm initçš„æ—¶å€™éœ€è¦æŒ‡å®šï¼ˆ108æ˜¯æˆ‘nodeèŠ‚ç‚¹çš„è™šæ‹ŸæœºIPï¼‰--apiserver-cert-extra-sans 192.168.56.108 --apiserver-advertise-address 192.168.56.108 \ï¼Œå‡Œä¹±äº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é¦–å…ˆä¿è¯kubeadmçš„ç‰ˆæœ¬æ­£ç¡®ï¼Œç„¶åè®°å¾—tokenä¹Ÿè¦æ­£ç¡®ï¼Œå¥½åƒtokenæ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œè¿‡æœŸäº†å°±è¦é‡æ–°ç”Ÿæˆã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-16 23:08:04</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/28/1b/f9/018197f1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°æ±Ÿçˆ±å­¦æœ¯</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆé—®ä¸ªé—®é¢˜å‘€<br><br>kubectl get deploy<br>kubectl get svc<br>kubectl get pod -n nginx-ingress<br><br>ä»è¿™é‡Œå¯ä»¥çœ‹å‡ºåº”ç”¨çš„deployä»¥åŠsvcæ˜¯åœ¨defaultå‘½åç©ºé—´ä¸‹çš„ï¼Œingressæ˜¯åœ¨è‡ªå·±çš„nginx-ingresså‘½åç©ºé—´ä¸‹ï¼Œä»–ä»¬åœ¨k8sä¸­ä¸å±äºä¸€ä¸ªå‘½åç©ºé—´ã€‚ä½†æ˜¯åœ¨ingress ruleçš„é…ç½®é‡Œï¼Œå…³äºbackendçš„é…ç½®ç›´æ¥ç”¨çš„serviceçš„åå­—ï¼Œæ˜¯å› ä¸ºå¦‚æœè¿™é‡Œä¸æä¾›å…·ä½“çš„å‘½åç©ºé—´çš„åå­—ï¼Œä»–ä¼šè‡ªåŠ¨è®¤ä¸ºæ˜¯defaultå—ã€‚è°¢è°¢ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ï¼Œå¦‚æœä¸å†™å…·ä½“çš„åå­—ç©ºé—´ï¼Œé»˜è®¤å°±æ˜¯defaultã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-10-08 13:53:38</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/25/87/f3a69d1b.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>peter</span>
  </div>
  <div class="_2_QraFYR_0">è¯·æ•™è€å¸ˆå‡ ä¸ªé—®é¢˜ï¼š<br>Q1ï¼šâ€œkubeadm joinâ€å‘½ä»¤é‡Œçš„tokençš„æ—¶æ•ˆæ€§æ²¡æœ‰èµ·ä½œç”¨ã€‚<br>è®²kubeadmçš„æ—¶å€™ï¼Œæåˆ°ï¼šâ€œkubeadm joinâ€å‘½ä»¤é‡Œçš„tokenæœ‰æ—¶æ•ˆæ€§ï¼Œé»˜è®¤æ˜¯24å°æ—¶ã€‚<br>ä½†æ˜¯ï¼Œæˆ‘çš„é›†ç¾¤ç¯å¢ƒåˆ›å»ºæˆåŠŸåï¼Œmasterè™šæ‹Ÿæœºå¯åŠ¨åk8sè‡ªåŠ¨è¿è¡Œï¼Œworkerè™šæ‹Ÿæœºå¯åŠ¨åè‡ªåŠ¨<br>è¿æ¥åˆ°masterï¼Œä¸€ä¸ªå¤šæ˜ŸæœŸäº†è¿˜æ˜¯è¿™æ ·ï¼Œå¥½åƒtokenæ°¸è¿œä¸ä¼šè¿‡æœŸï¼Œä¸ºä»€ä¹ˆï¼Ÿ<br><br>Q2ï¼šæ˜¯å¦éœ€è¦æ¸…ç†ç¯å¢ƒï¼Œæœ‰ä¸€é”®æ¸…é™¤çš„å‘½ä»¤å—ï¼Ÿ<br>è€å¸ˆçš„è§†é¢‘ï¼Œæ¯ä¸€ä¸ªè§†é¢‘çš„ç¯å¢ƒéƒ½æ˜¯å¹²å‡€çš„ï¼Œå’Œå…¶ä»–è§†é¢‘æ— å…³ã€‚<br>è€Œæˆ‘çš„æ“ä½œä¸æ˜¯è¿™æ ·ã€‚æˆ‘çš„æ“ä½œæ˜¯ï¼šæ¯ä¸€è®²éƒ½åœ¨åŒä¸€ä¸ªé›†ç¾¤ç¯å¢ƒä¸­æ“ä½œï¼Œæ“ä½œä¹‹å‰ä¹Ÿæ²¡æœ‰æ¸…ç†<br>ä»¥å‰çš„ä¸œè¥¿ï¼Œæ¯”å¦‚ä»¥å‰åˆ›å»ºçš„PODã€deployç­‰éƒ½å­˜åœ¨ã€‚è¿™ç§æ“ä½œæ–¹æ³•ä¸å¥½å§ï¼Œåº”è¯¥æ¸…ç†å§ã€‚<br><br>å¦‚æœéœ€è¦æ¸…ç†ï¼Œæœ‰ä¸€é”®æ¸…é™¤çš„å‘½ä»¤å—ï¼Ÿè¿˜æ˜¯éœ€è¦é€ä¸ªåˆ é™¤ï¼Ÿæ¯”å¦‚é€ä¸ªæŸ¥çœ‹cmã€dsã€PODç­‰ã€‚<br><br>Q3ï¼šServiceä»£ç†PODåï¼Œç”¨execè¿›å…¥PODï¼Œå†ç”¨curlè®¿é—®ã€‚<br>è¯·é—®ï¼šä¸ºä»€ä¹ˆæ˜¯è¿›å…¥PODï¼ŒServiceä»£ç†PODï¼ŒæŒ‰é“ç†åº”è¯¥æ˜¯è¿›å…¥Serviceå‘€ã€‚<br><br>Q4ï¼šåˆ é™¤serviceçš„æ—¶å€™ï¼Œä¹Ÿå¿…é¡»åˆ é™¤deployå—ï¼Ÿ<br>è§†é¢‘ä¸­çš„åˆ é™¤æ–¹æ³•æ˜¯ï¼š kubectl delete -f deploy.yml -f svc.ymlï¼Œ<br>æœ‰ä¸¤ä¸ªå­é—®é¢˜ï¼š<br>ç¬¬ä¸€ï¼Œè¿™é‡Œçš„deploy.ymlåº”è¯¥æ˜¯å¯¹åº”svc.ymlå§ï¼Œå°±æ˜¯è¯´svc.ymlåˆ›å»ºçš„serviceï¼Œ<br>ä»£ç†çš„PODæ˜¯ç”±deploy.ymlåˆ›å»ºå‡ºæ¥çš„ï¼Œå¯¹å§ã€‚<br><br>å¦å¤–ï¼Œå¯ä»¥åªåˆ é™¤serviceè€Œä¸åˆ é™¤serviceä»£ç†çš„PODå—ï¼Ÿ<br><br>Q5ï¼šä¸¤ç§åˆ é™¤æ–¹æ³•éƒ½å¯ä»¥å—ï¼Ÿ<br>ç¬¬ä¸€ç§ï¼škubectl delete delploy xxx<br>ç¬¬äºŒç§ï¼škubctl delete -f deploy.yml<br>ç¬¬ä¸€ç§æ–¹æ³•ä¸­çš„xxxæ˜¯ç¬¬äºŒç§æ–¹æ³•ä¸­çš„ deploy.ymlåˆ›å»ºå‡ºæ¥çš„ã€‚<br>è¿™ä¸¤ç§æ–¹æ³•éƒ½å¯ä»¥å—ï¼Ÿ è€Œä¸”ï¼Œå¥½åƒæ‰€æœ‰çš„å¯¹è±¡éƒ½æœ‰è¿™ä¸¤ç§åˆ é™¤æ–¹æ³•ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: <br>1.åº”è¯¥æ˜¯æœ‰æ—¶æ•ˆçš„ï¼Œç°åœ¨ä¹Ÿè®¸å˜äº†ï¼Ÿä¸ç¡®å®šã€‚<br><br>2.å¦‚æœéƒ½æ˜¯ç”¨YAML éƒ¨ç½²çš„ï¼Œå¯ä»¥ç”¨â€œdelete -f . â€æ¥åˆ é™¤æ‰€æœ‰å¯¹è±¡ã€‚<br><br>3.å› ä¸ºåŸŸåã€IPåœ°å€éƒ½æ˜¯åœ¨Kubernetesé‡Œçš„ï¼Œå¤–ç•Œè®¿é—®ä¸äº†ï¼Œè¿›podå°±å¯ä»¥äº†ã€‚Serviceæ˜¯ä¸ªè™šåœ°å€ï¼Œæ— æ³•è¿›å…¥ï¼Œåªæœ‰podæ˜¯å®ä½“ã€‚<br><br>4.ä¸å¿…è¦ï¼ŒServiceå’ŒDeploymentæ˜¯å½¼æ­¤ç‹¬ç«‹çš„ï¼Œæˆ‘æ˜¯ä¸ºäº†çœäº‹è¿ç»­åˆ é™¤ã€‚<br><br>5.å½“ç„¶å¯ä»¥ï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯æ‰¾åˆ°ç›¸åº”çš„podã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-12 15:30:15</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/4c/f4/8eda0b19.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>åƒé¸¡åƒé¸¡</span>
  </div>
  <div class="_2_QraFYR_0">å¦‚æœIngress Controllerçš„serviceæ¢æˆäº‘å‚å•†slb&#47;albï¼Œé‚£ä¹ˆå…¥å£æœåŠ¡å‘ç°èƒ½çš„é‡ä»»å°±åœ¨è´Ÿè½½å‡è¡¡äº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: yes</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-07 19:03:32</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a3/49/4a488f4c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å†œæ°‘å›­ä¸</span>
  </div>
  <div class="_2_QraFYR_0">å…«. æ­å»º WordPress ç½‘ç«™ <br>è®¿é—®http:&#47;&#47;wp.test&#47;è¿›å…¥å®‰è£…é¡µé¢ï¼Œä½†æ˜¯ä¹‹åç™»å½•æµè§ˆå™¨æ˜¾ç¤ºè·³è½¬åˆ°ä»¥ä¸‹è¿æ¥æ—¶ï¼š<br>http:&#47;&#47;wp.test&#47;wp-login.php?redirect_to=http%3A%2F%2Fwp.test%2Fwp-admin%2F&amp;reauth=1<br>æ²¡æœ‰ç™»å½•ï¼Œè¿˜æ˜¯åœåœ¨ç™»å½•ç•Œé¢ï¼Œç”¨æˆ·åå’Œå¯†ç éƒ½è¾“å¯¹äº†ã€‚<br>è¯·æ•™è¿™æ˜¯ä¸Šé¢é—®é¢˜ï¼Ÿ<br>è¿˜æœ‰å°±æ˜¯å®¿ä¸»æœºçš„hostså°†wp.hostä¸å…¶ä¸­1ä¸ªèŠ‚ç‚¹ç»‘å®šï¼Œè¿˜æ˜¯ä»»æ„1ä¸ªèŠ‚ç‚¹éƒ½å¯ä»¥ï¼Œå®éªŒå‘ç°å¥½åƒåªèƒ½ç»‘å®šå…¶ä¸­1ä¸ªèŠ‚ç‚¹ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸ªå¥½åƒæ˜¯WordPressç¨‹åºè·³è½¬çš„åŸå› ï¼Œä¸äº†è§£å®ƒçš„ç”¨æ³•ï¼Œæ‰€ä»¥ä¸çŸ¥é“æ”¹æ€ä¹ˆè§£å†³ã€‚<br><br>å¥½åœ¨ä¸å½±å“æˆ‘ä»¬å­¦ä¹ Kubernetesï¼Œåªè¦WordPressè·‘èµ·æ¥ï¼Œå°±è¯æ˜Kuberneteséƒ¨ç½²æˆåŠŸï¼Œå‰©ä¸‹æ˜¯åº”ç”¨å±‚é¢çš„é—®é¢˜ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-14 10:13:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/1b/44/82acaafc.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ— ä¸º</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆæ‚¨å¥½, æ‚¨çš„è¯¾ç¨‹éå¸¸çš„æ˜“å­¦.<br>æˆ‘æœ‰ä¸€ä¸ªé—®é¢˜, æˆ‘æœ¬åœ°çš„ kubeadm å¹¶æ²¡æœ‰ä½¿ç”¨docker images çš„é•œåƒ, æ˜¯æˆ‘æ¼äº†ä»€ä¹ˆæ­¥éª¤å—?</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè§‰é—®é¢˜æ²¡æœ‰å¤ªè¯´æ¸…æ¥šï¼Œæ²¡èƒ½ç†è§£ï¼Œsorryã€‚<br><br>kubeadmå®‰è£…æ˜¯å¿…é¡»è¦æ‹‰å–é•œåƒçš„ï¼Œå¦‚æœèƒ½ç›´æ¥è®¿é—®gcr.ioï¼Œå°±å¯ä»¥ä¸ç”¨è„šæœ¬ï¼Œç›´æ¥kubeadmè‡ªå·±å°±èƒ½æ‹‰å–é•œåƒå®‰è£…äº†ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-04 11:37:22</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>MonsterCale</span>
  </div>
  <div class="_2_QraFYR_0">workerèŠ‚ç‚¹kubeadm joinä¹‹åï¼ŒworkerèŠ‚ç‚¹ä¸Škubectl get nodesèƒ½çœ‹åˆ°masterã€workerèŠ‚ç‚¹éƒ½Readyäº†ï¼ŒmasterèŠ‚ç‚¹kubectl get nodesåªèƒ½çœ‹åˆ°masterèŠ‚ç‚¹çœ‹ä¸åˆ°workerèŠ‚ç‚¹ï¼Œè¿™æ˜¯ä¸ºä»€ä¹ˆ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸ªä¸åº”è¯¥å•Šï¼ŒæŠŠworkeråˆ é™¤é‡è£…è¯•è¯•å§ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-10-09 09:21:04</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1a/5a/cd/8710ed11.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¤§å¸ˆå…„</span>
  </div>
  <div class="_2_QraFYR_0">å¯¹æ¯”äº†ç›¸å…³gitä¸Šçš„æ–‡ä»¶ï¼Œé‡æ–°å¼„äº†ä¸€æ¬¡ï¼Œè®¿é—® wp.test  è¿”å›é”™è¯¯ä¿¡æ¯:<br>Error establishing a database connectionï¼Œæ˜¯å¦è¿˜éœ€è¦å…¶ä»–å†…å®¹è°ƒæ•´ï¼Œç›®å‰æ˜¯ç”¨äº†gitä¸Šçš„yamlï¼Œè·Ÿç€è§†é¢‘éƒ¨ç½²äº†ä¸€é</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åº”è¯¥æ˜¯WordPressæ²¡èƒ½å¤Ÿæ­£ç¡®è¿æ¥MariaDBï¼Œè¦çœ‹MariaDB ServiceåŸŸåï¼Œåœ¨WordPressé‡Œæ­£ç¡®é…ç½®ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-09-02 23:50:39</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/23/81/3865297c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é¾™ä¹‹å¤§è€…</span>
  </div>
  <div class="_2_QraFYR_0">workèŠ‚ç‚¹ä¸Šé¢ï¼Œjoinåˆ°é›†ç¾¤æˆåŠŸåï¼Œè¿è¡Œkubectl get nodesï¼ŒæŠ¥é”™å¦‚ä¸‹<br>Unable to connect to the server: dial tcp 192.168.49.2:8443: connect: no route to host<br><br>masterèŠ‚ç‚¹ä¸Šé¢kubectl get nodesï¼Œå¯ä»¥çœ‹åˆ°masterå’Œworkerï¼ŒworkçŠ¶æ€not ready</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åº”è¯¥æ˜¯workerèŠ‚ç‚¹ä¸Šæ²¡æœ‰æ‹·è´kubectlçš„configæ–‡ä»¶å§ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-17 11:44:00</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/9c/5e/80bbb02c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>BROOKS</span>
  </div>
  <div class="_2_QraFYR_0">æœ‰ç”¨ oh my zsh çš„å—ï¼Œåœ¨ ~&#47;.zshrc ä¸­å®šä¹‰äº† export out=&quot;--dry-run=client -o yaml&quot;ï¼Œä½¿ç”¨å‘½ä»¤å¯¼å‡ºæ¨¡æ¿æ—¶ä¼šæç¤ºï¼š<br>error: Invalid dry-run value (client -o yaml). Must be &quot;none&quot;, &quot;server&quot;, or &quot;client&quot;.</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æŸ¥ä¸€ä¸‹zshçš„å¸®åŠ©å§ï¼Œå¯èƒ½å˜é‡çš„ç”¨æ³•å’Œbash ä¸ä¸€æ ·ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-16 12:55:35</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/0c/86/8e52afb8.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>èŠ±èŠ±å¤§è„¸çŒ«</span>
  </div>
  <div class="_2_QraFYR_0">æœ‰ä¸€ä¸ªå¥‡æ€ªçš„é—®é¢˜ï¼šsudo vi &#47;etc&#47;hostnameå·²ç»è¦æ±‚æ”¹æˆmasteräº†ï¼Œå¹¶ä¸”å‘½ä»¤è¡Œhostnameæ˜¾å¼çš„ä¹Ÿæ˜¯masterï¼Œä½†æ˜¯é€šè¿‡kubectl get node è·å–åˆ°çš„nameè¿˜æ˜¯ä¿®æ”¹ä¹‹å‰çš„åç§°ï¼ï¼</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¯•ç€é‡å¯ä¸€ä¸‹ä¸»æœºè¯•è¯•ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-15 22:04:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKvNozkiaiao1IyuCzEIMPiaNicB1hgEcad3X4DS6IAq5lnOiagf2690Q7Q1RmyBN89gNqYHeHHtY2RcqQ/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¢¨é¾™</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®è€å¸ˆï¼Œä¸ºä»€ä¹ˆreplicas=2çš„deploymentåˆ›å»ºç¬¬äºŒä¸ªpodçš„æ—¶å€™é‚£ä¹ˆæ…¢ï¼Œä½†æ˜¯scaleåˆ°replicas=5æ“ä½œæ—¶podå‡ ä¹ç§’æ‰©å®¹åˆ°äº†5ä¸ªï¼Ÿè°¢è°¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯èƒ½æ˜¯ç¬¬äºŒä¸ªpodè°ƒåº¦åˆ°äº†å¦å¤–ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ­£åœ¨æ‹‰å–é•œåƒã€‚ä¹‹åå› ä¸ºèŠ‚ç‚¹ä¸Šéƒ½æœ‰é•œåƒï¼Œæ‰€ä»¥å®¹å™¨çš„å¯åŠ¨å°±å¾ˆå¿«äº†ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-13 22:46:38</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/2e/09/d0/8609bddc.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æˆ’è´ªå—”ç—´</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆè¿™è¾¹æœ‰æ²¡æœ‰æ¼”ç¤ºçš„ymlæ–‡ä»¶åœ°å€ï¼Œæƒ³è·Ÿç€æ“ç»ƒä¸€ç•ªï¼ŒğŸ«£</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: éƒ½åœ¨GitHubä¸Šï¼Œçœ‹è¯¾å‰å‡†å¤‡é‚£ä¸€èŠ‚ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-08-12 16:38:21</div>
  </div>
</div>
</div>
</li>
</ul>