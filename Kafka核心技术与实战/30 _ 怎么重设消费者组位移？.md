<audio title="30 _ æ€ä¹ˆé‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»ï¼Ÿ" src="https://static001.geekbang.org/resource/audio/3e/80/3e8e22ac6fc3f1038bbb44199f7f6d80.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯èƒ¡å¤•ã€‚ä»Šå¤©æˆ‘è¦è·Ÿä½ åˆ†äº«çš„ä¸»é¢˜æ˜¯ï¼šå¦‚ä½•é‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»ã€‚</p><h2>ä¸ºä»€ä¹ˆè¦é‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»ï¼Ÿ</h2><p>æˆ‘ä»¬çŸ¥é“ï¼ŒKafkaå’Œä¼ ç»Ÿçš„æ¶ˆæ¯å¼•æ“åœ¨è®¾è®¡ä¸Šæ˜¯æœ‰å¾ˆå¤§åŒºåˆ«çš„ï¼Œå…¶ä¸­ä¸€ä¸ªæ¯”è¾ƒæ˜¾è‘—çš„åŒºåˆ«å°±æ˜¯ï¼ŒKafkaçš„æ¶ˆè´¹è€…è¯»å–æ¶ˆæ¯æ˜¯å¯ä»¥é‡æ¼”çš„ï¼ˆreplayableï¼‰ã€‚</p><p>åƒRabbitMQæˆ–ActiveMQè¿™æ ·çš„ä¼ ç»Ÿæ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒä»¬å¤„ç†å’Œå“åº”æ¶ˆæ¯çš„æ–¹å¼æ˜¯ç ´åæ€§çš„ï¼ˆdestructiveï¼‰ï¼Œå³ä¸€æ—¦æ¶ˆæ¯è¢«æˆåŠŸå¤„ç†ï¼Œå°±ä¼šè¢«ä»Brokerä¸Šåˆ é™¤ã€‚</p><p>åè§‚Kafkaï¼Œç”±äºå®ƒæ˜¯åŸºäºæ—¥å¿—ç»“æ„ï¼ˆlog-basedï¼‰çš„æ¶ˆæ¯å¼•æ“ï¼Œæ¶ˆè´¹è€…åœ¨æ¶ˆè´¹æ¶ˆæ¯æ—¶ï¼Œä»…ä»…æ˜¯ä»ç£ç›˜æ–‡ä»¶ä¸Šè¯»å–æ•°æ®è€Œå·²ï¼Œæ˜¯åªè¯»çš„æ“ä½œï¼Œå› æ­¤æ¶ˆè´¹è€…ä¸ä¼šåˆ é™¤æ¶ˆæ¯æ•°æ®ã€‚åŒæ—¶ï¼Œç”±äºä½ç§»æ•°æ®æ˜¯ç”±æ¶ˆè´¹è€…æ§åˆ¶çš„ï¼Œå› æ­¤å®ƒèƒ½å¤Ÿå¾ˆå®¹æ˜“åœ°ä¿®æ”¹ä½ç§»çš„å€¼ï¼Œå®ç°é‡å¤æ¶ˆè´¹å†å²æ•°æ®çš„åŠŸèƒ½ã€‚</p><p>å¯¹äº†ï¼Œä¹‹å‰æœ‰å¾ˆå¤šåŒå­¦åœ¨ä¸“æ çš„ç•™è¨€åŒºæé—®ï¼šåœ¨å®é™…ä½¿ç”¨åœºæ™¯ä¸­ï¼Œæˆ‘è¯¥å¦‚ä½•ç¡®å®šæ˜¯ä½¿ç”¨ä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œè¿˜æ˜¯ä½¿ç”¨Kafkaå‘¢ï¼Ÿæˆ‘åœ¨è¿™é‡Œç»Ÿä¸€å›ç­”ä¸€ä¸‹ã€‚å¦‚æœåœ¨ä½ çš„åœºæ™¯ä¸­ï¼Œæ¶ˆæ¯å¤„ç†é€»è¾‘éå¸¸å¤æ‚ï¼Œå¤„ç†ä»£ä»·å¾ˆé«˜ï¼ŒåŒæ—¶ä½ åˆä¸å…³å¿ƒæ¶ˆæ¯ä¹‹é—´çš„é¡ºåºï¼Œé‚£ä¹ˆä¼ ç»Ÿçš„æ¶ˆæ¯ä¸­é—´ä»¶æ˜¯æ¯”è¾ƒåˆé€‚çš„ï¼›åä¹‹ï¼Œå¦‚æœä½ çš„åœºæ™¯éœ€è¦è¾ƒé«˜çš„ååé‡ï¼Œä½†æ¯æ¡æ¶ˆæ¯çš„å¤„ç†æ—¶é—´å¾ˆçŸ­ï¼ŒåŒæ—¶ä½ åˆå¾ˆåœ¨æ„æ¶ˆæ¯çš„é¡ºåºï¼Œæ­¤æ—¶ï¼ŒKafkaå°±æ˜¯ä½ çš„é¦–é€‰ã€‚</p><!-- [[[read_end]]] --><h2>é‡è®¾ä½ç§»ç­–ç•¥</h2><p>ä¸è®ºæ˜¯å“ªç§è®¾ç½®æ–¹å¼ï¼Œé‡è®¾ä½ç§»å¤§è‡´å¯ä»¥ä»ä¸¤ä¸ªç»´åº¦æ¥è¿›è¡Œã€‚</p><ol>
<li>ä½ç§»ç»´åº¦ã€‚è¿™æ˜¯æŒ‡æ ¹æ®ä½ç§»å€¼æ¥é‡è®¾ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç›´æ¥æŠŠæ¶ˆè´¹è€…çš„ä½ç§»å€¼é‡è®¾æˆæˆ‘ä»¬ç»™å®šçš„ä½ç§»å€¼ã€‚</li>
<li>æ—¶é—´ç»´åº¦ã€‚æˆ‘ä»¬å¯ä»¥ç»™å®šä¸€ä¸ªæ—¶é—´ï¼Œè®©æ¶ˆè´¹è€…æŠŠä½ç§»è°ƒæ•´æˆå¤§äºè¯¥æ—¶é—´çš„æœ€å°ä½ç§»ï¼›ä¹Ÿå¯ä»¥ç»™å‡ºä¸€æ®µæ—¶é—´é—´éš”ï¼Œæ¯”å¦‚30åˆ†é’Ÿå‰ï¼Œç„¶åè®©æ¶ˆè´¹è€…ç›´æ¥å°†ä½ç§»è°ƒå›30åˆ†é’Ÿä¹‹å‰çš„ä½ç§»å€¼ã€‚</li>
</ol><p>ä¸‹é¢çš„è¿™å¼ è¡¨æ ¼ç½—åˆ—äº†7ç§é‡è®¾ç­–ç•¥ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘æ¥è¯¦ç»†è§£é‡Šä¸‹è¿™äº›ç­–ç•¥ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/ac/6a/ac093597e8dbef3b1f832f24c125fc6a.jpg?wh=3853*1962" alt=""></p><p>Earliestç­–ç•¥è¡¨ç¤ºå°†ä½ç§»è°ƒæ•´åˆ°ä¸»é¢˜å½“å‰æœ€æ—©ä½ç§»å¤„ã€‚è¿™ä¸ªæœ€æ—©ä½ç§»ä¸ä¸€å®šå°±æ˜¯0ï¼Œå› ä¸ºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾ˆä¹…è¿œçš„æ¶ˆæ¯ä¼šè¢«Kafkaè‡ªåŠ¨åˆ é™¤ï¼Œæ‰€ä»¥å½“å‰æœ€æ—©ä½ç§»å¾ˆå¯èƒ½æ˜¯ä¸€ä¸ªå¤§äº0çš„å€¼ã€‚<strong>å¦‚æœä½ æƒ³è¦é‡æ–°æ¶ˆè´¹ä¸»é¢˜çš„æ‰€æœ‰æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨Earliestç­–ç•¥</strong>ã€‚</p><p>Latestç­–ç•¥è¡¨ç¤ºæŠŠä½ç§»é‡è®¾æˆæœ€æ–°æœ«ç«¯ä½ç§»ã€‚å¦‚æœä½ æ€»å…±å‘æŸä¸ªä¸»é¢˜å‘é€äº†15æ¡æ¶ˆæ¯ï¼Œé‚£ä¹ˆæœ€æ–°æœ«ç«¯ä½ç§»å°±æ˜¯15ã€‚<strong>å¦‚æœä½ æƒ³è·³è¿‡æ‰€æœ‰å†å²æ¶ˆæ¯ï¼Œæ‰“ç®—ä»æœ€æ–°çš„æ¶ˆæ¯å¤„å¼€å§‹æ¶ˆè´¹çš„è¯ï¼Œå¯ä»¥ä½¿ç”¨Latestç­–ç•¥ã€‚</strong></p><p>Currentç­–ç•¥è¡¨ç¤ºå°†ä½ç§»è°ƒæ•´æˆæ¶ˆè´¹è€…å½“å‰æäº¤çš„æœ€æ–°ä½ç§»ã€‚æœ‰æ—¶å€™ä½ å¯èƒ½ä¼šç¢°åˆ°è¿™æ ·çš„åœºæ™¯ï¼šä½ ä¿®æ”¹äº†æ¶ˆè´¹è€…ç¨‹åºä»£ç ï¼Œå¹¶é‡å¯äº†æ¶ˆè´¹è€…ï¼Œç»“æœå‘ç°ä»£ç æœ‰é—®é¢˜ï¼Œä½ éœ€è¦å›æ»šä¹‹å‰çš„ä»£ç å˜æ›´ï¼ŒåŒæ—¶ä¹Ÿè¦æŠŠä½ç§»é‡è®¾åˆ°æ¶ˆè´¹è€…é‡å¯æ—¶çš„ä½ç½®ï¼Œé‚£ä¹ˆï¼ŒCurrentç­–ç•¥å°±å¯ä»¥å¸®ä½ å®ç°è¿™ä¸ªåŠŸèƒ½ã€‚</p><p>è¡¨ä¸­ç¬¬4è¡Œçš„Specified-Offsetç­–ç•¥åˆ™æ˜¯æ¯”è¾ƒé€šç”¨çš„ç­–ç•¥ï¼Œè¡¨ç¤ºæ¶ˆè´¹è€…æŠŠä½ç§»å€¼è°ƒæ•´åˆ°ä½ æŒ‡å®šçš„ä½ç§»å¤„ã€‚<strong>è¿™ä¸ªç­–ç•¥çš„å…¸å‹ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œæ¶ˆè´¹è€…ç¨‹åºåœ¨å¤„ç†æŸæ¡é”™è¯¯æ¶ˆæ¯æ—¶ï¼Œä½ å¯ä»¥æ‰‹åŠ¨åœ°â€œè·³è¿‡â€æ­¤æ¶ˆæ¯çš„å¤„ç†</strong>ã€‚åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‡ºç°corruptedæ¶ˆæ¯æ— æ³•è¢«æ¶ˆè´¹çš„æƒ…å½¢ï¼Œæ­¤æ—¶æ¶ˆè´¹è€…ç¨‹åºä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œæ— æ³•ç»§ç»­å·¥ä½œã€‚ä¸€æ—¦ç¢°åˆ°è¿™ä¸ªé—®é¢˜ï¼Œä½ å°±å¯ä»¥å°è¯•ä½¿ç”¨Specified-Offsetç­–ç•¥æ¥è§„é¿ã€‚</p><p>å¦‚æœè¯´Specified-Offsetç­–ç•¥è¦æ±‚ä½ æŒ‡å®šä½ç§»çš„<strong>ç»å¯¹æ•°å€¼</strong>çš„è¯ï¼Œé‚£ä¹ˆShift-By-Nç­–ç•¥æŒ‡å®šçš„å°±æ˜¯ä½ç§»çš„<strong>ç›¸å¯¹æ•°å€¼</strong>ï¼Œå³ä½ ç»™å‡ºè¦è·³è¿‡çš„ä¸€æ®µæ¶ˆæ¯çš„è·ç¦»å³å¯ã€‚è¿™é‡Œçš„â€œè·³â€æ˜¯åŒå‘çš„ï¼Œä½ æ—¢å¯ä»¥å‘å‰â€œè·³â€ï¼Œä¹Ÿå¯ä»¥å‘åâ€œè·³â€ã€‚æ¯”å¦‚ï¼Œä½ æƒ³æŠŠä½ç§»é‡è®¾æˆå½“å‰ä½ç§»çš„å‰100æ¡ä½ç§»å¤„ï¼Œæ­¤æ—¶ä½ éœ€è¦æŒ‡å®šNä¸º-100ã€‚</p><p>åˆšåˆšè®²åˆ°çš„è¿™å‡ ç§ç­–ç•¥éƒ½æ˜¯ä½ç§»ç»´åº¦çš„ï¼Œä¸‹é¢æˆ‘ä»¬æ¥èŠèŠä»æ—¶é—´ç»´åº¦é‡è®¾ä½ç§»çš„DateTimeå’ŒDurationç­–ç•¥ã€‚</p><p>DateTimeå…è®¸ä½ æŒ‡å®šä¸€ä¸ªæ—¶é—´ï¼Œç„¶åå°†ä½ç§»é‡ç½®åˆ°è¯¥æ—¶é—´ä¹‹åçš„æœ€æ—©ä½ç§»å¤„ã€‚å¸¸è§çš„ä½¿ç”¨åœºæ™¯æ˜¯ï¼Œä½ æƒ³é‡æ–°æ¶ˆè´¹æ˜¨å¤©çš„æ•°æ®ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨è¯¥ç­–ç•¥é‡è®¾ä½ç§»åˆ°æ˜¨å¤©0ç‚¹ã€‚</p><p>Durationç­–ç•¥åˆ™æ˜¯æŒ‡ç»™å®šç›¸å¯¹çš„æ—¶é—´é—´éš”ï¼Œç„¶åå°†ä½ç§»è°ƒæ•´åˆ°è·ç¦»å½“å‰ç»™å®šæ—¶é—´é—´éš”çš„ä½ç§»å¤„ï¼Œå…·ä½“æ ¼å¼æ˜¯PnDTnHnMnSã€‚å¦‚æœä½ ç†Ÿæ‚‰Java 8å¼•å…¥çš„Durationç±»çš„è¯ï¼Œä½ åº”è¯¥ä¸ä¼šå¯¹è¿™ä¸ªæ ¼å¼æ„Ÿåˆ°é™Œç”Ÿã€‚å®ƒå°±æ˜¯ä¸€ä¸ªç¬¦åˆISO-8601è§„èŒƒçš„Durationæ ¼å¼ï¼Œä»¥å­—æ¯På¼€å¤´ï¼Œåé¢ç”±4éƒ¨åˆ†ç»„æˆï¼Œå³Dã€Hã€Må’ŒSï¼Œåˆ†åˆ«è¡¨ç¤ºå¤©ã€å°æ—¶ã€åˆ†é’Ÿå’Œç§’ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œå¦‚æœä½ æƒ³å°†ä½ç§»è°ƒå›åˆ°15åˆ†é’Ÿå‰ï¼Œé‚£ä¹ˆä½ å°±å¯ä»¥æŒ‡å®šPT0H15M0Sã€‚</p><p>æˆ‘ä¼šåœ¨åé¢åˆ†åˆ«ç»™å‡ºè¿™7ç§é‡è®¾ç­–ç•¥çš„å®ç°æ–¹å¼ã€‚ä¸è¿‡åœ¨æ­¤ä¹‹å‰ï¼Œæˆ‘å…ˆæ¥è¯´ä¸€ä¸‹é‡è®¾ä½ç§»çš„æ–¹æ³•ã€‚ç›®å‰ï¼Œé‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»çš„æ–¹å¼æœ‰ä¸¤ç§ã€‚</p><ul>
<li>é€šè¿‡æ¶ˆè´¹è€…APIæ¥å®ç°ã€‚</li>
<li>é€šè¿‡kafka-consumer-groupså‘½ä»¤è¡Œè„šæœ¬æ¥å®ç°ã€‚</li>
</ul><h2>æ¶ˆè´¹è€…APIæ–¹å¼è®¾ç½®</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹å¦‚ä½•é€šè¿‡APIçš„æ–¹å¼æ¥é‡è®¾ä½ç§»ã€‚æˆ‘ä¸»è¦ä»¥Java APIä¸ºä¾‹è¿›è¡Œæ¼”ç¤ºã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯å…¶ä»–è¯­è¨€ï¼Œæ–¹æ³•åº”è¯¥æ˜¯ç±»ä¼¼çš„ï¼Œä¸è¿‡ä½ è¦å‚è€ƒå…·ä½“çš„APIæ–‡æ¡£ã€‚</p><p>é€šè¿‡Java APIçš„æ–¹å¼æ¥é‡è®¾ä½ç§»ï¼Œä½ éœ€è¦è°ƒç”¨KafkaConsumerçš„seekæ–¹æ³•ï¼Œæˆ–è€…æ˜¯å®ƒçš„å˜ç§æ–¹æ³•seekToBeginningå’ŒseekToEndã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹å®ƒä»¬çš„æ–¹æ³•ç­¾åã€‚</p><pre><code>void seek(TopicPartition partition, long offset);
void seek(TopicPartition partition, OffsetAndMetadata offsetAndMetadata);
void seekToBeginning(Collection&lt;TopicPartition&gt; partitions);
void seekToEnd(Collection&lt;TopicPartition&gt; partitions);
</code></pre><p>æ ¹æ®æ–¹æ³•çš„å®šä¹‰ï¼Œæˆ‘ä»¬å¯ä»¥çŸ¥é“ï¼Œæ¯æ¬¡è°ƒç”¨seekæ–¹æ³•åªèƒ½é‡è®¾ä¸€ä¸ªåˆ†åŒºçš„ä½ç§»ã€‚OffsetAndMetadataç±»æ˜¯ä¸€ä¸ªå°è£…äº†Longå‹çš„ä½ç§»å’Œè‡ªå®šä¹‰å…ƒæ•°æ®çš„å¤åˆç±»ï¼Œåªæ˜¯ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè‡ªå®šä¹‰å…ƒæ•°æ®ä¸ºç©ºï¼Œå› æ­¤ä½ åŸºæœ¬ä¸Šå¯ä»¥è®¤ä¸ºè¿™ä¸ªç±»è¡¨å¾çš„ä¸»è¦æ˜¯æ¶ˆæ¯çš„ä½ç§»å€¼ã€‚seekçš„å˜ç§æ–¹æ³•seekToBeginningå’ŒseekToEndåˆ™æ‹¥æœ‰ä¸€æ¬¡é‡è®¾å¤šä¸ªåˆ†åŒºçš„èƒ½åŠ›ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨å®ƒä»¬æ—¶ï¼Œå¯ä»¥ä¸€æ¬¡æ€§ä¼ å…¥å¤šä¸ªä¸»é¢˜åˆ†åŒºã€‚</p><p>å¥½äº†ï¼Œæœ‰äº†è¿™äº›æ–¹æ³•ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€ä¸€åœ°å®ç°ä¸Šé¢æåˆ°çš„7ç§ç­–ç•¥äº†ã€‚æˆ‘ä»¬å…ˆæ¥çœ‹Earliestç­–ç•¥çš„å®ç°æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>Properties consumerProperties = new Properties();
consumerProperties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, false);
consumerProperties.put(ConsumerConfig.GROUP_ID_CONFIG, groupID);
consumerProperties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;);
consumerProperties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
consumerProperties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());
consumerProperties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);

String topic = &quot;test&quot;;  // è¦é‡è®¾ä½ç§»çš„Kafkaä¸»é¢˜ 
try (final KafkaConsumer&lt;String, String&gt; consumer = 
	new KafkaConsumer&lt;&gt;(consumerProperties)) {
         consumer.subscribe(Collections.singleton(topic));
         consumer.poll(0);
         consumer.seekToBeginning(
	consumer.partitionsFor(topic).stream().map(partitionInfo -&gt;          
	new TopicPartition(topic, partitionInfo.partition()))
	.collect(Collectors.toList()));
} 
</code></pre><p>è¿™æ®µä»£ç ä¸­æœ‰å‡ ä¸ªæ¯”è¾ƒå…³é”®çš„éƒ¨åˆ†ï¼Œä½ éœ€è¦æ³¨æ„ä¸€ä¸‹ã€‚</p><ol>
<li>ä½ è¦åˆ›å»ºçš„æ¶ˆè´¹è€…ç¨‹åºï¼Œè¦ç¦æ­¢è‡ªåŠ¨æäº¤ä½ç§»ã€‚</li>
<li>ç»„IDè¦è®¾ç½®æˆä½ è¦é‡è®¾çš„æ¶ˆè´¹è€…ç»„çš„ç»„IDã€‚</li>
<li>è°ƒç”¨seekToBeginningæ–¹æ³•æ—¶ï¼Œéœ€è¦ä¸€æ¬¡æ€§æ„é€ ä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºå¯¹è±¡ã€‚</li>
<li>æœ€é‡è¦çš„æ˜¯ï¼Œä¸€å®šè¦è°ƒç”¨å¸¦é•¿æ•´å‹çš„pollæ–¹æ³•ï¼Œè€Œä¸è¦è°ƒç”¨consumer.poll(Duration.ofSecond(0))ã€‚</li>
</ol><p>è™½ç„¶ç¤¾åŒºå·²ç»ä¸æ¨èä½¿ç”¨poll(long)äº†ï¼Œä½†çŸ­æœŸå†…åº”è¯¥ä¸ä¼šç§»é™¤å®ƒï¼Œæ‰€ä»¥ä½ å¯ä»¥æ”¾å¿ƒä½¿ç”¨ã€‚å¦å¤–ï¼Œä¸ºäº†é¿å…é‡å¤ï¼Œåœ¨åé¢çš„å®ä¾‹ä¸­ï¼Œæˆ‘åªç»™å‡ºæœ€å…³é”®çš„ä»£ç ã€‚</p><p>Latestç­–ç•¥å’ŒEarliestæ˜¯ç±»ä¼¼çš„ï¼Œæˆ‘ä»¬åªéœ€è¦ä½¿ç”¨seekToEndæ–¹æ³•å³å¯ï¼Œå¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼š</p><pre><code>consumer.seekToEnd(
	consumer.partitionsFor(topic).stream().map(partitionInfo -&gt;          
	new TopicPartition(topic, partitionInfo.partition()))
	.collect(Collectors.toList()));
</code></pre><p>å®ç°Currentç­–ç•¥çš„æ–¹æ³•å¾ˆç®€å•ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©KafkaConsumerçš„committedæ–¹æ³•æ¥è·å–å½“å‰æäº¤çš„æœ€æ–°ä½ç§»ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code>consumer.partitionsFor(topic).stream().map(info -&gt; 
	new TopicPartition(topic, info.partition()))
	.forEach(tp -&gt; {
	long committedOffset = consumer.committed(tp).offset();
	consumer.seek(tp, committedOffset);
});
</code></pre><p>è¿™æ®µä»£ç é¦–å…ˆè°ƒç”¨partitionsForæ–¹æ³•è·å–ç»™å®šä¸»é¢˜çš„æ‰€æœ‰åˆ†åŒºï¼Œç„¶åä¾æ¬¡è·å–å¯¹åº”åˆ†åŒºä¸Šçš„å·²æäº¤ä½ç§»ï¼Œæœ€åé€šè¿‡seekæ–¹æ³•é‡è®¾ä½ç§»åˆ°å·²æäº¤ä½ç§»å¤„ã€‚</p><p>å¦‚æœè¦å®ç°Specified-Offsetç­–ç•¥ï¼Œç›´æ¥è°ƒç”¨seekæ–¹æ³•å³å¯ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><pre><code>long targetOffset = 1234L;
for (PartitionInfo info : consumer.partitionsFor(topic)) {
	TopicPartition tp = new TopicPartition(topic, info.partition());
	consumer.seek(tp, targetOffset);
}
</code></pre><p>è¿™æ¬¡æˆ‘æ²¡æœ‰ä½¿ç”¨Java 8 Streamsçš„å†™æ³•ï¼Œå¦‚æœä½ ä¸ç†Ÿæ‚‰Lambdaè¡¨è¾¾å¼ä»¥åŠJava 8çš„Streamsï¼Œè¿™ç§å†™æ³•å¯èƒ½æ›´åŠ ç¬¦åˆä½ çš„ä¹ æƒ¯ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥å®ç°Shift-By-Nç­–ç•¥ï¼Œä¸»ä½“ä»£ç é€»è¾‘å¦‚ä¸‹ï¼š</p><pre><code>for (PartitionInfo info : consumer.partitionsFor(topic)) {
         TopicPartition tp = new TopicPartition(topic, info.partition());
	// å‡è®¾å‘å‰è·³123æ¡æ¶ˆæ¯
         long targetOffset = consumer.committed(tp).offset() + 123L; 
         consumer.seek(tp, targetOffset);
}
</code></pre><p>å¦‚æœè¦å®ç°DateTimeç­–ç•¥ï¼Œæˆ‘ä»¬éœ€è¦å€ŸåŠ©å¦ä¸€ä¸ªæ–¹æ³•ï¼š<strong>KafkaConsumer.</strong>  <strong>offsetsForTimesæ–¹æ³•</strong>ã€‚å‡è®¾æˆ‘ä»¬è¦é‡è®¾ä½ç§»åˆ°2019å¹´6æœˆ20æ—¥æ™šä¸Š8ç‚¹ï¼Œé‚£ä¹ˆå…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p><pre><code>long ts = LocalDateTime.of(
	2019, 6, 20, 20, 0).toInstant(ZoneOffset.ofHours(8)).toEpochMilli();
Map&lt;TopicPartition, Long&gt; timeToSearch = 
         consumer.partitionsFor(topic).stream().map(info -&gt; 
	new TopicPartition(topic, info.partition()))
	.collect(Collectors.toMap(Function.identity(), tp -&gt; ts));

for (Map.Entry&lt;TopicPartition, OffsetAndTimestamp&gt; entry : 
	consumer.offsetsForTimes(timeToSearch).entrySet()) {
consumer.seek(entry.getKey(), entry.getValue().offset());
}
</code></pre><p>è¿™æ®µä»£ç æ„é€ äº†LocalDateTimeå®ä¾‹ï¼Œç„¶ååˆ©ç”¨å®ƒå»æŸ¥æ‰¾å¯¹åº”çš„ä½ç§»å€¼ï¼Œæœ€åè°ƒç”¨seekï¼Œå®ç°äº†é‡è®¾ä½ç§»ã€‚</p><p>æœ€åï¼Œæˆ‘æ¥ç»™å‡ºå®ç°Durationç­–ç•¥çš„ä»£ç ã€‚å‡è®¾æˆ‘ä»¬è¦å°†ä½ç§»è°ƒå›30åˆ†é’Ÿå‰ï¼Œé‚£ä¹ˆä»£ç å¦‚ä¸‹ï¼š</p><pre><code>Map&lt;TopicPartition, Long&gt; timeToSearch = consumer.partitionsFor(topic).stream()
         .map(info -&gt; new TopicPartition(topic, info.partition()))
         .collect(Collectors.toMap(Function.identity(), tp -&gt; System.currentTimeMillis() - 30 * 1000  * 60));

for (Map.Entry&lt;TopicPartition, OffsetAndTimestamp&gt; entry : 
         consumer.offsetsForTimes(timeToSearch).entrySet()) {
         consumer.seek(entry.getKey(), entry.getValue().offset());
}
</code></pre><p><strong>æ€»ä¹‹ï¼Œä½¿ç”¨Java APIçš„æ–¹å¼æ¥å®ç°é‡è®¾ç­–ç•¥çš„ä¸»è¦å…¥å£æ–¹æ³•ï¼Œå°±æ˜¯seekæ–¹æ³•</strong>ã€‚</p><h2>å‘½ä»¤è¡Œæ–¹å¼è®¾ç½®</h2><p>ä½ç§»é‡è®¾è¿˜æœ‰å¦ä¸€ä¸ªé‡è¦çš„é€”å¾„ï¼š<strong>é€šè¿‡kafka-consumer-groupsè„šæœ¬</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªåŠŸèƒ½æ˜¯åœ¨Kafka 0.11ç‰ˆæœ¬ä¸­æ–°å¼•å…¥çš„ã€‚è¿™å°±æ˜¯è¯´ï¼Œå¦‚æœä½ ä½¿ç”¨çš„Kafkaæ˜¯0.11ç‰ˆæœ¬ä¹‹å‰çš„ï¼Œé‚£ä¹ˆä½ åªèƒ½ä½¿ç”¨APIçš„æ–¹å¼æ¥é‡è®¾ä½ç§»ã€‚</p><p>æ¯”èµ·APIçš„æ–¹å¼ï¼Œç”¨å‘½ä»¤è¡Œé‡è®¾ä½ç§»è¦ç®€å•å¾—å¤šã€‚é’ˆå¯¹æˆ‘ä»¬åˆšåˆšè®²è¿‡çš„7ç§ç­–ç•¥ï¼Œæœ‰7ä¸ªå¯¹åº”çš„å‚æ•°ã€‚ä¸‹é¢æˆ‘æ¥ä¸€ä¸€ç»™å‡ºå®ä¾‹ã€‚</p><p>Earliestç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--to-earliest</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --all-topics --to-earliest â€“execute
</code></pre><p>Latestç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--to-latest</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --all-topics --to-latest --execute
</code></pre><p>Currentç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--to-current</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --all-topics --to-current --execute
</code></pre><p>Specified-Offsetç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--to-offset</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --all-topics --to-offset &lt;offset&gt; --execute
</code></pre><p>Shift-By-Nç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--shift-by N</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --shift-by &lt;offset_N&gt; --execute
</code></pre><p>DateTimeç­–ç•¥ç›´æ¥æŒ‡å®š<strong>--to-datetime</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --to-datetime 2019-06-20T20:00:00.000 --execute
</code></pre><p>æœ€åæ˜¯å®ç°Durationç­–ç•¥ï¼Œæˆ‘ä»¬ç›´æ¥æŒ‡å®š<strong>--by-duration</strong>ã€‚</p><pre><code>bin/kafka-consumer-groups.sh --bootstrap-server kafka-host:port --group test-group --reset-offsets --by-duration PT0H30M0S --execute
</code></pre><h2>å°ç»“</h2><p>è‡³æ­¤ï¼Œé‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»çš„2ç§æ–¹å¼æˆ‘éƒ½è®²å®Œäº†ã€‚æˆ‘ä»¬æ¥å°ç»“ä¸€ä¸‹ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬ä¸»è¦è®¨è®ºäº†åœ¨Kafkaä¸­ï¼Œä¸ºä»€ä¹ˆè¦é‡è®¾ä½ç§»ä»¥åŠå¦‚ä½•é‡è®¾æ¶ˆè´¹è€…ç»„ä½ç§»ã€‚é‡è®¾ä½ç§»ä¸»è¦æ˜¯ä¸ºäº†å®ç°æ¶ˆæ¯çš„é‡æ¼”ã€‚ç›®å‰Kafkaæ”¯æŒ7ç§é‡è®¾ç­–ç•¥å’Œ2ç§é‡è®¾æ–¹æ³•ã€‚åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ¨èä½ ä½¿ç”¨ç¬¬2ç§æ–¹æ³•ï¼Œå³ç”¨å‘½ä»¤è¡Œçš„æ–¹å¼æ¥é‡è®¾ä½ç§»ã€‚æ¯•ç«Ÿï¼Œæ‰§è¡Œå‘½ä»¤è¦æ¯”å†™ç¨‹åºå®¹æ˜“å¾—å¤šã€‚ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ0.11åŠ0.11ç‰ˆæœ¬ä¹‹åçš„Kafkaæ‰æä¾›äº†ç”¨å‘½ä»¤è¡Œè°ƒæ•´ä½ç§»çš„æ–¹æ³•ã€‚å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ä¹‹å‰çš„ç‰ˆæœ¬ï¼Œé‚£ä¹ˆå°±åªèƒ½ä¾é APIçš„æ–¹å¼äº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/98/f3/98a7d3f9b0d3050947772d8cd2c4caf3.jpg?wh=2069*2580" alt=""></p><h2>å¼€æ”¾è®¨è®º</h2><p>ä½ åœ¨å®é™…ä½¿ç”¨è¿‡ç¨‹ä¸­ï¼Œæ˜¯å¦é‡åˆ°è¿‡è¦é‡è®¾ä½ç§»çš„åœºæ™¯ï¼Œä½ æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</p><p>æ¬¢è¿å†™ä¸‹ä½ çš„æ€è€ƒå’Œç­”æ¡ˆï¼Œæˆ‘ä»¬ä¸€èµ·è®¨è®ºã€‚å¦‚æœä½ è§‰å¾—æœ‰æ‰€æ”¶è·ï¼Œä¹Ÿæ¬¢è¿æŠŠæ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/16/71/ee/31b19304.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°å¯çˆ±</span>
  </div>
  <div class="_2_QraFYR_0">currentæ˜¯å›åˆ°æœ€è¿‘æäº¤ä½ç§»å¤„ï¼Œä½†æ˜¯æ¶ˆè´¹è€…ä¸æ˜¯æœ¬æ¥å°±ä»æœ€è¿‘æäº¤å¤„ç»§ç»­æ¶ˆè´¹å—</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: currentä¸»è¦æ˜¯ä¸ºäº†è°ƒè¯•åœºæ™¯ã€‚æ¯”å¦‚è¿™æ ·çš„åœºæ™¯ï¼šä½ åœæ‰äº†consumerï¼Œç°åœ¨offset=50ï¼Œç„¶åä¿®æ”¹äº†consumerä»£ç é‡æ–°ä¸Šçº¿ï¼Œconsumerå¼€å§‹ä»50æ¶ˆè´¹ï¼Œè¿è¡Œäº†ä¸€æ®µæ—¶é—´å‘ç°ä½ ä¿®æ”¹çš„ä»£ç æœ‰é—®é¢˜ï¼Œè¿˜è¦ç»§ç»­æ”¹ï¼Œé‚£ä¹ˆä¸‹æ‰consumerï¼Œå°†offsetè°ƒå›currentï¼Œæ”¹ä»£ç ä¹‹åå†ä¸Šçº¿ï¼Œconsumerä»50æ¶ˆè´¹ã€‚æ­¤æ—¶currentç­–ç•¥å°±æ˜¾å¾—å¾ˆæ–¹ä¾¿äº†ï¼Œå¯¹å§ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-29 16:25:20</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/7b/57/a9b04544.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>QQæ€ª</span>
  </div>
  <div class="_2_QraFYR_0">æ¯”è¾ƒæš´åŠ›çš„é‡æ–°å¼€ä¸ªæ¶ˆè´¹ç»„ä»å¤´æ¶ˆè´¹ğŸ˜‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-10 15:18:23</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/17/58/0f/c412b4a9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Curry</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œä¸ºä»€ä¹ˆè¦pollï¼ˆ0ï¼‰ä¸€ä¸‹ï¼Ÿæ˜¯ä¸ºäº†è·å–å…ƒæ•°æ®å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ï¼Œå»æ‹¿å…ƒæ•°æ®</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-05-05 10:20:42</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/c7/52/c5adf218.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å–œæ¬¢åœ°çƒçš„é˜¿åŸ¹åŒå­¦</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œé—®ä¸€ä¸ªé—®é¢˜: <br>åƒRocketMQè¿™æ ·çš„æ¶ˆæ¯å¼•æ“ï¼Œå¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹æŸæ¡æ¶ˆæ¯ä¸€ç›´å¤±è´¥ï¼Œä¼šå°†è¿™æ¡æ¶ˆæ¯æ”¾åˆ° â€œæ­»ä¿¡â€é˜Ÿåˆ—é‡Œï¼Œç„¶åæ¶ˆè´¹è€…ç»§ç»­æ¶ˆè´¹ä¸‹ä¸€æ¡æ¶ˆæ¯ã€‚åœ¨kafkaä¸­ï¼Œå¦‚æœæ¶ˆè´¹è€…æ¶ˆè´¹æŸæ¡æ¶ˆæ¯ä¸€ç›´å¤±è´¥ï¼Œä¼šæ€ä¹ˆå¤„ç†å‘¢ï¼Ÿéš¾é“ç¨‹åºä¼šä¸€ç›´æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ï¼Œç„¶åå¤±è´¥.. ç»§ç»­æ¶ˆè´¹è¿™æ¡æ¶ˆæ¯ .. ç„¶åç»§ç»­å¤±è´¥ ......</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: consumerç«¯å¯ä»¥é€‰æ‹©è·³è¿‡è¯¥æ¶ˆæ¯ã€‚çš„ç¡®è¿™æ–¹é¢Kafkaæ²¡æœ‰æä¾›å¼€ç®±å³ç”¨çš„dead letter queue~</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-05-27 22:03:20</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/d5/db/c45b90c8.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ°´å¤©ä¸€è‰²</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ï¼Œé‡ç½®offsetåˆ° datetimeï¼Œè¿™ä¸ª datetime æ˜¯ç”Ÿäº§æ—¶é—´è¿˜æ˜¯å½“å‰groupçš„æ¶ˆè´¹æ—¶é—´ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ¶ˆæ¯çš„åˆ›å»ºæ—¶é—´</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-12-17 06:09:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/48/f3/f1034ffd.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>cricket1981</span>
  </div>
  <div class="_2_QraFYR_0">&quot;æœ€é‡è¦çš„æ˜¯ï¼Œä¸€å®šè¦è°ƒç”¨å¸¦é•¿æ•´å‹çš„ poll æ–¹æ³•ï¼Œè€Œä¸è¦è°ƒç”¨ consumer.poll(Duration.ofSecond(0))ã€‚&quot;--- èƒ½è®²ä¸‹ä¸ºä»€ä¹ˆå—ï¼Ÿå¦‚æœä¸éµå®ˆä¼šæ€ä¹ˆæ ·ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸¤ä¸ªçš„å®ç°æ–¹å¼ä¸ä¸€æ ·ã€‚è¯¦ç»†è®¾è®¡åŸç†å·®åˆ«å¯ä»¥çœ‹çœ‹ï¼šhttps:&#47;&#47;www.cnblogs.com&#47;huxi2b&#47;p&#47;10773559.html</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-12 09:51:53</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/a8/e2/f8e51df2.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Li Shunduo</span>
  </div>
  <div class="_2_QraFYR_0">è¯•äº†ä¸‹å¼€ç€console consumerçš„æ—¶å€™å»è°ƒæ•´offset,é‡åˆ°ä»¥ä¸‹é”™è¯¯:<br>Error: Assignments can only be reset if the group &#39;test_group&#39; is inactive, but the current state is Stable.<br>åœæ‰console consumerä¹‹åï¼Œå°±å¯ä»¥è°ƒæ•´offsetäº†ã€‚<br>å¥½åƒä¸èƒ½åŠ¨æ€è°ƒæ•´?</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å—¯ï¼Œå¿…é¡»æ˜¯éactiveçš„groupæ‰è¡Œ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-12 18:14:36</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJjBL9wlHaH7GBicT9Gic7VmMNibOowYwpc7q6S6UEpwKcmLJ8I4pibwmwkSNuoORxzzZ3TjWte9wia0jw/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>cuiyunfeng</span>
  </div>
  <div class="_2_QraFYR_0">é‡ç½®ä½ç§»å‰ï¼Œæ‰§è¡Œconsumer.poll()ï¼Œå¯ä»¥è®©kafkaå¼ºåˆ¶æ›´æ–°æ‹…å½“çš„partitionä¿¡æ¯ï¼Œä»¥é˜²æ­¢å‘ç”Ÿkafka rebalanceåpartitionä¿¡æ¯é™ˆæ—§ï¼Œç„¶åå†å–å¾—partitionä¿¡æ¯è¿›è¡Œoffsetä½ç§»ã€‚æˆ–è€…ä¹Ÿå¯ä»¥é…åˆä½¿ç”¨kafka listeneræ¥å¤„ç†å‘ç”Ÿrebalanceæƒ…å†µä¸‹ï¼Œè¿›è¡Œé‡ç½®ä½ç§»ã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-09-06 02:09:46</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/23/ed/a4a774a8.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>What for</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ä¸€ä¸‹è€å¸ˆåœ¨é‡è®¾ä½ç§»ä¹‹å‰ä¸ºä»€ä¹ˆè¦è°ƒç”¨ consumer.poll æ–¹æ³•ï¼Ÿæ˜¯ä¸ºäº†è¿æ¥é›†ç¾¤å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å—¯å—¯ï¼Œä½ å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼Œå…¶å®è¿˜æœ‰å…¶ä»–ä½œç”¨ï¼Œæ¯”å¦‚è·å–é›†ç¾¤ä¿¡æ¯åå°ä¸»é¢˜æ•°æ®ç­‰</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-31 10:42:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/51/0d/fc1652fe.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>James</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆ,ä½ å¥½.å­˜åœ¨ä»¥ä¸‹é—®é¢˜,éº»çƒ¦è§£ç­”ä¸‹:<br>1.å¯¹æ–‡ä¸­è§£é‡Šçš„Latestä¸Currentæ„Ÿè§‰åŒºåˆ†ä¸æ¸…æ¥šï¼Œè€èƒ½èƒ½è¯¦ç»†ä¸¾ä¾‹ä»‹ç»ä¸‹;<br>æ–‡ä¸­æ˜¯ç¦æ­¢æäº¤ä½ç§»,é‚£ä¹ˆè¿™ä¸¤ä¸ªåº”è¯¥éƒ½æ˜¯ä¸€æ ·,æœ€æ–°çš„ä½ç§»ä½ç½®.<br>è¦æ˜¯å¯ä»¥æäº¤ä½ç§»å‘¢;ä¸æ˜¯ç‰¹åˆ«æ‡‚<br>2.ç¬¬ä¸€æ¡è¯„è®ºä¸­,currentä¸»è¦æ˜¯ä¸ºäº†è°ƒè¯•åœºæ™¯,è¦æ˜¯æœ‰æäº¤ä½ç§»(50-&gt;100),é‚£ä¹ˆé‡æ–°ä¸Šçº¿ä½¿ç”¨currentç­–ç•¥,æœ€æ–°æäº¤ä½ç§»æ˜¯ä¸æ˜¯100;</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: Latest ç­–ç•¥è¡¨ç¤ºæŠŠä½ç§»é‡è®¾æˆæœ€æ–°æœ«ç«¯ä½ç§»ï¼Œä¹Ÿå°±æ˜¯LEOã€‚Current ç­–ç•¥è¡¨ç¤ºå°†ä½ç§»è°ƒæ•´æˆæ¶ˆè´¹è€…å½“å‰æäº¤çš„æœ€æ–°ä½ç§»ï¼Œæ˜¯æ¶ˆè´¹è€…å·²ç»æäº¤çš„ä½ç§»ï¼Œåè€…å¿…ç„¶å°äºç­‰äºLEO</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-07-02 01:07:08</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/cd/2a/bdbed6ed.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ— è‡æœ‹å‹</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆ é—®ä¸€ä¸‹ å¦‚æœ æˆ‘æƒ³é’ˆå¯¹æŸä¸ªåˆ†åŒºé‡ç½®ä½ç§»ï¼Œæ€ä¹ˆåš</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: KafkaConsumer.seekæ–¹æ³•æ”¯æŒæŒ‡å®šå•ä¸ªåˆ†åŒºè¿›è¡Œé‡è®¾ä½ç§»</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-09-18 19:24:21</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/93/02/fcab58d1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>JasonZhi</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œä¸æ˜¯è¿˜å¯ä»¥é€šè¿‡auto offset reseté…ç½®é¡¹é‡è®¾ä½ç§»å—ï¼Ÿæ€ä¹ˆè¿™é‡Œæ²¡æœ‰è¯´</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™æ˜¯è¯´çš„æ˜¯æ‰‹åŠ¨è®¾ç½®ä½ç§»çš„æƒ…å†µï¼Œè‡ªåŠ¨è®¾ç½®ä½ç§»æ˜¯Kafkaè‡ªåŠ¨åšçš„ã€‚å½“ç„¶ä¹Ÿç®—æ˜¯é‡è®¾ä½ç§»çš„ä¸€ç§</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-30 09:29:41</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/cd/2a/bdbed6ed.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ— è‡æœ‹å‹</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®è€å¸ˆï¼Œcurrentè¿™ä¸ªé€‰é¡¹çš„åº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¦‚æœä½ ä¸Šçº¿çš„consumerç¨‹åºæœ‰bugï¼Œéœ€è¦é‡æ¼”è‡ªä¸Šçº¿èµ·å¤„ç†è¿‡çš„æ¶ˆæ¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨è¿™ä¸ªç­–ç•¥</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-26 16:45:57</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/ach5TNuIu8T4Of8ibvfWM4JPic5uQn9Y7TgGjBHLp2iar4icxJzs14bpUXV9OdYiciblvJl14zSqXjwtDffHnSTqbD6g/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é”‹èŠ’</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ï¼Œç”¨å‘½ä»¤è¡Œé‡è®¾ä½ç§»ï¼Œåº”è¯¥åœ¨å½“å‰group çš„leader èŠ‚ç‚¹ä¸Šï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸éœ€è¦çš„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-08-23 08:50:51</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/17/58/0f/c412b4a9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Curry</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®å¦‚ä½•ä¸åœæ­¢ç¨‹åºå»æŒ‡å®šä½ç§»å‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ç›®å‰å¯ä»¥é€šè¿‡Consumer APIçš„seekæ–¹æ³•æ¥å®ç°</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-05-05 11:51:09</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7f/ca/ea85bfdd.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>helloworld</span>
  </div>
  <div class="_2_QraFYR_0">è¿™é‡Œçš„--all-topicsæ˜¯ä»€ä¹ˆå«ä¹‰å‘¢ï¼Ÿä¸ºä»€ä¹ˆShift-By-Nã€DateTimeä¸Durationå‡æ²¡æœ‰ï¼Ÿæ˜¯ä¸æ˜¯å¯ä»¥è¿™ä¹ˆè®¤ä¸ºï¼šé€šè¿‡è„šæœ¬çš„æ–¹å¼è®¾ç½®ä½ç§»åªèƒ½è®¾ç½®Topicçš„æ‰€æœ‰ä½ç§»ï¼Œå¹¶ä¸”æ‰€è®¾ç½®çš„ä½ç§»ä¼šä½¿å„ä¸ªåˆ†åŒºéƒ½ä¸€æ ·ï¼Ÿè€Œä¸èƒ½å•ç‹¬è®¾ç½®æŸä¸ªåˆ†åŒºçš„ä½ç§»ï¼Ÿï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä½¿ç”¨consumer-groupså‘½ä»¤å¯ä»¥è®¾ç½®å•ä¸ªåˆ†åŒºçš„ä½ç§»ï¼Œæ–‡ä¸­åªæ˜¯ç”¨--all-topicsä¸¾ä¸ªä¾‹å­ã€‚æ¯”å¦‚æŒ‡å®š--topics topic1:0,1,2</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-16 00:31:25</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/f9/5f/b0a125a9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>chp</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œä¸ºå•¥æˆ‘æŒ‡å®šæ¶ˆè´¹è€…ä½ç§»æ²¡æ•ˆæœ<br>-------------------------------------------------<br>String topic = &quot;foo&quot;;<br>        try (final KafkaConsumer&lt;String, String&gt; consumer =<br>                      new KafkaConsumer&lt;&gt;(consumerProperties)) {<br>            consumer.subscribe(Collections.singleton(topic));<br>            ConsumerRecords consumerRecords = consumer.poll(0);<br>            Iterable&lt;ConsumerRecord&lt;String, String&gt;&gt; iterable = consumerRecords.records(&quot;foo&quot;);<br>            for (Iterator iterator = iterable.iterator(); iterator.hasNext();) {<br>                ConsumerRecord&lt;String, String&gt; consumerRecord = (ConsumerRecord)iterator.next();<br>                log.info(&quot;topic = {}, partition = {}, offset = {}, key = {}, value = {}\n&quot;,<br>                        consumerRecord.topic(), consumerRecord.partition(), consumerRecord.offset(),<br>                        consumerRecord.key(), consumerRecord.value());<br>            }<br>            for (PartitionInfo info : consumer.partitionsFor(topic)) {<br>                TopicPartition tp = new TopicPartition(topic, info.partition());<br>                consumer.seek(tp, 3L);<br>            }<br>        }<br>----------------------------------------------------------<br>æ²¡æŠ¥é”™ï¼Œå°±æ˜¯è®¾ç½®äº†ä½ç§»åï¼Œoffsetæ²¡å˜åŒ–</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åé¢æœ‰æ‰§è¡Œpollæ–¹æ³•äº†æ²¡ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-01 13:55:22</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/d5/68/2201b6b9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å½’é›¶</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæ–‡ä¸­è¯´ä½ è¦åˆ›å»ºçš„æ¶ˆè´¹è€…ç¨‹åºï¼Œè¦ç¦æ­¢è‡ªåŠ¨æäº¤ä½ç§»ã€‚ä¸ºä»€ä¹ˆé‡è®¾ä½ç§»éœ€è¦ç¦æ­¢è‡ªåŠ¨æäº¤å‘¢ï¼ŸäºŒè€…æœ‰ä»€ä¹ˆå…³ç³»å—ï¼Ÿè°¢è°¢ğŸ™</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¹¶ä¸æ˜¯è¯´é‡è®¾ä½ç§»å’Œç¦æ­¢è‡ªåŠ¨æäº¤ä¸€å®šæ˜¯äº’æ–¥çš„ã€‚åªæ˜¯ä½ æ—¢ç„¶è¦é‡è®¾ä½ç§»è¯´æ˜ä½ è¦äº²è‡ªå¯¹ä½ç§»è¿›è¡Œç®¡ç†ï¼Œé‚£ä¹ˆæœ€å¥½ç¦æ‰è‡ªåŠ¨æäº¤</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-02-22 19:42:05</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/21/0a/34/3e29eb5a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°šå°æ ‘</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆå¥½ã€‚æˆ‘é‡åˆ°ä¸ªé—®é¢˜ï¼Œåœ¨æ¶ˆè´¹æ¶ˆæ¯è¿‡ç¨‹ä¸­è¦æŸ¥è¯¢æ•°æ®åº“ä¸­çš„è®°å½•ï¼Œä½†æ˜¯æ¶ˆæ¯æ¥çš„æ—¶å€™åº“ä¸­è®°å½•ä¸ä¸€å®šå­˜åœ¨ï¼Œå¤§æ¦‚å»¶æ—¶0-30ç§’ï¼Œè¿™æ ·å°±å¯¼è‡´æ¶ˆè´¹é€»è¾‘ä¸æˆåŠŸã€‚ç»è®¨è®ºä¿è¯è®°å½•åœ¨æ¶ˆæ¯å‰å†™å…¥ä¸å¯è¡Œã€‚<br><br>æ‰€ä»¥åªèƒ½é‡å¤æ¶ˆè´¹ï¼Œæˆ‘ç”¨çš„åŠæ³•å¼€ä¸ªçº¿ç¨‹ç¡ä¸€ä¼šå†é‡æ–°æŠŠä¸æˆåŠŸçš„æ¶ˆæ¯å†™å›topicä¸­ï¼Œå¦‚æœå‡ æ¬¡ä¸æˆåŠŸå°±è®°å½•é”™è¯¯æ—¥å¿—ä¸ä¼šæ°¸è¿œå¾ªç¯ã€‚<br><br>æƒ³é—®è€å¸ˆè¿™æ ·åšæœ‰æ²¡æœ‰ä»€ä¹ˆé—®é¢˜ï¼Œæœ‰æ²¡æœ‰æ›´å¥½çš„è§£å†³æ–¹æ¡ˆå‘¢â˜ºï¸è°¢è°¢è€å¸ˆã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™å–å†³äºè®°å½•ä¸å­˜åœ¨çš„æ¯”ä¾‹ã€‚æ˜¯å¤§éƒ¨åˆ†æ—¶å€™éƒ½ä¸å­˜åœ¨è¿˜æ˜¯åªæœ‰å¶å‘çš„ä¸å­˜åœ¨ã€‚å¦‚æœæ˜¯åè€…å¯ä»¥è€ƒè™‘å°†ä¸å­˜åœ¨çš„é›¶æ˜Ÿæ¶ˆæ¯ç¼“å­˜èµ·æ¥ä»¥å¾…åé¢é‡æ–°å¤„ç†ã€‚å¦‚æœæ˜¯å‰è€…ï¼Œåˆ™éœ€è¦é€šç›˜è€ƒè™‘æ¶ˆè´¹é€»è¾‘ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-09-26 10:59:19</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/19/aa/6b/ab9a072a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¯¹ä¸é”™</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &quot;earliest&quot;è¿™ä¸ªé…ç½®å’Œseek()æ–¹æ³•ä¹‹é—´æœ‰å…³ç³»å—?æ¯”å¦‚æˆ‘è®¾ç½®çš„æ˜¯earliestï¼Œä½†æ˜¯ä½¿ç”¨çš„æ˜¯seekToEnd</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ConsumerConfig.AUTO_OFFSET_RESET_CONFIGæ˜¯å‡ºç°ä½ç§»é‡è®¾ç½®æ—¶çš„ç­–ç•¥ã€‚å¹³æ—¶ä½ç§»è®¾ç½®çš„ç­–ç•¥ä¸å–å†³äºè¿™ä¸ªå‚æ•°</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-07-30 18:06:53</div>
  </div>
</div>
</div>
</li>
</ul>