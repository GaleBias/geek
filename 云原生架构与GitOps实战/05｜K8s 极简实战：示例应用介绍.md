<audio title="05ï½œK8s æç®€å®æˆ˜ï¼šç¤ºä¾‹åº”ç”¨ä»‹ç»" src="https://static001.geekbang.org/resource/audio/6c/63/6cce92bbdc1ff9849a11e0b98682ab63.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä¸Šä¸€ç« ï¼Œæˆ‘ä»¬ä»¥ä¸€ä¸ª Python åº”ç”¨ä¸ºä¾‹ï¼Œå­¦ä¹ äº†å°†åº”ç”¨è¿ç§»åˆ°äº‘åŸç”Ÿæ¶æ„ä¸‹çš„å®Œæ•´è¿‡ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä»å®¹å™¨åŒ–ã€éƒ¨ç½²åˆ° K8sã€å¼¹æ€§ä¼¸ç¼©æœ€ååˆ° GitOps çš„å…¨è¿‡ç¨‹ã€‚åœ¨å®æˆ˜çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘æ²¡æœ‰å¤ªå¤šåœ°ä»‹ç»æ¦‚å¿µï¼Œè€Œæ˜¯è®©ä½ ç›´æ¥ä¸Šæ‰‹æ„Ÿå— K8s å’Œ GitOps çš„å¼ºå¤§ä¹‹å¤„ã€‚</p><p>è¿™ä¸€ç« ï¼Œæˆ‘ä¼šè®¾è®¡ä¸€ä¸ªæ›´åŠ æ¥è¿‘çœŸå®ä¸šåŠ¡çš„ç¤ºä¾‹åº”ç”¨ã€‚è¿™ä¸ªåº”ç”¨ä¼šæ¶µç›–ä½ åœ¨å·¥ä½œä¸­å¸¸ç”¨çš„ K8s å¯¹è±¡ï¼ŒåŒ…æ‹¬ Deploymentã€Serviceã€Ingressã€HPAã€Namespaceã€ConfigMap ç­‰ã€‚åœ¨å°†è¿™ä¸ªåº”ç”¨éƒ¨ç½²åˆ° K8s çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¼šé€æ¸æ·±å…¥åˆ°æ¯ä¸ª K8s å¯¹è±¡ä¸­ã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å…ˆæ¥äº†è§£ä¸€ä¸‹è¿™ä¸ªç¤ºä¾‹åº”ç”¨ã€‚</p><p>åœ¨å¼€å§‹å­¦ä¹ ä¹‹å‰ï¼Œä½ éœ€è¦åšå¥½ä»¥ä¸‹å‡†å¤‡ï¼š</p><ul>
<li>å‡†å¤‡ä¸€å°ç”µè„‘ï¼ˆé¦–é€‰ Linux æˆ– macOSï¼ŒWindows ä¹Ÿé€‚ç”¨ï¼Œæ³¨æ„æ“ä½œå·®å¼‚ï¼‰ï¼›</li>
<li><a href="https://docs.docker.com/engine/install/">å®‰è£… Docker</a>ï¼›</li>
<li><a href="https://kubernetes.io/docs/tasks/tools/">å®‰è£… Kubectl</a>ï¼›</li>
<li><a href="https://kind.sigs.k8s.io/docs/user/quick-start/#installation">å®‰è£… Kind</a>ã€‚</li>
</ul><h2>æ¶æ„ä»‹ç»</h2><h3>åº”ç”¨æ¶æ„</h3><p>æˆ‘è®¾è®¡çš„è¿™ä¸ªç¤ºä¾‹åº”ç”¨æ˜¯ä¸€å¥—å¾®æœåŠ¡æ¶æ„çš„åº”ç”¨ï¼Œä½ å¯ä»¥åœ¨ GitHub ä¸Šè·å–<a href="https://github.com/lyzhang1999/kubernetes-example">æºç </a>ï¼Œæºç ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class="language-powershell">$ ls
backend&nbsp; deploy&nbsp; &nbsp;frontend
</code></pre><p>åœ¨è¿™é‡Œï¼Œbackend ç›®å½•ä¸ºåç«¯æºç ï¼Œfrontend ç›®å½•ä¸ºå‰ç«¯æºç ï¼Œdeploy ç›®å½•æ˜¯åº”ç”¨çš„ K8s Manifestï¼Œå‰åç«¯éƒ½å·²ç»åŒ…å«æ„å»ºé•œåƒæ‰€éœ€çš„ Dockerfileã€‚</p><!-- [[[read_end]]] --><p>ç¤ºä¾‹åº”ç”¨ç”±ä¸‰ä¸ªæœåŠ¡ç»„æˆï¼š</p><ol>
<li>å‰ç«¯ï¼›</li>
<li>åç«¯ï¼›</li>
<li>æ•°æ®åº“ã€‚</li>
</ol><p>å…¶ä¸­ï¼Œå‰ç«¯é‡‡ç”¨ React ç¼–å†™ï¼Œå®ƒä¹Ÿæ˜¯åº”ç”¨å¯¹å¤–æä¾›æœåŠ¡çš„å…¥å£ï¼›åç«¯ç”± Python ç¼–å†™ï¼›æ•°æ®åº“é‡‡ç”¨æµè¡Œçš„ Postgresã€‚åº”ç”¨æ•´ä½“æ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/e4/e0/e47ayy03e7a3a6429c6c5b404133ede0.jpg?wh=1920x1074" alt="å›¾ç‰‡"></p><p>å‰ç«¯å®ç°äº†ä¸‰ä¸ªåŠŸèƒ½ï¼Œåˆ†åˆ«æ˜¯å­˜å‚¨è¾“å…¥çš„å†…å®¹ï¼Œåˆ—å‡ºè¾“å…¥å†…å®¹è®°å½•ä»¥åŠåˆ é™¤æ‰€æœ‰çš„è®°å½•ã€‚è¿™ä¸‰ä¸ªåŠŸèƒ½åˆ†åˆ«å¯¹åº”äº†åç«¯çš„ä¸‰ä¸ªæ¥å£ï¼Œä¹Ÿå°±æ˜¯ /add, /fetch å’Œ /deleteï¼Œæœ€åæ•°æ®ä¼šè¢«å­˜å‚¨åœ¨ Postgres æ•°æ®åº“ä¸­ã€‚</p><p>ç¤ºä¾‹åº”ç”¨çš„å‰ç«¯ç•Œé¢å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/4d/af/4d24857b5b97a1c8e7629198c8f379af.png?wh=1920x1172" alt="å›¾ç‰‡"></p><h3>K8s éƒ¨ç½²æ¶æ„</h3><p>ä¸ºäº†æ–¹ä¾¿ä½ æŠŠç¤ºä¾‹åº”ç”¨ç›´æ¥éƒ¨ç½²åˆ° K8s é›†ç¾¤å†…ï¼Œæˆ‘å·²ç»å†™å¥½äº† K8s Manifest æ–‡ä»¶ï¼Œä½ å¯ä»¥åœ¨ <a href="https://github.com/lyzhang1999/kubernetes-example/tree/main/deploy">GitHub</a> æ‰¾åˆ°è¿™äº›æ¸…å•æ–‡ä»¶ã€‚åº”ç”¨çš„ K8s éƒ¨ç½²æ¶æ„å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/f1/56/f1e65380bb2342676024341b034f0e56.jpg?wh=1920x1001" alt="å›¾ç‰‡"></p><p>åœ¨è¿™å¼ æ¶æ„å›¾ä¸­ï¼ŒIngress æ˜¯åº”ç”¨çš„å…¥å£ï¼ŒIngress ä¼šæ ¹æ®è¯·æ±‚è·¯å¾„å°†æµé‡åˆ†æµè‡³å‰åç«¯çš„ Service ä¸­ï¼Œç„¶å Service å°†è¯·æ±‚è½¬å‘ç»™å‰åç«¯ Pod è¿›è¡Œä¸šåŠ¡é€»è¾‘å¤„ç†ï¼Œåç«¯çš„å·¥ä½œè´Ÿè½½ Deployment é…ç½®äº† HPA è‡ªåŠ¨æ¨ªå‘æ‰©å®¹ã€‚åŒæ—¶ï¼ŒPostgres ä¹Ÿæ˜¯ä»¥ Deployment çš„æ–¹å¼éƒ¨ç½²åˆ°é›†ç¾¤å†…çš„ã€‚æœ€åï¼Œæ‰€æœ‰èµ„æºéƒ½éƒ¨ç½²åœ¨ K8s çš„ example å‘½åç©ºé—´ï¼ˆNamespaceï¼‰ä¸‹ã€‚</p><p>åœ¨ç†Ÿæ‚‰äº†åº”ç”¨æ¶æ„ä¹‹åï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬å°±æŠŠå®ƒéƒ¨ç½²åˆ° K8s é›†ç¾¤å†…ã€‚</p><h2>éƒ¨ç½²åº”ç”¨</h2><h3>åˆ›å»ºæ–°çš„ K8s é›†ç¾¤</h3><p>æˆ‘ä»¬è¿˜æ˜¯ä»¥éƒ¨ç½²åˆ°æœ¬åœ° Kind é›†ç¾¤ä¸ºä¾‹ï¼Œä¸ºäº†é¿å…èµ„æºå†²çªï¼Œéœ€è¦å…ˆæŠŠç¬¬ä¸€ç« å®éªŒè¿‡ç¨‹åˆ›å»ºçš„ Kind é›†ç¾¤åˆ æ‰ã€‚ä½ å¯ä»¥ç”¨ kind delete cluster æ¥åˆ é™¤é›†ç¾¤ï¼š</p><pre><code class="language-powershell">$ kind delete cluster
</code></pre><p>ç„¶åï¼Œé‡æ–°åˆ›å»ºä¸€ä¸ª K8s é›†ç¾¤ï¼Œå°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º config.yamlï¼š</p><pre><code class="language-yaml">kind: Cluster
apiVersion: kind.x-k8s.io/v1alpha4
nodes:
- role: control-plane
  kubeadmConfigPatches:
  - |
    kind: InitConfiguration
    nodeRegistration:
      kubeletExtraArgs:
        node-labels: "ingress-ready=true"
  extraPortMappings:
  - containerPort: 80
    hostPort: 80
    protocol: TCP
  - containerPort: 443
    hostPort: 443
    protocol: TCP
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ kind create cluster é‡æ–°åˆ›å»ºé›†ç¾¤ï¼š</p><pre><code class="language-yaml">â¯ kind create cluster --config config.yaml
Creating cluster "kind" ...
 âœ“ Ensuring node image (kindest/node:v1.23.4) ğŸ–¼
 âœ“ Preparing nodes ğŸ“¦  
 âœ“ Writing configuration ğŸ“œ 
 âœ“ Starting control-plane ğŸ•¹ï¸ 
 âœ“ Installing CNI ğŸ”Œ 
 âœ“ Installing StorageClass ğŸ’¾ 
Set kubectl context to "kind-kind"
You can now use your cluster with:

kubectl cluster-info --context kind-kind
</code></pre><p>ç”±äºç¤ºä¾‹åº”ç”¨ä½¿ç”¨äº† Ingressï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ä¸º Kind éƒ¨ç½² Ingressï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl apply -f æ¥éƒ¨ç½² Ingress-Nginxï¼š</p><pre><code class="language-powershell">$ kubectl create -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/ingress-nginx/ingress-nginx.yaml
namespace/ingress-nginx created
serviceaccount/ingress-nginx created
serviceaccount/ingress-nginx-admission created
......
</code></pre><p>æœ€åï¼Œå†éƒ¨ç½² Metric Serverï¼Œä»¥ä¾¿å¼€å¯ HPA åŠŸèƒ½ï¼š</p><pre><code class="language-powershell">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/resource/main/metrics/metrics.yaml
serviceaccount/metrics-server created
clusterrole.rbac.authorization.k8s.io/system:aggregated-metrics-reader created
clusterrole.rbac.authorization.k8s.io/system:metrics-server created
......
</code></pre><p><strong>å‡†å¤‡å¥½æ–°çš„ K8s é›†ç¾¤åï¼Œå°±å¯ä»¥å¼€å§‹éƒ¨ç½²ç¤ºä¾‹åº”ç”¨äº†ã€‚</strong></p><h3>éƒ¨ç½²ç¤ºä¾‹åº”ç”¨</h3><p>æˆ‘ä»¬æŠŠç¤ºä¾‹åº”ç”¨æ‰€æœ‰çš„èµ„æºéƒ½éƒ¨ç½²åœ¨ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´ä¸‹ï¼Œæ–°çš„å‘½åç©ºé—´å‘½åä¸º exampleã€‚æˆ‘ä»¬é¦–å…ˆéœ€è¦åˆ›å»ºè¯¥å‘½åç©ºé—´ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl create namespace æ¥åˆ›å»ºå‘½åç©ºé—´ï¼š</p><pre><code class="language-powershell">$ kubectl create namespace example
namespace/example created
</code></pre><p>ç„¶åï¼Œåˆ›å»º Postgres æ•°æ®åº“ï¼ŒåŒæ ·ä½¿ç”¨ kubectl apply æ¥åˆ›å»ºï¼š</p><pre><code class="language-powershell">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/database.yaml -n example
configmap/pg-init-script created
deployment.apps/postgres created
service/pg-service created
</code></pre><p>åœ¨ä¸Šé¢è¿™æ®µä»£ç ä¸­ï¼Œ-n å‚æ•°ä»£è¡¨æŒ‡å®šå‘½åç©ºé—´ï¼Œä¹Ÿå°±æ˜¯ example å‘½åç©ºé—´ï¼Œ<strong>æ³¨æ„ï¼Œåç»­åˆ›å»ºèµ„æºæ—¶éƒ½éœ€è¦æŒ‡å®šè¿™ä¸ªå‘½åç©ºé—´ã€‚</strong></p><p>ç„¶åå†åˆ†åˆ«åˆ›å»ºå‰åç«¯ Deployment å·¥ä½œè´Ÿè½½å’Œ Serviceï¼š</p><pre><code class="language-powershell">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/frontend.yaml -n example
deployment.apps/frontend created
service/frontend-service created

$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/backend.yaml -n example
deployment.apps/backend created
service/backend-service created
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä¸ºåº”ç”¨åˆ›å»º Ingress å’Œ HPA ç­–ç•¥ï¼š</p><pre><code class="language-powershell">$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/ingress.yaml -n example
ingress.networking.k8s.io/frontend-ingress created

$ kubectl apply -f https://ghproxy.com/https://raw.githubusercontent.com/lyzhang1999/kubernetes-example/main/deploy/hpa.yaml -n example
horizontalpodautoscaler.autoscaling/backend created
</code></pre><p>å…¶å®ï¼Œé™¤äº†å¯ä»¥æŒ‰ç…§ä¸Šé¢çš„å¼•å¯¼å•ç‹¬åˆ›å»ºç¤ºä¾‹åº”ç”¨çš„æ¯ä¸€ä¸ª K8s å¯¹è±¡ä»¥å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œé‚£å°±æ˜¯æŠŠè¿™ä¸ª Git ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åä½¿ç”¨ kubectl apply <strong>ä¸€æ¬¡æ€§å°†æ‰€æœ‰ç¤ºä¾‹åº”ç”¨çš„å¯¹è±¡</strong>éƒ¨ç½²åˆ°é›†ç¾¤å†…ï¼š</p><pre><code class="language-yaml">$ git clone https://ghproxy.com/https://github.com/lyzhang1999/kubernetes-example &amp;&amp; cd kubernetes-example
Cloning into 'kubernetes-example'...
......
Resolving deltas: 100% (28/28), done.

$ kubectl apply -f deploy -n example
deployment.apps/backend created
service/backend-service created
configmap/pg-init-script created
......
</code></pre><p>è¿™é‡Œçš„ -f å‚æ•°é™¤äº†å¯ä»¥æŒ‡å®šæ–‡ä»¶å¤–ï¼Œè¿˜å¯ä»¥æŒ‡å®šç›®å½•ï¼Œkubectl å°†ä¼šæ£€æŸ¥ç›®å½•ä¸‹æ‰€æœ‰å¯ç”¨çš„ Manifestï¼Œç„¶åæŠŠå®ƒéƒ¨ç½²åˆ° K8s é›†ç¾¤ã€‚-n å‚æ•°ä»£è¡¨å°†æ‰€æœ‰ Manifest éƒ¨ç½²åˆ° example å‘½åç©ºé—´ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ kubectl wait æ¥æ£€æŸ¥æ‰€æœ‰èµ„æºæ˜¯ä¸æ˜¯å·²ç»å¤„äº Ready çŠ¶æ€äº†ï¼š</p><pre><code class="language-powershell">$ kubectl wait --for=condition=Ready pods --all -n example
pod/backend-9b677898b-n5lsm condition met
pod/frontend-f948bdc85-q6x9f condition met
pod/postgres-7745b57d5d-f4trt condition met
</code></pre><p><strong>åˆ°è¿™é‡Œï¼Œç¤ºä¾‹åº”ç”¨å°±éƒ¨ç½²å®Œäº†ã€‚</strong></p><p>æ‰“å¼€æµè§ˆå™¨è®¿é—® 127.0.0.1ï¼Œä½ åº”è¯¥èƒ½çœ‹åˆ°ç¤ºä¾‹åº”ç”¨çš„å‰ç«¯ç•Œé¢ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/4d/07/4dae13ff82229226916b7b767d6a5007.png?wh=1920x1190" alt="å›¾ç‰‡"></p><p>ä½ å¯ä»¥å°è¯•åœ¨è¾“å‡ºæ¡†ä¸­è¾“å…¥å†…å®¹ï¼Œå¦‚æœç‚¹å‡» Add æŒ‰é’®ï¼Œä¸‹æ–¹çš„åˆ—è¡¨å†…ä¼šå‡ºç°ä½ è¾“å…¥çš„å†…å®¹ï¼Œç‚¹å‡» Clear æ‰€æœ‰å†…å®¹è¢«æ¸…ç©ºï¼Œè¿™å°±è¯´æ˜åº”ç”¨å·²ç»å¯ä»¥æ­£å¸¸å·¥ä½œäº†ã€‚</p><h2>K8s å¯¹è±¡è§£æ</h2><p>åœ¨è¿™ä¸ªç¤ºä¾‹åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„å‘½åç©ºé—´æ¥éƒ¨ç½²æ‰€æœ‰èµ„æºï¼Œè¿™ä¸ªå‘½åç©ºé—´æ˜¯ exampleã€‚</p><p>æ­¤å¤–ï¼Œç¤ºä¾‹åº”ç”¨æ¶‰åŠåˆ°çš„èµ„æºæ¯”è¾ƒå¤šï¼Œä¸ºäº†æ›´æ¸…æ¥šåœ°æ¢³ç†å®ƒä»¬ä¹‹é—´çš„é€»è¾‘å…³ç³»ï¼Œæˆ‘ç»™ä½ ç®€å•åœ°æ€»ç»“ä¸€ä¸‹ã€‚</p><p>é¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl get all æ¥æŸ¥çœ‹æŸä¸ªå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰èµ„æºï¼š</p><pre><code class="language-powershell">â¯ kubectl get all -n example
NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; RESTARTS&nbsp; &nbsp;AGE
pod/backend-648ff85f48-8qgjg&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 29s
pod/backend-648ff85f48-f845h&nbsp; &nbsp; 1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 51s
pod/frontend-7b55cc5c67-4svjz&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14s
pod/frontend-7b55cc5c67-9cx57&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 14s
pod/postgres-7745b57d5d-f4trt&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 44m

NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TYPE&nbsp; &nbsp; &nbsp; &nbsp; CLUSTER-IP&nbsp; &nbsp; &nbsp; EXTERNAL-IP&nbsp; &nbsp;PORT(S)&nbsp; &nbsp; AGE
service/backend-service&nbsp; &nbsp; ClusterIP&nbsp; &nbsp;10.96.244.140&nbsp; &nbsp;&lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 5000/TCP&nbsp; &nbsp;42m
service/frontend-service&nbsp; &nbsp;ClusterIP&nbsp; &nbsp;10.96.85.54&nbsp; &nbsp; &nbsp;&lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 3000/TCP&nbsp; &nbsp;43m
service/pg-service&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;ClusterIP&nbsp; &nbsp;10.96.166.74&nbsp; &nbsp; &lt;none&gt;&nbsp; &nbsp; &nbsp; &nbsp; 5432/TCP&nbsp; &nbsp;44m

NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;UP-TO-DATE&nbsp; &nbsp;AVAILABLE&nbsp; &nbsp;AGE
deployment.apps/backend&nbsp; &nbsp; 2/2&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;42m
deployment.apps/frontend&nbsp; &nbsp;2/2&nbsp; &nbsp; &nbsp;4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 4&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;43m
deployment.apps/postgres&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;44m

NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;AGE
replicaset.apps/backend-648ff85f48&nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;51s
replicaset.apps/frontend-7b55cc5c67&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;54s
replicaset.apps/postgres-7745b57d5d&nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;44m

NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;REFERENCE&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;TARGETS&nbsp; &nbsp; MINPODS&nbsp; &nbsp;MAXPODS&nbsp; &nbsp;REPLICAS&nbsp; &nbsp;AGE
horizontalpodautoscaler.autoscaling/backend&nbsp; &nbsp; Deployment/backend&nbsp; &nbsp; 0%/50%&nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp; &nbsp; 2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 8m17s
horizontalpodautoscaler.autoscaling/frontend&nbsp; &nbsp;Deployment/frontend&nbsp; &nbsp;51%/80%&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;10&nbsp; &nbsp; &nbsp; &nbsp; 10&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;8m17s
</code></pre><p>-n å‚æ•°è¡¨ç¤ºæŒ‡å®šä¸€ä¸ªå‘½åç©ºé—´ï¼Œä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œç¤ºä¾‹åº”ç”¨ä¸€å…±åˆ›å»ºäº† 5 ä¸ª Podã€3 ä¸ª Serviceã€3 ä¸ª Deploymentã€3 ä¸ª Replicasetã€2 ä¸ª HPAï¼Œæ˜¯ä¸æ˜¯å¯¹æœ‰äº›æ¦‚å¿µæœ‰ç‚¹é™Œç”Ÿå‘¢ï¼Ÿåˆ«æ‹…å¿ƒï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹ä¸­è¯¦ç»†ä»‹ç»ã€‚</p><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¸ºä½ å‡†å¤‡äº†ä¸€ä¸ªç¤ºä¾‹åº”ç”¨ï¼Œå¹¶å¼•å¯¼ä½ åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„æœ¬åœ° Kind é›†ç¾¤ï¼Œè¿˜å®Œæˆäº†éƒ¨ç½²çš„æ“ä½œã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä»‹ç»äº†åº”ç”¨æ•´ä½“çš„æ¶æ„è®¾è®¡ï¼ŒåŒ…æ‹¬ä¸šåŠ¡æ¶æ„å’Œ K8s éƒ¨ç½²æ¶æ„ã€‚</p><p>ç¤ºä¾‹åº”ç”¨ä¸»è¦ä»çœŸå®é¡¹ç›®å‡ºå‘ï¼Œåœ¨æˆ‘ä»¬è¿™ä¸ªåº”ç”¨é‡Œå‡ºç°çš„å¤§å¤šæ•° K8s å¯¹è±¡ï¼Œä½ ä¹Ÿä¼šåœ¨å®é™…å·¥ä½œä¸­ç”¨åˆ°å®ƒä»¬ï¼ŒæŒæ¡å®ƒä»¬æœ‰åŠ©äºä½ æŠŠçœŸå®çš„åº”ç”¨è¿ç§»åˆ° K8sã€‚åœ¨æ¥ä¸‹æ¥çš„è¯¾ç¨‹é‡Œï¼Œæˆ‘ä¼šä»è¿™ä¸ªç¤ºä¾‹åº”ç”¨å‡ºå‘ï¼Œä¸ºä½ è¯¦ç»†ä»‹ç»è¿™é‡Œå‡ºç°çš„æ¯ä¸€ä¸ª K8s å¯¹è±¡ç±»å‹ï¼Œä¸ºæœªæ¥çš„ GitOps è¯¾ç¨‹æ‰“ä¸‹åšå®çš„åŸºç¡€ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>è¯·ä½ å°è¯•åœ¨ç¤ºä¾‹åº”ç”¨ä¸­æ·»åŠ ä¸€äº›æ•°æ®ï¼Œç„¶åä½¿ç”¨ kubectl delete pod åˆ é™¤ Postgres çš„ Podï¼Œåˆ é™¤å K8s å°†ä¼šé‡æ–°åˆ›å»º Podï¼Œè¯·ä½ è§‚å¯Ÿä¸€ä¸‹ä¹‹å‰ä¿å­˜çš„æ•°æ®è¿˜å­˜åœ¨å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</p><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>includestdio.h</span>
  </div>
  <div class="_2_QraFYR_0">â€œé¦–å…ˆï¼Œä½ å¯ä»¥ä½¿ç”¨ kubect get all æ¥æŸ¥çœ‹æŸä¸ªå‘½åç©ºé—´ä¸‹çš„æ‰€æœ‰èµ„æºâ€ ã€‚å‘½ä»¤å†™é”™äº†ï¼Œkubectl<br><br>åˆ é™¤ Postgres Pod åï¼Œæ·»åŠ çš„æ•°æ®ä¸å­˜åœ¨ã€‚åŸå› ï¼šå†™å…¥çš„æ•°æ®ä½äºå®¹å™¨çš„å¯å†™å±‚ï¼Œä¸commitä¸ä¿å­˜ï¼Œdelete åï¼Œé‡æ–°æ‹‰èµ·çš„ Pod åŸºäºåŸå§‹å®¹å™¨é•œåƒåˆ›å»ºï¼Œä»…å­˜åœ¨åŸå§‹çš„åªè¯»å±‚æ•°æ®ã€‚éœ€è¦ä¿å­˜æ•°æ®çš„è¯ï¼Œå¯ä»¥æå‰é€šè¿‡ volume ç­‰åšå¥½æŒä¹…åŒ–æ–¹æ¡ˆï¼ŒæŠŠå®¹å™¨å’Œæ•°æ®è§£è€¦</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè°¢æŒ‡æ­£ã€‚<br>å›ç­”éå¸¸æ­£ç¡®ï¼</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 11:24:28</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/ff/28/040f6f01.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Y</span>
  </div>
  <div class="_2_QraFYR_0">ç»§ç»­è¿½å‰§</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ˜„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 12:52:45</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>GACÂ·DU</span>
  </div>
  <div class="_2_QraFYR_0">å‰ç«¯æ·»åŠ çš„æ•°æ®ä¼šè¢«åˆ é™¤ï¼Œå› ä¸ºæ²¡æœ‰æŒ‚ç›˜å­˜å‚¨ã€‚ç”Ÿäº§ç¯å¢ƒç”¨é‚£ç§å­˜å‚¨æ¡†æ¶ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹æœ‰å¾ˆå¤šå­˜å‚¨æ–¹æ¡ˆï¼Œæ¯”å¦‚ï¼š<br>1. https:&#47;&#47;github.com&#47;rook&#47;rook<br>2. https:&#47;&#47;github.com&#47;ceph&#47;ceph<br>3. https:&#47;&#47;github.com&#47;longhorn&#47;longhorn<br><br>å¦‚æœä½ ç”¨çš„æ˜¯äº‘å‚å•†çš„æ‰˜ç®¡ K8s é›†ç¾¤ï¼Œäº‘å‚å•†ä¸€èˆ¬ä¼šç›´æ¥æä¾›ç°æˆçš„å­˜å‚¨æ–¹æ¡ˆï¼Œæ¯”å¦‚ç»“åˆè‡ªå®¶äº‘ç›˜çš„å­˜å‚¨ï¼Œä¸éœ€è¦è‡ªå»ºã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 11:35:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1d/80/93/dde3d5f0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç†Šæ‚Ÿç©ºçš„å‡¶</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆä½ å¥½  éº»çƒ¦é—®ä¸‹  æ‚¨ç”»å›¾å·¥å…·ç”¨ä»€ä¹ˆç”»çš„ æŒºå¥½çš„</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: Draw.io</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-29 10:30:03</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/17/e9/26/afc08398.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Amosãƒ¾</span>
  </div>
  <div class="_2_QraFYR_0">å›¾é‡Œä¸æ˜¯5ä¸ªpodå—</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè°¢æŒ‡æ­£ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 09:45:43</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/33/27/e5a74107.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Da Vinci</span>
  </div>
  <div class="_2_QraFYR_0">éƒ¨ç½²å®Œingressï¼Œè®¿é—®404ï¼Œæ˜¯æœ‰ä»€ä¹ˆä¸å¯¹å—ï¼Œè€å¸ˆ<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ£€æŸ¥ä¸€ä¸‹ ingress-nginx pod æ˜¯ä¸æ˜¯ running çŠ¶æ€ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-23 17:56:12</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKIRSxInCiclMszZ21FptlHSHBB2icQSdIbRX2BYdiaEfdicsWxLzqB7h01jhibpLOAu9Hd8SfbZxHBaQg/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ¸£æ¸£è¾‰</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆä½ å¥½ï¼Œæˆ‘é€šè¿‡ä¸‹è½½githubé¡¹ç›®è¿›è¡Œéƒ¨ç½²ã€‚ä½†æ˜¯å½“æˆ‘è®¿é—®å‰ç«¯çš„æ—¶å€™å‡ºç°äº†502 BadGatewayé”™è¯¯ã€‚ç„¶åæŸ¥çœ‹podçš„æ—¶å€™å‘ç°å‰ç«¯çš„podé‡å¯äº†ã€‚å¹¶ä¸”åœ¨é‡å¯æˆåŠŸåå†æ¬¡è®¿é—®è¿˜æ˜¯å‡ºç°äº†502çš„é”™è¯¯ã€‚æˆ‘ç”¨çš„æ˜¯m1èŠ¯ç‰‡çš„macbookã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ–¹ä¾¿è´´ä¸€ä¸‹ pod çš„æ—¥å¿—ä¿¡æ¯å—</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-13 10:29:59</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a2/fb/94af9cf1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Alex</span>
  </div>
  <div class="_2_QraFYR_0">é’ˆå¯¹æ— æ³•æ‹‰å–é•œåƒçš„æƒ…å†µï¼Œå»ºè®®ä¿®æ”¹ä¸‹KINDå†…é›†ç¾¤çš„é•œåƒæºåˆ°å›½å†…é˜¿é‡Œçš„é•œåƒæºä¸Š<br>kind: Cluster<br>apiVersion: kind.x-k8s.io&#47;v1alpha4<br>nodes:<br>- role: control-plane<br>  kubeadmConfigPatches:<br>  - |<br>    kind: InitConfiguration<br>    imageRepository: registry.aliyuncs.com&#47;google_containers<br>    nodeRegistration:<br>      kubeletExtraArgs:<br>        node-labels: &quot;ingress-ready=true&quot;<br>  extraPortMappings:<br>  - containerPort: 80<br>    hostPort: 80<br>    protocol: TCP<br>  - containerPort: 443<br>    hostPort: 443<br>    protocol: TCP</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘ğŸ»æ„Ÿè°¢åˆ†äº«</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-12 10:41:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/a5/6d/a4de2acf.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Lee</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œè¯·æ•™ä¸€ä¸‹ï¼Œè¿è¡Œä¸€ä¸‹å‘½ä»¤ï¼Œå‘ç”Ÿé”™è¯¯ï¼š<br>kubectl apply -f https:&#47;&#47;ghproxy.com&#47;https:&#47;&#47;raw.githubusercontent.com&#47;lyzhang1999&#47;kubernetes-example&#47;main&#47;deploy&#47;ingress.yaml -n example<br><br>Error from server (InternalError): error when creating &quot;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.57.158:443: connect: connection refused</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: Ingress-nginx éƒ¨ç½²å¤±è´¥äº†ï¼Œæ£€æŸ¥ä¸€ä¸‹é•œåƒçš„æ‹‰å–æƒ…å†µã€‚å¦‚æœæ˜¯å› ä¸ºç½‘ç»œåŸå› ï¼Œå¯ä»¥å¼€é€šä¸€å°äº‘å‚å•†çš„é¦™æ¸¯è™šæ‹Ÿæœºæˆ–è€…æ‰˜ç®¡çš„ K8s é›†ç¾¤æ¥å®éªŒã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-03 16:24:29</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°é©¬ğŸ</span>
  </div>
  <div class="_2_QraFYR_0">å®¹å™¨podçš„çŠ¶æ€åªæœ‰ä¸€ä¸ªrunning å…¶ä»–çš„éƒ½æ˜¯contaninerCreating æ€ä¹ˆæï¼Ÿã€‹</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ç½‘ç»œåŸå› ï¼Œå¯ä»¥å°è¯•å¼€é€šäº‘å‚å•†é¦™æ¸¯é›†ç¾¤æ¥å®éªŒã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-03-23 18:05:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/e6/54/86056001.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å°é©¬ğŸ</span>
  </div>
  <div class="_2_QraFYR_0">Error from server (InternalError): error when creating &quot;https:&#47;&#47;ghproxy.com&#47;https:&#47;&#47;raw.githubusercontent.com&#47;lyzhang1999&#47;kubernetes-example&#47;main&#47;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.16.113:443: connect: connection refused    <br><br>è¿™ä¸ªæ˜¯ä»€ä¹ˆåŸå› å‘€ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ingress-nginx æ²¡æœ‰éƒ¨ç½²æˆåŠŸï¼Œæ£€æŸ¥å·¥ä½œè´Ÿè½½ã€‚ä¸€èˆ¬æ˜¯é•œåƒæ²¡æ‹‰å–æˆåŠŸï¼Œä½ å¯ä»¥å¼€é€šä¸€å°äº‘å‚å•†çš„é¦™æ¸¯é›†ç¾¤æ¥å®éªŒã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-03-23 15:11:16</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erUYW4duhqyicJEAOaEAbtSiaz22iaUmV1Mh1SJGcwRgicyZC16Rk3fJFvwXuhZJP6lqjLKCH13TEvrGg/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é™ˆæ•</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆä½ å¥½ï¼Œè¯·é—®ä¸€ä¸‹ï¼Œç”Ÿäº§ä¸Šæ•°æ®åº“ä¸Šäº‘çš„è¯æœ‰ä»€ä¹ˆæœ€ä½³å®è·µå¯ä»¥æ¨èå‘¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: äº‘æ•°æ®åº“å·²ç»å¾ˆæˆç†Ÿäº†ï¼Œåœ¨è¿ç§»è¿‡ç¨‹ä¸»è¦æ˜¯è¦åšæ•°æ®åŒæ­¥å’Œæµé‡åˆ‡æ¢ï¼Œä»ç§æœ‰éƒ¨ç½²çš„æ•°æ®åº“å®ä¾‹è¿ç§»åˆ°äº‘æ•°æ®åº“å¯èƒ½ä¼šå¯¼è‡´çŸ­æ—¶é—´çš„åœæœºã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-03-07 11:01:05</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1a/5f/af/a2a7c866.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>toranx11</span>
  </div>
  <div class="_2_QraFYR_0">æœ€æ–°çš„å‰ç«¯é•œåƒï¼ˆlyzhang1999&#47;frontend:latestï¼‰æ˜¯æœ‰é—®é¢˜å—ï¼Ÿfrontend pod ä¸€ç›´CrashLoopBackOffï¼š<br><br>Starting the development server...<br><br>node:events:491<br>      throw er; &#47;&#47; Unhandled &#39;error&#39; event<br>      ^<br><br>Error: EMFILE: too many open files, watch &#39;&#47;frontend&#47;public&#39;<br>    at FSWatcher.&lt;computed&gt; (node:internal&#47;fs&#47;watchers:244:19)<br>    at Object.watch (node:fs:2301:34)<br>    at createFsWatchInstance (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:38:15)<br>    at setFsWatchListener (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:81:15)<br>    at FSWatcher.NodeFsHandler._watchWithNodeFs (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:233:14)<br>    at FSWatcher.NodeFsHandler._handleDir (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:429:19)<br>    at FSWatcher.&lt;anonymous&gt; (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:477:19)<br>    at FSWatcher.&lt;anonymous&gt; (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:482:16)<br>    at FSReqCallback.oncomplete (node:fs:207:5)<br>Emitted &#39;error&#39; event on FSWatcher instance at:<br>    at FSWatcher._handleError (&#47;frontend&#47;node_modules&#47;chokidar&#47;index.js:260:10)<br>    at createFsWatchInstance (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:40:5)<br>    at setFsWatchListener (&#47;frontend&#47;node_modules&#47;chokidar&#47;lib&#47;nodefs-handler.js:81:15)<br>    [... lines matching original stack trace ...]<br>    at FSReqCallback.oncomplete (node:fs:207:5) {<br>  errno: -24,<br>  syscall: &#39;watch&#39;,<br>  code: &#39;EMFILE&#39;,<br>  path: &#39;&#47;frontend&#47;public&#39;,<br>  filename: &#39;&#47;frontend&#47;public&#39;<br>}</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é•œåƒæ˜¯æ­£å¸¸çš„ï¼Œâ€œtoo many open filesâ€ä¼¼ä¹æ˜¯å®¿ä¸»æœºçš„é…ç½®å¯¼è‡´çš„ï¼ŒæŸ¥çœ‹è¿™ä¸ªæ–‡æ¡£æ’æŸ¥ï¼šhttps:&#47;&#47;kind.sigs.k8s.io&#47;docs&#47;user&#47;known-issues&#47;#pod-errors-due-to-too-many-open-filesã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-28 12:20:48</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/2c/00/b7/a39ab3e5.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é˜¿æ˜Ÿ</span>
  </div>
  <div class="_2_QraFYR_0">CentOS 8.2 ä¸‹ï¼ŒæŒ‰ç…§å¼•å¯¼éƒ½å®‰è£…å¥½äº†ï¼Œä½†æ˜¯æ‰§è¡Œ<br>kubectl apply -f .&#47;deploy&#47;ingress.yaml -n example æ—¶æŠ¥é”™äº†ï¼š<br><br>error when creating &quot;deploy&#47;ingress.yaml&quot;: Internal error occurred: failed calling webhook &quot;validate.nginx.ingress.kubernetes.io&quot;: failed to call webhook: Post &quot;https:&#47;&#47;ingress-nginx-controller-admission.ingress-nginx.svc:443&#47;networking&#47;v1&#47;ingresses?timeout=10s&quot;: dial tcp 10.96.136.247:443: connect: connection refused</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ£€æŸ¥ä¸€ä¸‹ Ingress-nginx æ˜¯ä¸æ˜¯æ²¡å®‰è£…æˆåŠŸï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-04 09:22:51</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>éƒ‘æµ·æˆ</span>
  </div>
  <div class="_2_QraFYR_0">åˆ é™¤podåï¼Œæ·»åŠ çš„æ•°æ®ä¸å­˜åœ¨äº†ã€‚podæ²¡æœ‰æŒ‚è½½æŒä¹…åŒ–å­˜å‚¨ï¼Œkubernetes å­˜å‚¨æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ†ä¸º: å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ã€ä¸´æ—¶å­˜å‚¨ã€æŒä¹…åŒ–å­˜å‚¨ã€‚å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ä¸podå†…å®¹å™¨ç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œå®¹å™¨åˆ é™¤åé”€æ¯ï¼›ä¸´æ—¶å­˜å‚¨ä¸podç”Ÿå‘½å‘¨æœŸä¸€è‡´ï¼Œpodåˆ é™¤åé”€æ¯ï¼›æŒä¹…åŒ–å­˜å‚¨æ˜¯å¤–éƒ¨çš„ç½‘ç»œå­˜å‚¨æˆ–è€…hostpathï¼Œä¼šä¸€ç›´ä¿ç•™ã€‚ç¤ºä¾‹ä¸­ä½¿ç”¨å®¹å™¨æ–‡ä»¶ç³»ç»Ÿå­˜å‚¨ï¼Œåˆ é™¤podå°±è¢«é”€æ¯</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: éå¸¸æ­£ç¡®ğŸ‘ğŸ»</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-13 08:56:41</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/a9/c6/30b29c22.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é‚£é£åœ¨æå®¢</span>
  </div>
  <div class="_2_QraFYR_0">æç¤º unable to recognize &quot;hpa.yaml&quot;: no matches for kind &quot;HorizontalPodAutoscaler&quot; in version &quot;autoscaling&#47;v2&quot;ï¼Œæ˜¯æˆ‘çš„ k8s ç‰ˆæœ¬ä½äº†å—ï¼Œæˆ‘çš„ k8s å®éªŒç‰ˆæœ¬æ˜¯ v1.22.2</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ï¼Œéœ€è¦ 1.23 ä»¥ä¸Šçš„ç‰ˆæœ¬ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-10 17:34:04</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æå¤š</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œfrontendçš„èµ„æºé…é¢æ•°å€¼æ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œæˆ‘è¿™é‡Œä¸€ç›´æç¤ºOOMé”™è¯¯ï¼š<br><br>pod&#47;backend-6f756f886f-8ncv8    1&#47;1     Running             0                   15m<br>pod&#47;backend-6f756f886f-k6c9x    1&#47;1     Running             0                   58m<br>pod&#47;frontend-7b55cc5c67-5r54z   1&#47;1     Terminating         0                   5m12s<br>pod&#47;frontend-7b55cc5c67-brl6q   1&#47;1     Running             2 (81s ago)         4m57s<br>pod&#47;frontend-7b55cc5c67-cwgtt   0&#47;1     OOMKilled           3 (&lt;invalid&gt; ago)   15m<br>pod&#47;frontend-7b55cc5c67-tktd9   1&#47;1     Running             2 (&lt;invalid&gt; ago)   5m12s<br>pod&#47;frontend-7b85d8fc8-5fj6t    0&#47;1     ContainerCreating   0                   8s<br>pod&#47;frontend-7b85d8fc8-8v2b7    1&#47;1     Running             0                   38s<br>pod&#47;frontend-7b85d8fc8-jnw4j    0&#47;1     ContainerCreating   0                   38s<br>pod&#47;frontend-7b85d8fc8-x9vv9    0&#47;1     ContainerCreating   0                   38s<br>pod&#47;postgres-7745b57d5d-hckqd   1&#47;1     Running             0                   58m<br><br>æŸ¥çœ‹hpaå¯¹åº”çš„é¢åº¦ä¹Ÿè¶…äº†ï¼š<br><br>horizontalpodautoscaler.autoscaling&#47;backend    Deployment&#47;backend    25%&#47;50%, 1%&#47;50%   2         10        2          5m46s<br>horizontalpodautoscaler.autoscaling&#47;frontend   Deployment&#47;frontend   200%&#47;80%          2         10        5          5m46s<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æˆ‘æ›´æ–°äº†ä¸€ç‰ˆï¼Œä½ å¯ä»¥é‡æ–°æ‹‰ä¸€ä¸‹ç¤ºä¾‹åº”ç”¨ä»“åº“ï¼Œé‡æ–°éƒ¨ç½²è¯•è¯•çœ‹ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-03 23:33:46</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1d/80/93/dde3d5f0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç†Šæ‚Ÿç©ºçš„å‡¶</span>
  </div>
  <div class="_2_QraFYR_0">æ€è€ƒé¢˜ï¼š åˆ é™¤å‘½åç©ºé—´ä¸‹pgæ•°æ®åº“å æ•°æ®ä¸è§äº†ï¼›å®ä¾‹éƒ½åˆ äº†ï¼ˆç†è§£æ˜¯ç‰©ç†åˆ é™¤ï¼‰ï¼› æ•°æ®è‚¯å®šä¸åº”è¯¥åœ¨äº† </div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸»è¦çš„åŸå› æ˜¯æ²¡æœ‰ä¸º Pg Pod é…ç½®æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-29 11:18:28</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/8a/63/a5fda84d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>çƒŸç«ä¸å </span>
  </div>
  <div class="_2_QraFYR_0">æ€è€ƒé¢˜ï¼šæ•°æ®ä¸åœ¨äº†ï¼Œpgæ²¡æœ‰æŒä¹…åŒ–å­˜å‚¨ï¼Œæ–°podåŸºäºyamlæ–‡ä»¶å®šä¹‰çš„é•œåƒå¯åŠ¨ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ­£ç¡®ï¼Œå¯ä»¥è¿›ä¸€æ­¥å°è¯•ä¸º pg å¢åŠ æŒä¹…åŒ–å­˜å‚¨ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 22:04:33</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä¸€æ­¥</span>
  </div>
  <div class="_2_QraFYR_0">mac éƒ¨ç½²å®Œæˆä¹‹åï¼Œè®¿é—® 127.0.0.1 :3000 æ— æ³•è®¿é—®ï¼Œè¿›å…¥åˆ°å®¹å™¨å†…å°±å¯ä»¥è®¿é—®ï¼Œç½‘ç»œä¸é€š</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: éƒ¨ç½² Ingress-Nginx ä¹‹åè®¿é—®æœ¬åœ° 127.0.0.1 å°±å¯ä»¥äº†ï¼Œåº”ç”¨å¸¦æœ‰ Ingress ç­–ç•¥ã€‚å¦å¤–æ³¨æ„åˆ›å»º Kind é›†ç¾¤çš„æ—¶å€™éœ€è¦æŒ‰ç…§æ–‡ä¸­çš„æ­¥éª¤æš´éœ² 80 ç«¯å£ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-19 19:32:01</div>
  </div>
</div>
</div>
</li>
</ul>