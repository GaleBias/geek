<audio title="13ï½œå®¹å™¨åŒ–ï¼šå¦‚ä½•ä¸ºä¸åŒè¯­è¨€å¿«é€Ÿæ„å»ºå¤šå¹³å°é•œåƒï¼Ÿ" src="https://static001.geekbang.org/resource/audio/b5/65/b5730c3ef1f08ec6f6369264d0d00c65.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚ä»è¿™èŠ‚è¯¾å¼€å§‹ï¼Œæˆ‘ä»¬æ¥å®¹å™¨åŒ–çš„å®è·µã€‚</p><p>åœ¨<a href="https://time.geekbang.org/column/article/612566">ç¬¬1è®²</a>ä¸­ï¼Œæˆ‘ä»¬ä»¥ Python Flask åº”ç”¨ä¸ºä¾‹ï¼Œå±•ç¤ºäº†å¦‚ä½•ç¼–å†™ Dockerfile ï¼Œå¦‚ä½•æ„å»ºå’Œæ¨é€é•œåƒã€‚åœ¨ç¼–å†™ Dockerfile æ–¹é¢ï¼Œæˆ‘ä¸ºä½ ä»‹ç»äº†æ„å»ºé•œåƒé€šç”¨çš„å¥—è·¯ã€‚</p><p>ä½†å¯¹äºå…¶ä»–é Python è¯­è¨€ç¼–å†™çš„ä¸šåŠ¡åº”ç”¨æ¥è¯´ï¼Œå¦‚ä½•å¿«é€Ÿæ„å»ºé•œåƒå‘¢ï¼Ÿ</p><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¼šä»‹ç»ä¸åŒè¯­è¨€æ„å»ºé•œåƒçš„ä¾‹å­å’Œæ¨¡æ¿ï¼ŒåŒ…æ‹¬å¸¸ç”¨çš„åç«¯è¯­è¨€ Javaã€Golangã€Node.js ä»¥åŠå‰ç«¯ Vue æ¡†æ¶ç¼–å†™çš„ä¸šåŠ¡åº”ç”¨ï¼Œæ¯ä¸€ç§è¯­è¨€æˆ‘éƒ½ä¼šè®¾è®¡ä¸€ä¸ªæ¥è¿‘çœŸå®çš„æ„å»ºå®¹å™¨é•œåƒçš„ä¾‹å­ã€‚æ­¤å¤–ï¼Œè€ƒè™‘æ„å»ºé•œåƒå¯¹å¤šå¹³å°çš„å…¼å®¹æ€§ï¼Œæˆ‘è¿˜ä¼šä»‹ç»ä¸€ç§æ„å»ºå¤šå¹³å°é•œåƒçš„æ–¹æ³•ï¼Œè¿™æ ·ï¼Œæˆ‘ä»¬æ„å»ºå‡ºæ¥çš„é•œåƒå°±èƒ½å¤Ÿå…¼å®¹å¤šä¸ªä¸åŒçš„ CPU å¹³å°äº†ã€‚æœªæ¥ï¼Œå¦‚æœä½ éœ€è¦å¯¹å®é™…çš„ä¸šåŠ¡åº”ç”¨è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ ï¼Œå®Œå…¨å¯ä»¥å‚è€ƒæˆ‘ä»¬è¿™èŠ‚è¯¾çš„å†…å®¹ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œä½ éœ€è¦ç¡®ä¿å·²ç»åœ¨æœ¬åœ°å®‰è£…äº† Dockerï¼Œå¹¶å°†æˆ‘æå‰å‡†å¤‡å¥½çš„ç¤ºä¾‹åº”ç”¨ä»“åº“å…‹éš†åˆ°æœ¬åœ°ï¼š<a href="https://github.com/lyzhang1999/gitops.git">https://github.com/lyzhang1999/gitops.git</a>ã€‚</p><h2>Java åº”ç”¨å®¹å™¨åŒ–</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ Java åº”ç”¨çš„å®¹å™¨åŒ–ã€‚</p><p>å¸¸è§çš„ Java åº”ç”¨å¯åŠ¨æ–¹å¼æœ‰ä¸¤ç§ï¼Œè¿™ä¹Ÿå°±æ„å‘³ç€é•œåƒæ„å»ºæ–¹å¼ä¹Ÿæœ‰ä¸¤ç§ã€‚ä¸€ç§æ˜¯å°†åº”ç”¨æ‰“åŒ…æˆ Jar åŒ…ï¼Œåœ¨é•œåƒå†…ç›´æ¥å¯åŠ¨åº”ç”¨ Jar åŒ…æ¥æ„å»ºé•œåƒã€‚å¦ä¸€ç§æ˜¯åœ¨å®¹å™¨é‡Œé€šè¿‡ Spring Boot æ’ä»¶ç›´æ¥å¯åŠ¨åº”ç”¨ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘åˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§é•œåƒæ„å»ºæ–¹å¼ã€‚</p><!-- [[[read_end]]] --><h3>å¯åŠ¨ Jar åŒ…çš„æ„å»ºæ–¹å¼</h3><p>ä»¥ Spring Boot å’Œ Maven ä¸ºä¾‹ï¼Œæˆ‘å·²ç»æå‰åˆ›å»ºå¥½äº†ä¸€ä¸ª Demo åº”ç”¨ï¼Œæˆ‘ä»¬ä»¥å®ƒä¸ºä¾‹å­ä»‹ç»å¦‚ä½•ä½¿ç”¨ Jar åŒ…æ„å»ºé•œåƒã€‚</p><p>åœ¨å°†ç¤ºä¾‹åº”ç”¨å…‹éš†åˆ°æœ¬åœ°åï¼Œè¿›å…¥ Spring Boot Demo ç›®å½•å¹¶åˆ—å‡ºæ‰€æœ‰æ–‡ä»¶ã€‚</p><pre><code class="language-yaml">$ cd gitops/docker/13/spring-boot
$ ls -al
total 80
drwxr-xr-x&nbsp; 12 weiwang&nbsp; staff&nbsp; &nbsp; 384 10&nbsp; 5 11:17 .
drwxr-xr-x&nbsp; &nbsp;4 weiwang&nbsp; staff&nbsp; &nbsp; 128 10&nbsp; 5 11:17 ..
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; &nbsp; 6 10&nbsp; 5 10:30 .dockerignore
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 374 10&nbsp; 5 11:05 Dockerfile
drwxr-xr-x&nbsp; &nbsp;4 weiwang&nbsp; staff&nbsp; &nbsp; 128 10&nbsp; 5 11:17 src
......
</code></pre><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ <strong>src ç›®å½•ã€Dockerfile æ–‡ä»¶å’Œ .dockerignore æ–‡ä»¶</strong>ã€‚</p><p>é¦–å…ˆï¼Œsrc ç›®å½•ä¸‹çš„ src/main/java/com/example/demo/DemoApplication.java æ–‡ä»¶çš„å†…å®¹æ˜¯ Demo åº”ç”¨çš„ä¸»ä½“æ–‡ä»¶ï¼Œå®ƒåŒ…å«ä¸€ä¸ª /hello æ¥å£ï¼Œä½¿ç”¨ Get è¯·æ±‚è®¿é—®åä¼šè¿”å› â€œHello Worldâ€ã€‚</p><pre><code class="language-yaml">

package com.example.demo;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;

@SpringBootApplication
@RestController
public class DemoApplication {
    public static void main(String[] args) {
        SpringApplication.run(DemoApplication.class, args);
    }
    
    @GetMapping("/hello")
    public String hello(@RequestParam(value = "name", defaultValue = "World") String name) {
        return String.format("Hello %s!", name);
    }
}
</code></pre><p>Demo åº”ç”¨çš„ä¸»ä½“å†…å®¹è™½ç„¶å¾ˆç®€å•ï¼Œä½†å®ƒä»£è¡¨äº† <strong>Spring Boot + Maven</strong> çš„å…¸å‹ç»„åˆï¼Œåªè¦ç¬¦åˆè¿™ä¸¤ç§æŠ€æœ¯é€‰å‹ï¼Œä½ éƒ½å¯ä»¥ç›´æ¥å‚è€ƒè¿™é‡Œçš„ä¾‹å­æ¥å®¹å™¨åŒ–ä½ çš„ä¸šåŠ¡åº”ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæ˜¯æ„å»ºé•œåƒçš„æ ¸å¿ƒå†…å®¹ Dockerfile æ–‡ä»¶ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1

FROM eclipse-temurin:17-jdk-jammy as builder
WORKDIR /opt/app
COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN ./mvnw dependency:go-offline
COPY ./src ./src
RUN ./mvnw clean install
 
 
FROM eclipse-temurin:17-jre-jammy
WORKDIR /opt/app
EXPOSE 8080
COPY --from=builder /opt/app/target/*.jar /opt/app/*.jar
CMD ["java", "-jar", "/opt/app/*.jar" ]
</code></pre><p>åˆšå¼€å§‹å­¦ä¹  Dockerfile çš„åŒå­¦å¯èƒ½ä¼šæ„Ÿåˆ°ç–‘æƒ‘ï¼Œä¸ºä»€ä¹ˆè¿™é‡Œæœ‰ä¸¤ä¸ª FROM è¯­å¥å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œè¿™é‡Œä½¿ç”¨äº†å¤šé˜¶æ®µæ„å»ºçš„æ–¹å¼ï¼Œä½ å¯ä»¥ç†è§£ä¸ºï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µçš„æ„å»ºäº§ç‰©å¯ä»¥ä½œä¸ºä¸‹ä¸€ä¸ªé˜¶æ®µçš„è¾“å…¥ï¼Œè¿™é‡Œä½ åªéœ€è¦å…ˆçŸ¥é“è¿™ç§ç”¨æ³•å°±å¥½ï¼Œåé¢çš„è¯¾ç¨‹æˆ‘ä»¬è¿˜ä¼šæœ‰æ›´è¯¦ç»†çš„ä»‹ç»ã€‚</p><p><strong>æˆ‘ä»¬æ¥çœ‹ç¬¬ä¸€é˜¶æ®µçš„æ„å»ºï¼Œä¹Ÿå°±æ˜¯ä»ç¬¬ 3 è¡Œåˆ°ç¬¬ 9 è¡Œã€‚</strong>ç¬¬ 3 è¡Œ FROM è¡¨ç¤ºæŠŠ eclipse-temurin:17-jdk-jammy ä½œä¸º build é˜¶æ®µçš„åŸºç¡€é•œåƒï¼Œç„¶åä½¿ç”¨ WORKDIR å…³é”®å­—æŒ‡å®šäº†å·¥ä½œç›®å½•ä¸º /opt/appï¼Œåç»­çš„æ–‡ä»¶æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸ªå·¥ä½œç›®å½•ä¸‹å±•å¼€ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œç¬¬ 5 å’Œç¬¬ 6 è¡Œé€šè¿‡ COPY å…³é”®å­—å°† .mvn ç›®å½•å’Œ mvnwã€pom.xml æ–‡ä»¶å¤åˆ¶åˆ°äº†å·¥ä½œç›®å½•ä¸‹ï¼Œç¬¬ 7 è¡Œé€šè¿‡ RUN å…³é”®å­—è¿è¡Œ ./mvnw dependency:go-offline æ¥å®‰è£…ä¾èµ–ã€‚ç„¶åï¼Œç¬¬ 8 è¡Œå°† src ç›®å½•å¤åˆ¶åˆ°äº†é•œåƒä¸­ï¼Œç¬¬ 9 è¡Œä½¿ç”¨ RUN å…³é”®å­—æ‰§è¡Œ ./mvnw clean install è¿›è¡Œç¼–è¯‘ã€‚</p><p><strong>ç¬¬ 12 è¡Œåˆ° 16 è¡Œæ˜¯ç¬¬äºŒä¸ªæ„å»ºé˜¶æ®µã€‚</strong>ç¬¬ 12 è¡Œè¡¨ç¤ºä½¿ç”¨ eclipse-temurin:17-jre-jammy ä½œä¸ºåŸºç¡€é•œåƒï¼Œç¬¬ 13 è¡ŒåŒæ ·æŒ‡å®šäº†å·¥ä½œç›®å½•ä¸º /opt/appï¼Œç¬¬ 14 è¡Œçš„ EXPOSE å…³é”®å­—ä¹‹å‰æˆ‘ä»¬æœ‰æåˆ°è¿‡ï¼Œå®ƒæ˜¯ä¸€ä¸ªå¤‡æ³¨åŠŸèƒ½ï¼Œå¹¶ä¸æ˜¯è¦æš´éœ²çœŸå®å®¹å™¨ç«¯å£çš„æ„æ€ã€‚</p><p>ç¬¬ 15 è¡Œçš„ COPY è¯­å¥æ¯”è¾ƒå¤æ‚ï¼Œå®ƒæŒ‡çš„æ˜¯ä» builder é˜¶æ®µä¹Ÿå°±æ˜¯å°†ç¬¬ä¸€ä¸ªé˜¶æ®µä½äº /opt/app/target/ ç›®å½•ä¸‹æ‰€æœ‰çš„ .jar æ–‡ä»¶éƒ½æ‹·è´åˆ°å½“å‰æ„å»ºé˜¶æ®µé•œåƒçš„ /opt/app/ ç›®å½•ä¸‹ã€‚ç¬¬ 16 è¡Œä½¿ç”¨ CMD å…³é”®å­—å®šä¹‰äº†å¯åŠ¨å‘½ä»¤ï¼Œä¹Ÿå°±æ˜¯é€šè¿‡ java -jar çš„æ–¹å¼å¯åŠ¨åº”ç”¨ã€‚</p><p>æœ€åï¼Œ.dockerignore çš„åŠŸèƒ½å’Œæˆ‘ä»¬ç†Ÿæ‚‰çš„ .gitignore æ–‡ä»¶åŠŸèƒ½ç±»ä¼¼ï¼Œå®ƒæŒ‡çš„æ˜¯åœ¨æ„å»ºè¿‡ç¨‹ä¸­éœ€è¦å¿½ç•¥çš„æ–‡ä»¶æˆ–ç›®å½•ï¼Œåˆç†çš„æ–‡ä»¶å¿½ç•¥ç­–ç•¥å°†æœ‰åŠ©äºæé«˜æ„å»ºé•œåƒçš„é€Ÿåº¦ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå› ä¸ºæˆ‘ä»¬è¦åœ¨å®¹å™¨é‡Œé‡æ–°ç¼–è¯‘åº”ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿½ç•¥äº†æœ¬åœ°çš„ target ç›®å½•ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ docker build å‘½ä»¤æ¥æ„å»ºé•œåƒäº†ã€‚</p><pre><code class="language-yaml">$ docker build -t spring-boot .
</code></pre><p>å½“é•œåƒæ„å»ºå®Œæˆåï¼Œæˆ‘ä»¬è¦ä½¿ç”¨ docker run å‘½ä»¤å¯åŠ¨é•œåƒï¼Œå¹¶é€šè¿‡ --publish æš´éœ²ç«¯å£ã€‚</p><pre><code class="language-yaml">$ docker run --publish 8080:8080 spring-boot
......
2022-10-05 03:59:48.746&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] com.example.demo.DemoApplication&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Starting DemoApplication v0.0.1-SNAPSHOT using Java 17.0.4.1 on da50d0bb2460 with PID 1 (/opt/app/*.jar started by root in /opt/app)
2022-10-05 03:59:48.748&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] com.example.demo.DemoApplication&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: No active profile set, falling back to 1 default profile: "default"
2022-10-05 03:59:49.643&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] o.s.b.w.embedded.tomcat.TomcatWebServer&nbsp; : Tomcat initialized with port(s): 8080 (http)
2022-10-05 03:59:49.655&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] o.apache.catalina.core.StandardService&nbsp; &nbsp;: Starting service [Tomcat]
2022-10-05 03:59:49.656&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] org.apache.catalina.core.StandardEngine&nbsp; : Starting Servlet engine: [Apache Tomcat/9.0.65]
2022-10-05 03:59:49.754&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] o.a.c.c.C.[Tomcat].[localhost].[/]&nbsp; &nbsp; &nbsp; &nbsp;: Initializing Spring embedded WebApplicationContext
2022-10-05 03:59:49.755&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] w.s.c.ServletWebServerApplicationContext : Root WebApplicationContext: initialization completed in 933 ms
2022-10-05 03:59:50.105&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] o.s.b.w.embedded.tomcat.TomcatWebServer&nbsp; : Tomcat started on port(s): 8080 (http) with context path ''
2022-10-05 03:59:50.117&nbsp; INFO 1 --- [&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;main] com.example.demo.DemoApplication&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;: Started DemoApplication in 1.796 seconds (JVM running for 2.221)
</code></pre><p>æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œç»ˆç«¯ï¼Œå¹¶ä½¿ç”¨ curl è®¿é—® hello æ¥å£éªŒè¯è¿”å›å†…å®¹ã€‚</p><pre><code class="language-yaml">$ curl localhost:8080/hello&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
Hello World!
</code></pre><p>å¦‚æœè¦ç»ˆæ­¢ spring-boot åº”ç”¨ï¼Œä½ å¯ä»¥å›åˆ°æ‰§è¡Œ docker run çš„å‘½ä»¤è¡Œç»ˆç«¯ï¼Œå¹¶ä½¿ç”¨ ctrll+c æ¥åœæ­¢å®¹å™¨ã€‚</p><p>å¦‚æœä½ è·Ÿç€æˆ‘æ“ä½œåˆ°äº†è¿™é‡Œï¼Œè¯´æ˜ä½ ä¹Ÿå·²ç»æˆåŠŸä»¥ Jar åŒ…çš„æ–¹å¼å°† Spring Boot åº”ç”¨æ„å»ºä¸º Docker é•œåƒäº†ã€‚</p><h3>Spring Boot æ’ä»¶çš„æ„å»ºæ–¹å¼</h3><p>é™¤äº†ä½¿ç”¨ Jar åŒ…ï¼ŒSpring Boot åº”ç”¨è¿˜å¯ä»¥é€šè¿‡ ./mvnw spring-boot:run çš„æ–¹å¼å¯åŠ¨ï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠå®ƒä½œä¸ºé•œåƒçš„å¯åŠ¨å‘½ä»¤ã€‚</p><p>æˆ‘è¿˜æ˜¯ä»¥ Spring Boot ç¤ºä¾‹åº”ç”¨ä¸ºä¾‹ï¼Œæˆ‘åœ¨ç¤ºä¾‹åº”ç”¨ Dockerfile æ–‡ä»¶åŒçº§ç›®å½•ä¸‹å·²ç»æå‰å‡†å¤‡å¥½äº† Dockerfile-Boot æ–‡ä»¶ï¼Œä¸‹é¢æ˜¯è¯¥æ–‡ä»¶çš„å†…å®¹ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1

FROM eclipse-temurin:17-jdk-jammy

WORKDIR /app

COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN ./mvnw dependency:resolve

COPY src ./src
CMD ["./mvnw", "spring-boot:run"]
</code></pre><p>ç›¸æ¯”è¾ƒ Jar çš„å¯åŠ¨æ–¹å¼ï¼ŒSpring Boot æ’ä»¶çš„å¯åŠ¨æ–¹å¼æ˜¾å¾—æ›´åŠ ç®€å•ã€‚åœ¨æ„å»ºè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å®é™…ä¸Šè¿˜ç”¨äº†ä¸€ä¸ªå°æŠ€å·§ï¼šç¬¬ 7 å’Œç¬¬ 8 è¡Œä»£è¡¨å•ç‹¬å¤åˆ¶äº†ä¾èµ–æ¸…å•æ–‡ä»¶ pom.xml è€Œä¸æ˜¯å¤åˆ¶æ•´ä¸ªæ ¹ç›®å½•ï¼Œç›®çš„æ˜¯åœ¨ä¾èµ–ä¸å˜çš„æƒ…å†µä¸‹å……åˆ†åˆ©ç”¨ Docker æ„å»ºç¼“å­˜ã€‚</p><p>åœ¨è¿™ä¸ª Dockerfile æ–‡ä»¶ä¸­æœ‰ä¸¤æ¡å…³é”®çš„å‘½ä»¤ï¼Œä¸€ä¸ª mvnw dependency:resolve ç”¨äºå®‰è£…ä¾èµ–ï¼Œå¦ä¸€ä¸ª mvnw spring-boot:run å‘½ä»¤ç”¨æ¥å¯åŠ¨åº”ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ docker build å‘½ä»¤æ„å»ºé•œåƒï¼Œè¿™é‡Œè¦æ³¨æ„å¢åŠ  -f å‚æ•°æŒ‡å®šæ–°çš„ Dockerfile æ–‡ä»¶ã€‚</p><pre><code class="language-yaml">$ docker build -t spring-boot . -f Dockerfile-Boot
</code></pre><p>é•œåƒæ„å»ºæˆåŠŸåï¼Œä½¿ç”¨ docker run å‘½ä»¤å¯åŠ¨é•œåƒã€‚</p><pre><code class="language-yaml">$ docker run --publish 8080:8080 spring-boot
</code></pre><p>æœ€åï¼Œä½ å¯ä»¥å°è¯•ç”¨ curl è®¿é—® localhost:8080/hello æ¥å£ï¼Œå°†ä¼šå¾—åˆ° Hello World è¿”å›ç»“æœã€‚</p><p>Spring Boot æ’ä»¶çš„å¯åŠ¨æ–¹å¼è™½ç„¶æ¯”è¾ƒç®€å•ï¼Œä½†å®ƒå°†æ„å»ºè¿‡ç¨‹å»¶è¿Ÿåˆ°äº†å¯åŠ¨é˜¶æ®µï¼Œå¹¶ä¸”ä¾èµ–é•œåƒçš„ JDK å·¥å…·ï¼Œå¯¹äºç”Ÿäº§ç¯å¢ƒæ¥è¯´è¿™äº›éƒ½ä¸æ˜¯å¿…è¦çš„ã€‚å¦‚æœä½ é€šè¿‡ docker images å‘½ä»¤ä»”ç»†å¯¹æ¯”ä¸¤æ¬¡æ„å»ºé•œåƒå ç”¨çš„ç©ºé—´å¤§å°ï¼Œä½ ä¼šå‘ç°ï¼Œç¬¬ä¸€ç§æ–¹å¼æ„å»ºç”Ÿæˆçš„é•œåƒå¤§æ¦‚åœ¨ 280M å·¦å³ï¼Œè€Œç¬¬äºŒç§æ„å»ºæ–¹å¼ç”Ÿæˆçš„é•œåƒåœ¨ 500M å·¦å³ã€‚åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘æ›´æ¨èä½ ä½¿ç”¨ç¬¬ä¸€ç§æ–¹å¼æ¥æ„å»º Java é•œåƒã€‚</p><h2>Golang åº”ç”¨å®¹å™¨åŒ–</h2><p>ä¸‹é¢æˆ‘ä»¬ç»§ç»­æ¥çœ‹ Go åº”ç”¨çš„å®¹å™¨åŒ–ã€‚</p><p>ä»¥ Echo æ¡†æ¶ä¸ºä¾‹ï¼Œæˆ‘æå‰ç¼–å†™å¥½äº†ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹åº”ç”¨ã€‚åœ¨å°†ç¤ºä¾‹åº”ç”¨å…‹éš†åˆ°æœ¬åœ°åï¼Œä½ å¯ä»¥è¿›å…¥ docker/13/golang ç›®å½•å¹¶æŸ¥çœ‹ã€‚</p><pre><code class="language-yaml">$ cd gitops/docker/13/golang
$ ls -al
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; &nbsp;292 10&nbsp; 5 14:16 Dockerfile
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; &nbsp;599 10&nbsp; 5 14:12 go.mod
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; 2825 10&nbsp; 5 14:12 go.sum
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; &nbsp;235 10&nbsp; 5 14:13 main.go
</code></pre><p>main.go æ–‡ä»¶æ˜¯åº”ç”¨çš„ä¸»ä½“æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ª /hello æ¥å£ï¼Œé€šè¿‡ Get æ–¹æ³•è¯·æ±‚åï¼Œå°†è¿”å› Hello World å­—ç¬¦ä¸²ã€‚</p><pre><code class="language-yaml">package main

import (
    "net/http"
    "github.com/labstack/echo/v4"
)

func main() {
    e := echo.New()
    e.GET("/hello", func(c echo.Context) error {
        return c.String(http.StatusOK, "Hello World Golang")
    })
    e.Logger.Fatal(e.Start(":8080"))
}
</code></pre><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ Dockerfile çš„å†…å®¹ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1
FROM golang:1.17 as builder
WORKDIR /opt/app
COPY . .
RUN go build -o example

FROM ubuntu:latest
WORKDIR /opt/app
COPY --from=builder /opt/app/example /opt/app/example
EXPOSE 8080
CMD ["/opt/app/example"]
</code></pre><p>åŒæ ·åœ°ï¼Œè¿™ä¸ª Dockerfile åŒ…å«äº†ä¸¤ä¸ªæ„å»ºé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªæ„å»ºé˜¶æ®µæ˜¯ä»¥ golang:1.17 ä¸ºåŸºç¡€é•œåƒï¼Œç„¶åæˆ‘ä»¬æ‰§è¡Œ go build å‘½ä»¤ç¼–è¯‘å¹¶è¾“å‡ºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œå°†å…¶å‘½åä¸º exampleã€‚</p><p>ç¬¬äºŒä¸ªæ„å»ºé˜¶æ®µæ˜¯ä»¥ ubuntu:latest ä¸ºåŸºç¡€é•œåƒï¼Œç¬¬ 9 è¡Œé€šè¿‡ COPY å…³é”®å­—å°†ç¬¬ä¸€ä¸ªé˜¶æ®µæ„å»ºçš„ example å¯æ‰§è¡Œæ–‡ä»¶å¤åˆ¶åˆ°é•œåƒçš„ /opt/app/ ç›®å½•ä¸‹ï¼Œæœ€åï¼Œä½¿ç”¨ CMD æ¥è¿è¡Œ example å¯åŠ¨åº”ç”¨ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker build æ¥æ„å»ºé•œåƒã€‚</p><pre><code class="language-yaml">$ docker build -t golang .
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docker run æ¥å¯åŠ¨é•œåƒã€‚</p><pre><code class="language-yaml">$ docker run --publish 8080:8080 golang
&nbsp; &nbsp;____&nbsp; &nbsp; __
&nbsp; / __/___/ /&nbsp; ___
&nbsp;/ _// __/ _ \/ _ \
/___/\__/_//_/\___/ v4.9.0
High performance, minimalist Go web framework
https://echo.labstack.com
____________________________________O/_______
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; O\
â‡¨ http server started on [::]:8080
</code></pre><p>å¦‚æœä½ è¿˜æ²¡æœ‰ç»ˆæ­¢ä¹‹å‰è¿è¡Œçš„ Spring Boot ç¤ºä¾‹ï¼Œåœ¨è¿è¡Œ Golang ç¤ºä¾‹æ—¶ï¼Œä½ å¯èƒ½ä¼šå¾—åˆ° â€œBind for 0.0.0.0:8080 failed: port is already allocatedâ€ çš„é”™è¯¯ã€‚ä½ å¯ä»¥é€šè¿‡ docker ps å‘½ä»¤æ¥æŸ¥çœ‹ Spring Demo çš„å®¹å™¨ IDï¼Œå¹¶é€šè¿‡ docker stop [Container ID] æ¥ç»ˆæ­¢å®ƒã€‚è¿™æ—¶å€™å†è¿è¡Œ Golang ç¤ºä¾‹å°±èƒ½å¤Ÿæ­£å¸¸å¯åŠ¨äº†ã€‚</p><p>ç°åœ¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æ¥è®¿é—® localhost:8080/hello æ¥å£ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿”å›äº†é¢„æœŸçš„ Hello World Golang å­—ç¬¦ä¸²ã€‚</p><h2>Node.js åº”ç”¨å®¹å™¨åŒ–</h2><p>ä»¥ Express.js æ¡†æ¶ä¸ºä¾‹ï¼Œæˆ‘å·²ç»æå‰ç¼–å†™å¥½äº†ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œåœ¨å°†ç¤ºä¾‹åº”ç”¨å…‹éš†åˆ°æœ¬åœ°åï¼Œä½ å¯ä»¥è¿›å…¥ docker/13/node ç›®å½•å¹¶æŸ¥çœ‹ã€‚</p><pre><code class="language-yaml">$ cd gitops/docker/13/node
$ ls -al
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; &nbsp;12 10&nbsp; 5 16:45 .dockerignore
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 589 10&nbsp; 5 16:39 Dockerfile
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 230 10&nbsp; 5 16:44 app.js
drwxr-xr-x&nbsp; 60 weiwang&nbsp; staff&nbsp; &nbsp;1920 10&nbsp; 5 16:26 node_modules
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; 39326 10&nbsp; 5 16:26 package-lock.json
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 251 10&nbsp; 5 16:26 package.json
</code></pre><p>app.js æ˜¯ç¤ºä¾‹åº”ç”¨çš„ä¸»ä½“æ–‡ä»¶ï¼ŒåŒ…å«ä¸€ä¸ª /hello æ¥å£ã€‚å½“æˆ‘ä»¬é€šè¿‡ Get è¯·æ±‚è®¿é—®æ—¶ï¼Œä¼šè¿”å›â€œHello World Node.jsâ€å­—ç¬¦ä¸²ã€‚</p><pre><code class="language-yaml">const express = require('express')
const app = express()
const port = 3000

app.get('/hello', (req, res) =&gt; {
  res.send('Hello World Node.js')
})

app.listen(port, () =&gt; {
  console.log(`Example app listening on port ${port}`)
})
</code></pre><p>.dockerignore æ˜¯æ„å»ºé•œåƒæ—¶çš„å¿½ç•¥æ–‡ä»¶ï¼Œåœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¿½ç•¥äº† node_modules ç›®å½•ã€‚</p><pre><code class="language-yaml">$ cat .dockerignore
node_modules
</code></pre><p>æ¥ç€æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Dockerfile æ–‡ä»¶çš„å†…å®¹ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1
FROM node:latest AS build
RUN sed -i "s@http://\(deb\|security\).debian.org@https://mirrors.aliyun.com@g" /etc/apt/sources.list
RUN apt-get update &amp;&amp; apt-get install -y dumb-init
WORKDIR /usr/src/app
COPY package*.json ./
RUN npm ci --only=production
 

FROM node:16.17.0-bullseye-slim
ENV NODE_ENV production
COPY --from=build /usr/bin/dumb-init /usr/bin/dumb-init
USER node
WORKDIR /usr/src/app
COPY --chown=node:node --from=build /usr/src/app/node_modules /usr/src/app/node_modules
COPY --chown=node:node . /usr/src/app
CMD ["dumb-init", "node", "app.js"]
</code></pre><p>è¿™æ˜¯ä¸€ä¸ªç”±ä¸¤ä¸ªé˜¶æ®µç»„æˆçš„é•œåƒæ„å»ºæ–¹æ³•ã€‚ç¬¬ä¸€ä¸ªé˜¶æ®µä½¿ç”¨ node:latest ä½œä¸º build é˜¶æ®µçš„åŸºç¡€é•œåƒï¼ŒåŒæ—¶å®‰è£…äº† dumb-init ç»„ä»¶ã€‚æ­¤å¤–ï¼Œè¿™ç§æ„å»ºæ–¹æ³•è¿˜å°† package.json å’Œ package-lock.json å¤åˆ¶åˆ°é•œåƒå†…ï¼Œå¹¶é€šè¿‡ npm ci --only=production å‘½ä»¤å®‰è£…ä¾èµ–ã€‚</p><p>ä»ç¬¬ 10 è¡Œå¼€å§‹æ˜¯ç¬¬äºŒä¸ªæ„å»ºé˜¶æ®µï¼Œè¿™é‡Œä½¿ç”¨äº† node:16.17.0-bullseye-slim ä½œä¸ºåŸºç¡€é•œåƒï¼Œæ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜ä¸º Express é…ç½®äº† NODE_ENV=production çš„ç¯å¢ƒå˜é‡ï¼Œä»£è¡¨åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ã€‚è¿™ä¼šæ”¹å˜ Express.js æ¡†æ¶çš„é»˜è®¤é…ç½®ï¼Œå¦‚æ—¥å¿—ç­‰çº§ã€ç¼“å­˜å¤„ç†ç­–ç•¥ç­‰ã€‚ç„¶åï¼Œæˆ‘ä»¬è¿˜è¦å°† build é˜¶æ®µå®‰è£…çš„ dumb-init ç»„ä»¶ã€ä¾èµ–ä»¥åŠæºç å¤åˆ¶åˆ°ç¬¬äºŒä¸ªé˜¶æ®µçš„é•œåƒä¸­ï¼Œä¿®æ”¹æºç å’Œä¾èµ–ç›®å½•çš„ç”¨æˆ·ç»„ã€‚æœ€åï¼Œé€šè¿‡ CMD å‘½ä»¤ä½¿ç”¨ node å¯åŠ¨ app.jsã€‚</p><p>åœ¨å°† NodeJS å®¹å™¨åŒ–çš„è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸€ä¸ªéœ€è¦ç‰¹åˆ«æ³¨æ„çš„ç»†èŠ‚ï¼Œç”±äº NodeJS å¹¶ä¸æ˜¯è®¾è®¡ä»¥ PID=1 çš„è¿›ç¨‹è¿è¡Œçš„ï¼Œæ‰€ä»¥å¸¸è§„çš„å¯åŠ¨æ–¹å¼å¹¶ä¸èƒ½è®© NodeJS ç¨‹åºåœ¨å®¹å™¨å†…æ¥æ”¶åˆ° Kill ä¿¡å·ï¼Œè¿™ä¼šå¯¼è‡´ Node è¿›ç¨‹ä¸èƒ½è¢«ä¼˜é›…ç»ˆæ­¢ï¼ˆä¾‹å¦‚æ›´æ–°æ—¶çªç„¶ä¸­æ–­ï¼‰ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥é€šè¿‡ dumb-init ç»„ä»¶æ¥å¯åŠ¨ Node è¿›ç¨‹ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker build æ¥æ„å»ºé•œåƒã€‚</p><pre><code class="language-yaml">$ docker build -t nodejs .
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docker run æ¥å¯åŠ¨é•œåƒã€‚</p><pre><code class="language-yaml">$ docker run --publish 3000:3000 nodejs
Example app listening on port 3000
</code></pre><p>è¿›è¡Œåˆ°è¿™é‡Œï¼Œä½ å¯ä»¥ä½¿ç”¨ curl å‘½ä»¤æ¥è®¿é—® localhost:3000/hello æ¥å£ï¼ŒæŸ¥çœ‹æ˜¯å¦è¿”å›äº†é¢„æœŸçš„ Hello World Node.js å­—ç¬¦ä¸²ã€‚</p><h2>Vue åº”ç”¨å®¹å™¨åŒ–</h2><p>å¸¸è§çš„ Vue åº”ç”¨å®¹å™¨åŒ–æ–¹æ¡ˆæœ‰ä¸¤ç§ï¼Œç¬¬ä¸€ç§æ˜¯å°† http-server ç»„ä»¶ä½œä¸ºä»£ç†æœåŠ¡å™¨æ¥æ„å»ºé•œåƒï¼Œç¬¬äºŒç§æ˜¯è®© Nginx ä½œä¸ºä»£ç†æœåŠ¡å™¨æ¥æ„å»ºé•œåƒã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šåˆ†åˆ«ä»‹ç»è¿™ä¸¤ç§é•œåƒæ„å»ºæ–¹å¼ã€‚</p><h3>Http-server æ„å»ºæ–¹å¼</h3><p>å…ˆçœ‹ http-server çš„æ„å»ºæ–¹å¼ã€‚ä»¥ Vue æ¡†æ¶ä¸ºä¾‹ï¼Œæˆ‘å·²ç»æå‰å°†é¡¹ç›®è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œæ¥ä¸‹æ¥ä½ éœ€è¦å°†ç¤ºä¾‹åº”ç”¨å…‹éš†åˆ°æœ¬åœ°ï¼Œç„¶åè¿›å…¥ docker/13/vue/example ç›®å½•å¹¶æŸ¥çœ‹ã€‚</p><pre><code class="language-yaml">$ cd gitops/docker/13/vue/example
$ ls -al
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; &nbsp;12 10&nbsp; 5 17:26 .dockerignore
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 172 10&nbsp; 5 17:27 Dockerfile
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; &nbsp; 0 10&nbsp; 5 17:34 Dockerfile-Nginx
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 631 10&nbsp; 5 17:23 README.md
-rw-r--r--&nbsp; &nbsp;1 weiwang&nbsp; staff&nbsp; &nbsp; 337 10&nbsp; 5 17:23 index.html
......
</code></pre><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œ.dockerignore æ–‡ä»¶çš„å†…å®¹å’Œ Node.js åº”ç”¨ä¸€æ ·ï¼Œéƒ½æ˜¯å¿½ç•¥ node_modules ç›®å½•ï¼Œä»¥ä¾¿åŠ é€Ÿé•œåƒçš„æ„å»ºé€Ÿåº¦ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬é‡ç‚¹å…³æ³¨ Dockerfile æ–‡ä»¶å†…å®¹ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1

FROM node:lts-alpine
RUN npm install -g http-server
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

EXPOSE 8080
CMD [ "http-server", "dist" ]
</code></pre><p>ç®€å•åˆ†æä¸€ä¸‹ä¸Šé¢ Dockerfile çš„å†…å®¹ã€‚é¦–å…ˆä½¿ç”¨ node:lts-alpine ä½œä¸ºåŸºç¡€é•œåƒï¼Œç„¶åå®‰è£… http-server ä½œä¸ºä»£ç†æœåŠ¡å™¨ï¼Œç¬¬ 6 è¡Œä»£è¡¨çš„å«ä¹‰æ˜¯ï¼Œå°† package.json å’Œ package-lock.json å¤åˆ¶åˆ°é•œåƒå†…ï¼Œå¹¶ä½¿ç”¨ npm install å®‰è£…ä¾èµ–ã€‚è¿™é‡Œè®©ä¾èµ–å®‰è£…å’Œæºç å®‰è£…è§£è€¦çš„ç›®çš„æ˜¯å°½é‡ä½¿ç”¨ Docker é•œåƒæ„å»ºç¼“å­˜ï¼Œåªè¦åœ¨ package.json æ–‡ä»¶å†…å®¹ä¸å˜çš„æƒ…å†µä¸‹ï¼Œå³ä¾¿æ˜¯æºç æ”¹å˜ï¼Œéƒ½å¯ä»¥ä½¿ç”¨å·²ç»ä¸‹è½½å¥½çš„ npm ä¾èµ–ç¼“å­˜ã€‚</p><p>ä¾èµ–å®‰è£…å®Œæ¯•åï¼Œç¬¬ 8 è¡Œï¼Œæˆ‘ä»¬è¦å°†é¡¹ç›®æºç å¤åˆ¶åˆ°é•œåƒå†…ï¼Œå¹¶ä¸”é€šè¿‡ npm run build æ¥æ„å»º dist ç›®å½•ï¼Œæœ€åï¼Œç¬¬ 12 è¡Œï¼Œä½¿ç”¨ http-server æ¥å¯åŠ¨ dist ç›®å½•çš„é™æ€æ–‡ä»¶ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker build æ¥æ„å»ºé•œåƒäº†ã€‚</p><pre><code class="language-yaml">$ docker build -t vue .
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docker run å¯åŠ¨é•œåƒã€‚</p><pre><code class="language-yaml">$ docker run --publish 8080:8080 vue
Starting up http-server, serving dist

http-server version: 14.1.1

http-server settings:&nbsp;
CORS: disabled
......
</code></pre><p>åˆ°è¿™é‡Œï¼Œä½ å¯ä»¥æ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080">http://localhost:8080</a> ï¼Œå¦‚æœå‡ºç° Vue ç¤ºä¾‹åº”ç”¨çš„é¡¹ç›®ï¼Œè¯´æ˜é•œåƒæ„å»ºå®Œæˆï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src="https://static001.geekbang.org/resource/image/ca/f2/cae462930f97f9e5fb22bdf7ea3366f2.png?wh=1920x1038" alt="å›¾ç‰‡"></p><h3>Nginx æ„å»ºæ–¹å¼</h3><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ http-server æ¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œè¿™åœ¨å¼€å‘å’Œæµ‹è¯•åœºæ™¯ï¼Œæˆ–è€…æ˜¯åœ¨å°å‹çš„ä½¿ç”¨åœºæ™¯ä¸­æ˜¯å®Œå…¨å¯ä»¥çš„ã€‚ä¸è¿‡ï¼Œ<strong>åœ¨æ­£å¼çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘æ¨èä½ æŠŠ Nginx ä½œä¸ºåå‘ä»£ç†æœåŠ¡å™¨æ¥å¯¹å¤–æä¾›æœåŠ¡ï¼Œå®ƒä¹Ÿæ˜¯æ€§èƒ½æœ€å¥½ã€ä½¿ç”¨æœ€å¹¿æ³›å’Œç¨³å®šæ€§æœ€é«˜çš„ä¸€ç§æ–¹æ¡ˆã€‚</strong></p><p>åœ¨ Vue ç¤ºä¾‹é¡¹ç›®çš„åŒçº§ç›®å½•ä¸‹ï¼Œæˆ‘å·²ç»åˆ›å»ºå¥½äº†åä¸º Dockerfile-Nginx æ–‡ä»¶ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1

FROM node:lts-alpine as build-stage
WORKDIR /app
COPY package*.json ./
RUN npm install
COPY . .
RUN npm run build

FROM nginx:stable-alpine as production-stage
COPY --from=build-stage /app/dist /usr/share/nginx/html
EXPOSE 80
CMD ["nginx", "-g", "daemon off;"]
</code></pre><p>è¿™ä¸ª Dockerfile å®šä¹‰äº†ä¸¤ä¸ªæ„å»ºé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªé˜¶æ®µæ˜¯ç¬¬ 3 è¡Œåˆ°ç¬¬ 8 è¡Œçš„å†…å®¹ï¼Œå…¶ä»–çš„æ˜¯ç¬¬äºŒé˜¶æ®µçš„å†…å®¹ã€‚</p><p>ç¬¬ä¸€é˜¶æ®µçš„æ„å»ºè¿‡ç¨‹å’Œæˆ‘ä»¬åœ¨ä¸Šé¢æåˆ°çš„ http-server çš„æ„å»ºæ–¹å¼éå¸¸ç±»ä¼¼ï¼Œå®ƒæ˜¯ä»¥ node:lts-alpine ä¸ºåŸºç¡€é•œåƒï¼ŒåŒæ—¶å¤åˆ¶ package.json å’Œ package-lock.json å¹¶å®‰è£…ä¾èµ–ï¼Œç„¶åå†å¤åˆ¶é¡¹ç›®æºç å¹¶ä¸”æ‰§è¡Œ npm run build æ¥æ„å»ºé¡¹ç›®ï¼Œç”Ÿæˆ dist ç›®å½•ã€‚</p><p>ç¬¬äºŒä¸ªé˜¶æ®µçš„æ„å»ºè¿‡ç¨‹åˆ™æ˜¯å¼•å…¥äº†ä¸€ä¸ªæ–°çš„ nginx:stable-alpine é•œåƒä½œä¸ºè¿è¡Œé•œåƒï¼Œè¿˜å°†ç¬¬ä¸€é˜¶æ®µæ„å»ºçš„ dist ç›®å½•å¤åˆ¶åˆ°äº†ç¬¬äºŒé˜¶æ®µçš„ /usr/share/nginx/html ç›®å½•ä¸­ã€‚è¿™ä¸ªç›®å½•æ˜¯ Nginx é»˜è®¤çš„ç½‘é¡µç›®å½•ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒNginx å°†ä½¿ç”¨è¯¥ç›®å½•çš„å†…å®¹ä½œä¸ºé™æ€èµ„æºã€‚æœ€åç¬¬ 13 è¡Œä»¥å‰å°çš„æ–¹å¼å¯åŠ¨ Nginxã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ docker build æ¥æ„å»ºé•œåƒã€‚</p><pre><code class="language-yaml">$ docker build -t vue-nginx -f Dockerfile-Nginx .
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docker run å¯åŠ¨é•œåƒã€‚</p><pre><code class="language-yaml">$ docker run --publish 8080:80 vue-nginx
/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration
/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/
/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh
10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf
10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf
/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh
......
</code></pre><p>æœ€åï¼Œæ‰“å¼€æµè§ˆå™¨è®¿é—® <a href="http://localhost:8080">http://localhost:8080</a> éªŒè¯ä¸€ä¸‹ï¼Œå¦‚æœå‡ºç°å’Œå‰é¢æåˆ°çš„ http-server æ„å»ºæ–¹å¼ä¸€æ ·çš„ Vue ç¤ºä¾‹åº”ç”¨ç•Œé¢ï¼Œå°±è¯´æ˜é•œåƒæ„å»ºæˆåŠŸäº†ã€‚</p><h2>æ„å»ºå¤šå¹³å°é•œåƒ</h2><p>å¥½äº†ï¼Œä¸Šé¢çš„æ¡ˆä¾‹ï¼Œæˆ‘ä»¬éƒ½æ˜¯é€šè¿‡åœ¨æœ¬åœ°æ‰§è¡Œ docker build å‘½ä»¤æ¥æ„å»ºé•œåƒï¼Œç„¶ååœ¨æœ¬åœ°é€šè¿‡ docker run å‘½ä»¤æ¥æ‰§è¡Œçš„ã€‚å®é™…ä¸Šï¼Œåœ¨æ„å»ºé•œåƒæ—¶ï¼ŒDocker ä¼šé»˜è®¤æ„å»ºæœ¬æœºå¯¹åº”å¹³å°çš„é•œåƒï¼Œä¾‹å¦‚å¸¸è§çš„ AMD64 å¹³å°ï¼Œè¿™åœ¨å¤§å¤šæ•°æƒ…å†µæ˜¯é€‚ç”¨çš„ã€‚</p><p>ä½†æ˜¯ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸åŒå¹³å°çš„è®¾å¤‡å°è¯•å¯åŠ¨è¿™ä¸ªé•œåƒæ—¶ï¼Œå¯èƒ½ä¼šé‡åˆ°ä¸‹é¢çš„é—®é¢˜ã€‚</p><pre><code class="language-yaml">WARNING: The requested image's platform (linux/arm64/v8) does not match the detected host platform (linux/amd64) and no specific platform was requested
</code></pre><p>äº§ç”Ÿè¿™ä¸ªé—®é¢˜çš„åŸå› æ˜¯ï¼Œæ„å»ºå’Œè¿è¡Œè®¾å¤‡çš„ CPU å¹³å°å­˜åœ¨å·®å¼‚ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæœ€å…¸å‹çš„ä¾‹å­æ˜¯æ„å»ºé•œåƒçš„è®¡ç®—æœºæ˜¯ AMD64 æ¶æ„ï¼Œä½†è¿è¡Œé•œåƒçš„æœºå™¨æ˜¯ ARM64ã€‚</p><p>è¦æŸ¥çœ‹é•œåƒé€‚ç”¨äºä»€ä¹ˆå¹³å°ï¼Œä½ å¯ä»¥æ‰¾åˆ° DockerHub é•œåƒè¯¦æƒ…é¡µã€‚ä¾‹å¦‚ï¼Œ Alpine é•œåƒé€‚ç”¨çš„å¹³å°å°±å¯ä»¥åœ¨è¿™ä¸ª<a href="https://hub.docker.com/_/alpine/tags">é“¾æ¥</a>æŸ¥çœ‹ï¼Œè¯¦æƒ…é¡µæˆªå›¾å¦‚ä¸‹ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/fa/9d/fa9e309a63a2e8ac5dbbebab1a30529d.png?wh=1920x966" alt="å›¾ç‰‡"></p><p>ä»è¿™ä¸ªé¡µé¢æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒApline é•œåƒé€‚ç”¨çš„å¹³å°éå¸¸å¤šï¼Œä¾‹å¦‚ Linux/386ã€Linux/amd64 ç­‰ç­‰ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œåœ¨æ„å»ºé•œåƒæ—¶ï¼Œæˆ‘ä»¬åªä¼šæ„å»ºæœ¬æœºå¹³å°çš„é•œåƒï¼Œä½†æ˜¯å½“æ‹‰å–é•œåƒæ—¶ï¼ŒDocker ä¼šè‡ªåŠ¨æ‹‰å–ç¬¦åˆå½“å‰å¹³å°çš„é•œåƒç‰ˆæœ¬ã€‚</p><p>é‚£ä¹ˆï¼Œæ€ä¹ˆæ‰èƒ½çœŸæ­£å®ç°è·¨å¹³å°çš„<strong>â€œä¸€æ¬¡æ„å»ºï¼Œåˆ°å¤„è¿è¡Œâ€</strong>ç›®æ ‡å‘¢ï¼ŸDocker ä¸ºæˆ‘ä»¬æä¾›äº†æ„å»ºå¤šå¹³å°é•œåƒçš„æ–¹æ³•ï¼šbuildxã€‚</p><h3>åˆå§‹åŒ–</h3><p>è¦ä½¿ç”¨ Buildxï¼Œé¦–å…ˆéœ€è¦åˆ›å»ºæ„å»ºå™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨ docker buildx create å‘½ä»¤æ¥åˆ›å»ºå®ƒï¼Œå¹¶å°†å…¶å‘½åä¸º mybuilderã€‚</p><pre><code class="language-yaml">$ $ docker buildx create --name builder
builder
</code></pre><p>ç„¶åï¼Œå°† mybuilder è®¾ç½®ä¸ºé»˜è®¤çš„æ„å»ºå™¨ã€‚</p><pre><code class="language-yaml">$ docker buildx use builder
</code></pre><p>æ¥ä¸‹æ¥ï¼Œåˆå§‹åŒ–æ„å»ºå™¨ï¼Œè¿™ä¸€æ­¥ä¸»è¦æ˜¯å¯åŠ¨ buildkit å®¹å™¨ã€‚</p><pre><code class="language-yaml">$ $ docker buildx inspect --bootstrap
[+] Building 19.1s (1/1) FINISHED&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp;=&gt; [internal] booting buildkit&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 19.1s
&nbsp;=&gt; =&gt; pulling image moby/buildkit:buildx-stable-1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;18.3s
&nbsp;=&gt; =&gt; creating container buildx_buildkit_mybuilder0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 0.8s
Name:&nbsp; &nbsp;builder
Driver: docker-container

Nodes:
Name:&nbsp; &nbsp; &nbsp; mybuilder0
Endpoint:&nbsp; unix:///var/run/docker.sock
Status:&nbsp; &nbsp; running
Buildkit:&nbsp; v0.10.4
Platforms: linux/amd64, linux/amd64/v2, linux/amd64/v3, linux/arm64, linux/riscv64, linux/ppc64le, linux/s390x, linux/386, linux/mips64le, linux/mips64, linux/arm/v7, linux/arm/v6
</code></pre><p>åˆå§‹åŒ–å®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥ä»è¿”å›ç»“æœä¸­çœ‹åˆ°æ”¯æŒçš„å¹³å°ï¼Œä¾‹å¦‚ Linux/amd64ã€Linux/arm64 ç­‰ã€‚</p><h3>æ„å»ºå¤šå¹³å°é•œåƒ</h3><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±å¯ä»¥å°è¯•ä½¿ç”¨ buildx æ¥æ„å»ºå¤šå¹³å°é•œåƒäº†ã€‚æˆ‘å·²ç»æå‰ç¼–å†™å¥½äº†ä¸€ä¸ªç®€å•ç¤ºä¾‹ï¼Œåœ¨å°†ç¤ºä¾‹åº”ç”¨å…‹éš†åˆ°æœ¬åœ°åï¼Œä½ å¯ä»¥è¿›å…¥ docker/13/multi-arch ç›®å½•å¹¶æŸ¥çœ‹ã€‚</p><pre><code class="language-yaml">$ cd gitops/docker/13/multi-arch
$ ls -al
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; &nbsp;439 10&nbsp; 5 23:49 Dockerfile
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; 1075 10&nbsp; 5 18:34 go.mod
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; 6962 10&nbsp; 5 18:34 go.sum
-rw-r--r--&nbsp; 1 weiwang&nbsp; staff&nbsp; &nbsp;397 10&nbsp; 5 18:39 main.go
</code></pre><p>main.go æ˜¯ç¤ºä¾‹åº”ç”¨çš„ä¸»ä½“æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯åŠ¨ä¸€ä¸ª HTTP æœåŠ¡å™¨ï¼Œè®¿é—®æ ¹è·¯å¾„å¯ä»¥è¿”å› Runtime åŒ…çš„ä¸€äº›å†…ç½®å˜é‡ã€‚</p><pre><code class="language-yaml">package main
import (
    "net/http"
    "runtime"
    "github.com/gin-gonic/gin"
)
var (
    r = gin.Default()
)
func main() {
    r.GET("/", indexHandler)
    r.Run(":8080")
}
func indexHandler(c *gin.Context) {
    var osinfo = map[string]string{
        "arch":    runtime.GOARCH,
        "os":      runtime.GOOS,
        "version": runtime.Version(),
    }
    c.JSON(http.StatusOK, osinfo)
}
</code></pre><p>ç›¸æ¯”è¾ƒå•ä¸€å¹³å°çš„æ„å»ºæ–¹æ³•ï¼Œåœ¨æ„å»ºå¤šå¹³å°é•œåƒçš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ Dockerfile å†…ä½¿ç”¨ä¸€äº›å†…ç½®å˜é‡ï¼Œä¾‹å¦‚ BUILDPLATFORMã€TARGETOS å’Œ TARGETARCHï¼Œä»–ä»¬åˆ†åˆ«å¯¹åº”æ„å»ºå¹³å°ï¼ˆä¾‹å¦‚ Linux/amd64ï¼‰ã€ç³»ç»Ÿï¼ˆä¾‹å¦‚ Linuxï¼‰å’Œæ¶æ„ï¼ˆä¾‹å¦‚ AMD64ï¼‰ã€‚</p><pre><code class="language-yaml"># syntax=docker/dockerfile:1
FROM --platform=$BUILDPLATFORM golang:1.18 as build
ARG TARGETOS TARGETARCH
WORKDIR /opt/app
COPY go.* ./
RUN go mod download
COPY . .
RUN --mount=type=cache,target=/root/.cache/go-build \
GOOS=$TARGETOS GOARCH=$TARGETARCH go build -o /opt/app/example .

FROM ubuntu:latest
WORKDIR /opt/app
COPY --from=build /opt/app/example ./example
CMD ["/opt/app/example"]
</code></pre><p>è¿™ä¸ª Dockerfile åŒ…å«ä¸¤ä¸ªæ„å»ºé˜¶æ®µï¼Œç¬¬ä¸€ä¸ªæ„å»ºé˜¶æ®µæ˜¯ä»ç¬¬ 2 è¡Œè‡³ç¬¬ 9 è¡Œï¼Œç¬¬äºŒä¸ªæ„å»ºé˜¶æ®µæ˜¯ä»ç¬¬ 11 è¡Œåˆ°ç¬¬ 14 è¡Œã€‚</p><p><strong>æˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€ä¸ªæ„å»ºé˜¶æ®µã€‚</strong></p><p>ç¬¬ 2 è¡Œ FROM åŸºç¡€é•œåƒå¢åŠ äº†ä¸€ä¸ª --platform=$BUILDPLATFORM å‚æ•°ï¼Œå®ƒä»£è¡¨â€œå¼ºåˆ¶ä½¿ç”¨ä¸åŒå¹³å°çš„åŸºç¡€é•œåƒâ€ï¼Œä¾‹å¦‚ Linux/amd64ã€‚åœ¨æ²¡æœ‰è¯¥å‚æ•°é…ç½®çš„æƒ…å†µä¸‹ï¼ŒDocker é»˜è®¤ä¼šä½¿ç”¨æ„å»ºå¹³å°ï¼ˆæœ¬æœºï¼‰å¯¹åº”æ¶æ„çš„åŸºç¡€é•œåƒã€‚</p><p>ç¬¬ 3 è¡Œ ARG å£°æ˜äº†ä½¿ç”¨ä¸¤ä¸ªå†…ç½®å˜é‡ TARGETOS å’Œ TARGETARCHï¼ŒTARGETOS ä»£è¡¨ç³»ç»Ÿï¼Œä¾‹å¦‚ Linuxï¼ŒTARGETARCH åˆ™ä»£è¡¨å¹³å°ï¼Œä¾‹å¦‚ Amd64ã€‚è¿™ä¸¤ä¸ªå‚æ•°å°†ä¼šåœ¨ Golang äº¤å‰ç¼–è¯‘æ—¶ç”Ÿæˆå¯¹åº”å¹³å°çš„äºŒè¿›åˆ¶æ–‡ä»¶ã€‚</p><p>ç¬¬ 4 è¡Œ WORKDIR å£°æ˜äº†å·¥ä½œç›®å½•ã€‚</p><p>ç¬¬ 5 è¡Œçš„æ„æ€æ˜¯é€šè¿‡ COPY å°† go.mod å’Œ go.sum æ‹·è´åˆ°é•œåƒä¸­ï¼Œå¹¶åœ¨ç¬¬ 6 è¡Œä½¿ç”¨ RUN æ¥è¿è¡Œ go mod download ä¸‹è½½ä¾èµ–ã€‚è¿™æ ·ï¼Œåœ¨è¿™ä¸¤ä¸ªæ–‡ä»¶ä¸å˜çš„å‰æä¸‹ï¼ŒDocker å°†ä½¿ç”¨æ„å»ºç¼“å­˜æ¥åŠ å¿«æ„å»ºé€Ÿåº¦ã€‚</p><p>åœ¨ä¸‹è½½å®Œä¾èµ–ä¹‹åï¼Œæˆ‘ä»¬é€šè¿‡ç¬¬ 7 è¡ŒæŠŠæ‰€æœ‰æºç æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒå†…ã€‚</p><p>ç¬¬ 8 è¡Œæœ‰ä¸¤ä¸ªå«ä¹‰ï¼Œé¦–å…ˆï¼Œ --mount=type=cache,target=/root/.cache/go-build çš„ç›®çš„æ˜¯å‘Šè¯‰Docker ä½¿ç”¨ Golang æ„å»ºç¼“å­˜ï¼ŒåŠ å¿«é•œåƒæ„å»ºçš„é€Ÿåº¦ã€‚æ¥ä¸‹æ¥ï¼ŒGOOS=$TARGETOS GOARCH=$TARGETARCH go build -o /opt/app/example . ä»£è¡¨çš„å«ä¹‰æ˜¯ Golang äº¤å‰ç¼–è¯‘ã€‚æ³¨æ„ï¼Œ$TARGETOS å’Œ $TARGETARCH æ˜¯æˆ‘ä»¬æåˆ°çš„å†…ç½®å˜é‡ï¼Œåœ¨å…·ä½“æ„å»ºé•œåƒçš„æ—¶å€™ï¼ŒDocker ä¼šå¸®æˆ‘ä»¬å¡«å……è¿›å»ã€‚</p><p><strong>ç¬¬äºŒä¸ªæ„å»ºé˜¶æ®µæ¯”è¾ƒç®€å•ï¼Œä¸»è¦æ˜¯ä½¿ç”¨ ubuntu:latest åŸºç¡€é•œåƒï¼Œå°†ç¬¬ä¸€ä¸ªæ„å»ºé˜¶æ®µç”Ÿæˆçš„äºŒè¿›åˆ¶æ–‡ä»¶å¤åˆ¶åˆ°é•œåƒå†…ï¼Œç„¶åæŒ‡å®šé•œåƒçš„å¯åŠ¨å‘½ä»¤ã€‚</strong></p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¼€å§‹æ„å»ºå¤šå¹³å°é•œåƒäº†ã€‚</p><p>åœ¨å¼€å§‹æ„å»ºä¹‹å‰ï¼Œå…ˆæ‰§è¡Œ docker login ç™»å½•åˆ° DockerHubã€‚</p><pre><code class="language-yaml">$ docker login
Username:
Password:
Login Succeeded
</code></pre><p>æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ docker buildx build ä¸€æ¬¡æ€§æ„å»ºå¤šå¹³å°é•œåƒã€‚</p><pre><code class="language-yaml">$ docker buildx build --platform linux/amd64,linux/arm64 -t lyzhang1999/multi-arch:latest --push&nbsp; .
</code></pre><p>åœ¨è¿™ä¸ªå‘½ä»¤ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ --platform å‚æ•°æŒ‡å®šäº†ä¸¤ä¸ªå¹³å°ï¼šLinux/amd64 å’Œ Linux/arm64ï¼ŒåŒæ—¶ -t å‚æ•°æŒ‡å®šäº†é•œåƒçš„ Tagï¼Œè€Œ --push å‚æ•°åˆ™ä»£è¡¨æ„å»ºå®Œæˆåç›´æ¥å°†é•œåƒæ¨é€åˆ° DockerHubã€‚</p><p>è¿˜è®°å¾—æˆ‘ä»¬åœ¨ Dockerfile ç¬¬ 2 è¡Œå¢åŠ çš„ --platform=$BUILDPLATFORM å‚æ•°å—ï¼Ÿå½“æ‰§è¡Œè¿™æ¡å‘½ä»¤æ—¶ï¼ŒDocker ä¼šåˆ†åˆ«ä½¿ç”¨ Amd64 å’Œ Arm64 ä¸¤ä¸ªå¹³å°çš„ golang:1.18 é•œåƒï¼Œå¹¶ä¸”åœ¨å¯¹åº”çš„é•œåƒå†…æ‰§è¡Œç¼–è¯‘è¿‡ç¨‹ã€‚</p><p>æ‰§è¡Œå®Œå‘½ä»¤åï¼Œé•œåƒä¼šä¸Šä¼ åˆ° DockerHub å¹³å°ã€‚è¿›å…¥è¿™ä¸ªé•œåƒè¯¦æƒ…é¡µæˆ‘ä»¬å°±ä¼šå‘ç°å®ƒåŒæ—¶å…¼å®¹äº† Amd64 å’Œ Arm64 ä¸¤ä¸ªå¹³å°ã€‚è¿™æ ·ï¼Œå¤šå¹³å°é•œåƒå°±æ„å»ºå®Œæˆäº†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/ab/77/ab41d5c634eff040c1a05b49708c9077.png?wh=1920x889" alt="å›¾ç‰‡"></p><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¸ºä½ ä»‹ç»äº†ä¸»æµè¯­è¨€é•œåƒæ„å»ºçš„æ¡ˆä¾‹ï¼ŒåŒ…æ‹¬åç«¯è¯­è¨€ Golangã€Javaã€Node.js ä»¥åŠå‰ç«¯ Vue æ¡†æ¶ã€‚</p><p>åœ¨è¿™äº›æ¡ˆä¾‹ä¸­ï¼Œæˆ‘å°½é‡æŒ‰ç…§çœŸå®çš„ç”Ÿäº§ç¯å¢ƒæ¥ç¼–å†™ Dockerfileï¼Œæˆ‘ä½¿ç”¨åˆ°äº†ä¸€äº› Dockerfile çš„é«˜çº§ç”¨æ³•ï¼Œä¾‹å¦‚å¤šé˜¶æ®µæ„å»ºã€ä½¿ç”¨ç¼“å­˜å’Œä½¿ç”¨ .dockerignore ç­‰ï¼Œè¿™äº›ç”¨æ³•å¯ä»¥å¸®åŠ©æˆ‘ä»¬åŠ é€Ÿæ„å»ºé•œåƒå’Œç¼©å°é•œåƒå¤§å°ã€‚å½“ä½ éœ€è¦å°†å®é™…çš„ä¸šåŠ¡è¿›è¡Œå®¹å™¨åŒ–æ”¹é€ æ—¶ï¼Œå¯ä»¥ç›´æ¥å‚è€ƒæˆ‘ç¼–å†™çš„æ¡ˆä¾‹ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘è¿˜ä»‹ç»äº†å¦‚ä½•ä½¿ç”¨ buildx æ„å»ºå¤šå¹³å°é•œåƒã€‚åœ¨è¿™ä¸€éƒ¨åˆ†ï¼Œæˆ‘é€šè¿‡ä¸€ä¸ªçœŸå®çš„ä¾‹å­ä»‹ç»äº†å¦‚ä½•æ„å»º Golang çš„å¤šå¹³å°é•œåƒã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¤šå¹³å°é•œåƒå¹¶ä¸å¸¸ç”¨ï¼Œä½†å¦‚æœä½ æ„å»ºçš„é•œåƒéœ€è¦å…¼å®¹ä¸åŒçš„ CPU å¹³å°ï¼Œé‚£å°±å¯ä»¥é€šè¿‡è¿™ç§æ–¹æ³•æ¥å®ç°ã€‚</p><p>è¿™èŠ‚è¯¾æˆ‘è¿˜æåˆ°äº†â€œå¤šé˜¶æ®µæ„å»ºâ€ï¼Œä½†å¹¶æ²¡æœ‰å¯¹å®ƒåšæ·±å…¥è®²è§£ï¼Œè¿™æ˜¯æˆ‘ä»¬ä¸‹èŠ‚è¯¾çš„é‡ç‚¹ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>ç»“åˆç›¸å…³èµ„æ–™ï¼Œè¯·ä½ ç®€å•åˆ†äº«ä¸€ä¸‹ä¸ºä»€ä¹ˆæˆ‘ä»¬èƒ½æ„å»ºéæœ¬åœ°å¹³å°çš„é•œåƒå‘¢ï¼Ÿï¼ˆæç¤ºï¼šDocker QEMUã€‚ï¼‰</p><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>éƒ‘æµ·æˆ</span>
  </div>
  <div class="_2_QraFYR_0">æ€è€ƒé¢˜ï¼šæŸ¥äº†ä¸€äº›å…³äºqemuçš„åŸç†ï¼Œå°è¯•ç†è§£ä¸€ä¸‹ã€‚docker buildx é€šè¿‡qemuçš„user modï¼ˆbinfmt_miscï¼‰æ³¨å†Œä¸€ä¸ªè½¬æ¢ç¨‹åºåŠ¨æ€è½¬æ¢ä¸åŒcpuæ¶æ„ä¹‹é—´çš„å‘½ä»¤ğŸ˜</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘ğŸ»å¾ˆæ˜“æ‡‚çš„åŸç†è§£é‡Šã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-18 10:31:21</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/64/08/0287f41f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>äº‰å…‰ Alan</span>
  </div>
  <div class="_2_QraFYR_0">å¤šå¹³å°æ„å»ºåœ¨dockerfileå†™æ¶æ„ä¿¡æ¯æ„Ÿè§‰å¾ˆéº»çƒ¦<br><br>æˆ‘ä»¬çš„åšæ³•æ˜¯from çš„åŸºç¡€é•œåƒåšæˆå¤šæ¶æ„ï¼Œç„¶ådockerfileæ­£å¸¸å†™å³å¯ï¼Œæ„å»ºçš„æ—¶å€™æŒ‡å®šæ¶æ„å°±è¡Œäº†</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¹Ÿæ˜¯ä¸€ç§ä¸é”™çš„å®è·µæ–¹å¼ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-10 21:41:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_df0d4d</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®.dockerignoreæ˜¯ä¸æ˜¯åªæœ‰Dockerfileä¸­æŒ‡å®šCOPY . .çš„æ—¶å€™æ‰æœ‰ä½œç”¨ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ï¼Œé™¤äº† COPYï¼ŒADD æŒ‡ä»¤ä¹Ÿä¼šå¿½ç•¥ .dockerignore å®šä¹‰çš„å†…å®¹ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-08 17:17:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_df0d4d</span>
  </div>
  <div class="_2_QraFYR_0">å¤šé˜¶æ®µæ„å»ºï¼Œé‚£ä¸ºä»€ä¹ˆä¸ç›´æ¥ç”¨ä¸“é—¨çš„æ‰“åŒ…æœåŠ¡å™¨æ„å»ºå‘¢ï¼Œç„¶åç›´æ¥ç¬¬äºŒé˜¶æ®µæ„å»ºå°±å¥½äº†ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¹Ÿæ˜¯ä¸€ç§æ–¹å¼ï¼Œä¸è¿‡åŠ å…¥ä¸“ç”¨çš„æ‰“åŒ…æœåŠ¡å™¨å°±å˜æˆæœ‰çŠ¶æ€äº†ï¼ŒDockerfile çš„æ€æƒ³æ˜¯å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹æ„å»ºã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-08 16:02:21</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/DYAIOgq83erUYW4duhqyicJEAOaEAbtSiaz22iaUmV1Mh1SJGcwRgicyZC16Rk3fJFvwXuhZJP6lqjLKCH13TEvrGg/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é™ˆæ•</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆä½ å¥½ï¼Œè¯·æ•™ä¸‹ï¼Œæœ¬èŠ‚è¯¾çš„ nginx é•œåƒæ„å»ºæ˜¯æŠŠé™æ€èµ„æºæ”¾åœ¨é•œåƒä¸­ï¼Œå¦‚æœæˆ‘ä»¬é‡‡ç”¨ pvc æŒ‚è½½é™æ€èµ„æºçš„æ–¹å¼ï¼Œæ˜¯ä¸æ˜¯å¯ä»¥é¿å…æ¯æ¬¡æ”¹ä»£ç éœ€è¦é‡æ‰“é•œåƒï¼Œé‡å¯å®¹å™¨ï¼Ÿè¿™ç§æ–¹å¼ä¼šæ›´å¥½å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸€èˆ¬ä¸è¿™ä¹ˆåšã€‚å› ä¸ºå¦‚æœæŒ‰è¿™ä¸ªæ–¹æ¡ˆçš„è¯ï¼ŒPVC çš„ä»£ç æ¥æºå¯èƒ½æ˜¯ ConfigMap æˆ–è€… Secretï¼Œè€Œä»–ä»¬çš„å¤§å°æ˜¯æœ‰é™åˆ¶çš„ï¼Œå¦å¤–æ›´æ–°å®ƒä»¬ä¹Ÿä¸æ–¹ä¾¿ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-03-12 09:13:07</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/dd/09/feca820a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>helloworld</span>
  </div>
  <div class="_2_QraFYR_0">goçš„ä¸¤é˜¶æ®µæ„å»ºæœ‰ä¸€ä¸ªé—®é¢˜ï¼Œæ¯æ¬¡goä»£ç æœ‰æ›´æ–°é‡æ–°buildï¼Œéƒ½ä¼šå¯¼è‡´é‡æ–°ä¸‹è½½æ‰€æœ‰ä¾èµ–åº“ï¼Œæ²¡æ³•åˆ©ç”¨ç¼“å­˜ï¼Œç¼–è¯‘é€Ÿåº¦è¢«æ‹–çš„å¾ˆæ…¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘ğŸ» æ˜¯çš„ï¼Œè¿™é‡Œæ²¡æœ‰è€ƒè™‘åˆ°å…ˆå®‰è£…ä¾èµ–ä»¥åŠç¼“å­˜çš„é—®é¢˜ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-20 09:17:11</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/eXPVCBWf4piaxJZL6tibMTjWqYfu9gDCkpgfRDAASMn4YOybkriabMw4VGlwqDIbAt26R1LysGWfKDhiaWNxnAicM9w/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_988110</span>
  </div>
  <div class="_2_QraFYR_0"> =&gt; CACHED [builder 4&#47;7] COPY mvnw pom.xml .&#47;                                                                                    0.0s <br> =&gt; ERROR [builder 5&#47;7] RUN .&#47;mvnw dependency:go-offline   <br><br>è€å¸ˆä½ å¥½ï¼Œä¸ºä»€ä¹ˆä¼šæç¤ºè¯¥errorä¿¡æ¯ã€‚å®¹å™¨é‡Œé¢æ˜¯æœ‰è¿™ä¸ªæ–‡ä»¶çš„</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯èƒ½æ˜¯ç½‘ç»œåŸå› å¯¼è‡´çš„ï¼Œç”¨é¦™æ¸¯çš„è™šæ‹Ÿæœºæ„å»ºè¯•è¯•ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-11 17:25:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/de/0e/af8dd241.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>GeekZd</span>
  </div>
  <div class="_2_QraFYR_0">Step 1&#47;12 : FROM eclipse-temurin:v17-jdk-jammy as builder<br>Error parsing reference: &quot;eclipse-temurin:v17-jdk-jammy as builder&quot; is not a valid repository&#47;tag: invalid reference format  è¿™ä¸ªæŠ¥é”™å’‹å›äº‹ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¯•ä¸€ä¸‹ç›´æ¥ç”¨ docker pull è¿™ä¸ªé•œåƒçœ‹çœ‹æ˜¯ä¸æ˜¯ç½‘ç»œé—®é¢˜ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-06 22:46:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/ce/6d/0c15c18a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¾æ›™è¾‰</span>
  </div>
  <div class="_2_QraFYR_0">ä¸ºä»€ä¹ˆéœ€è¦ä¸¤æ¬¡æ„å»ºï¼Œåªè¦ç¬¬ä¸€æ¬¡æ„å»ºå¯ä»¥å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: èƒ½å…·ä½“ä¸€ç‚¹å˜›</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-29 09:30:58</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/ec/21/b0fe1bfd.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Adam</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œé™¤äº†docker buildxè¿™ç§å·¥å…·å¤–ï¼Œè¿˜æœ‰æ²¡æœ‰å…¶å®ƒå·¥å…·ä¹Ÿå¯ä»¥ç”¨æ¥è¿›è¡Œå¤šå¹³å°æ„å»ºã€‚æ„Ÿè§‰docker in dockerçš„æ–¹å¼ä¸å¤ªçµæ´»ï¼Œkanikoåˆæ»¡è¶³ä¸äº†ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¤šå¹³å°æ„å»º buildx åº”è¯¥æ˜¯ç›®å‰æœ€å¥½çš„é€‰æ‹©äº†ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-18 17:23:16</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>GACÂ·DU</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæ‰§è¡Œ.&#47;mvnw dependency:go-offlineä¸€ç›´å¡ç€ä¸åŠ¨æ˜¯ä»€ä¹ˆæƒ…å†µï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åº”è¯¥æ˜¯ç½‘ç»œé—®é¢˜ï¼Œå¯ä»¥å°è¯•å‚è€ƒç¬¬16è®²çš„å†…å®¹ï¼Œç”¨ github action æ¥æ„å»ºï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ç½‘ç»œé—®é¢˜äº†ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-09 22:33:54</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>jeffery</span>
  </div>
  <div class="_2_QraFYR_0">buildx éœ€è¦å®‰è£…<br>https:&#47;&#47;github.com&#47;docker&#47;buildx#linux-packages<br>mkdir -pv ~&#47;.docker&#47;cli-plugins&#47;<br>wget -O ~&#47;.docker&#47;cli-plugins&#47;docker-buildx \<br>    https:&#47;&#47;github.com&#47;docker&#47;buildx&#47;releases&#47;download&#47;v0.9.1&#47;buildx-v0.9.1.linux-amd64<br><br>chmod a+x ~&#47;.docker&#47;cli-plugins&#47;docker-buildx<br><br>ç„¶åå‘½ä»¤<br> $ docker buildx create --name builder æ‰èƒ½ç”Ÿæ•ˆ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘ğŸ» macOS å’Œ Windows Docker desktop æ˜¯åŒ…å« buildx çš„ï¼ŒLinux éœ€è¦æŒ‰ç…§ä½ çš„æ–¹æ³•æ‰‹åŠ¨å®‰è£…ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-08 23:17:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/9d/84/171b2221.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>jeffery</span>
  </div>
  <div class="_2_QraFYR_0">1. git clone https:&#47;&#47;github.com&#47;lyzhang1999&#47;gitops.git<br>fatal: unable to access â€˜https:&#47;&#47;github.com&#47;â€¦&#47;.g<br>è§£å†³æ–¹æ¡ˆï¼š<br>~# git config --global http.proxy<br>~# git config --unset http.proxy<br>2. https:&#47;&#47;github.com&#47;lyzhang1999&#47;gitops&#47;blob&#47;main&#47;docker&#47;13&#47;golang&#47;Dockerfile#L6<br>ä¹‹å‰æ·»åŠ goproxy<br>RUN go env -w GO111MODULE=on<br>RUN go env -w GOPROXY=https:&#47;&#47;goproxy.cn,direct<br>é‡åˆ°é”™è¯¯ï¼š<br>Step 6&#47;14 : RUN go mod download<br>---&gt; Running in bd45f51f1f37<br>go mod download: github.com&#47;labstack&#47;echo&#47;v4@v4.10.0: Get &quot;https:&#47;&#47;proxy.golang.org&#47;github.com&#47;labstack&#47;echo&#47;v4&#47;@v&#47;v4.10.0.info&quot;: dial tcp 172.217.163.49:443: connect: connection refused<br>...<br>The command &#39;&#47;bin&#47;sh -c go mod download&#39; returned a non-zero code: 1<br><br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: çœ‹èµ·æ¥æ˜¯ä»£ç†æˆ–è€…ç½‘ç»œçš„é—®é¢˜ï¼Œé…ç½® Go proxy èƒ½è§£å†³å—ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-08 20:32:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/57/4f/6fb51ff1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä¸€æ­¥</span>
  </div>
  <div class="_2_QraFYR_0">æœ€åå¤šå¹³å°æ„å»º<br>FROM ubuntu é•œåƒçš„æ—¶å€™ ä¹Ÿè¦åŠ ä¸Š --platform=$BUILDPLATFORM å‚æ•°</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-07 17:37:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/46/d3/e25d104a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Ãªï½—Ä›ï½</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ä¸‹ï¼Œubuntu è¿™ä¸ªé•œåƒæ˜¯èƒ½æ”¯æŒä¸åŒæ¶æ„çš„å§ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ”¯æŒçš„ï¼Œå¸¸è§çš„ arm64ï¼Œamd64ï¼Œppc64le ç­‰éƒ½æ”¯æŒã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-06 16:58:28</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/27/ff/e4/927547a9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ— åæ— å§“</span>
  </div>
  <div class="_2_QraFYR_0">å¤šå¹³å°æ„å»ºä¸€èˆ¬éƒ½æ˜¯ä»€ä¹ˆæ ·çš„ç¯å¢ƒä¸‹é¢æ‰ä½¿ç”¨å‘¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æœ‰å¼‚æ„çš„ K8s é›†ç¾¤å°±å¯èƒ½ä¼šéœ€è¦ï¼Œä¾‹å¦‚è¿è¡Œåœ¨ ARM64 å¹³å°çš„ K8sã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-06 15:28:41</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/54/21/0bac2254.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ©™æ±</span>
  </div>
  <div class="_2_QraFYR_0">åŸæ¥nodejsåº”ç”¨å¯åŠ¨åé»˜è®¤pidä¸æ˜¯1ï¼Œç”¨äº†1å¹´å¤šéƒ½æ²¡æ³¨æ„ ä¸€ä¼šèµ¶ç´§çœ‹çœ‹</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-06 09:38:50</div>
  </div>
</div>
</div>
</li>
</ul>