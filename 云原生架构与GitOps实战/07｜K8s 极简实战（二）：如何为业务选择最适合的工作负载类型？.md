<audio title="07ï½œK8s æç®€å®æˆ˜ï¼ˆäºŒï¼‰ï¼šå¦‚ä½•ä¸ºä¸šåŠ¡é€‰æ‹©æœ€é€‚åˆçš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼Ÿ" src="https://static001.geekbang.org/resource/audio/70/f6/707bffd809c8ec0e36f48800e83a54f6.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç‹ç‚œã€‚</p><p>ä¸Šä¸€èŠ‚è¯¾ï¼Œæˆ‘å¸¦ä½ è®¤è¯†äº† K8s èµ„æºçš„é€»è¾‘éš”ç¦»æœºåˆ¶ï¼Œä¹Ÿå°±æ˜¯å‘½åç©ºé—´ã€‚å®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç»„ç»‡ K8s èµ„æºï¼ŒåŒæ—¶å…·æœ‰ä¸€å®šçš„éš”ç¦»ç‰¹æ€§ã€‚</p><p><strong>å·¥ä½œè´Ÿè½½æ˜¯ K8s è¿è¡Œçš„ä¸šåŠ¡ç¨‹åº</strong>ã€‚è¿˜è®°å¾—æˆ‘ä»¬åœ¨ä¸Šä¸€æ¨¡å—è¯´ K8s çš„æœ€å°è°ƒåº¦å•ä½æ˜¯ Pod å—ï¼Ÿè™½ç„¶å·¥ä½œè´Ÿè½½ç±»å‹æœ‰å¥½å‡ ç§ï¼Œä½†ä»–ä»¬æœ€ç»ˆéƒ½æ˜¯ä»¥ Pod çš„å½¢å¼è¿è¡Œçš„ã€‚å½“ç„¶ï¼ŒPod ä¹Ÿæ˜¯ä¸€ç§å·¥ä½œè´Ÿè½½ç±»å‹ï¼Œä¸è¿‡æˆ‘ä»¬ä¹‹å‰æœ‰æåˆ°è¿‡ï¼Œåœ¨å®é™…çš„é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¹¶ä¸ä¼šç›´æ¥ä½¿ç”¨ Pod è¿™ä¸ªå·¥ä½œè´Ÿè½½ç±»å‹ï¼Œè€Œæ˜¯é€šè¿‡å…¶ä»–çš„å·¥ä½œè´Ÿè½½ç±»å‹æ¥é—´æ¥ä½¿ç”¨å®ƒã€‚</p><p>è¿™èŠ‚è¯¾ï¼Œæˆ‘ä»¬å°±æ¥çœ‹çœ‹æœ‰å“ªäº› K8s å¸¸ç”¨çš„å·¥ä½œè´Ÿè½½ç±»å‹ï¼Œä»¥åŠå¦‚ä½•ä½¿ç”¨å®ƒä»¬ã€‚æˆ‘ä»ç„¶ä»ç¤ºä¾‹åº”ç”¨å‡ºå‘ï¼Œé‡ç‚¹å‘ä½ ä»‹ç» Deployment å·¥ä½œè´Ÿè½½ï¼Œåªè¦ä½ æŒæ¡å®ƒï¼Œå°±å¯ä»¥æ»¡è¶³å·¥ä½œä¸­å¸¸è§çš„ä¸šåŠ¡åœºæ™¯ã€‚</p><p>åœ¨æ­£å¼å¼€å§‹ä¹‹å‰ï¼Œä½ è¿˜æ˜¯éœ€è¦ç¡®ä¿å·²ç»æŒ‰ç…§<a href="https://time.geekbang.org/column/article/614570">â€œç¤ºä¾‹åº”ç”¨ä»‹ç»â€</a>çš„å¼•å¯¼åœ¨æœ¬åœ° Kind é›†ç¾¤éƒ¨ç½²äº†ç¤ºä¾‹åº”ç”¨ã€‚</p><h2>å·¥ä½œè´Ÿè½½ç±»å‹</h2><p>K8s çš„å·¥ä½œè´Ÿè½½åŒ…æ‹¬ï¼šReplicaSetã€Deploymentã€StatefulSetã€DaemonSetã€Jobã€CronJobã€‚åœ¨å®é™…å·¥ä½œä¸­ï¼Œæˆ‘ä»¬æœ€å¸¸ç”¨åˆ°çš„æ˜¯ Deploymentï¼Œä¸è¿‡åœ¨æ­£å¼ä»‹ç»å®ƒä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦å…ˆäº†è§£å¦å¤–ä¸€ä¸ªå·¥ä½œè´Ÿè½½ï¼šReplicaSetã€‚</p><h3>ReplicaSet</h3><!-- [[[read_end]]] --><p>ReplicaSet å·¥ä½œè´Ÿè½½ä¸»è¦çš„ä½œç”¨æ˜¯ä¿æŒä¸€å®šæ•°é‡çš„ Pod å§‹ç»ˆå¤„äºè¿è¡ŒçŠ¶æ€ã€‚å½“æˆ‘ä»¬ç›´æ¥åˆ›å»º Pod æ—¶ï¼Œå‡è®¾ Pod æ‰€åœ¨çš„èŠ‚ç‚¹å‡ºç°æ•…éšœï¼Œé™¤éæ‰‹åŠ¨é‡æ–°åˆ›å»ºå®ƒï¼Œå¦åˆ™ Pod æ°¸è¿œä¸ä¼šæ¢å¤ã€‚<strong>Pod ä¸å…·å¤‡è‡ªåŠ¨æ¢å¤èƒ½åŠ›</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸æ¨èç›´æ¥ä½¿ç”¨ Pod çš„é‡è¦åŸå› ã€‚</p><p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦æ›´é«˜ç»´åº¦çš„å·¥ä½œè´Ÿè½½å¸®æˆ‘ä»¬åˆ›å»ºå’Œç»´æŠ¤ Podï¼ŒReplicaSet å¯ä»¥ç¡®ä¿å¤„äºè¿è¡ŒçŠ¶æ€çš„ Pod å§‹ç»ˆä¿æŒåœ¨æœŸæœ›çš„æ•°é‡ï¼Œè®©æˆ‘ä»¬ä¸å¿…å†éœ€è¦æ‹…å¿ƒçªå‘æ•…éšœå¯¼è‡´çš„ä¸šåŠ¡ä¸­æ–­ã€‚ReplicaSet å’Œ Pod çš„å…³ç³»å¦‚å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/4b/7d/4b43205ebdcef5dcd6bf1a1b0d50b57d.jpg?wh=1920x851" alt="å›¾ç‰‡"></p><p>ä¸ºäº†è¿›ä¸€æ­¥è¯´æ˜ ReplicaSet çš„ç‰¹æ€§ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°è¯•åˆ›å»º ReplicaSet å·¥ä½œè´Ÿè½½ã€‚å…ˆå°†ä¸‹é¢çš„å†…å®¹ä¿å­˜ä¸º ReplicaSet.yamlï¼š</p><pre><code class="language-yaml">apiVersion: apps/v1
kind: ReplicaSet
metadata:
&nbsp; name: frontend
&nbsp; labels:
&nbsp; &nbsp; app: frontend
spec:
&nbsp; replicas: 3   # 3 ä¸ªå‰¯æœ¬æ•°
&nbsp; selector:
&nbsp; &nbsp; matchLabels:
&nbsp; &nbsp; &nbsp; app: frontend
&nbsp; template:
&nbsp; &nbsp; metadata:
&nbsp; &nbsp; &nbsp; labels:
&nbsp; &nbsp; &nbsp; &nbsp; app: frontend
&nbsp; &nbsp; spec:
&nbsp; &nbsp; &nbsp; containers:
&nbsp; &nbsp; &nbsp; - name: frontend
&nbsp; &nbsp; &nbsp; &nbsp; image: lyzhang1999/frontend:v1
</code></pre><p>ç„¶åï¼Œä½¿ç”¨ kubectl apply åˆ›å»º ReplicaSet å·¥ä½œè´Ÿè½½ï¼š</p><pre><code class="language-yaml">$ kubectl apply -f ReplicaSet.yaml
replicaset.apps/frontend created
</code></pre><p>ç°åœ¨ï¼Œæˆ‘ä»¬å°è¯•ä¿®æ”¹ ReplicaSet.yaml çš„å†…å®¹ï¼Œå°†é•œåƒç‰ˆæœ¬ä» v1 ä¿®æ”¹åˆ° v2ï¼š</p><pre><code class="language-yaml">apiVersion: apps/v1
kind: ReplicaSet
metadata:
  name: frontend
  ......
spec:
  ......
  template:
    ......
    spec:
      containers:
      - name: frontend
        image: lyzhang1999/frontend:v2 # ä¿®æ”¹é•œåƒç‰ˆæœ¬
</code></pre><p>å†æ¬¡è¿è¡Œ kubectl apply -f ä½¿ä¿®æ”¹ç”Ÿæ•ˆï¼š</p><pre><code class="language-powershell">$ kubectl apply -f ReplicaSet.yaml
replicaset.apps/frontend configured
</code></pre><p>ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ kubectl get pods æ¥æŸ¥çœ‹æ‰€æœ‰ Pod çš„é•œåƒç‰ˆæœ¬ä¿¡æ¯ï¼š</p><pre><code class="language-powershell">$ kubectl get pods --selector=app=frontend -o jsonpath='{.items[*].spec.containers[0].image}'
lyzhang1999/frontend:v1 lyzhang1999/frontend:v1 lyzhang1999/frontend:v1
</code></pre><p>ä»è¿”å›ç»“æœå¯ä»¥çœ‹å‡ºï¼Œ<strong>Pod çš„é•œåƒç‰ˆæœ¬å¹¶æ²¡æœ‰è¢«æ›´æ–°ä¸º v2</strong>ã€‚è¿™æ˜¯å› ä¸º ReplicaSet åªè´Ÿè´£ç»´æŠ¤ Pod æ•°é‡ï¼Œåœ¨æ•°é‡æ²¡æœ‰å˜åŒ–çš„æƒ…å†µä¸‹ï¼ŒPod ä¸ä¼šè¢«æ›´æ–°ã€‚åªæœ‰å°†æ—§çš„ Pod æ€æ­»ï¼ŒReplicaSet æ‰ä¼šåœ¨é‡æ–°åˆ›å»º Pod çš„æ—¶å€™ä½¿ç”¨æ–°çš„é•œåƒç‰ˆæœ¬ã€‚</p><p>è¦éªŒè¯è¿™ä¸ªè¿‡ç¨‹ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl delete pod æ¥åˆ é™¤æŸä¸€ä¸ª Podï¼š</p><pre><code class="language-powershell">$ kubectl get pods
NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;READY&nbsp; &nbsp;STATUS&nbsp; &nbsp; RESTARTS&nbsp; &nbsp;AGE
frontend-25kf4&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 28s
frontend-j94fv&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 28s
frontend-mbst5&nbsp; &nbsp;1/1&nbsp; &nbsp; &nbsp;Running&nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 28s

$ kubectl delete pods frontend-25kf4
pod "frontend-25kf4" deleted
</code></pre><p>åˆ é™¤å…¶ä¸­ä¸€ä¸ª Pod ä¹‹åï¼ŒReplicaSet ä¼šå‘ç° Pod æ•°é‡å’Œé¢„æœŸæ•°é‡ç›¸å·® 1 ä¸ª Podï¼Œæ‰€ä»¥ä¼šé‡æ–°åˆ›å»ºä¸€ä¸ª Pod ä»¥æ»¡è¶³é¢„æœŸè¦æ±‚ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å†æ¬¡æŸ¥çœ‹æ‰€æœ‰ Pod çš„é•œåƒç‰ˆæœ¬ä¿¡æ¯ï¼š</p><pre><code class="language-powershell">$ kubectl get pods --selector=app=frontend -o jsonpath='{.items[*].spec.containers[0].image}'
lyzhang1999/frontend:v2 lyzhang1999/frontend:v1 lyzhang1999/frontend:v1
</code></pre><p>å°±å¯ä»¥ä»è¿”å›ç»“æœçœ‹å‡ºï¼ŒPod é‡æ–°åˆ›å»ºåï¼Œé•œåƒç‰ˆæœ¬ä¹Ÿéšä¹‹æ›´æ–°äº†ã€‚</p><p>é€šè¿‡è¿™ä¸ªå®éªŒæˆ‘ä»¬å¾—å‡ºç»“è®ºï¼ŒReplicaSet åªèƒ½ç¡®ä¿ Pod æ•°é‡ï¼Œåœ¨æˆ‘ä»¬éœ€è¦æ›´æ–° Pod çš„æ—¶å€™ï¼Œå¹¶ä¸èƒ½å¸®æˆ‘ä»¬è‡ªåŠ¨è¿›è¡Œæ›´æ–°ï¼Œè¿™æ„å‘³ç€æ— æ³•å®ç°æœŸæœ›çŠ¶æ€å’Œå®é™…çš„çŠ¶æ€çš„ä¸€è‡´æ€§ã€‚æ‰€ä»¥ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬<strong>ä¸ä¼šç›´æ¥ä½¿ç”¨ ReplicaSet å·¥ä½œè´Ÿè½½</strong>ï¼Œè€Œæ˜¯ä¼šä½¿ç”¨æ›´ä¸Šå±‚çš„ Deployment å·¥ä½œè´Ÿè½½ã€‚</p><h3>Deployment</h3><p>Deployment æ˜¯ä¼—å¤šå·¥ä½œè´Ÿè½½ç±»å‹ä¸­æœ€é‡è¦ã€ä¹Ÿæ˜¯ K8s é‡Œæœ€å¸¸ç”¨çš„å·¥ä½œè´Ÿè½½ç±»å‹ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼ŒDeployment å·¥ä½œè´Ÿè½½èƒ½å¤Ÿæ»¡è¶³ç»å¤§å¤šæ•°çš„ä¸šåŠ¡è¯‰æ±‚ã€‚</p><p>Deployment å¯ä»¥çœ‹ä½œæ˜¯ç®¡ç† ReplicaSet çš„å·¥ä½œè´Ÿè½½ï¼Œå°±åƒ ReplicaSet ç®¡ç† Pod ä¸€æ ·ï¼Œå®ƒå¯ä»¥åˆ›å»ºã€åˆ é™¤ ReplicaSetï¼Œè€Œå®ƒå¯¹ ReplicaSet çš„ç®¡ç†æœ€ç»ˆåˆä¼šå½±å“åˆ° Podã€‚Deploymentã€ReplicaSet å’Œ Pod ä¸‰è€…çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/8b/1a/8b7b5876956eae74b71aefe2b34f051a.jpg?wh=1920x835" alt="å›¾ç‰‡"></p><p>Deployment éå¸¸æœ‰ç”¨ï¼Œå®ƒå¯ä»¥å®ç°æ›´æ–°ã€å›æ»šå’Œæ¨ªå‘æ‰©å®¹ã€‚æ¯”å¦‚ï¼Œåœ¨æˆ‘ä»¬ç¬¬ä¸€æ¬¡éƒ¨ç½²äº† Pod ä¹‹åï¼Œå½“éœ€è¦æ›´æ–° Pod çš„é•œåƒæ—¶ï¼ŒDeployment å¯ä»¥é€šè¿‡ä¸åœæœºçš„æ»šåŠ¨æ›´æ–°ï¼Œé¿å…æ—§çš„ Pod è¢«åŒæ—¶å…³é—­ï¼Œé˜²æ­¢æœåŠ¡åœæœºã€‚ä»ä¸Šé¢è¿™å¼ æ¶æ„å›¾å¯ä»¥çœ‹å‡ºï¼Œæ»šåŠ¨æ›´æ–°æ˜¯é€šè¿‡åˆ›å»ºå¤šä¸ª ReplicaSet å®ç°çš„ã€‚</p><p>æ­¤å¤–ï¼ŒDeployment è¿˜å¯ä»¥æä¾›æ¨ªå‘ä¼¸ç¼©èƒ½åŠ›ï¼Œé…åˆ HPA è‡ªåŠ¨è¿›è¡Œæ‰©ç¼©å®¹ã€‚</p><p>æ‰€ä»¥ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œ<strong>å¯¹äºæ— çŠ¶æ€åº”ç”¨ï¼ŒDeployment æ˜¯æœ€ä½³çš„é€‰æ‹©</strong>ã€‚åœ¨æˆ‘ä»¬è¿™ä¸ªç¤ºä¾‹åº”ç”¨ä¸­ï¼Œå‰åç«¯ä»¥åŠæ•°æ®åº“éƒ½æ˜¯é‡‡ç”¨ Deployment å·¥ä½œè´Ÿè½½éƒ¨ç½²çš„ï¼Œå¦‚æœä½ åœ¨å®é™…å·¥ä½œä¸­éœ€è¦ä½¿ç”¨å®ƒï¼Œä¹Ÿå¯ä»¥å‚è€ƒç¤ºä¾‹ä¸­çš„å†™æ³•ã€‚Deployment çš„å­—æ®µå’Œ Pod æ¯”è¾ƒç›¸ä¼¼ï¼Œè¿™é‡Œå°±ä¸å†ä¸ºä½ ä¸€ä¸€ä»‹ç»äº†ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°†ä»¥ç¤ºä¾‹åº”ç”¨ä¸ºä¾‹ï¼Œå¸¦ä½ è¿›ä¸€æ­¥ç†è§£ Deployment æ˜¯å¦‚ä½•ç®¡ç† ReplicaSet çš„ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®è®¤ä½ å·²ç»æŒ‰ç…§<a href="https://time.geekbang.org/column/article/614570">â€œç¤ºä¾‹åº”ç”¨ä»‹ç»â€</a>å°†æ¼”ç¤ºåº”ç”¨éƒ¨ç½²åˆ°äº† example å‘½åç©ºé—´ã€‚</p><p>ç¡®è®¤å¥½ä¹‹åï¼Œæˆ‘ä»¬ä½¿ç”¨ kubectl describe deployment æ¥è·å–å·¥ä½œè´Ÿè½½è¯¦æƒ…ï¼š</p><pre><code class="language-powershell">$ kubectl describe deployment backend -n example
Name:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;backend
Namespace:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; example
......
Replicas:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2 desired | 2 updated | 2 total | 2 available | 0 unavailable
StrategyType:&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;RollingUpdate
......
RollingUpdateStrategy:&nbsp; 25% max unavailable, 25% max surge
......
OldReplicaSets:&nbsp; &lt;none&gt;
NewReplicaSet:&nbsp; &nbsp;backend-648ff85f48 (2/2 replicas created)
</code></pre><p>åœ¨ä¸Šé¢çš„è¿”å›å†…å®¹ä¸­ï¼Œæˆ‘ä»¬è¦é‡ç‚¹å…³æ³¨å‡ ä¸ªä¿¡æ¯ã€‚é¦–å…ˆï¼Œ StrategyType ä»£è¡¨çš„æ˜¯éƒ¨ç½²ç­–ç•¥ï¼Œå®ƒé»˜è®¤ä»¥ RollingUpdate ä¹Ÿå°±æ˜¯æ»šåŠ¨æ›´æ–°çš„æ–¹å¼å¯¹ Pod è¿›è¡Œé€ä¸ªæ›´æ–°ï¼Œå®ƒæ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ï¼Œä¸ä¼šé€ æˆä¸šåŠ¡åœæœºã€‚</p><p>RollingUpdateStrategy æ˜¯å¯¹æ»šåŠ¨æ›´æ–°æ›´åŠ ç²¾ç»†çš„æ§åˆ¶ã€‚max surge ç”¨æ¥æŒ‡å®šæœ€å¤§è¶…å‡ºæœŸæœ› Pod çš„ä¸ªæ•°ï¼Œmax unavailable æ˜¯å…è®¸ Pod ä¸å¯ç”¨çš„æ•°é‡ï¼Œä»¥æœŸæœ› 8 ä¸ªå‰¯æœ¬æ•°çš„å·¥ä½œè´Ÿè½½ä¸ºä¾‹ï¼Œmax unavailable çš„å€¼ä¸º 25% ï¼Œä¹Ÿå°±æ˜¯ 2ï¼Œmax surge çš„å€¼ä¸º 25%ï¼Œä¹Ÿæ˜¯ 2ï¼Œé‚£ä¹ˆåœ¨æ»šåŠ¨æ›´æ–°æ—¶ï¼Œæ›´æ–°ç­–ç•¥æ˜¯ï¼š</p><ul>
<li>æ›´æ–°æœŸé—´æœ€å¤šä¼šæœ‰ 10 ä¸ª Podï¼ˆ8 ä¸ªæ‰€éœ€çš„ Pod + 2 ä¸ª maxSurge Podï¼‰å¤„äºè¿è¡ŒçŠ¶æ€ï¼›</li>
<li>æ›´æ–°æœŸé—´è‡³å°‘ä¼šæœ‰ 6 ä¸ª Podï¼ˆ8 ä¸ªæ‰€éœ€çš„ Pod - 2 ä¸ª maxUnavailable Podï¼‰å¤„äºè¿è¡ŒçŠ¶æ€ã€‚</li>
</ul><p>å·¥ä½œè´Ÿè½½æ˜ç»†é‡Œçš„æœ€åä¸€è¡Œçš„ NewReplicaSet æŒ‡çš„æ˜¯ç”± Deployment åˆ›å»ºå¹¶ç®¡ç†çš„ ReplicaSet åç§°ã€‚</p><p>ä¸ºäº†æ›´åŠ ç›´è§‚åœ°å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ›´æ–° Deploymentã€‚å…ˆå°†æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ frontend HPA æœ€å° Pod æ•°é‡è°ƒæ•´ä¸º 3ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl patch hpa å‘½ä»¤æ¥è°ƒæ•´ï¼š</p><pre><code class="language-powershell">$ kubectl patch hpa backend -p '{"spec":{"minReplicas": 3}}' -n example
horizontalpodautoscaler.autoscaling/backend patched
</code></pre><p>åœ¨æ­£å¼ä¿®æ”¹ Deployment ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ kubectl get replicaset --watch æ¥ç›‘æ§ ReplicaSet çš„å˜åŒ–çŠ¶æ€ï¼Œä»¥ä¾¿è¿›ä¸€æ­¥çš„åˆ†æï¼š</p><pre><code class="language-powershell">$ kubectl get replicaset --watch -n example
NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;AGE
backend-648ff85f48&nbsp; &nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;24h
frontend-7b55cc5c67&nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;2&nbsp; &nbsp; &nbsp; &nbsp;24h
postgres-7745b57d5d&nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;1&nbsp; &nbsp; &nbsp; &nbsp;24h
</code></pre><p><strong>æ‰“å¼€ä¸€ä¸ªæ–°çš„å‘½ä»¤è¡Œç»ˆç«¯ï¼Œ</strong>ä½¿ç”¨ kubectl set image æ¥æ›´æ–° backend Deploymentï¼š</p><pre><code class="language-powershell">$ kubectl set image deployment/backend flask-backend=lyzhang1999/backend:v1 -n example
NAME&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; DESIRED&nbsp; &nbsp;CURRENT&nbsp; &nbsp;READY&nbsp; &nbsp;AGE
backend-648ff85f48&nbsp; &nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;25h
......
backend-6bf7dbbdbb&nbsp; &nbsp; 3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;3&nbsp; &nbsp; &nbsp; &nbsp;44s
backend-648ff85f48&nbsp; &nbsp; 0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;0&nbsp; &nbsp; &nbsp; &nbsp;25h
</code></pre><p>è¿”å›ç»“æœæ¯”è¾ƒå¤šï¼Œè¿™é‡Œåªæˆªå–äº†ä¸€éƒ¨åˆ†ã€‚ä»æœ€åè¿”å›çš„ç»“æœå¯ä»¥çœ‹å‡ºï¼Œæ—§çš„ ReplicaSet backend-648ff85f48 æœŸæœ›çš„å‰¯æœ¬æ•°ä» 3 é™åˆ°äº† 0ï¼Œæ–°åˆ›å»ºçš„ ReplicaSet backend-6bf7dbbdbb æœ€åçš„å‰¯æœ¬æ•°ä¸º 3ï¼Œåœ¨æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œæ–°æ—§ ReplicaSet åŒæ—¶å­˜åœ¨ï¼Œæ—§çš„ ReplicaSet å‰¯æœ¬æ•°åœ¨ä¸æ–­å‡å°‘ï¼Œæ–°çš„ ReplicaSet åœ¨ä¸æ–­åœ°å¢åŠ ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»“åˆ RollingUpdateStrategy é…ç½®ä¸­çš„ maxSurge å’Œ maxUnavailable æ¥åˆ†ææ•´ä¸ªæ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/3d/f5/3d4e05ded76fcecdf5cab6f6c17bf6f5.jpg?wh=1920x580" alt="å›¾ç‰‡"></p><p>åœ¨ä¸Šé¢çš„å›¾ä¸­ï¼Œç»¿è‰²æ–¹å—è¡¨ç¤ºå¤„äºå°±ç»ªçŠ¶æ€çš„ Podï¼Œçº¢è‰²æ–¹å—è¡¨ç¤ºå¤„äºæœªå°±ç»ªçŠ¶æ€çš„ Podï¼Œä¸Šæ–¹ä»å·¦åˆ°å³çš„è½´çº¿æ˜¯æ—¶é—´è½´ã€‚åœ¨ Deployment æ»šåŠ¨æ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œæ—§çš„ ReplicaSet ä¸æ–­æ§åˆ¶ Pod ç¼©å®¹ï¼Œæ–°çš„ ReplicaSet ä¸æ–­æ§åˆ¶ Pod æ‰©å®¹ï¼Œåœ¨æŸä¸ªæ—¶é—´ç‚¹ï¼Œæ–°æ—§ ReplicaSet ä¼šå…±å­˜ã€‚</p><p>æœ‰äº†æ»šåŠ¨æ›´æ–°çš„æœºåˆ¶ï¼Œæˆ‘ä»¬å†ä¹Ÿä¸ç”¨æ‹…å¿ƒå› ä¸ºå‘å¸ƒå¯¼è‡´çš„ä¸šåŠ¡ä¸­æ–­é—®é¢˜äº†ã€‚</p><p>å¦‚æœä½ éœ€è¦æŠŠä¸šåŠ¡è¿ç§»åˆ° K8sï¼Œå°¤å…¶æ˜¯å¯¹äºç°ä»£å¾®æœåŠ¡åº”ç”¨ï¼Œä½ åº”è¯¥å°† Deployment å·¥ä½œè´Ÿè½½ä½œä¸ºé¦–é€‰ç±»å‹ã€‚</p><h3>StatefulSet</h3><p>StatefulSet å’Œ Deployment å·¥ä½œè´Ÿè½½éå¸¸ç±»ä¼¼ï¼Œä½†å®ƒä¸»è¦ç”¨äºéƒ¨ç½²â€œæœ‰çŠ¶æ€â€çš„åº”ç”¨ï¼Œå®ƒçš„æ ¸å¿ƒèƒ½åŠ›æ˜¯ä¿å­˜ Pod çš„çŠ¶æ€ï¼Œæ¯”å¦‚æœ€å¸¸è§çš„å¦‚å­˜å‚¨çŠ¶æ€ã€‚åœ¨å‡ºç°æ•…éšœ Pod éœ€è¦é‡å»ºæ—¶ï¼Œæ–°çš„ Pod å°†æ¢å¤åŸæ¥çš„çŠ¶æ€ã€‚</p><p>åœ¨å®é™…å·¥ä½œä¸­ï¼ŒStatefulSet ä¸»è¦è§£å†³ä»¥ä¸‹ä¸¤ä¸ªé—®é¢˜ã€‚</p><ul>
<li>å‰¯æœ¬ä¹‹é—´æœ‰å·®å¼‚ï¼šç›¸æ¯”è¾ƒ Deployment é‚£æ ·åˆ›å»ºå®Œå…¨ä¸€è‡´çš„ Pod å‰¯æœ¬ï¼ŒStatefulSet é¢å‘çš„åœºæ™¯ä¼šæ›´å¤æ‚ã€‚ä¾‹å¦‚ä¸€äº›ä¸­é—´ä»¶åœºæ™¯éœ€è¦æœ‰ä¸»ä»èŠ‚ç‚¹ï¼Œå®ƒä¼šè¦æ±‚å…ˆå¯åŠ¨ä¸»èŠ‚ç‚¹ Pod ï¼Œå†å¯åŠ¨ä»èŠ‚ç‚¹ Podï¼ŒStatefulSet å°±å¯ä»¥å¾ˆå¥½åœ°å®Œæˆè¿™ç±»æ“ä½œã€‚æ­¤å¤–ï¼Œå½“ Pod å‡ºç°å¼‚å¸¸éœ€è¦é‡å»ºæ—¶ï¼ŒStatefulSet å¯ä»¥ç¡®ä¿ Pod çš„åç§°ä¸€è‡´æ€§ã€‚</li>
<li>ä¿æŒå­˜å‚¨çŠ¶æ€ï¼šStatefulSet å¯ä»¥é…åˆæŒä¹…åŒ–å­˜å‚¨ä¸€èµ·ä½¿ç”¨ï¼Œå³ä¾¿æ˜¯ Pod è¢«åˆ é™¤ï¼ŒStatefulSet ä»ç„¶èƒ½å¤Ÿé€šè¿‡ç»‘å®šå…³ç³»æ‰¾åˆ°æŒä¹…åŒ–å­˜å‚¨å·ã€‚</li>
</ul><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯é‡Œï¼ŒStatefulSet ç»å¸¸ç”¨æ¥éƒ¨ç½²ä¸­é—´ä»¶ï¼Œä¾‹å¦‚ Postgresã€MySQLã€MongoDBã€etcd ç­‰ã€‚è¿™äº›ä¸­é—´ä»¶æœ‰æ—¶å€™éœ€è¦ä»¥ä¸»ä»çš„æ–¹å¼è¿›è¡Œé«˜å¯ç”¨éƒ¨ç½²ï¼ŒStatefulSet ä¸ºè¿™äº›ç»„ä»¶æä¾›äº†å¾ˆå¥½çš„æ”¯æŒã€‚</p><p>å®é™…ä¸Šï¼Œæˆ‘ä»¬åœ¨å·¥ä½œä¸­<strong>å‡ ä¹ä¸ä¼šä»¥ StatefulSet çš„å½¢å¼éƒ¨ç½²ä¸šåŠ¡ç³»ç»Ÿã€‚</strong>åœ¨ä¸€äº›ç‰¹æ®Šçš„ç¯å¢ƒä¸‹ï¼Œæ¯”å¦‚ Demo å’Œæµ‹è¯•ç¯å¢ƒï¼Œä¸šåŠ¡åº”ç”¨å¯èƒ½ä¼šéœ€è¦æ•°æ®åº“æˆ–è€… MQ æ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ­¤æ—¶åˆ™éœ€è¦ä½¿ç”¨ StatefulSet å·¥ä½œè´Ÿè½½ã€‚å³ä¾¿æ˜¯ä½¿ç”¨è¿™äº›æ•°æ®åº“å’Œ MQ ç­‰ä¸­é—´ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿä¸éœ€è¦è‡ªå·±å†™ StatefulSet Manifestï¼Œåªéœ€è¦æ‰¾åˆ°å¯¹åº”ä¸­é—´ä»¶çš„ Helm Chart ç›´æ¥å®‰è£…å³å¯ã€‚</p><p>æœ€åæˆ‘æƒ³è¯´çš„æ˜¯ï¼Œåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œæˆ‘å¹¶ä¸æ¨èä½ ä½¿ç”¨ StatefulSet æ¥éƒ¨ç½²è¿™äº›ä¸­é—´ä»¶ï¼Œè¿™æ˜¯å› ä¸ºè¯¸å¦‚æ•°æ®åº“å’Œæ¶ˆæ¯é˜Ÿåˆ—ä¸­é—´ä»¶ï¼Œé™¤äº†éœ€è¦æŒä¹…åŒ–ä»¥å¤–ï¼Œè¿˜éœ€è¦å®ç°æ•°æ®å¤‡ä»½å’Œå®¹ç¾ï¼Œè¿™å¹¶ä¸æ˜¯ K8s æ“…é•¿çš„ï¼Œä¹Ÿæ²¡å¿…è¦é‡å¤é€ è½®å­ã€‚</p><p>å¯¹äºå¸¸ç”¨çš„ä¸­é—´ä»¶ï¼Œäº‘å‚å•†éƒ½ä¸ºæˆ‘ä»¬æä¾›äº†å¯¹åº”çš„é«˜å¯ç”¨äº§å“ã€‚ä¾‹å¦‚ MySQL æ•°æ®åº“å®ä¾‹ï¼Œå®ƒä»¬åº•å±‚æ”¯æŒé«˜å¯ç”¨ï¼ŒæŒ‰é‡ä»˜è´¹ï¼Œå¹¶ä¸”å‡ ä¹ä¸éœ€è¦ä»˜å‡ºé¢å¤–çš„ç»´æŠ¤æˆæœ¬ï¼Œç›´æ¥ä½¿ç”¨å®ƒä»¬æ˜¯ä¸€ç§æ›´å¥½çš„æŠ€æœ¯é€‰å‹æ–¹æ¡ˆã€‚</p><h3>DaemonSet</h3><p>DaemonSet æ˜¯ä¸€ç§éå¸¸ç‰¹æ®Šçš„å·¥ä½œè´Ÿè½½ï¼Œä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºèŠ‚ç‚¹çº§çš„å®ˆæŠ¤è¿›ç¨‹ï¼Œå®ƒå¯ä»¥ä¸ºé›†ç¾¤çš„æ¯ä¸ªèŠ‚ç‚¹éƒ½åˆ›å»ºä¸€ä¸ª Podã€‚å½“èŠ‚ç‚¹è¢«æ·»åŠ æ—¶ï¼Œå®ƒä¼šåœ¨æ–°èŠ‚ç‚¹å¯åŠ¨æ–°çš„ Podï¼Œç›¸ååœ°ï¼Œå½“èŠ‚ç‚¹è¢«åˆ é™¤æ—¶ï¼ŒPod ä¹Ÿå°†ä¼šè¢«åˆ é™¤ã€‚</p><p>DaemonSet ç»å¸¸ç”¨äºä¸‹é¢å‡ ç§ä¸šåŠ¡åœºæ™¯ã€‚</p><ul>
<li>å­˜å‚¨æ’ä»¶ï¼šåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹è¿è¡Œå­˜å‚¨å®ˆæŠ¤è¿›ç¨‹ï¼Œä¾‹å¦‚ Cephã€‚</li>
<li>ç½‘ç»œæ’ä»¶ä»£ç†ï¼šåœ¨æ¯ä¸€ä¸ªèŠ‚ç‚¹ä¸Šè¿è¡Œç½‘ç»œæ’ä»¶ï¼Œä»¥ä¾¿å¤„ç†èŠ‚ç‚¹çš„å®¹å™¨ç½‘ç»œé€šä¿¡ã€‚</li>
<li>ç›‘æ§å’Œæ—¥å¿—ç»„ä»¶ï¼šä¸ºæ¯ä¸€ä¸ªèŠ‚ç‚¹é‡‡é›†æ—¥å¿—æˆ–è€…ç›‘æ§æŒ‡æ ‡ï¼Œä¾‹å¦‚ Prometheus Node Exporter å’Œ Fluentdã€‚</li>
</ul><p>ä»è¿™äº›ä¸šåŠ¡åœºæ™¯é‡Œæˆ‘ä»¬ä¼šå‘ç°ï¼ŒDaemonSet ä¸€èˆ¬ç”¨æ¥æ‰©å±• K8s çš„èƒ½åŠ›ï¼Œæ¯”å¦‚æ—¥å¿—å’Œç›‘æ§ç»„ä»¶ï¼Œè¿™äº›éƒ½æ˜¯æˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨çš„ã€‚å’Œ StatefulSet ç±»ä¼¼ï¼Œ<strong>æˆ‘ä»¬åœ¨å·¥ä½œä¸­ä¹Ÿå‡ ä¹ä¸ä¼šä»¥ DaemonSet çš„æ–¹å¼éƒ¨ç½²ä¸šåŠ¡åº”ç”¨ã€‚</strong></p><h3>Job/CronJob</h3><p>åˆšæ‰æˆ‘ä»¬è®²åˆ°çš„ Deploymentã€StatefulSet å’Œ DaemonSet éƒ½æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯å®ƒä»¬éƒ½ä¸»è¦é’ˆå¯¹é•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ã€‚é™¤éå‘ç”Ÿäº†é”™è¯¯ï¼Œå¦åˆ™ Pod å°†ä¸€ç›´è¿è¡Œä¸‹å»ã€‚</p><p>è¯•æƒ³æœ‰ä¸€ç§åœºæ™¯ï¼Œä½ éœ€è¦è¿è¡Œä¸€ä¸ªæ‰¹å¤„ç†ä»»åŠ¡ï¼Œè¿è¡Œç»“æŸå³ä»£è¡¨å®Œæˆä»»åŠ¡ã€‚å¦‚æœä½ ä½¿ç”¨ Deployment å’Œå…¶ä»–çš„å·¥ä½œè´Ÿè½½ï¼Œè¿›ç¨‹ç»“æŸåï¼Œ K8s ä¼šè®¤ä¸ºå‡ºç°äº†æ•…éšœï¼Œäºæ˜¯ä¸æ–­é‡å¯ Podã€‚è¿™æ˜¯è‚¯å®šä¸è¡Œçš„ã€‚åƒè¿™ç§ä¸€æ¬¡æ€§çš„ä»»åŠ¡Jobå°±æ´¾ä¸Šç”¨åœºäº†ã€‚</p><p>åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šä½¿ç”¨ Job æ¥å¤„ç†æ•°æ®åº“è¿ç§»ä»»åŠ¡ã€‚ä¸‹é¢æ˜¯ä¸€ä¸ªå…¸å‹çš„ Job Manifest ä¾‹å­ï¼š</p><pre><code class="language-yaml">apiVersion: batch/v1
kind: Job
metadata:
&nbsp; name: "migration-job"
&nbsp; labels:
&nbsp; annotations:
spec:&nbsp;
&nbsp; backoffLimit: 4
  activeDeadlineSeconds: 200
  completions: 1
  parallelism: 1
&nbsp; template:
&nbsp; &nbsp; metadata:
&nbsp; &nbsp; &nbsp; name: "migration-job-pod"
&nbsp; &nbsp; spec:
&nbsp; &nbsp; &nbsp; restartPolicy: Never
&nbsp; &nbsp; &nbsp; containers:
&nbsp; &nbsp; &nbsp; - name: db-migrations
&nbsp; &nbsp; &nbsp; &nbsp; image: rancher/gitjob:v0.1.32
&nbsp; &nbsp; &nbsp; &nbsp; command: ["/bin/sh", "-c"]
&nbsp; &nbsp; &nbsp; &nbsp; args:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - git clone ${DB_MIGRATION_SCRIPT_REPO} &amp;&amp; sh migrate.sh
</code></pre><p>è¿™æ®µ Manifest æ˜¯ä¸€æ®µç¤ºä¾‹å†…å®¹ï¼Œæ”¾åœ¨è¿™é‡Œç›®çš„æ˜¯ä¸ºä½ æä¾›å‚è€ƒï¼Œå¹¶ä¸èƒ½çœŸæ­£å·¥ä½œã€‚å®ƒçš„æ ¸å¿ƒä»»åŠ¡æ˜¯å¯åŠ¨ä¸€ä¸ªåŒ…å« Git å®¢æˆ·ç«¯çš„å®¹å™¨ï¼Œä½¿ç”¨ git clone å‘½ä»¤æ¥å…‹éš†æ•°æ®åº“ migrate è„šæœ¬çš„ä»“åº“ï¼Œç„¶åè¿è¡Œè„šæœ¬å®Œæˆæ•°æ®è¿ç§»ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è¯¦ç»†çœ‹çœ‹ Job çš„ä¸€äº›<strong>ç‰¹æ®Šå­—æ®µ</strong>ã€‚</p><p>backoffLimit ä»£è¡¨ Job è¿è¡Œå¤±è´¥ä¹‹åé‡æ–°è¿è¡Œçš„æ¬¡æ•°ï¼Œé»˜è®¤å€¼ä¸º 6ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒJob çš„é‡å¯æ—¶é—´æ˜¯å‘ˆæŒ‡æ•°çº§å¢é•¿çš„ï¼Œä¾‹å¦‚ï¼Œä¸‹ä¸€æ¬¡ Job é‡æ–°è¿è¡Œçš„æ—¶é—´å¯èƒ½æ˜¯ 10sã€20sã€40sï¼Œæœ€å¤§æ—¶é—´ä¸º 6 åˆ†é’Ÿã€‚</p><p>completions å­—æ®µè¡¨ç¤º Job çš„å®Œæˆæ¡ä»¶ï¼Œé»˜è®¤å€¼ä¸º 1ï¼Œæ„å‘³ç€å½“æœ‰ä¸€ä¸ª Pod çš„çŠ¶æ€ä¸ºâ€œå®Œæˆâ€æ—¶ï¼ŒJob ä¹Ÿå°±å®Œæˆäº†ã€‚</p><p>parallelism å­—æ®µè¡¨ç¤ºå¹¶è¡Œï¼Œæ„æ€æ˜¯åŒæ—¶å¯åŠ¨å‡ ä¸ª Pod è¿è¡Œä»»åŠ¡ï¼Œé»˜è®¤å€¼ä¸º 1 ï¼Œæ„å‘³ç€é»˜è®¤åªå¯åŠ¨ä¸€ä¸ª Pod è¿è¡Œä»»åŠ¡ã€‚</p><p>restartPolicy ä»£è¡¨é‡å¯ç­–ç•¥ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ restartPolicy è®¾ç½®ä¸º Neverï¼Œæ„å‘³ç€ Pod è¿è¡Œå¤±è´¥åå°†ä¸ä¼šè¢«é‡æ–°å¯åŠ¨ã€‚é™¤äº† Neverï¼Œæˆ‘ä»¬è¿˜å¯ä»¥è®¾ç½® OnFailureï¼Œæ„æ€æ˜¯å¦‚æœå®¹å™¨è¿›ç¨‹é€€å‡ºçŠ¶æ€ç é 0 ï¼Œé‚£ä¹ˆ Pod å°†ä¼šè¢«è‡ªåŠ¨é‡å¯ï¼Œé‡æ–°æ‰§è¡Œä»»åŠ¡ï¼Œè€Œåœ¨ Deployment ä¸­ï¼ŒrestartPolicy å­—æ®µåªèƒ½è¢«è®¾ç½®ä¸º Alwaysã€‚</p><p>å½“ Job è¿è¡Œå®Œæˆåï¼ŒPod çš„çŠ¶æ€å°†ä» Running è½¬å˜ä¸º Completedã€‚ä½†æˆ‘ä»¬è¿˜å¯èƒ½é‡åˆ°ä¸€ç§ç‰¹æ®Šæƒ…å†µï¼Œå¦‚æœä»»åŠ¡å¡ä½æˆ–è€…é•¿æ—¶é—´æ²¡ååº”æ€ä¹ˆåŠå‘¢ï¼Ÿå…¶å®è¿™æ—¶å€™æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ activeDeadlineSeconds å­—æ®µæ§åˆ¶ Pod çš„æœ€é•¿è¿è¡Œæ—¶é—´ã€‚</p><p>åœ¨ä¸Šé¢çš„é…ç½®ä¸­ï¼Œå¦‚æœè¿è¡Œæ—¶é—´è¶…è¿‡ 200 ç§’ï¼Œé‚£ä¹ˆ Pod ä¼šè¢«å¼ºåˆ¶ç»ˆæ­¢ï¼Œå¹¶ä¸”åœ¨äº‹ä»¶ä¸­æ˜¾ç¤ºçš„ç»ˆæ­¢åŸå› æ˜¯ DeadlineExceededã€‚</p><p>è¿˜æœ‰ä¸€ç§å’Œ Job ç±»ä¼¼çš„å·¥ä½œè´Ÿè½½ç±»å‹æ˜¯ CronJobï¼Œå®ƒä»¬çš„åŒºåˆ«åœ¨äº CronJob å¯ä»¥è®¾ç½®å’Œ Linux Crontab ä¸€è‡´çš„è¡¨è¾¾å¼ï¼Œå¹¶åœ¨ç‰¹å®šçš„æ—¶é—´è‡ªåŠ¨é‡å¤è¿è¡Œï¼Œä¾‹å¦‚æ¯åˆ†é’Ÿè‡ªåŠ¨è¿è¡Œä¸€æ¬¡ï¼Œä¸‹é¢æ˜¯ CronJob çš„ä¾‹å­ï¼š</p><pre><code class="language-yaml">apiVersion: batch/v1
kind: CronJob
metadata:
&nbsp; name: run-every-minute
spec:
&nbsp; schedule: "* * * * *"
&nbsp; jobTemplate:
&nbsp; &nbsp; spec:
&nbsp; &nbsp; &nbsp; template:
&nbsp; &nbsp; &nbsp; &nbsp; spec:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; containers:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - name: cronjob
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; image: busybox:latest
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; command:
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - /bin/sh
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - -c
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; - echo Hello World
</code></pre><h2>æ€»ç»“</h2><p>åœ¨è¿™èŠ‚è¯¾ï¼Œæˆ‘ä¸ºä½ ä»‹ç»äº† K8s å‡ ç§å¸¸è§çš„å·¥ä½œè´Ÿè½½ç±»å‹ã€‚å…¶ä¸­ï¼ŒDeployment æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§å·¥ä½œè´Ÿè½½ï¼Œä½ å¯ä»¥å¤šèŠ±ç‚¹æ—¶é—´å»ç†è§£å®ƒã€‚Deployment çš„åŠŸèƒ½éå¸¸å¼ºå¤§ï¼Œå®ƒå¯ä»¥å’Œå…¶ä»–çš„ K8s å¯¹è±¡ä¸€èµ·å·¥ä½œï¼Œé…ç½®ä¹Ÿç›¸å¯¹å¤æ‚ï¼Œæˆ‘ä»¬è¿˜ä¼šåœ¨åç»­çš„è¯¾ç¨‹ä¸­åšè¿›ä¸€æ­¥çš„è¡¥å……ã€‚</p><p>æ­¤å¤–ï¼Œæˆ‘è¿˜ä»‹ç»äº† Statefulset å’Œ DaemonSetã€‚åœ¨å®é™…çš„ä¸šåŠ¡åœºæ™¯ï¼Œæˆ‘ä»¬å‡ ä¹ä¸ä¼šå°†ä¸šåŠ¡åº”ç”¨ä»¥è¿™ä¸¤ç§å·¥ä½œè´Ÿè½½çš„æ–¹å¼è¿›è¡Œéƒ¨ç½²ï¼Œæ‰€ä»¥æˆ‘å¹¶æ²¡æœ‰ä¸ºä½ è¿›è¡Œæ·±å…¥ä»‹ç»ã€‚ä¸è¿‡ï¼Œåœ¨ Demo å’Œæµ‹è¯•åœºæ™¯ä¸­ï¼Œä¸šåŠ¡åº”ç”¨è¦é¡ºåˆ©è¿è¡Œå¾€å¾€è¿˜éœ€è¦å…¶ä»–ä¸­é—´ä»¶çš„é…åˆï¼Œä¾‹å¦‚æ•°æ®åº“å’Œä¸­é—´ä»¶ï¼Œè¿™äº›ä¸­é—´ä»¶å¯ä»¥ç›´æ¥ä½¿ç”¨ç¤¾åŒºå·²ç»å°è£…å¥½çš„ Helm chart è¿›è¡Œéƒ¨ç½²ï¼Œè¿™éƒ¨åˆ†å†…å®¹ä¹Ÿå°†åœ¨åç»­çš„è¯¾ç¨‹ä¸­è¯¦ç»†ä»‹ç»ã€‚</p><p>é™¤äº†ä¸Šé¢è¿™äº›é’ˆå¯¹é•¿æ—¶é—´è¿è¡Œçš„åº”ç”¨ï¼ŒJob å’Œ CronJob æ›´é€‚åˆå¤„ç†ä¸€æ¬¡æ€§çš„ä»»åŠ¡ï¼Œå®ƒä»¬å¯ä»¥å¸®åŠ©ä½ æŠŠä¸€äº›æ‰¹å¤„ç†ä»»åŠ¡è¿ç§»åˆ° K8s ä¸­ï¼Œæ¯”å¦‚å…¸å‹çš„åœºæ™¯æ˜¯æ•°æ®åº“åˆå§‹åŒ–å·¥ä½œä»¥åŠä¼ ç»Ÿçš„ Crontab å®šæ—¶ä»»åŠ¡ã€‚</p><h2>æ€è€ƒé¢˜</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€é“æ€è€ƒé¢˜å§ã€‚</p><p>åœ¨å‰é¢ backend æ»šåŠ¨æ›´æ–°çš„ä¾‹å­ä¸­ï¼Œç¤ºæ„å›¾é‡Œæ–°æ—§ ReplicaSet å…±å­˜æœŸé—´ä¸€å…±æœ‰ 4 ä¸ª Podï¼Œä½†å…¶å®è¿™å¹¶ä¸å‡†ç¡®ï¼Œä½ èƒ½é€šè¿‡å®è·µæ‰¾å‡ºæ»šåŠ¨æ›´æ–°è¿‡ç¨‹æœ€å¤šæœ‰å‡ ä¸ª Pod åŒæ—¶å­˜åœ¨å—ï¼Ÿï¼ˆæç¤ºï¼šTerminating ç»ˆæ­¢çŠ¶æ€ä¹ŸåŒæ—¶è®¡å…¥ã€‚ï¼‰</p><p>æ¬¢è¿ä½ ç»™æˆ‘ç•™è¨€äº¤æµè®¨è®ºï¼Œä½ ä¹Ÿå¯ä»¥æŠŠè¿™èŠ‚è¯¾åˆ†äº«ç»™æ›´å¤šçš„æœ‹å‹ä¸€èµ·é˜…è¯»ã€‚æˆ‘ä»¬ä¸‹èŠ‚è¯¾è§ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/23/bb/a1a61f7c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>GACÂ·DU</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®è€å¸ˆï¼Œæ»šåŠ¨æ›´æ–°ä¹‹åæ—§çš„é•œåƒæ˜¯å¦‚ä½•å¤„ç†çš„ï¼Ÿæˆ‘ç°åœ¨æ˜¯é€šè¿‡å†™è„šæœ¬çš„æ–¹å¼ï¼Œéƒ¨ç½²åœ¨æ¯ä¸ªnodeä¸Šï¼Œè®¾ç½®Crontabå®šæ—¶æ¸…ç†ï¼Œè§‰å¾—ä¸å¤Ÿæ™ºèƒ½ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å…¶å®æˆ‘ä»¬å®Œå…¨ä¸ç”¨æ‹…å¿ƒæ—§é•œåƒå ç”¨ç£ç›˜ç©ºé—´çš„é—®é¢˜ã€‚<br><br>å®é™…ä¸Š K8s ä¼šæ ¹æ®é•œåƒä½¿ç”¨æƒ…å†µæ¥å¸®æˆ‘ä»¬è‡ªåŠ¨æ¸…ç†å®ƒä»¬ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸éœ€è¦è¿›è¡Œäººå·¥å¹²é¢„ï¼Œå¹¶ä¸” K8s ä¹Ÿä¸æ¨èæˆ‘ä»¬æ‰‹åŠ¨å¹²é¢„è¿™ä¸ªè¿‡ç¨‹ã€‚<br><br>æ­¤å¤–ï¼Œkubelet æœ‰ä¸¤ä¸ªå‚æ•°å¯ä»¥æ§åˆ¶é•œåƒåˆ é™¤çš„è¡Œä¸ºï¼Œä¸€ä¸ªæ˜¯ image-gc-high-thresholdï¼Œå¦ä¸€ä¸ªæ˜¯ image-gc-low-thresholdï¼Œä»–ä»¬çš„å€¼é»˜è®¤æ˜¯ 85% å’Œ 80%ï¼Œè¿™æ„å‘³ç€å½“ç£ç›˜ä½¿ç”¨ç‡è¾¾åˆ° 85% çš„æ—¶å€™è‡ªåŠ¨æ‰§è¡Œæ¸…ç†ï¼Œå¹¶å°†ç£ç›˜ä½¿ç”¨ç‡é™åˆ° 80%ã€‚<br><br>æœ€åï¼Œä¸åŒç‰ˆæœ¬çš„ä¸šåŠ¡é•œåƒå…¶å®å¤§éƒ¨åˆ†çš„ Layer å±‚éƒ½æ˜¯ç›¸åŒçš„ï¼Œæ¯æ¬¡æ‹‰å–æ–°é•œåƒç‰ˆæœ¬åªä¼šæœ‰å°‘é‡å±‚çš„å˜åŒ–ï¼Œå¹¶ä¸æ˜¯æ¯æ¬¡æ‹‰å–é•œåƒéƒ½ä¼šé¢å¤–å ç”¨ä¸€ä»½é•œåƒç©ºé—´å¤§å°ï¼Œæ‰‹åŠ¨æ¸…ç†ä»–ä»¬çš„æ”¶ç›Šä¸å¤§ï¼Œå¹¶ä¸”è¿˜å¯èƒ½ä¼šå¢åŠ é•œåƒæ‹‰å–çš„æ—¶é—´ï¼Œä»è€Œå½±å“åº”ç”¨çš„æ›´æ–°é€Ÿåº¦ã€‚<br><br></p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-23 10:20:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/f6/24/547439f1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ghostwritten</span>
  </div>
  <div class="_2_QraFYR_0">è´Ÿè½½ç±»å‹ï¼šReplicaSetã€Deploymentã€Statefulsetã€DaemonSetã€job&#47;cronjob<br>1. Pod ä¸å…·å¤‡è‡ªåŠ¨æ¢å¤èƒ½åŠ›<br>2. ReplicaSetï¼škubectl apply -f æ— æ³•æ›´æ–°ç”Ÿæ•ˆï¼Œåˆ é™¤podå¯é‡è½½é…ç½®mainfulç”Ÿæ•ˆ<br>3. Deploymentï¼šæ— çŠ¶æ€åº”ç”¨ï¼Œå¸¸ç”¨ï¼›åº”ç”¨å‰åç«¯ç»„ä»¶ç­‰ã€‚<br>     StrategyType: <br>         Recreateï¼šæ­¤ç­–ç•¥ç±»å‹å°†åœ¨åˆ›å»ºæ–° Pod ä¹‹å‰å…ˆé”€æ¯ç°æœ‰ Pod<br>         RollingUpdate: æ»šåŠ¨æ›´æ–°çš„æ–¹å¼å¯¹ Pod è¿›è¡Œé€ä¸ªæ›´æ–°ï¼Œå®ƒæ˜¯é»˜è®¤çš„æ›´æ–°ç­–ç•¥ï¼Œä¸ä¼šé€ æˆä¸šåŠ¡åœæœº<br>      RollingUpdateStrategy æ˜¯å¯¹æ»šåŠ¨æ›´æ–°æ›´åŠ ç²¾ç»†çš„æ§åˆ¶ã€‚<br>      max surge ç”¨æ¥æŒ‡å®šæœ€å¤§è¶…å‡ºæœŸæœ› Pod çš„ä¸ªæ•°<br>      max unavailable æ˜¯å…è®¸ Pod ä¸å¯ç”¨çš„æ•°é‡<br>4. Statefulsetï¼šæœ‰çŠ¶æ€åº”ç”¨ï¼Œåº”ç”¨å‰¯æœ¬å·®å¼‚ã€æŒä¹…å­˜å‚¨ï¼Œä¸å¸¸ç”¨ç†ç”±ï¼škubernetsä¸æ“…é•¿æ•°æ®å¤‡ä»½å’Œå®¹ç¾ç­‰ã€‚ä¸­é—´ä»¶å¯Helm Chart å®‰è£…ã€‚<br>5. DaemonSetï¼šå­˜å‚¨æ’ä»¶ã€ç½‘ç»œæ’ä»¶ä»£ç†ã€ç›‘æ§å’Œæ—¥å¿—ç»„ä»¶<br>6. job\cronjob: å¤‡ä»½ã€å·¡æ£€....;<br>   ç‰¹æ®Šå­—æ®µ:backoffLimit ã€completions ã€restartPolicyã€activeDeadlineSeconds....<br><br>å­¦ä¹ å‘½ä»¤ï¼š<br>kubectl get pods --selector=app=frontend -o jsonpath=&#39;{.items[*].spec.containers[0].image}â€™<br>kubectl patch hpa backend -p &#39;{&quot;spec&quot;:{&quot;minReplicas&quot;: 3}}&#39; -n example<br>kubectl get replicaset --watch -n example<br>kubectl set image deployment&#47;backend flask-backend=lyzhang1999&#47;backend:v1 -n example<br>.....<br>[kubectl](https:&#47;&#47;smoothies.com.cn&#47;kubernetes-docs&#47;%E7%BB%84%E4%BB%B6&#47;Kubectl&#47;kubectl-command.html)</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¾ˆå®Œæ•´çš„è¯¾ç¨‹å‘½ä»¤æ€»ç»“ğŸ‘ğŸ»</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-28 22:36:45</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>includestdio.h</span>
  </div>
  <div class="_2_QraFYR_0">æœ€å¤šä¼šæœ‰6ä¸ªã€‚æ–°çš„ rs æ‹‰èµ·ä¸€ä¸ªæ–° Pod ï¼Œæ—§çš„ rs ç»ˆæ­¢ä¸€ä¸ª Pod ï¼Œä½†æ˜¯ç»ˆæ­¢å¹¶ä¸ç¡®ä¿å®Œå…¨é€€å‡ºï¼Œåªè¦æ—§ Pod å¤„äº Terminating çŠ¶æ€ï¼Œåˆ™æ–°çš„ rs åˆ™ä¼šç»§ç»­æ‹‰èµ·ä¸‹ä¸€ä¸ª Podã€‚å¦‚æœæ—§Podç»ˆæ­¢çš„è¶³å¤Ÿæ…¢ï¼Œåˆ™æœ‰å¯èƒ½å‡ºç°3ä¸ªrunningçš„æ–°Podå’Œ3ä¸ªTerminatingçš„æ—§Pod</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: éå¸¸æ­£ç¡®ï¼Œè¿™ç¡®å®æ˜¯æœ‰å¯èƒ½å‡ºç°çš„ã€‚<br><br>å¯ä»¥è¿›ä¸€æ­¥ç ”ç©¶çœ‹çœ‹å¦‚ä½•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œè®© K8s åœ¨æ—§ç‰ˆæœ¬å®Œå…¨é€€å‡ºåæ‰æ‹‰èµ·æ–°çš„ Podï¼Œè€Œä¸æ˜¯ åœ¨ Terminating çŠ¶æ€å°±æ‹‰èµ·ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-23 09:22:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1e/43/05/3fbf26cf.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Noel ZHANG</span>
  </div>
  <div class="_2_QraFYR_0">å…¶å®æˆ‘ä¸€ç›´æƒ³çŸ¥é“åœ¨deploymentæ»šåŠ¨æ›´æ–°çš„æ—¶å€™æµé‡æ˜¯æ€ä¹ˆåˆ†é…çš„ï¼Œæˆ‘ä»¬ç”¨ä¸åˆ°è¿™ä¹ˆç»†ï¼Œä¹Ÿå°±æ²¡ç ”ç©¶è¿‡</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ»šåŠ¨çš„æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œæ–°çš„æœåŠ¡ä¼šåŠ å…¥åˆ° Service Endpointï¼Œæ—§çš„æœåŠ¡ä¼šé€æ¸ä» Endpoint ä¸­åˆ é™¤ã€‚<br>å¯¹äº iptables å’Œ ipvs ä¸¤ç§ kube-proxy çš„å®ç°æ–¹å¼åœ¨æµé‡å¤„ç†ä¸Šæœ‰æ‰€ä¸åŒï¼Œiptables é»˜è®¤ä¼šéšæœºæŠŠæµé‡è½¬å‘åˆ° Endpoint åç«¯ä¸Šï¼Œipvs åˆ™é»˜è®¤ä¼šä»¥åŠ æƒè½®è¯¢çš„æ–¹å¼è½¬å‘æµé‡ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-14 22:55:33</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/32/a8/d5bf5445.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>éƒ‘æµ·æˆ</span>
  </div>
  <div class="_2_QraFYR_0">max unavilable 0ï¼Œmax surge 1ï¼Œæœ€åæƒ…å†µï¼šæ–°çš„rs 3 replicaï¼Œæ—§rs 3å‰¯æœ¬</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-14 09:03:14</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/76/f5/e3f5bd8d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å®ä»”</span>
  </div>
  <div class="_2_QraFYR_0">â€œrestartPolicy ä»£è¡¨é‡å¯ç­–ç•¥ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ restartPolicy è®¾ç½®ä¸º Neverï¼Œæ„å‘³ç€ Pod è¿è¡Œå®Œæˆåå°†ä¸ä¼šè¢«é‡æ–°å¯åŠ¨â€ã€‚è¿™é‡Œè€å¸ˆæ˜¯ä¸æ˜¯æœ‰é—®é¢˜ï¼Œåº”è¯¥æ˜¯restartPolicyè®¾ç½®äº†Nerverä¹‹åï¼Œä»£è¡¨çš„æ˜¯Podè¿è¡Œå¤±è´¥åä¸ä¼šè¢«é‡æ–°å¯åŠ¨ï¼Œè€Œä¸æ˜¯è¿è¡Œå®Œæˆåè¢«é‡æ–°å¯åŠ¨å§ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ï¼Œæ„Ÿè°¢æŒ‡æ­£ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-06 20:35:05</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/2a/d1/34/03dc9e03.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æå¤š</span>
  </div>
  <div class="_2_QraFYR_0">â€œä¸ºäº†æ›´åŠ ç›´è§‚åœ°å±•ç¤ºä»–ä»¬ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æ›´æ–° Deploymentã€‚å…ˆå°†æˆ‘ä»¬ä¹‹å‰éƒ¨ç½²çš„ frontend HPA æœ€å° Pod æ•°é‡è°ƒæ•´ä¸º 3ï¼Œä½ å¯ä»¥ä½¿ç”¨ kubectl patch hpa å‘½ä»¤æ¥è°ƒæ•´ï¼šâ€<br><br>è¿™éƒ¨åˆ†åº”è¯¥æ˜¯â€œ backend HPA æœ€å° Pod æ•°é‡è°ƒæ•´ä¸º 3â€å§ï¼Œå’Œåé¢ä»£ç å¯¹åº”çš„ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯çš„ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-04 19:08:36</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/23/52/66/3e4d4846.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>includestdio.h</span>
  </div>
  <div class="_2_QraFYR_0">â€œåœ¨æ­£å¼ä¿®æ”¹ Deployment ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆä½¿ç”¨ kubect get replicaset --watch æ¥ç›‘æ§â€ å‘½ä»¤é”™äº†å“ˆ -.-</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè°¢æŒ‡æ­£ï½</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-12-23 09:27:48</div>
  </div>
</div>
</div>
</li>
</ul>