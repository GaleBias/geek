<audio title="26 _ ä½¿ç”¨é˜»å¡IOå’Œçº¿ç¨‹æ¨¡å‹ï¼šæ¢ä¸€ç§è½»é‡çš„æ–¹å¼" src="https://static001.geekbang.org/resource/audio/3c/3d/3ce7b95449c684eb6445234806b51c3d.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯ç››å»¶æ•ï¼Œè¿™é‡Œæ˜¯ç½‘ç»œç¼–ç¨‹å®æˆ˜ç¬¬26è®²ï¼Œæ¬¢è¿å›æ¥ã€‚</p><p>åœ¨å‰é¢ä¸€è®²ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†è¿›ç¨‹æ¨¡å‹æ¥å¤„ç†ç”¨æˆ·è¿æ¥è¯·æ±‚ï¼Œè¿›ç¨‹åˆ‡æ¢ä¸Šä¸‹æ–‡çš„ä»£ä»·æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œå¹¸è¿çš„æ˜¯ï¼Œæœ‰ä¸€ç§è½»é‡çº§çš„æ¨¡å‹å¯ä»¥å¤„ç†å¤šç”¨æˆ·è¿æ¥è¯·æ±‚ï¼Œè¿™å°±æ˜¯çº¿ç¨‹æ¨¡å‹ã€‚è¿™ä¸€è®²é‡Œï¼Œæˆ‘ä»¬å°±æ¥äº†è§£ä¸€ä¸‹çº¿ç¨‹æ¨¡å‹ã€‚</p><p>çº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯è¿è¡Œåœ¨è¿›ç¨‹ä¸­çš„ä¸€ä¸ªâ€œé€»è¾‘æµâ€ï¼Œç°ä»£æ“ä½œç³»ç»Ÿéƒ½å…è®¸åœ¨å•è¿›ç¨‹ä¸­è¿è¡Œå¤šä¸ªçº¿ç¨‹ã€‚çº¿ç¨‹ç”±æ“ä½œç³»ç»Ÿå†…æ ¸ç®¡ç†ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ä¸Šä¸‹æ–‡ï¼ˆcontextï¼‰ï¼ŒåŒ…æ‹¬ä¸€ä¸ªå¯ä»¥å”¯ä¸€æ ‡è¯†çº¿ç¨‹çš„IDï¼ˆthread IDï¼Œæˆ–è€…å«tidï¼‰ã€æ ˆã€ç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰ã€‚åœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸­ï¼Œæ‰€æœ‰çš„çº¿ç¨‹å…±äº«è¯¥è¿›ç¨‹çš„æ•´ä¸ªè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ŒåŒ…æ‹¬ä»£ç ã€æ•°æ®ã€å †ã€å…±äº«åº“ç­‰ã€‚</p><p>åœ¨å‰é¢çš„ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æ²¡æœ‰æ˜¾å¼ä½¿ç”¨çº¿ç¨‹ï¼Œä½†è¿™ä¸ä»£è¡¨çº¿ç¨‹æ²¡æœ‰å‘æŒ¥ä½œç”¨ã€‚å®é™…ä¸Šï¼Œæ¯ä¸ªè¿›ç¨‹ä¸€å¼€å§‹éƒ½ä¼šäº§ç”Ÿä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€èˆ¬è¢«ç§°ä¸ºä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹å¯ä»¥å†äº§ç”Ÿå­çº¿ç¨‹ï¼Œè¿™æ ·çš„ä¸»çº¿ç¨‹-å­çº¿ç¨‹å¯¹å¯ä»¥å«åšä¸€ä¸ªå¯¹ç­‰çº¿ç¨‹ã€‚</p><p>ä½ å¯èƒ½ä¼šé—®ï¼Œæ—¢ç„¶å¯ä»¥ä½¿ç”¨å¤šè¿›ç¨‹æ¥å¤„ç†å¹¶å‘ï¼Œä¸ºä»€ä¹ˆè¿˜è¦ä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å‹å‘¢ï¼Ÿ</p><p>ç®€å•æ¥è¯´ï¼Œåœ¨åŒä¸€ä¸ªè¿›ç¨‹ä¸‹ï¼Œçº¿ç¨‹ä¸Šä¸‹æ–‡åˆ‡æ¢çš„å¼€é”€è¦æ¯”è¿›ç¨‹å°å¾—å¤šã€‚æ€ä¹ˆç†è§£çº¿ç¨‹ä¸Šä¸‹æ–‡å‘¢ï¼Ÿæˆ‘ä»¬çš„ä»£ç è¢«CPUæ‰§è¡Œçš„æ—¶å€™ï¼Œæ˜¯éœ€è¦ä¸€äº›æ•°æ®æ”¯æ’‘çš„ï¼Œæ¯”å¦‚ç¨‹åºè®¡æ•°å™¨å‘Šè¯‰CPUä»£ç æ‰§è¡Œåˆ°å“ªé‡Œäº†ï¼Œå¯„å­˜å™¨é‡Œå­˜äº†å½“å‰è®¡ç®—çš„ä¸€äº›ä¸­é—´å€¼ï¼Œå†…å­˜é‡Œæ”¾ç½®äº†ä¸€äº›å½“å‰ç”¨åˆ°çš„å˜é‡ç­‰ï¼Œä»ä¸€ä¸ªè®¡ç®—åœºæ™¯ï¼Œåˆ‡æ¢åˆ°å¦å¤–ä¸€ä¸ªè®¡ç®—åœºæ™¯ï¼Œç¨‹åºè®¡æ•°å™¨ã€å¯„å­˜å™¨ç­‰è¿™äº›å€¼é‡æ–°è½½å…¥æ–°åœºæ™¯çš„å€¼ï¼Œå°±æ˜¯çº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ã€‚</p><!-- [[[read_end]]] --><h2>POSIXçº¿ç¨‹æ¨¡å‹</h2><p>POSIXçº¿ç¨‹æ˜¯ç°ä»£UNIXç³»ç»Ÿæä¾›çš„å¤„ç†çº¿ç¨‹çš„æ ‡å‡†æ¥å£ã€‚POSIXå®šä¹‰çš„çº¿ç¨‹å‡½æ•°å¤§çº¦æœ‰60å¤šä¸ªï¼Œè¿™äº›å‡½æ•°å¯ä»¥å¸®åŠ©æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹ã€å›æ”¶çº¿ç¨‹ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å…ˆçœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ç¨‹åºã€‚</p><pre><code>int another_shared = 0;

void thread_run(void *arg) {
    int *calculator = (int *) arg;
    printf(&quot;hello, world, tid == %d \n&quot;, pthread_self());
    for (int i = 0; i &lt; 1000; i++) {
        *calculator += 1;
        another_shared += 1;
    }
}

int main(int c, char **v) {
    int calculator;

    pthread_t tid1;
    pthread_t tid2;

    pthread_create(&amp;tid1, NULL, thread_run, &amp;calculator);
    pthread_create(&amp;tid2, NULL, thread_run, &amp;calculator);

    pthread_join(tid1, NULL);
    pthread_join(tid2, NULL);

    printf(&quot;calculator is %d \n&quot;, calculator);
    printf(&quot;another_shared is %d \n&quot;, another_shared);
}
</code></pre><p>thread_helloworldç¨‹åºä¸­ï¼Œä¸»çº¿ç¨‹ä¾æ¬¡åˆ›å»ºäº†ä¸¤ä¸ªå­çº¿ç¨‹ï¼Œç„¶åç­‰å¾…è¿™ä¸¤ä¸ªå­çº¿ç¨‹å¤„ç†å®Œæ¯•ä¹‹åç»ˆæ­¢ã€‚æ¯ä¸ªå­çº¿ç¨‹éƒ½åœ¨å¯¹ä¸¤ä¸ªå…±äº«å˜é‡è¿›è¡Œè®¡ç®—ï¼Œæœ€ååœ¨ä¸»çº¿ç¨‹ä¸­æ‰“å°å‡ºæœ€åçš„è®¡ç®—ç»“æœã€‚</p><p>ç¨‹åºçš„ç¬¬18å’Œ19è¡Œåˆ†åˆ«è°ƒç”¨äº†pthread_createåˆ›å»ºäº†ä¸¤ä¸ªçº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å…¥å£éƒ½æ˜¯thread_runå‡½æ•°ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨äº†calculatorè¿™ä¸ªå…¨å±€å˜é‡ï¼Œå¹¶ä¸”é€šè¿‡ä¼ åœ°å€æŒ‡é’ˆçš„æ–¹å¼ï¼Œå°†è¿™ä¸ªå€¼ä¼ ç»™äº†thread_runå‡½æ•°ã€‚å½“è°ƒç”¨pthread_createç»“æŸï¼Œå­çº¿ç¨‹ä¼šç«‹å³æ‰§è¡Œï¼Œä¸»çº¿ç¨‹åœ¨æ­¤åè°ƒç”¨äº†pthread_joinå‡½æ•°ç­‰å¾…å­çº¿ç¨‹ç»“æŸã€‚</p><p>è¿è¡Œè¿™ä¸ªç¨‹åºï¼Œå¾ˆå¹¸è¿ï¼Œè®¡ç®—çš„ç»“æœæ˜¯æ­£ç¡®çš„ã€‚</p><pre><code>$./thread-helloworld
hello, world, tid == 125607936 
hello, world, tid == 126144512 
calculator is 2000 
another_shared is 2000 
</code></pre><h2>ä¸»è¦çº¿ç¨‹å‡½æ•°</h2><h3>åˆ›å»ºçº¿ç¨‹</h3><p>æ­£å¦‚å‰é¢çœ‹åˆ°ï¼Œé€šè¿‡è°ƒç”¨pthread_createå‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ã€‚è¿™ä¸ªå‡½æ•°çš„åŸå‹å¦‚ä¸‹ï¼š</p><pre><code>int pthread_create(pthread_t *tid, const pthread_attr_t *attr,
ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€void *(*func)(void *), void *arg);

è¿”å›ï¼šè‹¥æˆåŠŸåˆ™ä¸º0ï¼Œè‹¥å‡ºé”™åˆ™ä¸ºæ­£çš„Exxxå€¼
</code></pre><p>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹IDï¼ˆtidï¼‰å”¯ä¸€æ¥æ ‡è¯†ï¼Œå…¶æ•°æ®ç±»å‹ä¸ºpthread_tï¼Œä¸€èˆ¬æ˜¯unsigned intã€‚pthread_createå‡½æ•°çš„ç¬¬ä¸€ä¸ªè¾“å‡ºå‚æ•°tidå°±æ˜¯ä»£è¡¨äº†çº¿ç¨‹IDï¼Œå¦‚æœåˆ›å»ºçº¿ç¨‹æˆåŠŸï¼Œtidå°±è¿”å›æ­£ç¡®çš„çº¿ç¨‹IDã€‚</p><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰å¾ˆå¤šå±æ€§ï¼Œæ¯”å¦‚ä¼˜å…ˆçº§ã€æ˜¯å¦åº”è¯¥æˆä¸ºä¸€ä¸ªå®ˆæŠ¤è¿›ç¨‹ç­‰ï¼Œè¿™äº›å€¼å¯ä»¥é€šè¿‡pthread_attr_tæ¥æè¿°ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¸ä¼šç‰¹æ®Šè®¾ç½®ï¼Œå¯ä»¥ç›´æ¥æŒ‡å®šè¿™ä¸ªå‚æ•°ä¸ºNULLã€‚</p><p>ç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºæ–°çº¿ç¨‹çš„å…¥å£å‡½æ•°ï¼Œè¯¥å‡½æ•°å¯ä»¥æ¥æ”¶ä¸€ä¸ªå‚æ•°argï¼Œç±»å‹ä¸ºæŒ‡é’ˆï¼Œå¦‚æœæˆ‘ä»¬æƒ³ç»™çº¿ç¨‹å…¥å£å‡½æ•°ä¼ å¤šä¸ªå€¼ï¼Œé‚£ä¹ˆéœ€è¦æŠŠè¿™äº›å€¼åŒ…è£…æˆä¸€ä¸ªç»“æ„ä½“ï¼Œå†æŠŠè¿™ä¸ªç»“æ„ä½“çš„åœ°å€ä½œä¸ºpthread_createçš„ç¬¬å››ä¸ªå‚æ•°ï¼Œåœ¨çº¿ç¨‹å…¥å£å‡½æ•°å†…ï¼Œå†å°†è¯¥åœ°å€è½¬ä¸ºè¯¥ç»“æ„ä½“çš„æŒ‡é’ˆå¯¹è±¡ã€‚</p><p>åœ¨æ–°çº¿ç¨‹çš„å…¥å£å‡½æ•°å†…ï¼Œå¯ä»¥æ‰§è¡Œpthread_selfå‡½æ•°è¿”å›çº¿ç¨‹tidã€‚</p><pre><code>pthread_t pthread_self(void)
</code></pre><h3>ç»ˆæ­¢çº¿ç¨‹</h3><p>ç»ˆæ­¢ä¸€ä¸ªçº¿ç¨‹æœ€ç›´æ¥çš„æ–¹æ³•æ˜¯åœ¨çˆ¶çº¿ç¨‹å†…è°ƒç”¨ä»¥ä¸‹å‡½æ•°ï¼š</p><pre><code>void pthread_exit(void *status)
</code></pre><p>å½“è°ƒç”¨è¿™ä¸ªå‡½æ•°ä¹‹åï¼Œçˆ¶çº¿ç¨‹ä¼šç­‰å¾…å…¶ä»–æ‰€æœ‰çš„å­çº¿ç¨‹ç»ˆæ­¢ï¼Œä¹‹åçˆ¶çº¿ç¨‹è‡ªå·±ç»ˆæ­¢ã€‚</p><p>å½“ç„¶ï¼Œå¦‚æœä¸€ä¸ªå­çº¿ç¨‹å…¥å£å‡½æ•°ç›´æ¥é€€å‡ºäº†ï¼Œé‚£ä¹ˆå­çº¿ç¨‹ä¹Ÿå°±è‡ªç„¶ç»ˆæ­¢äº†ã€‚æ‰€ä»¥ï¼Œç»å¤§å¤šæ•°çš„å­çº¿ç¨‹æ‰§è¡Œä½“éƒ½æ˜¯ä¸€ä¸ªæ— é™å¾ªç¯ã€‚</p><p>ä¹Ÿå¯ä»¥é€šè¿‡è°ƒç”¨pthread_cancelæ¥ä¸»åŠ¨ç»ˆæ­¢ä¸€ä¸ªå­çº¿ç¨‹ï¼Œå’Œpthread_exitä¸åŒçš„æ˜¯ï¼Œå®ƒå¯ä»¥æŒ‡å®šæŸä¸ªå­çº¿ç¨‹ç»ˆæ­¢ã€‚</p><pre><code>int pthread_cancel(pthread_t tid)
</code></pre><h3>å›æ”¶å·²ç»ˆæ­¢çº¿ç¨‹çš„èµ„æº</h3><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨pthread_joinå›æ”¶å·²ç»ˆæ­¢çº¿ç¨‹çš„èµ„æºï¼š</p><pre><code>int pthread_join(pthread_t tid, void ** thread_return)
</code></pre><p>å½“è°ƒç”¨pthread_joinæ—¶ï¼Œä¸»çº¿ç¨‹ä¼šé˜»å¡ï¼Œç›´åˆ°å¯¹åº”tidçš„å­çº¿ç¨‹è‡ªç„¶ç»ˆæ­¢ã€‚å’Œpthread_cancelä¸åŒçš„æ˜¯ï¼Œå®ƒä¸ä¼šå¼ºè¿«å­çº¿ç¨‹ç»ˆæ­¢ã€‚</p><h3>åˆ†ç¦»çº¿ç¨‹</h3><p>ä¸€ä¸ªçº¿ç¨‹çš„é‡è¦å±æ€§æ˜¯å¯ç»“åˆçš„ï¼Œæˆ–è€…æ˜¯åˆ†ç¦»çš„ã€‚ä¸€ä¸ªå¯ç»“åˆçš„çº¿ç¨‹æ˜¯èƒ½å¤Ÿè¢«å…¶ä»–çº¿ç¨‹æ€æ­»å’Œå›æ”¶èµ„æºçš„ï¼›è€Œä¸€ä¸ªåˆ†ç¦»çš„çº¿ç¨‹ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹æ€æ­»æˆ–å›æ”¶èµ„æºã€‚ä¸€èˆ¬æ¥è¯´ï¼Œé»˜è®¤çš„å±æ€§æ˜¯å¯ç»“åˆçš„ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨pthread_detachå‡½æ•°å¯ä»¥åˆ†ç¦»ä¸€ä¸ªçº¿ç¨‹ï¼š</p><pre><code>int pthread_detach(pthread_t tid)
</code></pre><p>åœ¨é«˜å¹¶å‘çš„ä¾‹å­é‡Œï¼Œæ¯ä¸ªè¿æ¥éƒ½ç”±ä¸€ä¸ªçº¿ç¨‹å•ç‹¬å¤„ç†ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒæœåŠ¡å™¨ç¨‹åºå¹¶ä¸éœ€è¦å¯¹æ¯ä¸ªå­çº¿ç¨‹è¿›è¡Œç»ˆæ­¢ï¼Œè¿™æ ·çš„è¯ï¼Œæ¯ä¸ªå­çº¿ç¨‹å¯ä»¥åœ¨å…¥å£å‡½æ•°å¼€å§‹çš„åœ°æ–¹ï¼ŒæŠŠè‡ªå·±è®¾ç½®ä¸ºåˆ†ç¦»çš„ï¼Œè¿™æ ·å°±èƒ½åœ¨å®ƒç»ˆæ­¢åè‡ªåŠ¨å›æ”¶ç›¸å…³çš„çº¿ç¨‹èµ„æºäº†ï¼Œå°±ä¸éœ€è¦è°ƒç”¨pthread_joinå‡½æ•°äº†ã€‚</p><h2>æ¯ä¸ªè¿æ¥ä¸€ä¸ªçº¿ç¨‹å¤„ç†</h2><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ”¹é€ ä¸€ä¸‹æœåŠ¡å™¨ç«¯ç¨‹åºã€‚æˆ‘ä»¬çš„ç›®æ ‡æ˜¯è¿™æ ·ï¼šæ¯æ¬¡æœ‰æ–°çš„è¿æ¥åˆ°è¾¾åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œè€Œä¸æ˜¯ç”¨æ–°è¿›ç¨‹æ¥å¤„ç†å®ƒã€‚</p><pre><code>#include &quot;lib/common.h&quot;

extern void loop_echo(int);

void thread_run(void *arg) {
    pthread_detach(pthread_self());
    int fd = (int) arg;
    loop_echo(fd);
}

int main(int c, char **v) {
    int listener_fd = tcp_server_listen(SERV_PORT);
    pthread_t tid;
    
    while (1) {
        struct sockaddr_storage ss;
        socklen_t slen = sizeof(ss);
        int fd = accept(listener_fd, (struct sockaddr *) &amp;ss, &amp;slen);
        if (fd &lt; 0) {
            error(1, errno, &quot;accept failed&quot;);
        } else {
            pthread_create(&amp;tid, NULL, &amp;thread_run, (void *) fd);
        }
    }

    return 0;
}
</code></pre><p>è¿™ä¸ªç¨‹åºçš„ç¬¬18è¡Œé˜»å¡è°ƒç”¨åœ¨acceptä¸Šï¼Œä¸€æ—¦æœ‰æ–°è¿æ¥å»ºç«‹ï¼Œé˜»å¡è°ƒç”¨è¿”å›ï¼Œè°ƒç”¨pthread_createåˆ›å»ºä¸€ä¸ªå­çº¿ç¨‹æ¥å¤„ç†è¿™ä¸ªè¿æ¥ã€‚</p><p>æè¿°è¿æ¥æœ€ä¸»è¦çš„æ˜¯è¿æ¥æè¿°å­—ï¼Œè¿™é‡Œé€šè¿‡å¼ºåˆ¶æŠŠæè¿°å­—è½¬æ¢ä¸ºvoid *æŒ‡é’ˆçš„æ–¹å¼ï¼Œå®Œæˆäº†ä¼ å€¼ã€‚å¦‚æœä½ å¯¹è¿™éƒ¨åˆ†æœ‰ç‚¹ä¸ç†è§£ï¼Œå»ºè®®çœ‹ä¸€ä¸‹Cè¯­è¨€ç›¸å…³çš„æŒ‡é’ˆéƒ¨åˆ†å†…å®¹ã€‚æˆ‘ä»¬è¿™é‡Œå¯ä»¥ç®€å•æ€»ç»“ä¸€ä¸‹ï¼Œè™½ç„¶ä¼ çš„æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œä½†æ˜¯è¿™ä¸ªæŒ‡é’ˆé‡Œå­˜æ”¾çš„å¹¶ä¸æ˜¯ä¸€ä¸ªåœ°å€ï¼Œè€Œæ˜¯è¿æ¥æè¿°ç¬¦çš„æ•°å€¼ã€‚</p><p>æ–°çº¿ç¨‹å…¥å£å‡½æ•°thread_runé‡Œï¼Œç¬¬6è¡Œä½¿ç”¨äº†pthread_detachæ–¹æ³•ï¼Œå°†å­çº¿ç¨‹è½¬å˜ä¸ºåˆ†ç¦»çš„ï¼Œä¹Ÿå°±æ„å‘³ç€å­çº¿ç¨‹ç‹¬è‡ªè´Ÿè´£çº¿ç¨‹èµ„æºå›æ”¶ã€‚ç¬¬7è¡Œï¼Œå¼ºåˆ¶å°†æŒ‡é’ˆè½¬å˜ä¸ºæè¿°ç¬¦æ•°æ®ï¼Œå’Œå‰é¢å°†æè¿°å­—è½¬æ¢ä¸ºvoid *æŒ‡é’ˆå¯¹åº”ï¼Œç¬¬8è¡Œè°ƒç”¨loop_echoæ–¹æ³•å¤„ç†è¿™ä¸ªè¿æ¥çš„æ•°æ®è¯»å†™ã€‚</p><p>loop_echoçš„ç¨‹åºå¦‚ä¸‹ï¼Œåœ¨æ¥æ”¶å®¢æˆ·ç«¯çš„æ•°æ®ä¹‹åï¼Œå†ç¼–ç å›é€å‡ºå»ã€‚</p><pre><code>char rot13_char(char c) {
    if ((c &gt;= 'a' &amp;&amp; c &lt;= 'm') || (c &gt;= 'A' &amp;&amp; c &lt;= 'M'))
        return c + 13;
    else if ((c &gt;= 'n' &amp;&amp; c &lt;= 'z') || (c &gt;= 'N' &amp;&amp; c &lt;= 'Z'))
        return c - 13;
    else
        return c;
}

void loop_echo(int fd) {
    char outbuf[MAX_LINE + 1];
    size_t outbuf_used = 0;
    ssize_t result;
    while (1) {
        char ch;
        result = recv(fd, &amp;ch, 1, 0);

        //æ–­å¼€è¿æ¥æˆ–è€…å‡ºé”™
        if (result == 0) {
            break;
        } else if (result == -1) {
            error(1, errno, &quot;read error&quot;);
            break;
        }

        if (outbuf_used &lt; sizeof(outbuf)) {
            outbuf[outbuf_used++] = rot13_char(ch);
        }

        if (ch == '\n') {
            send(fd, outbuf, outbuf_used, 0);
            outbuf_used = 0;
            continue;
        }
    }
}
</code></pre><p>è¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œå¼€å¯å¤šä¸ªtelnetå®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºå¯ä»¥å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥å¹¶å›é€æ•°æ®ã€‚å•ç‹¬ä¸€ä¸ªè¿æ¥é€€å‡ºä¹Ÿä¸ä¼šå½±å“å…¶ä»–è¿æ¥çš„æ•°æ®æ”¶å‘ã€‚</p><pre><code>$telnet 127.0.0.1 43211
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
aaa
nnn
^]
telnet&gt; quit
Connection closed.
</code></pre><h2>æ„å»ºçº¿ç¨‹æ± å¤„ç†å¤šä¸ªè¿æ¥</h2><p>ä¸Šé¢çš„æœåŠ¡å™¨ç«¯ç¨‹åºè™½ç„¶å¯ä»¥æ­£å¸¸å·¥ä½œï¼Œä¸è¿‡å®ƒæœ‰ä¸€ä¸ªç¼ºç‚¹ï¼Œé‚£å°±æ˜¯å¦‚æœå¹¶å‘è¿æ¥è¿‡å¤šï¼Œå°±ä¼šå¼•èµ·çº¿ç¨‹çš„é¢‘ç¹åˆ›å»ºå’Œé”€æ¯ã€‚è™½ç„¶çº¿ç¨‹åˆ‡æ¢çš„ä¸Šä¸‹æ–‡å¼€é”€ä¸å¤§ï¼Œä½†æ˜¯çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€å´æ˜¯ä¸å°çš„ã€‚</p><p>èƒ½ä¸èƒ½å¯¹è¿™ä¸ªç¨‹åºè¿›è¡Œä¸€äº›ä¼˜åŒ–å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨é¢„åˆ›å»ºçº¿ç¨‹æ± çš„æ–¹å¼æ¥è¿›è¡Œä¼˜åŒ–ã€‚åœ¨æœåŠ¡å™¨ç«¯å¯åŠ¨æ—¶ï¼Œå¯ä»¥å…ˆæŒ‰ç…§å›ºå®šå¤§å°é¢„åˆ›å»ºå‡ºå¤šä¸ªçº¿ç¨‹ï¼Œå½“æœ‰æ–°è¿æ¥å»ºç«‹æ—¶ï¼Œå¾€è¿æ¥å­—é˜Ÿåˆ—é‡Œæ”¾ç½®è¿™ä¸ªæ–°è¿æ¥æè¿°å­—ï¼Œçº¿ç¨‹æ± é‡Œçš„çº¿ç¨‹è´Ÿè´£ä»è¿æ¥å­—é˜Ÿåˆ—é‡Œå–å‡ºè¿æ¥æè¿°å­—è¿›è¡Œå¤„ç†ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/d9/72/d976c7b993862f0dbef75354d2f49672.png?wh=1430*462" alt=""><br>
è¿™ä¸ªç¨‹åºçš„å…³é”®æ˜¯è¿æ¥å­—é˜Ÿåˆ—çš„è®¾è®¡ï¼Œå› ä¸ºè¿™é‡Œæ—¢æœ‰å¾€è¿™ä¸ªé˜Ÿåˆ—é‡Œæ”¾ç½®æè¿°ç¬¦çš„æ“ä½œï¼Œä¹Ÿæœ‰ä»è¿™ä¸ªé˜Ÿåˆ—é‡Œå–å‡ºæè¿°ç¬¦çš„æ“ä½œã€‚</p><p>å¯¹æ­¤ï¼Œéœ€è¦å¼•å…¥ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µï¼Œä¸€ä¸ªæ˜¯é”mutexï¼Œä¸€ä¸ªæ˜¯æ¡ä»¶å˜é‡conditionã€‚é”å¾ˆå¥½ç†è§£ï¼ŒåŠ é”çš„æ„æ€å°±æ˜¯å…¶ä»–çº¿ç¨‹ä¸èƒ½è¿›å…¥ï¼›æ¡ä»¶å˜é‡åˆ™æ˜¯åœ¨å¤šä¸ªçº¿ç¨‹éœ€è¦äº¤äº’çš„æƒ…å†µä¸‹ï¼Œç”¨æ¥çº¿ç¨‹é—´åŒæ­¥çš„åŸè¯­ã€‚</p><pre><code>//å®šä¹‰ä¸€ä¸ªé˜Ÿåˆ—
typedef struct {
    int number;  //é˜Ÿåˆ—é‡Œçš„æè¿°å­—æœ€å¤§ä¸ªæ•°
    int *fd;     //è¿™æ˜¯ä¸€ä¸ªæ•°ç»„æŒ‡é’ˆ
    int front;   //å½“å‰é˜Ÿåˆ—çš„å¤´ä½ç½®
    int rear;    //å½“å‰é˜Ÿåˆ—çš„å°¾ä½ç½®
    pthread_mutex_t mutex;  //é”
    pthread_cond_t cond;    //æ¡ä»¶å˜é‡
} block_queue;

//åˆå§‹åŒ–é˜Ÿåˆ—
void block_queue_init(block_queue *blockQueue, int number) {
    blockQueue-&gt;number = number;
    blockQueue-&gt;fd = calloc(number, sizeof(int));
    blockQueue-&gt;front = blockQueue-&gt;rear = 0;
    pthread_mutex_init(&amp;blockQueue-&gt;mutex, NULL);
    pthread_cond_init(&amp;blockQueue-&gt;cond, NULL);
}

//å¾€é˜Ÿåˆ—é‡Œæ”¾ç½®ä¸€ä¸ªæè¿°å­—fd
void block_queue_push(block_queue *blockQueue, int fd) {
    //ä¸€å®šè¦å…ˆåŠ é”ï¼Œå› ä¸ºæœ‰å¤šä¸ªçº¿ç¨‹éœ€è¦è¯»å†™é˜Ÿåˆ—
    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);
    //å°†æè¿°å­—æ”¾åˆ°é˜Ÿåˆ—å°¾çš„ä½ç½®
    blockQueue-&gt;fd[blockQueue-&gt;rear] = fd;
    //å¦‚æœå·²ç»åˆ°æœ€åï¼Œé‡ç½®å°¾çš„ä½ç½®
    if (++blockQueue-&gt;rear == blockQueue-&gt;number) {
        blockQueue-&gt;rear = 0;
    }
    printf(&quot;push fd %d&quot;, fd);
    //é€šçŸ¥å…¶ä»–ç­‰å¾…è¯»çš„çº¿ç¨‹ï¼Œæœ‰æ–°çš„è¿æ¥å­—ç­‰å¾…å¤„ç†
    pthread_cond_signal(&amp;blockQueue-&gt;cond);
    //è§£é”
    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);
}

//ä»é˜Ÿåˆ—é‡Œè¯»å‡ºæè¿°å­—è¿›è¡Œå¤„ç†
int block_queue_pop(block_queue *blockQueue) {
    //åŠ é”
    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);
    //åˆ¤æ–­é˜Ÿåˆ—é‡Œæ²¡æœ‰æ–°çš„è¿æ¥å­—å¯ä»¥å¤„ç†ï¼Œå°±ä¸€ç›´æ¡ä»¶ç­‰å¾…ï¼Œç›´åˆ°æœ‰æ–°çš„è¿æ¥å­—å…¥é˜Ÿåˆ—
    while (blockQueue-&gt;front == blockQueue-&gt;rear)
        pthread_cond_wait(&amp;blockQueue-&gt;cond, &amp;blockQueue-&gt;mutex);
    //å–å‡ºé˜Ÿåˆ—å¤´çš„è¿æ¥å­—
    int fd = blockQueue-&gt;fd[blockQueue-&gt;front];
    //å¦‚æœå·²ç»åˆ°æœ€åï¼Œé‡ç½®å¤´çš„ä½ç½®
    if (++blockQueue-&gt;front == blockQueue-&gt;number) {
        blockQueue-&gt;front = 0;
    }
    printf(&quot;pop fd %d&quot;, fd);
    //è§£é”
    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);
    //è¿”å›è¿æ¥å­—
    return fd;
}  
</code></pre><p>è¿™é‡Œæœ‰block_queueç›¸å…³çš„å®šä¹‰å’Œå®ç°ï¼Œå¹¶åœ¨å…³é”®çš„åœ°æ–¹åŠ äº†ä¸€äº›æ³¨é‡Šï¼Œæœ‰å‡ ä¸ªåœ°æ–¹éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><p>ç¬¬ä¸€æ˜¯è®°å¾—å¯¹æ“ä½œè¿›è¡ŒåŠ é”å’Œè§£é”ï¼Œè¿™é‡Œæ˜¯é€šè¿‡pthread_mutex_lockå’Œpthread_mutex_unlockæ¥å®Œæˆçš„ã€‚</p><p>ç¬¬äºŒæ˜¯å½“å·¥ä½œçº¿ç¨‹æ²¡æœ‰æè¿°å­—å¯ç”¨æ—¶ï¼Œéœ€è¦ç­‰å¾…ï¼Œç¬¬43è¡Œé€šè¿‡è°ƒç”¨pthread_cond_waitï¼Œæ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ç­‰å¾…æœ‰æ–°çš„æè¿°å­—å¯è¾¾ã€‚ç¬¬32è¡Œï¼Œä¸»çº¿ç¨‹é€šçŸ¥å·¥ä½œçº¿ç¨‹æœ‰æ–°çš„æè¿°ç¬¦éœ€è¦æœåŠ¡ã€‚</p><p>æœåŠ¡å™¨ç«¯ç¨‹åºå¦‚ä¸‹ï¼š</p><pre><code>void thread_run(void *arg) {
    pthread_t tid = pthread_self();
    pthread_detach(tid);

    block_queue *blockQueue = (block_queue *) arg;
    while (1) {
        int fd = block_queue_pop(blockQueue);
        printf(&quot;get fd in thread, fd==%d, tid == %d&quot;, fd, tid);
        loop_echo(fd);
    }
}

int main(int c, char **v) {
    int listener_fd = tcp_server_listen(SERV_PORT);

    block_queue blockQueue;
    block_queue_init(&amp;blockQueue, BLOCK_QUEUE_SIZE);

    thread_array = calloc(THREAD_NUMBER, sizeof(Thread));
    int i;
    for (i = 0; i &lt; THREAD_NUMBER; i++) {
        pthread_create(&amp;(thread_array[i].thread_tid), NULL, &amp;thread_run, (void *) &amp;blockQueue);
    }

    while (1) {
        struct sockaddr_storage ss;
        socklen_t slen = sizeof(ss);
        int fd = accept(listener_fd, (struct sockaddr *) &amp;ss, &amp;slen);
        if (fd &lt; 0) {
            error(1, errno, &quot;accept failed&quot;);
        } else {
            block_queue_push(&amp;blockQueue, fd);
        }
    }

    return 0;
}
</code></pre><p>æœ‰äº†æè¿°å­—é˜Ÿåˆ—ï¼Œä¸»ç¨‹åºå˜å¾—éå¸¸ç®€æ´ã€‚ç¬¬19-23è¡Œé¢„åˆ›å»ºäº†å¤šä¸ªçº¿ç¨‹ï¼Œç»„æˆäº†ä¸€ä¸ªçº¿ç¨‹æ± ã€‚28-32è¡Œåœ¨æ–°è¿æ¥å»ºç«‹åï¼Œå°†è¿æ¥æè¿°å­—åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>7-9è¡Œæ˜¯å·¥ä½œçº¿ç¨‹çš„ä¸»å¾ªç¯ï¼Œä»æè¿°å­—é˜Ÿåˆ—ä¸­å–å‡ºæè¿°å­—ï¼Œå¯¹è¿™ä¸ªè¿æ¥è¿›è¡ŒæœåŠ¡å¤„ç†ã€‚</p><p>åŒæ ·çš„ï¼Œè¿è¡Œè¿™ä¸ªç¨‹åºä¹‹åï¼Œå¼€å¯å¤šä¸ªtelnetå®¢æˆ·ç«¯ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªæœåŠ¡å™¨ç¨‹åºå¯ä»¥æ­£å¸¸å¤„ç†å¤šä¸ªå¹¶å‘è¿æ¥å¹¶å›æ˜¾ã€‚</p><pre><code>$telnet 127.0.0.1 43211
Trying 127.0.0.1...
Connected to localhost.
Escape character is '^]'.
aaa
nnn
^]
telnet&gt; quit
Connection closed.
</code></pre><p>å’Œå‰é¢çš„ç¨‹åºç›¸æ¯”ï¼Œçº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€å¤§å¤§é™ä½ï¼Œä½†å› ä¸ºçº¿ç¨‹æ± å¤§å°å›ºå®šï¼Œåˆå› ä¸ºä½¿ç”¨äº†é˜»å¡å¥—æ¥å­—ï¼Œè‚¯å®šä¼šå‡ºç°æœ‰è¿æ¥å¾—ä¸åˆ°åŠæ—¶æœåŠ¡çš„åœºæ™¯ã€‚è¿™ä¸ªé—®é¢˜çš„è§£å†³è¿˜æ˜¯è¦å›åˆ°æˆ‘åœ¨å¼€ç¯‡è¯é‡Œæåˆ°çš„æ–¹æ¡ˆä¸Šæ¥ï¼Œå¤šè·¯I/Oå¤ç”¨åŠ ä¸Šçº¿ç¨‹æ¥å¤„ç†ï¼Œä»…ä»…ä½¿ç”¨é˜»å¡I/Oæ¨¡å‹å’Œçº¿ç¨‹æ˜¯æ²¡æœ‰åŠæ³•è¾¾åˆ°æè‡´çš„é«˜å¹¶å‘å¤„ç†èƒ½åŠ›ã€‚</p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†çº¿ç¨‹æ¥æ„å»ºæœåŠ¡å™¨ç«¯ç¨‹åºã€‚ä¸€ç§æ˜¯æ¯æ¬¡åŠ¨æ€åˆ›å»ºçº¿ç¨‹ï¼Œå¦ä¸€ç§æ˜¯ä½¿ç”¨çº¿ç¨‹æ± æé«˜æ•ˆç‡ã€‚å’Œè¿›ç¨‹ç›¸æ¯”ï¼Œçº¿ç¨‹çš„è¯­ä¹‰æ›´è½»é‡ï¼Œä½¿ç”¨çš„åœºæ™¯ä¹Ÿæ›´å¤šã€‚çº¿ç¨‹æ˜¯é«˜æ€§èƒ½ç½‘ç»œæœåŠ¡å™¨å¿…é¡»æŒæ¡çš„æ ¸å¿ƒçŸ¥è¯†ï¼Œå¸Œæœ›ä½ èƒ½å¤Ÿé€šè¿‡æœ¬è®²çš„å­¦ä¹ ï¼Œç‰¢ç‰¢æŒæ¡å®ƒã€‚</p><h2>æ€è€ƒé¢˜</h2><p>å’Œå¾€å¸¸ä¸€æ ·ï¼Œç»™ä½ ç•™ä¸¤é“æ€è€ƒé¢˜ã€‚</p><p>ç¬¬ä¸€é“ï¼Œè¿æ¥å­—é˜Ÿåˆ—çš„å®ç°é‡Œï¼Œæœ‰ä¸€ä¸ªé‡è¦æƒ…å†µæ²¡æœ‰è€ƒè™‘ï¼Œå°±æ˜¯é˜Ÿåˆ—é‡Œæ²¡æœ‰å¯ç”¨çš„ä½ç½®äº†ï¼Œæƒ³æƒ³çœ‹ï¼Œå¦‚ä½•å¯¹è¿™ç§æƒ…å†µè¿›è¡Œä¼˜åŒ–ï¼Ÿ</p><p>ç¬¬äºŒé“ï¼Œæˆ‘åœ¨è®²åˆ°ç¬¬ä¸€ä¸ªhello-worldè®¡æ•°å™¨åº”ç”¨æ—¶ï¼Œè¯´â€œç»“æœæ˜¯å¹¸è¿â€è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ€ä¹ˆç†è§£å‘¢ï¼Ÿ</p><p>æ¬¢è¿ä½ åœ¨è¯„è®ºåŒºå†™ä¸‹ä½ çš„æ€è€ƒï¼Œæˆ‘ä¼šå’Œä½ ä¸€èµ·æ€è€ƒï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„æœ‹å‹æˆ–è€…åŒäº‹ï¼Œä¸€èµ·äº¤æµä¸€ä¸‹ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/eb/22/46b054b0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä¸·ç‹ä¼ å¥‡ä¸·</span>
  </div>
  <div class="_2_QraFYR_0">ç¬¬äºŒé¢˜ï¼šå¯èƒ½ä¼šå¾—åˆ°æ¯”æ­£ç¡®çš„å€¼å°çš„å€¼<br>i++å¤§è‡´åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š<br>       1ã€ä»å†…å­˜è¯»å‡ºiçš„å€¼åˆ°å¯„å­˜å™¨<br>       2ã€æ“ä½œå¯„å­˜å™¨åŠ 1<br>       3ã€å°†å¯„å­˜å™¨å€¼å†™åˆ°iå†…å­˜<br>å¤šä¸ªçº¿ç¨‹å»æ“ä½œåŒä¸€ä¸ªå…¨å±€å˜é‡çš„æ—¶å€™ï¼Œå¯èƒ½æŸä¸ªçº¿ç¨‹åœ¨ç¬¬äºŒæ­¥çš„æ—¶å€™åˆ‡æ¢åˆ°å¦ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™æ ·å°±å¯¼è‡´å°‘åŠ äº†ã€‚æ¯”å¦‚çº¿ç¨‹A åœ¨i=1 çš„æ—¶å€™åœ¨ç¬¬äºŒæ­¥ï¼Œè¿™ä¸ªæ—¶å€™å¯„å­˜å™¨åŠ 1å€¼ä¸º2ï¼Œåœ¨è¿™ä¸ªæ—¶å€™åˆ‡æ¢åˆ°çº¿ç¨‹B ï¼Œç”±äºçº¿ç¨‹Aè¿˜æ²¡æœ‰æŠŠ2å†™åˆ°ié‡Œé¢ï¼Œä½¿ç”¨Bè¯»å‡ºæ¥è¿˜æ˜¯1ï¼Œè‡ªå¢å†™åˆ°ié‡Œé¢ï¼Œiä¸º2ï¼Œåœ¨åˆ‡æ¢åˆ°çº¿ç¨‹Aï¼Œçº¿ç¨‹Aå°†å¯„å­˜å™¨é‡Œé¢çš„2å†™åˆ°iï¼Œè¿™æ ·å°±å°‘åŠ äº†ä¸€æ¬¡ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¤šçº¿ç¨‹ç¨‹åºè®¾è®¡çš„å¸¸è§å‘ã€‚è§£é‡Šåˆ°ä½ï¼Œèµã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-02-13 20:25:18</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/82/3d/356fc3d6.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¿†æ°´å¯’</span>
  </div>
  <div class="_2_QraFYR_0">ç¬¬ä¸€é“ï¼Œå…¶å®è¿™é‡Œä½¿ç”¨çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨æ‰©å®¹ç­–ç•¥è§£å†³fdå­˜æ”¾çš„é—®é¢˜ã€‚<br>ç¬¬äºŒé¢˜ï¼Œåœ¨å¹¶å‘åœºæ™¯ä¸‹å¾ˆå®¹æ˜“é€ æˆè®¡ç®—ç»“æœçš„ä¸å‡†ç¡®ã€‚å› ä¸ºè¿™é‡Œé¢æ˜¯ä¸¤ä¸ªçº¿ç¨‹å„æ‰§è¡Œ1000æ¬¡ã€‚å®é™…ä¸Šå¾ˆå¤§ç»“æœæ˜¯å°‘äº2000çš„ç»“æœã€‚è§£å†³æ–¹æ³•å¯ä»¥åŠ ä¸Šé”æˆ–volitateå…³é”®å­—ï¼ˆè§£å†³å¯è§è¡Œé—®é¢˜ï¼‰ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-15 15:32:24</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/f6/e3/e4bcd69e.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ²‰æ·€çš„æ¢¦æƒ³</span>
  </div>
  <div class="_2_QraFYR_0">å…³äºé˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Œé¢å¤–åŠ ä¸€ä¸ªcondï¼Œè¡¨ç¤ºé˜Ÿåˆ—æœªæ»¡æ¡ä»¶å°±å¯ä»¥äº†ã€‚<br><br>typedef struct {<br>    int number;<br>    int *fd;<br>    int front;<br>    int rear;<br>    &#47;&#47; é˜Ÿåˆ—ä¸­å½“å‰å…ƒç´ æ•°ç›®<br>    int count;<br>    pthread_mutex_t mutex;<br>    pthread_cond_t not_empty;<br>    &#47;&#47; é˜Ÿåˆ—æœªæ»¡æ¡ä»¶<br>    pthread_cond_t not_full;<br>} block_queue;<br><br>void block_queue_init(block_queue *blockQueue, int number) {<br>    blockQueue-&gt;number = number;<br>    blockQueue-&gt;fd = calloc(number, sizeof(int));<br>    blockQueue-&gt;count = blockQueue-&gt;front = blockQueue-&gt;rear = 0;<br>    pthread_mutex_init(&amp;blockQueue-&gt;mutex, NULL);<br>    pthread_cond_init(&amp;blockQueue-&gt;not_empty, NULL);<br>    pthread_cond_init(&amp;blockQueue-&gt;not_full, NULL);<br>}<br><br>void block_queue_push(block_queue *blockQueue, int fd) {<br>    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);<br>    while (blockQueue-&gt;count == blockQueue-&gt;number){   &#47;&#47;é˜Ÿåˆ—æ»¡<br>        pthread_cond_wait(&amp;blockQueue-&gt;not_full, &amp;blockQueue-&gt;mutex);<br>    }<br><br>    blockQueue-&gt;fd[blockQueue-&gt;rear] = fd;<br>    if (++blockQueue-&gt;rear == blockQueue-&gt;number) { <br>        blockQueue-&gt;rear = 0;<br>    }<br>    blockQueue-&gt;count++;<br>    printf(&quot;push fd %d&quot;, fd);<br>    pthread_cond_signal(&amp;blockQueue-&gt;not_empty);<br>    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);<br>}<br><br>int block_queue_pop(block_queue *blockQueue) {<br>    pthread_mutex_lock(&amp;blockQueue-&gt;mutex);<br>    while (blockQueue-&gt;front == blockQueue-&gt;rear)  &#47;&#47; ç©ºé˜Ÿåˆ—<br>        pthread_cond_wait(&amp;blockQueue-&gt;not_empty, &amp;blockQueue-&gt;mutex);<br>    int fd = blockQueue-&gt;fd[blockQueue-&gt;front];<br>    if (++blockQueue-&gt;front == blockQueue-&gt;number) {<br>        blockQueue-&gt;front = 0;<br>    }<br>    blockQueue-&gt;count--;<br>    printf(&quot;pop fd %d&quot;, fd);<br>    pthread_cond_signal(&amp;blockQueue-&gt;not_full);<br>    &#47;&#47; è§£é”<br>    pthread_mutex_unlock(&amp;blockQueue-&gt;mutex);<br>    return fd;<br>}<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¸é”™çš„æƒ³æ³•ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-07 17:23:08</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/c1/39/11904266.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Steiner</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®block_queue_popçš„pthread_cond_waitä¸ºä»€ä¹ˆè¦æ”¾åœ¨whileè€Œä¸æ˜¯ifä¸­</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¥½é—®é¢˜ã€‚<br><br>è¿™æ˜¯ä¸ºäº†ç¡®ä¿è¢«pthread_cond_waitå”¤é†’ä¹‹åçš„çº¿ç¨‹ï¼Œç¡®å®å¯ä»¥æ»¡è¶³ç»§ç»­å¾€ä¸‹æ‰§è¡Œçš„æ¡ä»¶ã€‚å¦‚æœæ²¡æœ‰whileå¾ªç¯çš„å†æ¬¡ç¡®è®¤ï¼Œå¯èƒ½ç›´æ¥å°±å¾€ä¸‹æ‰§è¡Œäº†ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-14 15:28:36</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/82/42/8b04d489.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>åˆ˜ä¸¹</span>
  </div>
  <div class="_2_QraFYR_0">block_queue_pushæœªè€ƒè™‘é˜Ÿåˆ—æ»¡çš„æƒ…å†µï¼Œå¯ä»¥åœ¨æœ¬å‡½æ•°é‡Œå…ˆåˆ¤æ–­æ˜¯å¦é˜Ÿåˆ—æ»¡äº†ï¼Œå¦‚æœæ»¡å°±æŒ‰æŸä¸ªç­–ç•¥æ‰©å®¹ï¼Œä¾‹å¦‚æ‰©å¤§1.5æˆ–2å€ã€‚æ‰©å®¹å¤±è´¥æˆ–è€…å®¹é‡è¶…è¿‡æœ€å¤§å€¼ï¼Œå°±è¿”å›å¤±è´¥ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¾ˆå¥½çš„æ–¹æ³•ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-07 09:48:12</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ—ç‡•</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œè¯·é—®ä¸€ä¸‹ï¼Œæˆ‘è·‘äº†thread02è¿™ä¸ªç¨‹åºã€‚åœ¨æ²¡æœ‰å®¢æˆ·ç«¯è¿ä¸Šæ¥çš„æƒ…å†µä¸‹ï¼Œæˆ‘å‘ç°å››ä¸ªå­çº¿ç¨‹éƒ½æ‰§è¡Œåˆ°äº†block_queqe_popå‡½æ•°é‡Œé¢ï¼Œå¹¶éƒ½æˆåŠŸæ‰§è¡Œå®Œpthread_mutex_lockï¼Œé˜»å¡åœ¨åé¢çš„whileå¾ªç¯é‡Œé¢ã€‚è¿™é‡Œæˆ‘æƒ³é—®çš„æ˜¯å››ä¸ªå­çº¿ç¨‹ï¼Œä¸æ˜¯æœ€å¤šåªåº”è¯¥æœ‰ä¸€ä¸ªèƒ½æ‹¿åˆ°äº’æ–¥é‡ï¼Œå…¶ä»–ä¸‰ä¸ªéƒ½åº”è¯¥é˜»å¡åœ¨pthread_mutex_lockå‡½æ•°ä¸­ä¹ˆï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é—®é¢˜çš„å…³é”®æ˜¯pthread_cond_waitè¿™ä¸ªå‡½æ•°ï¼Œäº‹å®ä¸Šï¼Œè¿™ä¸ªå‡½æ•°ä½¿å¾—å½“å‰çº¿ç¨‹è¿›å…¥ä¼‘çœ ï¼Œå¹¶ä¸”é‡Šæ”¾å½“å‰çº¿ç¨‹æŒæœ‰çš„äº’æ–¥é”ã€‚è€Œå½“è°ƒç”¨çº¿ç¨‹åæ¥ä»pthread_cond_waitè¿”å›æ—¶ï¼Œè¯¥çº¿ç¨‹å†æ¬¡æŒæœ‰è¯¥äº’æ–¥é”ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆå››ä¸ªå­çº¿ç¨‹éƒ½å¯ä»¥è·‘å®Œpthread_mutex_lockï¼Œç„¶åéƒ½åœ¨pthread_cond_waitè¿™ä¸ªå‡½æ•°ä¸­ä¼‘çœ ç­‰å¾…çš„åŸå› ã€‚<br></p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-04-25 11:03:40</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1c/f0/ab/3f7f3ae7.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ„šç¬¨çš„è€é¼ </span>
  </div>
  <div class="_2_QraFYR_0">æœ‰ä¸ªåœ°æ–¹ä¸å¤ªç†è§£ï¼Œä¸€å¼€å§‹åˆå§‹çŠ¶æ€ä¸‹ï¼Œçº¿ç¨‹popåŠ é”äº†ï¼Œä¸ºä»€ä¹ˆï¼Œæœ‰acceptæ—¶å€™ï¼Œæ‰§è¡Œpushçš„æ—¶å€™è·å–é”æ€ä¹ˆèƒ½æˆåŠŸå‘¢ï¼Œä¸æ˜¯é”å·²ç»è¢«popç”¨äº†ï¼Œè¿˜æ²¡é‡Šæ”¾å‘¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é—®é¢˜çš„å…³é”®åœ¨äºpthread_cond_waitçš„è¯­ä¹‰ï¼Œåœ¨æ¶ˆè´¹è€…çº¿ç¨‹ä¸­ï¼Œé€šè¿‡waitç­‰å¾…è¿æ¥å¤„ç†ï¼Œè¿™ä¸ªæ—¶å€™acceptä¹‹åæ‰§è¡Œ pushè·å–é”æ˜¯å¯ä»¥çš„ï¼Œå¹¶ä¸”é€šè¿‡signalçš„æ–¹å¼è®©æ¶ˆè´¹è€…çº¿ç¨‹è‹é†’è¿‡æ¥å¤„ç†ã€‚<br><br>åœ¨ç»å¤§éƒ¨åˆ†æ—¶åˆ»ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹éƒ½æ˜¯åœ¨waitçŠ¶æ€çš„ï¼Œpushä¸€å¼€å§‹çš„locké”åªæ˜¯ä¸€ä¸ªéå¸¸çŸ­æš‚çš„checkåŠ¨ä½œã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-21 21:27:22</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1c/f0/ab/3f7f3ae7.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ„šç¬¨çš„è€é¼ </span>
  </div>
  <div class="_2_QraFYR_0">è¿™ä¸ªçº¿ç¨‹å‡½æ•°é‡Œé¢ï¼Œæ²¡æœ‰è°ƒç”¨closeå…³é—­connfdï¼Œå¯¼è‡´ï¼Œå¾ˆå¤šå¾ˆå¤šsocketçŠ¶æ€ä¸å¯¹ï¼Œæ²¡æœ‰æ­£å¸¸è¿›å…¥time_waitçŠ¶æ€<br>tcp4       0      0  127.0.0.1.43211        127.0.0.1.53703        CLOSE_WAIT <br>tcp4       0      0  127.0.0.1.53703        127.0.0.1.43211        FIN_WAIT_2 <br>tcp4       0      0  127.0.0.1.43211        127.0.0.1.53695        CLOSE_WAIT <br>tcp4       0      0  127.0.0.1.53695        127.0.0.1.43211        FIN_WAIT_2</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ç¡®å®å¦‚æ­¤ï¼Œéœ€è¦åœ¨å¾ªç¯å‡½æ•°é‡Œå¤„ç†å®ŒåŠ ä¸Šclose(fd)çš„æ“ä½œã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-20 16:23:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/2b/84/07f0c0d6.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>supermouse</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆæˆ‘æƒ³é—®ä¸€ä¸‹ï¼Œçº¿ç¨‹çš„åˆ›å»ºé”€æ¯å’Œè¿›ç¨‹çš„åˆ›å»ºé”€æ¯å“ªä¸ªå¼€é”€æ¯”è¾ƒå¤§ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æˆ‘è§‰å¾—æ˜¯çº¿ç¨‹ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-02-24 21:51:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/ff/46/2ea2fe90.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é˜¿å°”å‘æ–¯</span>
  </div>
  <div class="_2_QraFYR_0">æˆ‘è‡ªå®šä¹‰é˜»å¡é˜Ÿåˆ—(å¤šäº†ä¸ªcntè®¡æ•°å…ƒç´ ä¸ªæ•°ï¼Œå’Œæ¡ä»¶å˜é‡åˆ†å¼€æ¥ï¼Œå®ç°èµ·æ¥æ¸…æ™°æ˜äº†ç®€å•å¤šäº†)<br>typedef struct<br>{<br>  int size;       &#47;&#47;é˜Ÿåˆ—å®¹é‡<br>  int *pFd;      &#47;&#47;å­˜å‚¨é˜Ÿåˆ—å…ƒç´ ï¼ŒåŠ¨æ€åˆ†é…<br>  int cnt;         &#47;&#47;é˜Ÿåˆ—å½“å‰å…ƒç´ ä¸ªæ•°<br>  int pushIdx; &#47;&#47;å…¥é˜Ÿå…ƒç´ ç´¢å¼•<br>  int popIdx;   &#47;&#47;å‡ºå¯¹å…ƒç´ ç´¢å¼•<br>  pthread_mutex_t mutex;  &#47;&#47;é”<br>  pthread_cond_t noFull;     &#47;&#47;éæ»¡ï¼Œå³é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°cntä»sizeå€¼ï¼Œå˜æˆsize - 1æ—¶çš„è§¦å‘æ¡ä»¶<br>  pthread_cond_t noEmpty;&#47;&#47;éç©ºï¼Œå³é˜Ÿåˆ—å…ƒç´ ä¸ªæ•°cntä»0å€¼ï¼Œå˜æˆ1æ—¶çš„è§¦å‘æ¡ä»¶<br>}BlockQueue;</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯ä»¥çš„ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-11-06 22:54:41</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/39/fa/a7edbc72.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å®‰æ’</span>
  </div>
  <div class="_2_QraFYR_0">1.æ²¡ä½ç½®å¯ç”¨å¯ä»¥é€‰æ‹©ä¸¢å¼ƒï¼Œå–å‡ºæ¥ç›´æ¥å…³é—­ï¼Œç­‰å¾…å¯¹æ–¹é‡è¿ï¼Œæˆ–è€…å…ˆåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æœ‰ä½ç½®ï¼Œæ²¡ä½ç½®çš„è¯ç›´æ¥å°±ä¸å–å‡ºå¥—æ¥å­—ï¼Œè®©å®ƒç•™åœ¨å†…æ ¸é˜Ÿåˆ—ä¸­ï¼Œè®©å†…æ ¸å¤„ç†ã€‚<br>2.å­˜åœ¨ç«æ€æ¡ä»¶ï¼Œéœ€è¦åŠ é”ï¼Œä¸åŠ é”å¯èƒ½å¤§éƒ¨åˆ†æ—¶é—´ä¹Ÿèƒ½å¾—åˆ°æ­£ç¡®ç»“æœã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-07 08:18:19</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/43/5b/17fef3ba.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æˆ‘ç‘Ÿç‘Ÿçš„æ–¹æ³•</span>
  </div>
  <div class="_2_QraFYR_0">å¤šè·¯ I&#47;O å¤ç”¨å…·ä½“æ˜¯å•¥æ„æ€å•Š</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä½ å¯ä»¥æƒ³è±¡æˆæœ‰ä¸€ä¸ªI&#47;Oå¤„ç†çš„&quot;å¤šé¢æ‰‹&quot;ï¼Œå¯ä»¥åŒæ—¶å¤„ç†å¤šä¸ªI&#47;Oï¼Œæ‰€ä»¥æŠŠå®ƒå«åš&quot;å¤šè·¯I&#47;Oå¤ç”¨&quot;ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-04-22 08:12:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1b/2b/27/9676d6b3.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è¶…å¤§çº¢ç»†èƒ</span>
  </div>
  <div class="_2_QraFYR_0">æ¯æ¬¡æ·»åŠ  fd ä¹‹å‰ï¼Œåˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦æ»¡äº†<br> (blockQueue-&gt;rear + 1) % blockQueue-&gt;number == blockQueue-&gt;front<br>å¦‚æœæ»¡äº†å¯ä»¥é‡‡ç”¨ç±»ä¼¼ C++ vector çš„æ‰©å®¹æ–¹å¼ç›´æ¥æŠŠçº¿ç¨‹æ± ç¿»å€æ‰©å®¹ï¼Œ<br>å¦‚æœæ‰©å®¹å‰çš„ blockQueue-&gt;rear &lt; blockQueue-&gt;front <br>è¿˜éœ€è¦å°† 0~blockQueue-&gt;rear çš„ fd ç§»åˆ° blockQueue-&gt;front~blockQueue-&gt;number-1 çš„åé¢ï¼Œå†å°†æ–°çš„ fd åŠ å…¥</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¥½åŠæ³•</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-01-17 20:12:59</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/67/f4/9a1feb59.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é’±</span>
  </div>
  <div class="_2_QraFYR_0">1ï¼šé˜»å¡IO+å¤šè¿›ç¨‹â€”â€”å®ç°ç®€å•ï¼Œæ€§èƒ½ä¸€èˆ¬<br>2ï¼šé˜»å¡IO+å¤šçº¿ç¨‹â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šè¿›ç¨‹ï¼Œå‡å°‘äº†ä¸Šä¸‹æ–‡åˆ‡æ¢æ‰€å¸¦æ¥çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰æ‰€æé«˜ã€‚<br>3ï¼šé˜»å¡IO+çº¿ç¨‹æ± â€”â€”ç›¸æ¯”äºé˜»å¡IO+å¤šçº¿ç¨‹ï¼Œå‡å°‘äº†çº¿ç¨‹é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæ€§èƒ½æœ‰äº†è¿›ä¸€æ­¥çš„æé«˜ã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-11-24 17:36:11</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/64/86/f5a9403a.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å¤šè¥„ä¸¸</span>
  </div>
  <div class="_2_QraFYR_0">1. (just talk)å¯ä»¥æ‹’ç» æ‰©å®¹ æˆ–è€… åŠ ä¸€ä¸ªä¿¡å·é‡æ¥å˜ä¸ºé˜»å¡é˜Ÿåˆ—å­<br><br>2. ç»å¤§å¤šæ•°æƒ…å†µä¸‹è¿™ä¸ªå€¼å°äº2000å“‡</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-10-09 21:06:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/29/d2/2b/af13fcd6.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ç®€ç®€å•å•å°±æ˜¯å¹¸ç¦</span>
  </div>
  <div class="_2_QraFYR_0">çº¿ç¨‹é‡Œé¢çš„æ‰“å°èƒ½æ˜¾ç¤ºå‡ºæ¥ï¼Ÿï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-07-19 08:04:05</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>åŠŸå¤«ç†ŠçŒ«</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæˆ‘è®°å¾—é”æœ‰ä¸€ä¸ªæ˜¯éé˜»å¡ï¼Œé‚£èƒ½ä¸èƒ½ç”¨é‚£ä¸ªæ¥æ›¿æ¢æ™®é€šçš„é”æ¥å®ç°è¿™ä¸ªçº¿ç¨‹æ± æ¥å¢åŠ è¿™ä¸ªçº¿ç¨‹æ± çš„è¿è¡Œæ•ˆç‡ã€‚<br>ç¬¬ä¸€é—®æ„Ÿè§‰æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯ç”¨é“¾è¡¨æ¥è¯•è¯•æ— è®ºå•å‘è¿˜æ˜¯åŒå‘é“¾è¡¨ç®¡ç†ã€‚æˆ–è€…ç”¨reallocæ¥æ‰©å®¹</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-05-31 14:31:26</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/29/b0/d3/200e82ff.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>åŠŸå¤«ç†ŠçŒ«</span>
  </div>
  <div class="_2_QraFYR_0">ç¬¬ä¸€é—®ï¼šå¯ä»¥ç»™ä¸€ä¸ªæ‰©å®¹çš„æœ€å¤§å€¼ï¼Œç„¶åç”¨reallocæ‰©å®¹ã€‚å¦‚æœè¶…è¿‡äº†æœ€å¤§å€¼ç„¶åç­‰å¾…ä¸€ä¸ªæ¡ä»¶å˜é‡å°±å¯ä»¥äº†</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-05-31 14:22:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/12/a8/8aaf13e0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>mikewoo</span>
  </div>
  <div class="_2_QraFYR_0">ç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯éœ€è¦è€ƒè™‘åœ¨é˜Ÿåˆ—æ»¡äº†çš„åœºæ™¯ä¸‹æ˜¯å¦éœ€è¦åšæ‰©å®¹æˆ–è€…é‡‡å–å„ç§æ‹’ç»ç­–ç•¥ï¼›ç¬¬äºŒä¸ªé—®é¢˜æ˜¯å¤šçº¿ç¨‹æ‰§è¡Œå¸¸è§çš„çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘ğŸ»</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-04-30 17:55:27</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/29/25/c7/edd74dfb.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ·¡C</span>
  </div>
  <div class="_2_QraFYR_0">1.å¯ä»¥è‡ªæ—‹<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æˆ‘çŒœä½ æ˜¯è¯´å¯ä»¥å¾ªåº.....</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-02-12 14:33:59</div>
  </div>
</div>
</div>
</li>
</ul>