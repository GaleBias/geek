<audio title="33 _  SDK è®¾è®¡ï¼ˆä¸Šï¼‰ï¼šå¦‚ä½•è®¾è®¡å‡ºä¸€ä¸ªä¼˜ç§€çš„ Go SDKï¼Ÿ" src="https://static001.geekbang.org/resource/audio/97/f4/979d085783a9cc210156717875b933f4.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å­”ä»¤é£ã€‚æ¥ä¸‹æ¥çš„ä¸¤è®²ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•è®¾è®¡å’Œå®ç°ä¸€ä¸ªä¼˜ç§€çš„Go SDKã€‚</p><p>åç«¯æœåŠ¡é€šè¿‡APIæ¥å£å¯¹å¤–æä¾›åº”ç”¨çš„åŠŸèƒ½ï¼Œä½†æ˜¯ç”¨æˆ·ç›´æ¥è°ƒç”¨APIæ¥å£ï¼Œéœ€è¦ç¼–å†™APIæ¥å£è°ƒç”¨çš„é€»è¾‘ï¼Œå¹¶ä¸”éœ€è¦æ„é€ å…¥å‚å’Œè§£æè¿”å›çš„æ•°æ®åŒ…ï¼Œä½¿ç”¨èµ·æ¥æ•ˆç‡ä½ï¼Œè€Œä¸”æœ‰ä¸€å®šçš„å¼€å‘å·¥ä½œé‡ã€‚</p><p>åœ¨å®é™…çš„é¡¹ç›®å¼€å‘ä¸­ï¼Œé€šå¸¸ä¼šæä¾›å¯¹å¼€å‘è€…æ›´å‹å¥½çš„SDKåŒ…ï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨ã€‚å¾ˆå¤šå¤§å‹æœåŠ¡åœ¨å‘å¸ƒæ—¶éƒ½ä¼šä¼´éšç€SDKçš„å‘å¸ƒï¼Œä¾‹å¦‚è…¾è®¯äº‘å¾ˆå¤šäº§å“éƒ½æä¾›äº†SDKï¼š</p><p><img src="https://static001.geekbang.org/resource/image/e1/fa/e1bb8eb03c2f26f546710e95751c17fa.png?wh=1920x747" alt="å›¾ç‰‡"></p><p>æ—¢ç„¶SDKå¦‚æ­¤é‡è¦ï¼Œé‚£ä¹ˆå¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Go SDKå‘¢ï¼Ÿè¿™ä¸€è®²æˆ‘å°±æ¥è¯¦ç»†ä»‹ç»ä¸€ä¸‹ã€‚</p><h2>ä»€ä¹ˆæ˜¯SDKï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹ä»€ä¹ˆæ˜¯SDKã€‚</p><p>å¯¹äºSDKï¼ˆSoftware Development Kitï¼Œè½¯ä»¶å¼€å‘å·¥å…·åŒ…ï¼‰ï¼Œä¸åŒåœºæ™¯ä¸‹æœ‰ä¸åŒçš„è§£é‡Šã€‚ä½†æ˜¯å¯¹äºä¸€ä¸ªGoåç«¯æœåŠ¡æ¥è¯´ï¼ŒSDKé€šå¸¸æ˜¯æŒ‡<strong>å°è£…äº†Goåç«¯æœåŠ¡APIæ¥å£çš„è½¯ä»¶åŒ…</strong>ï¼Œé‡Œé¢é€šå¸¸åŒ…å«äº†è·Ÿè½¯ä»¶ç›¸å…³çš„åº“ã€æ–‡æ¡£ã€ä½¿ç”¨ç¤ºä¾‹ã€å°è£…å¥½çš„APIæ¥å£å’Œå·¥å…·ã€‚</p><p>è°ƒç”¨SDKè·Ÿè°ƒç”¨æœ¬åœ°å‡½æ•°æ²¡æœ‰å¤ªå¤§çš„åŒºåˆ«ï¼Œæ‰€ä»¥å¯ä»¥æå¤§åœ°æå‡å¼€å‘è€…çš„å¼€å‘æ•ˆç‡å’Œä½“éªŒã€‚SDKå¯ä»¥ç”±æœåŠ¡æä¾›è€…æä¾›ï¼Œä¹Ÿå¯ä»¥ç”±å…¶ä»–ç»„ç»‡æˆ–ä¸ªäººæä¾›ã€‚ä¸ºäº†é¼“åŠ±å¼€å‘è€…ä½¿ç”¨å…¶ç³»ç»Ÿæˆ–è¯­è¨€ï¼ŒSDKé€šå¸¸éƒ½æ˜¯å…è´¹æä¾›çš„ã€‚</p><p>é€šå¸¸ï¼ŒæœåŠ¡æä¾›è€…ä¼šæä¾›ä¸åŒè¯­è¨€çš„SDKï¼Œæ¯”å¦‚é’ˆå¯¹Pythonå¼€å‘è€…ä¼šæä¾›Pythonç‰ˆçš„SDKï¼Œé’ˆå¯¹Goå¼€å‘è€…ä¼šæä¾›Goç‰ˆçš„SDKã€‚ä¸€äº›æ¯”è¾ƒä¸“ä¸šçš„å›¢é˜Ÿè¿˜ä¼šæœ‰SDKè‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼Œå¯ä»¥æ ¹æ®APIæ¥å£å®šä¹‰ï¼Œè‡ªåŠ¨ç”Ÿæˆä¸åŒè¯­è¨€çš„SDKã€‚ä¾‹å¦‚ï¼ŒProtocol Buffersçš„ç¼–è¯‘å·¥å…·protocï¼Œå°±å¯ä»¥åŸºäºProtobufæ–‡ä»¶ç”ŸæˆC++ã€Pythonã€Javaã€JavaScriptã€PHPç­‰è¯­è¨€ç‰ˆæœ¬çš„SDKã€‚é˜¿é‡Œäº‘ã€è…¾è®¯äº‘è¿™äº›ä¸€çº¿å¤§å‚ï¼Œä¹Ÿå¯ä»¥åŸºäºAPIå®šä¹‰ï¼Œç”Ÿæˆä¸åŒç¼–ç¨‹è¯­è¨€çš„SDKã€‚</p><!-- [[[read_end]]] --><h2>SDKè®¾è®¡æ–¹æ³•</h2><p>é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•æ‰èƒ½è®¾è®¡ä¸€ä¸ªå¥½çš„SDKå‘¢ï¼Ÿå¯¹äºSDKï¼Œä¸åŒå›¢é˜Ÿä¼šæœ‰ä¸åŒçš„è®¾è®¡æ–¹å¼ï¼Œæˆ‘è°ƒç ”äº†ä¸€äº›ä¼˜ç§€SDKçš„å®ç°ï¼Œå‘ç°è¿™äº›SDKæœ‰ä¸€äº›å…±åŒç‚¹ã€‚æ ¹æ®æˆ‘çš„è°ƒç ”ç»“æœï¼Œç»“åˆæˆ‘åœ¨å®é™…å¼€å‘ä¸­çš„ç»éªŒï¼Œæˆ‘æ€»ç»“å‡ºäº†ä¸€å¥—SDKè®¾è®¡æ–¹æ³•ï¼Œæ¥ä¸‹æ¥å°±åˆ†äº«ç»™ä½ ã€‚</p><h3>å¦‚ä½•ç»™SDKå‘½åï¼Ÿ</h3><p>åœ¨è®²è®¾è®¡æ–¹æ³•ä¹‹å‰ï¼Œæˆ‘å…ˆæ¥ä»‹ç»ä¸¤ä¸ªé‡è¦çš„çŸ¥è¯†ç‚¹ï¼šSDKçš„å‘½åæ–¹å¼å’ŒSDKçš„ç›®å½•ç»“æ„ã€‚</p><p>SDKçš„åå­—ç›®å‰æ²¡æœ‰ç»Ÿä¸€çš„è§„èŒƒï¼Œä½†æ¯”è¾ƒå¸¸è§çš„å‘½åæ–¹å¼æ˜¯ <code>xxx-sdk-go</code> / <code>xxx-sdk-python</code> / <code>xxx-sdk-java</code> ã€‚å…¶ä¸­ï¼Œ <code>xxx</code> å¯ä»¥æ˜¯é¡¹ç›®åæˆ–è€…ç»„ç»‡åï¼Œä¾‹å¦‚è…¾è®¯äº‘åœ¨GitHubä¸Šçš„ç»„ç»‡åä¸ºtencentcloudï¼Œé‚£å®ƒçš„SDKå‘½åå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/e2/1e/e269d5d0e19a73d45ccdf5f5561c611e.png?wh=1210x863" alt="å›¾ç‰‡"></p><h3>SDKçš„ç›®å½•ç»“æ„</h3><p>ä¸åŒé¡¹ç›®SDKçš„ç›®å½•ç»“æ„ä¹Ÿä¸ç›¸åŒï¼Œä½†ä¸€èˆ¬éœ€è¦åŒ…å«ä¸‹é¢è¿™äº›æ–‡ä»¶æˆ–ç›®å½•ã€‚ç›®å½•åå¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†ç›®å½•åŠŸèƒ½æ˜¯ç±»ä¼¼çš„ã€‚</p><ul>
<li><strong>README.md</strong>ï¼šSDKçš„å¸®åŠ©æ–‡æ¡£ï¼Œé‡Œé¢åŒ…å«äº†å®‰è£…ã€é…ç½®å’Œä½¿ç”¨SDKçš„æ–¹æ³•ã€‚</li>
<li><strong>examples/sample/</strong>ï¼šSDKçš„ä½¿ç”¨ç¤ºä¾‹ã€‚</li>
<li><strong>sdk/</strong>ï¼šSDKå…±äº«çš„åŒ…ï¼Œé‡Œé¢å°è£…äº†æœ€åŸºç¡€çš„é€šä¿¡åŠŸèƒ½ã€‚å¦‚æœæ˜¯HTTPæœåŠ¡ï¼ŒåŸºæœ¬éƒ½æ˜¯åŸºäº <code>net/http</code> åŒ…è¿›è¡Œå°è£…ã€‚</li>
<li><strong>api</strong>ï¼šå¦‚æœ <code>xxx-sdk-go</code> åªæ˜¯ä¸ºæŸä¸€ä¸ªæœåŠ¡æä¾›SDKï¼Œå°±å¯ä»¥æŠŠè¯¥æœåŠ¡çš„æ‰€æœ‰APIæ¥å£å°è£…ä»£ç å­˜æ”¾åœ¨apiç›®å½•ä¸‹ã€‚</li>
<li><strong>services/{iam, tms}</strong> ï¼šå¦‚æœ <code>xxx-sdk-go</code> ä¸­ï¼Œ <code>xxx</code> æ˜¯ä¸€ä¸ªç»„ç»‡ï¼Œé‚£ä¹ˆè¿™ä¸ªSDKå¾ˆå¯èƒ½ä¼šé›†æˆè¯¥ç»„ç»‡ä¸­å¾ˆå¤šæœåŠ¡çš„APIï¼Œå°±å¯ä»¥æŠŠæŸç±»æœåŠ¡çš„APIæ¥å£å°è£…ä»£ç å­˜æ”¾åœ¨ <code>services/&lt;æœåŠ¡å&gt;</code>ä¸‹ï¼Œä¾‹å¦‚AWSçš„<a href="https://github.com/aws/aws-sdk-go/tree/main/service">Go SDK</a>ã€‚</li>
</ul><p>ä¸€ä¸ªå…¸å‹çš„ç›®å½•ç»“æ„å¦‚ä¸‹ï¼š</p><pre><code class="language-bash">â”œâ”€â”€ examples            # ç¤ºä¾‹ä»£ç å­˜æ”¾ç›®å½•
â”‚   â””â”€â”€ authz.go
â”œâ”€â”€ README.md           # SDKä½¿ç”¨æ–‡æ¡£
â”œâ”€â”€ sdk                 # å…¬å…±åŒ…ï¼Œå°è£…äº†SDKé…ç½®ã€APIè¯·æ±‚ã€è®¤è¯ç­‰ä»£ç 
â”‚   â”œâ”€â”€ client.go
â”‚   â”œâ”€â”€ config.go
â”‚   â”œâ”€â”€ credential.go
â”‚   â””â”€â”€ ...
â””â”€â”€ services            # APIå°è£…
    â”œâ”€â”€ common
    â”‚   â””â”€â”€ model
    â”œâ”€â”€ iam             # iamæœåŠ¡çš„APIæ¥å£
    â”‚   â”œâ”€â”€ authz.go
    â”‚   â”œâ”€â”€ client.go
    â”‚   â””â”€â”€ ...
    â””â”€â”€ tms             # tmsæœåŠ¡çš„APIæ¥å£
</code></pre><h3>SDKè®¾è®¡æ–¹æ³•</h3><p>SDKçš„è®¾è®¡æ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/9f/ca/9fb7aa8d3da4210223e9b0c87943e8ca.jpg?wh=1920x841" alt="å›¾ç‰‡"></p><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡Configé…ç½®åˆ›å»ºå®¢æˆ·ç«¯Clientï¼Œä¾‹å¦‚ <code>func NewClient(config sdk.Config) (Client, error)</code>ï¼Œé…ç½®ä¸­å¯ä»¥æŒ‡å®šä¸‹é¢çš„ä¿¡æ¯ã€‚</p><ul>
<li>æœåŠ¡çš„åç«¯åœ°å€ï¼šæœåŠ¡çš„åç«¯åœ°å€å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶æ¥é…ç½®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥å›ºåŒ–åœ¨SDKä¸­ï¼Œæ¨èåç«¯æœåŠ¡åœ°å€å¯é€šè¿‡é…ç½®æ–‡ä»¶é…ç½®ã€‚</li>
<li>è®¤è¯ä¿¡æ¯ï¼šæœ€å¸¸ç”¨çš„è®¤è¯æ–¹å¼æ˜¯é€šè¿‡å¯†é’¥è®¤è¯ï¼Œä¹Ÿæœ‰ä¸€äº›æ˜¯é€šè¿‡ç”¨æˆ·åå’Œå¯†ç è®¤è¯ã€‚</li>
<li>å…¶ä»–é…ç½®ï¼šä¾‹å¦‚è¶…æ—¶æ—¶é—´ã€é‡è¯•æ¬¡æ•°ã€ç¼“å­˜æ—¶é—´ç­‰ã€‚</li>
</ul><p>åˆ›å»ºçš„Clientæ˜¯ä¸€ä¸ªç»“æ„ä½“æˆ–è€…Go interfaceã€‚è¿™é‡Œæˆ‘å»ºè®®ä½ ä½¿ç”¨interfaceç±»å‹ï¼Œè¿™æ ·å¯ä»¥å°†å®šä¹‰å’Œå…·ä½“å®ç°è§£è€¦ã€‚Clientå…·æœ‰ä¸€äº›æ–¹æ³•ï¼Œä¾‹å¦‚ CreateUserã€DeleteUserç­‰ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªAPIæ¥å£ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªClientå®šä¹‰ï¼š</p><pre><code class="language-go">type Client struct {
    client *sdk.Request
}

func (c *Client) CreateUser(req *CreateUserRequest) (*CreateUserResponse, error) {
    // normal code
    resp := &amp;CreateUserResponse{}
    err := c.client.Send(req, resp)
    return resp, err
}
</code></pre><p>è°ƒç”¨ <code>client.CreateUser(req)</code> ä¼šæ‰§è¡ŒHTTPè¯·æ±‚ï¼Œåœ¨ <code>req</code> ä¸­å¯ä»¥æŒ‡å®šHTTPè¯·æ±‚çš„æ–¹æ³•Methodã€è·¯å¾„Pathå’Œè¯·æ±‚Bodyã€‚ <code>CreateUser</code> å‡½æ•°ä¸­ï¼Œä¼šè°ƒç”¨ <code>c.client.Send(req)</code> æ‰§è¡Œå…·ä½“çš„HTTPè¯·æ±‚ã€‚</p><p><code>c.client</code> æ˜¯ <code>*Request</code> ç±»å‹çš„å˜é‡ï¼Œ  <code>*Request</code> ç±»å‹çš„å˜é‡å…·æœ‰ä¸€äº›æ–¹æ³•ï¼Œå¯ä»¥æ ¹æ®ä¼ å…¥çš„è¯·æ±‚å‚æ•° <code>req</code> å’Œ <code>config</code> é…ç½®æ„é€ å‡ºè¯·æ±‚è·¯å¾„ã€è®¤è¯å¤´å’Œè¯·æ±‚Bodyï¼Œå¹¶è°ƒç”¨ <code>net/http</code> åŒ…å®Œæˆæœ€ç»ˆçš„HTTPè¯·æ±‚ï¼Œæœ€åå°†è¿”å›ç»“æœUnmarshalåˆ°ä¼ å…¥çš„ <code>resp</code> ç»“æ„ä½“ä¸­ã€‚</p><p>æ ¹æ®æˆ‘çš„è°ƒç ”ï¼Œç›®å‰æœ‰ä¸¤ç§SDKè®¾è®¡æ–¹å¼å¯ä¾›å‚è€ƒï¼Œä¸€ç§æ˜¯å„å¤§å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼ï¼Œä¸€ç§æ˜¯Kubernetes client-goçš„è®¾è®¡æ–¹å¼ã€‚IAMé¡¹ç›®åˆ†åˆ«å®ç°äº†è¿™ä¸¤ç§SDKè®¾è®¡æ–¹å¼ï¼Œä½†æˆ‘è¿˜æ˜¯æ›´å€¾å‘äºå¯¹å¤–æä¾›client-goæ–¹å¼çš„SDKï¼Œæˆ‘ä¼šåœ¨ä¸‹ä¸€è®²è¯¦ç»†ä»‹ç»å®ƒã€‚è¿™ä¸¤ç§è®¾è®¡æ–¹å¼çš„è®¾è®¡æ€è·¯è·Ÿä¸Šé¢ä»‹ç»çš„æ˜¯ä¸€è‡´çš„ã€‚</p><h2>å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼</h2><p>è¿™é‡Œï¼Œæˆ‘å…ˆæ¥ç®€å•ä»‹ç»ä¸‹å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ¨¡å¼ã€‚SDKæ¶æ„å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/82/ce/82ebe90b0490b9a2a76e2f302dd896ce.jpg?wh=1920x866" alt="å›¾ç‰‡"></p><p>SDKæ¡†æ¶åˆ†ä¸ºä¸¤å±‚ï¼Œåˆ†åˆ«æ˜¯APIå±‚å’ŒåŸºç¡€å±‚ã€‚APIå±‚ä¸»è¦ç”¨æ¥æ„å»ºå®¢æˆ·ç«¯å®ä¾‹ï¼Œå¹¶è°ƒç”¨å®¢æˆ·ç«¯å®ä¾‹æä¾›çš„æ–¹æ³•æ¥å®ŒæˆAPIè¯·æ±‚ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•å¯¹åº”ä¸€ä¸ªAPIæ¥å£ã€‚APIå±‚æœ€ç»ˆä¼šè°ƒç”¨åŸºç¡€å±‚æä¾›çš„èƒ½åŠ›ï¼Œæ¥å®ŒæˆREST APIè¯·æ±‚ã€‚åŸºç¡€å±‚é€šè¿‡ä¾æ¬¡æ‰§è¡Œæ„å»ºè¯·æ±‚å‚æ•°ï¼ˆBuilderï¼‰ã€ç­¾å‘å¹¶æ·»åŠ è®¤è¯å¤´ï¼ˆSignerï¼‰ã€æ‰§è¡ŒHTTPè¯·æ±‚ï¼ˆRequestï¼‰ä¸‰å¤§æ­¥éª¤ï¼Œæ¥å®Œæˆå…·ä½“çš„REST APIè¯·æ±‚ã€‚</p><p>ä¸ºäº†è®©ä½ æ›´å¥½åœ°ç†è§£å…¬æœ‰äº‘SDKçš„è®¾è®¡æ–¹å¼ï¼Œæ¥ä¸‹æ¥æˆ‘ä¼šç»“åˆä¸€äº›çœŸå®çš„ä»£ç ï¼Œç»™ä½ è®²è§£APIå±‚å’ŒåŸºç¡€å±‚çš„å…·ä½“è®¾è®¡ï¼ŒSDKä»£ç è§<a href="https://github.com/marmotedu/medu-sdk-go">medu-sdk-go</a>ã€‚</p><h3>APIå±‚ï¼šåˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹</h3><p>å®¢æˆ·ç«¯åœ¨ä½¿ç”¨æœåŠ¡Açš„SDKæ—¶ï¼Œé¦–å…ˆéœ€è¦æ ¹æ®Configé…ç½®åˆ›å»ºä¸€ä¸ªæœåŠ¡Açš„å®¢æˆ·ç«¯Clientï¼ŒClientå®é™…ä¸Šæ˜¯ä¸€ä¸ªstructï¼Œå®šä¹‰å¦‚ä¸‹ï¼š</p><pre><code class="language-go">type Client struct {
    sdk.Client
}
</code></pre><p>åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œéœ€è¦ä¼ å…¥è®¤è¯ï¼ˆä¾‹å¦‚å¯†é’¥ã€ç”¨æˆ·å/å¯†ç ï¼‰ã€åç«¯æœåŠ¡åœ°å€ç­‰é…ç½®ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/services/iam/authz/client.go#L24-L29">NewClientWithSecret</a>æ–¹æ³•æ¥æ„å»ºä¸€ä¸ªå¸¦å¯†é’¥å¯¹çš„å®¢æˆ·ç«¯ï¼š</p><pre><code class="language-go">func NewClientWithSecret(secretID, secretKey string) (client *Client, err error) {
    client = &amp;Client{}
    config := sdk.NewConfig().WithEndpoint(defaultEndpoint)
    client.Init(serviceName).WithSecret(secretID, secretKey).WithConfig(config)
    return
}
</code></pre><p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸Šé¢åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œä¼ å…¥çš„å¯†é’¥å¯¹æœ€ç»ˆä¼šåœ¨åŸºç¡€å±‚ä¸­è¢«ä½¿ç”¨ï¼Œç”¨æ¥ç­¾å‘JWT Tokenã€‚</p><p>Clientæœ‰å¤šä¸ªæ–¹æ³•ï¼ˆSenderï¼‰ï¼Œä¾‹å¦‚ Authzç­‰ï¼Œæ¯ä¸ªæ–¹æ³•ä»£è¡¨ä¸€ä¸ªAPIæ¥å£ã€‚Senderæ–¹æ³•ä¼šæ¥æ”¶AuthzRequestç­‰ç»“æ„ä½“ç±»å‹çš„æŒ‡é’ˆä½œä¸ºè¾“å…¥å‚æ•°ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ <code>client.Authz(req)</code> æ¥æ‰§è¡ŒREST APIè°ƒç”¨ã€‚å¯ä»¥åœ¨ <code>client.Authz</code> æ–¹æ³•ä¸­æ·»åŠ ä¸€äº›ä¸šåŠ¡é€»è¾‘å¤„ç†ã€‚<code>client.Authz</code> ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">type AuthzRequest struct {
&nbsp; &nbsp; *request.BaseRequest
&nbsp; &nbsp; Resource *string `json:"resource"`
&nbsp; &nbsp; Action *string `json:"action"`
&nbsp; &nbsp; Subject *string `json:"subject"`
&nbsp; &nbsp; Context *ladon.Context
}

func (c *Client) Authz(req *AuthzRequest) (resp *AuthzResponse, err error) {
&nbsp; &nbsp; if req == nil {
&nbsp; &nbsp; &nbsp; &nbsp; req = NewAuthzRequest()
&nbsp; &nbsp; }

&nbsp; &nbsp; resp = NewAuthzResponse()
&nbsp; &nbsp; err = c.Send(req, resp)
&nbsp; &nbsp; return
}
</code></pre><p>è¯·æ±‚ç»“æ„ä½“ä¸­çš„å­—æ®µéƒ½æ˜¯æŒ‡é’ˆç±»å‹çš„ï¼Œä½¿ç”¨æŒ‡é’ˆçš„å¥½å¤„æ˜¯å¯ä»¥åˆ¤æ–­å…¥å‚æ˜¯å¦æœ‰è¢«æŒ‡å®šï¼Œå¦‚æœ<code>req.Subject == nil</code> å°±è¯´æ˜ä¼ å‚ä¸­æ²¡æœ‰Subjectå‚æ•°ï¼Œå¦‚æœ<code>req.Subject != nil</code>å°±è¯´æ˜å‚æ•°ä¸­æœ‰ä¼ Subjectå‚æ•°ã€‚æ ¹æ®æŸä¸ªå‚æ•°æ˜¯å¦è¢«ä¼ å…¥ï¼Œæ‰§è¡Œä¸åŒçš„ä¸šåŠ¡é€»è¾‘ï¼Œè¿™åœ¨Go APIæ¥å£å¼€å‘ä¸­éå¸¸å¸¸è§ã€‚</p><p>å¦å¤–ï¼Œå› ä¸ºClienté€šè¿‡åŒ¿åçš„æ–¹å¼ç»§æ‰¿äº†åŸºç¡€å±‚ä¸­çš„<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L18-L24">Client</a>ï¼š</p><pre><code class="language-go">type Client struct {
	sdk.Client
}
</code></pre><p>æ‰€ä»¥ï¼ŒAPIå±‚åˆ›å»ºçš„Clientæœ€ç»ˆå¯ä»¥ç›´æ¥è°ƒç”¨åŸºç¡€å±‚ä¸­çš„Clientæä¾›çš„<code>Send(req, resp)</code> æ–¹æ³•ï¼Œæ¥æ‰§è¡ŒRESTful APIè°ƒç”¨ï¼Œå¹¶å°†ç»“æœä¿å­˜åœ¨ <code>resp</code> ä¸­ã€‚</p><p>ä¸ºäº†æ–¹ä¾¿å’ŒAPIå±‚çš„Clientè¿›è¡ŒåŒºåˆ†ï¼Œæˆ‘ä¸‹é¢ç»Ÿä¸€å°†åŸºç¡€å±‚ä¸­çš„Clientç§°ä¸º<strong>sdk.Client</strong>ã€‚</p><p>æœ€åï¼Œä¸€ä¸ªå®Œæ•´çš„å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">package main

import (
	"fmt"

	"github.com/ory/ladon"

	"github.com/marmotedu/medu-sdk-go/sdk"
	iam "github.com/marmotedu/medu-sdk-go/services/iam/authz"
)

func main() {
	client, _ := iam.NewClientWithSecret("XhbY3aCrfjdYcP1OFJRu9xcno8JzSbUIvGE2", "bfJRvlFwsoW9L30DlG87BBW0arJamSeK")

	req := iam.NewAuthzRequest()
	req.Resource = sdk.String("resources:articles:ladon-introduction")
	req.Action = sdk.String("delete")
	req.Subject = sdk.String("users:peter")
	ctx := ladon.Context(map[string]interface{}{"remoteIPAddress": "192.168.0.5"})
	req.Context = &amp;ctx

	resp, err := client.Authz(req)
	if err != nil {
		fmt.Println("err1", err)
		return
	}
	fmt.Printf("get response body: `%s`\n", resp.String())
	fmt.Printf("allowed: %v\n", resp.Allowed)
}
</code></pre><h3>åŸºç¡€å±‚ï¼šæ„å»ºå¹¶æ‰§è¡ŒHTTPè¯·æ±‚</h3><p>ä¸Šé¢æˆ‘ä»¬åˆ›å»ºäº†å®¢æˆ·ç«¯å®ä¾‹ï¼Œå¹¶è°ƒç”¨äº†å®ƒçš„ <a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L61-L93">Send</a> æ–¹æ³•æ¥å®Œæˆæœ€ç»ˆçš„HTTPè¯·æ±‚ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹Sendæ–¹æ³•å…·ä½“æ˜¯å¦‚ä½•æ„å»ºHTTPè¯·æ±‚çš„ã€‚</p><p>sdk.Clienté€šè¿‡Sendæ–¹æ³•ï¼Œå®Œæˆæœ€ç»ˆçš„APIè°ƒç”¨ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">func (c *Client) Send(req request.Request, resp response.Response) error {
	method := req.GetMethod()
	builder := GetParameterBuilder(method, c.Logger)
	jsonReq, _ := json.Marshal(req)
	encodedUrl, err := builder.BuildURL(req.GetURL(), jsonReq)
	if err != nil {
		return err
	}

	endPoint := c.Config.Endpoint
	if endPoint == "" {
		endPoint = fmt.Sprintf("%s/%s", defaultEndpoint, c.ServiceName)
	}
	reqUrl := fmt.Sprintf("%s://%s/%s%s", c.Config.Scheme, endPoint, req.GetVersion(), encodedUrl)

	body, err := builder.BuildBody(jsonReq)
	if err != nil {
		return err
	}

	sign := func(r *http.Request) error {
		signer := NewSigner(c.signMethod, c.Credential, c.Logger)
		_ = signer.Sign(c.ServiceName, r, strings.NewReader(body))
		return err
	}

	rawResponse, err := c.doSend(method, reqUrl, body, req.GetHeaders(), sign)
	if err != nil {
		return err
	}

	return response.ParseFromHttpResponse(rawResponse, resp)
}
</code></pre><p>ä¸Šé¢çš„ä»£ç å¤§ä½“ä¸Šå¯ä»¥åˆ†ä¸ºå››ä¸ªæ­¥éª¤ã€‚</p><p><strong>ç¬¬ä¸€æ­¥ï¼ŒBuilderï¼šæ„å»ºè¯·æ±‚å‚æ•°ã€‚</strong></p><p>æ ¹æ®ä¼ å…¥çš„AuthzRequestå’Œå®¢æˆ·ç«¯é…ç½®Configï¼Œæ„é€ HTTPè¯·æ±‚å‚æ•°ï¼ŒåŒ…æ‹¬è¯·æ±‚è·¯å¾„å’Œè¯·æ±‚Bodyã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹å¦‚ä½•æ„é€ HTTPè¯·æ±‚å‚æ•°ã€‚</p><ol>
<li>HTTPè¯·æ±‚è·¯å¾„æ„å»º</li>
</ol><p>åœ¨åˆ›å»ºå®¢æˆ·ç«¯æ—¶ï¼Œæˆ‘ä»¬é€šè¿‡<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/services/iam/authz/authz.go#L32-L42">NewAuthzRequest</a>å‡½æ•°åˆ›å»ºäº† <code>/v1/authz</code> REST APIæ¥å£è¯·æ±‚ç»“æ„ä½“AuthzRequestï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">func NewAuthzRequest() (req *AuthzRequest) {&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; req = &amp;AuthzRequest{&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; BaseRequest: &amp;request.BaseRequest{&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; URL:&nbsp; &nbsp; &nbsp;"/authz",&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Method:&nbsp; "POST",&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Header:&nbsp; nil,&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; Version: "v1",&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; &nbsp; &nbsp; },&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; }&nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; return&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬åˆ›å»ºçš„ <code>req</code> ä¸­åŒ…å«äº†APIç‰ˆæœ¬ï¼ˆVersionï¼‰ã€APIè·¯å¾„ï¼ˆURLï¼‰å’Œè¯·æ±‚æ–¹æ³•ï¼ˆMethodï¼‰ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥åœ¨Sendæ–¹æ³•ä¸­ï¼Œæ„å»ºå‡ºè¯·æ±‚è·¯å¾„ï¼š</p><pre><code class="language-go">endPoint := c.Config.Endpoint&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
if endPoint == "" {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
&nbsp; &nbsp; endPoint = fmt.Sprintf("%s/%s", defaultEndpoint, c.ServiceName)&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
}&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;
reqUrl := fmt.Sprintf("%s://%s/%s%s", c.Config.Scheme, endPoint, req.GetVersion(), encodedUrl)&nbsp;
</code></pre><p>ä¸Šè¿°ä»£ç ä¸­ï¼Œc.Config.Scheme=http/httpsã€endPoint=iam.api.marmotedu.com:8080ã€req.GetVersion()=v1å’ŒencodedUrlï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºå®ƒä»¬ç­‰äº/authzã€‚æ‰€ä»¥ï¼Œæœ€ç»ˆæ„å»ºå‡ºçš„è¯·æ±‚è·¯å¾„ä¸º<code>http://iam.api.marmotedu.com:8080/v1/authz</code> ã€‚</p><ol start="2">
<li>HTTPè¯·æ±‚Bodyæ„å»º</li>
</ol><p>åœ¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/parameter_builder.go#L68-L86">BuildBody</a>æ–¹æ³•ä¸­æ„å»ºè¯·æ±‚Bodyã€‚BuildBodyä¼šå°† <code>req</code> MarshalæˆJSONæ ¼å¼çš„stringã€‚HTTPè¯·æ±‚ä¼šä»¥è¯¥å­—ç¬¦ä¸²ä½œä¸ºBodyå‚æ•°ã€‚</p><p><strong>ç¬¬äºŒæ­¥ï¼ŒSignerï¼šç­¾å‘å¹¶æ·»åŠ è®¤è¯å¤´ã€‚</strong></p><p>è®¿é—®IAMçš„APIæ¥å£éœ€è¦è¿›è¡Œè®¤è¯ï¼Œæ‰€ä»¥åœ¨å‘é€HTTPè¯·æ±‚ä¹‹å‰ï¼Œè¿˜éœ€è¦ç»™HTTPè¯·æ±‚æ·»åŠ è®¤è¯Headerã€‚</p><p>medu-sdk-go ä»£ç æä¾›äº†JWTå’ŒHMACä¸¤ç§è®¤è¯æ–¹å¼ï¼Œæœ€ç»ˆé‡‡ç”¨äº†JWTè®¤è¯æ–¹å¼ã€‚JWTè®¤è¯ç­¾å‘æ–¹æ³•ä¸º<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/signer.go#L108-L113">Sign</a>ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">func (v1 SignatureV1) Sign(serviceName string, r *http.Request, body io.ReadSeeker) http.Header {
	tokenString := auth.Sign(v1.Credentials.SecretID, v1.Credentials.SecretKey, "medu-sdk-go", serviceName+".marmotedu.com")
	r.Header.Set("Authorization", fmt.Sprintf("Bearer %s", tokenString))
	return r.Header

}
</code></pre><p><code>auth.Sign</code> æ–¹æ³•æ ¹æ®SecretIDå’ŒSecretKeyç­¾å‘JWT Tokenã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥è°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L95-L112">doSend</a>æ–¹æ³•æ¥æ‰§è¡ŒHTTPè¯·æ±‚äº†ã€‚è°ƒç”¨ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">rawResponse, err := c.doSend(method, reqUrl, body, req.GetHeaders(), sign)
if err != nil {&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;
&nbsp; &nbsp; return err&nbsp; &nbsp; &nbsp;
}&nbsp;
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬ä¼ å…¥äº†HTTPè¯·æ±‚æ–¹æ³• <code>method</code> ã€HTTPè¯·æ±‚URL  <code>reqUrl</code> ã€HTTPè¯·æ±‚Body  <code>body</code>ï¼Œä»¥åŠç”¨æ¥ç­¾å‘JWT Tokençš„ <code>sign</code> æ–¹æ³•ã€‚æˆ‘ä»¬åœ¨è°ƒç”¨ <code>NewAuthzRequest</code> åˆ›å»º <code>req</code> æ—¶ï¼ŒæŒ‡å®šäº†HTTP Methodï¼Œæ‰€ä»¥è¿™é‡Œçš„ <code>method := req.GetMethod()</code> ã€reqUrlå’Œè¯·æ±‚Bodyéƒ½æ˜¯é€šè¿‡Builderæ¥æ„å»ºçš„ã€‚</p><p><strong>ç¬¬ä¸‰æ­¥ï¼ŒRequestï¼šæ‰§è¡ŒH<strong><strong>T</strong></strong>T<strong><strong>P</strong></strong>è¯·æ±‚ã€‚</strong></p><p>è°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/client.go#L95-L112">doSend</a>æ–¹æ³•æ‰§è¡ŒHTTPè¯·æ±‚ï¼ŒdoSendé€šè¿‡è°ƒç”¨ <code>net/http</code> åŒ…æä¾›çš„ <code>http.NewRequest</code> æ–¹æ³•æ¥å‘é€HTTPè¯·æ±‚ï¼Œæ‰§è¡Œå®ŒHTTPè¯·æ±‚åï¼Œä¼šè¿”å› <code>*http.Response</code> ç±»å‹çš„Responseã€‚ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">func (c *Client) doSend(method, url, data string, header map[string]string, sign SignFunc) (*http.Response, error) {
&nbsp; &nbsp; client := &amp;http.Client{Timeout: c.Config.Timeout}

&nbsp; &nbsp; req, err := http.NewRequest(method, url, strings.NewReader(data))
&nbsp; &nbsp; if err != nil {
&nbsp; &nbsp; &nbsp; &nbsp; c.Logger.Errorf("%s", err.Error())
&nbsp; &nbsp; &nbsp; &nbsp; return nil, err
&nbsp; &nbsp; }

&nbsp; &nbsp; c.setHeader(req, header)

&nbsp; &nbsp; err = sign(req)
&nbsp; &nbsp; if err != nil {
&nbsp; &nbsp; &nbsp; &nbsp; return nil, err
&nbsp; &nbsp; }

&nbsp; &nbsp; return client.Do(req)
}
</code></pre><p><strong>ç¬¬å››æ­¥ï¼Œå¤„ç†H<strong><strong>TT</strong></strong>P<strong><strong>è¯·æ±‚</strong></strong>è¿”å›ç»“æœã€‚</strong></p><p>è°ƒç”¨doSendæ–¹æ³•è¿”å› <code>*http.Response</code> ç±»å‹çš„Responseåï¼ŒSendæ–¹æ³•ä¼šè°ƒç”¨<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/response/response.go#L37-L52">ParseFromHttpResponse</a>å‡½æ•°æ¥å¤„ç†HTTP Responseï¼ŒParseFromHttpResponseå‡½æ•°ä»£ç å¦‚ä¸‹ï¼š</p><pre><code class="language-go">func ParseFromHttpResponse(rawResponse *http.Response, response Response) error {
	defer rawResponse.Body.Close()
	body, err := ioutil.ReadAll(rawResponse.Body)
	if err != nil {
		return err
	}
	if rawResponse.StatusCode != 200 {
		return fmt.Errorf("request fail with status: %s, with body: %s", rawResponse.Status, body)
	}

	if err := response.ParseErrorFromHTTPResponse(body); err != nil {
		return err
	}

	return json.Unmarshal(body, &amp;response)
}
</code></pre><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ParseFromHttpResponseå‡½æ•°ä¸­ï¼Œä¼šå…ˆåˆ¤æ–­HTTP Responseä¸­çš„StatusCodeæ˜¯å¦ä¸º200ï¼Œå¦‚æœä¸æ˜¯200ï¼Œåˆ™ä¼šæŠ¥é”™ã€‚å¦‚æœæ˜¯200ï¼Œä¼šè°ƒç”¨ä¼ å…¥çš„respå˜é‡æä¾›çš„<a href="https://github.com/marmotedu/medu-sdk-go/blob/v1.0.0/sdk/response/response.go#L26-L35">ParseErrorFromHTTPResponse</a>æ–¹æ³•ï¼Œæ¥å°†HTTP Responseçš„Body Unmarshalåˆ°respå˜é‡ä¸­ã€‚<br>
é€šè¿‡ä»¥ä¸Šå››æ­¥ï¼ŒSDKè°ƒç”¨æ–¹è°ƒç”¨äº†APIï¼Œå¹¶è·å¾—äº†APIçš„è¿”å›ç»“æœ <code>resp</code> ã€‚</p><p>ä¸‹é¢è¿™äº›å…¬æœ‰äº‘å‚å•†çš„SDKé‡‡ç”¨äº†æ­¤è®¾è®¡æ¨¡å¼ï¼š</p><ul>
<li>è…¾è®¯äº‘SDKï¼š<a href="https://github.com/TencentCloud/tencentcloud-sdk-go">tencentcloud-sdk-go</a>ã€‚</li>
<li>AWS SDKï¼š<a href="https://github.com/aws/aws-sdk-go">aws-sdk-go</a>ã€‚</li>
<li>é˜¿é‡Œäº‘SDKï¼š<a href="https://github.com/aliyun/alibaba-cloud-sdk-go">alibaba-cloud-sdk-go</a>ã€‚</li>
<li>äº¬ä¸œäº‘SDKï¼š<a href="https://github.com/jdcloud-api/jdcloud-sdk-go">jdcloud-sdk-go</a>ã€‚</li>
<li>Ucloud SDKï¼š<a href="https://github.com/ucloud/ucloud-sdk-go">ucloud-sdk-go</a>ã€‚</li>
</ul><p>IAMå…¬æœ‰äº‘æ–¹å¼çš„SDKå®ç°ä¸º <a href="https://github.com/marmotedu/medu-sdk-go">medu-sdk-go</a>ã€‚</p><p>æ­¤å¤–ï¼ŒIAMè¿˜è®¾è®¡å¹¶å®ç°äº†Kubernetes client-goæ–¹å¼çš„Go SDKï¼š<a href="https://github.com/marmotedu/marmotedu-sdk-go">marmotedu-sdk-go</a>ï¼Œmarmotedu-sdk-goä¹Ÿæ˜¯IAM Go SDKæ‰€é‡‡ç”¨çš„SDKã€‚ä¸‹ä¸€è®²ä¸­ï¼Œæˆ‘ä¼šå…·ä½“ä»‹ç»marmotedu-sdk-goçš„è®¾è®¡å’Œå®ç°ã€‚</p><h2>æ€»ç»“</h2><p>è¿™ä¸€è®²ï¼Œæˆ‘ä¸»è¦ä»‹ç»äº†å¦‚ä½•è®¾è®¡ä¸€ä¸ªä¼˜ç§€çš„Go SDKã€‚é€šè¿‡æä¾›SDKï¼Œå¯ä»¥æé«˜APIè°ƒç”¨æ•ˆç‡ï¼Œå‡å°‘APIè°ƒç”¨éš¾åº¦ï¼Œæ‰€ä»¥å¤§å‹åº”ç”¨é€šå¸¸éƒ½ä¼šæä¾›SDKã€‚ä¸åŒå›¢é˜Ÿæœ‰ä¸åŒçš„SDKè®¾è®¡æ–¹æ³•ï¼Œä½†ç›®å‰æ¯”è¾ƒå¥½çš„å®ç°æ˜¯å…¬æœ‰äº‘å‚å•†é‡‡ç”¨çš„SDKè®¾è®¡æ–¹å¼ã€‚</p><p>å…¬æœ‰äº‘å‚å•†çš„SDKè®¾è®¡æ–¹å¼ä¸­ï¼ŒSDKæŒ‰è°ƒç”¨é¡ºåºä»ä¸Šåˆ°ä¸‹å¯ä»¥åˆ†ä¸º3ä¸ªæ¨¡å—ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/b9/a9/b9bd3020ae56f6bb49bc3a38bcaf64a9.jpg?wh=1920x878" alt="å›¾ç‰‡"></p><p>Clientæ„é€ SDKå®¢æˆ·ç«¯ï¼Œåœ¨æ„é€ å®¢æˆ·ç«¯æ—¶ï¼Œä¼šåˆ›å»ºè¯·æ±‚å‚æ•° <code>req</code> ï¼Œ <code>req</code> ä¸­ä¼šæŒ‡å®šAPIç‰ˆæœ¬ã€HTTPè¯·æ±‚æ–¹æ³•ã€APIè¯·æ±‚è·¯å¾„ç­‰ä¿¡æ¯ã€‚</p><p>Clientä¼šè¯·æ±‚Builderå’ŒSigneræ¥æ„å»ºHTTPè¯·æ±‚çš„å„é¡¹å‚æ•°ï¼šHTTPè¯·æ±‚æ–¹æ³•ã€HTTPè¯·æ±‚è·¯å¾„ã€HTTPè®¤è¯å¤´ã€HTTPè¯·æ±‚Bodyã€‚Builderå’ŒSigneræ˜¯æ ¹æ® <code>req</code> é…ç½®æ¥æ„é€ è¿™äº›HTTPè¯·æ±‚å‚æ•°çš„ã€‚</p><p>æ„é€ å®Œæˆä¹‹åï¼Œä¼šè¯·æ±‚Requestæ¨¡å—ï¼ŒRequestæ¨¡å—é€šè¿‡è°ƒç”¨ <code>net/http</code> åŒ…ï¼Œæ¥æ‰§è¡ŒHTTPè¯·æ±‚ï¼Œå¹¶è¿”å›è¯·æ±‚ç»“æœã€‚</p><h2>è¯¾åç»ƒä¹ </h2><ol>
<li>æ€è€ƒä¸‹ï¼Œå¦‚ä½•å®ç°å¯ä»¥æ”¯æŒå¤šä¸ªAPIç‰ˆæœ¬çš„SDKåŒ…ï¼Œä»£ç å¦‚ä½•å®ç°ï¼Ÿ</li>
<li>è¿™ä¸€è®²ä»‹ç»äº†ä¸€ç§SDKå®ç°æ–¹å¼ï¼Œåœ¨ä½ çš„Goå¼€å‘ç”Ÿæ¶¯ä¸­ï¼Œè¿˜æœ‰æ²¡æœ‰ä¸€äº›æ›´å¥½çš„SDKå®ç°æ–¹æ³•ï¼Ÿæ¬¢è¿åœ¨ç•™è¨€åŒºåˆ†äº«ã€‚</li>
</ol><p>æœŸå¾…ä½ åœ¨ç•™è¨€åŒºä¸æˆ‘äº¤æµè®¨è®ºï¼Œæˆ‘ä»¬ä¸‹ä¸€è®²è§ã€‚</p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/25/06/13/e4f9f79b.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä½ èµ–ä¸œä¸œä¸é”™å˜›</span>
  </div>
  <div class="_2_QraFYR_0">Q1:æ„å»ºRequestæ—¶å°†APIç‰ˆæœ¬ä½œä¸ºå¯é€‰å‚æ•°ä¼ å…¥</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä¼˜ç§€ï¼</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-08-11 22:49:17</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/53/a8/abc96f70.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>return</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆè®²çš„å¤ªå¥½äº†ï¼Œ<br>è¯·æ•™è€å¸ˆä¸€ä¸ªé—®é¢˜ï¼š<br>sdkä¸­ æ—¥å¿—åº”è¯¥å¦‚ä½•è®¾è®¡æ¯”è¾ƒå¥½ï¼Œ<br>æˆ‘çœ‹ é˜¿é‡Œäº‘æ˜¯ é»˜è®¤äº†ä¸€ä¸ªå®ç°ï¼Œç”¨çš„æ ‡å‡†logã€‚<br>è¿™æ ·å¥½å—ï¼Œ å¦‚æœç”¨æˆ·ä½¿ç”¨çš„æ˜¯  zapï¼Œé‚£æ˜¯ä¸æ˜¯å¾—åˆ†æ–‡ä»¶ï¼Œç”¨åŒä¸€ä¸ªæ–‡ä»¶ä¼šä¸ä¼šå†²çªã€‚<br>æ„Ÿè§‰éƒ½ä¸ä¼˜é›…</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æˆ‘æ„Ÿè§‰æœ‰2ä¸ªæ€è·¯ï¼š<br>1. ç›´æ¥è¿”å›é”™è¯¯ï¼Œä¸æ‰“å°æ—¥å¿—ã€‚<br>2. å¦‚æœSDKä¸­éœ€è¦æ‰“å°æ—¥å¿—ï¼Œåœ¨åˆ›å»ºSDK Clientæ—¶ï¼Œæ·»åŠ ä¸€ä¸ªå¯é€‰çš„Loggeræ¥å£ï¼Œå°†ç¨‹åºä¸­çš„loggerä¼ è¿›å…¥ã€‚<br><br>å»ºè®®1ï¼Œæ„Ÿè§‰SDKæ²¡å¿…è¦æ‰“å°æ—¥å¿—ï¼Œå› ä¸ºSDKåŠŸèƒ½å…¶å®æ¯”è¾ƒç®€å•ï¼Œå°±æ˜¯ç»„åˆå‚æ•°ã€å‘é€HTTPè¯·æ±‚ã€è¿”å›æ•°æ®ã€‚ä¸ä¼šå°è£…å¤æ‚çš„é€»è¾‘ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-12-06 16:07:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/7a/d2/4ba67c0c.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Sch0ng</span>
  </div>
  <div class="_2_QraFYR_0">sdkä¸ºæœåŠ¡ä½¿ç”¨æ–¹æä¾›äº†æ–¹ä¾¿çš„åŒæ—¶ï¼Œä¹Ÿä¸ºæœåŠ¡æä¾›æ–¹çœå»å¾ˆå¤šä¸å¿…è¦çš„æ²Ÿé€šåŸ¹è®­æˆæœ¬ã€‚<br>æ–‡ä¸­ä»‹ç»äº†go sdkçš„ç›®å½•ç»“æ„ï¼Œæ¶æ„å’Œäº‘å‚å•†å¸¸ç”¨çš„è®¾è®¡å®ç°æ–¹æ¡ˆã€‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-08-17 23:36:26</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/3e/89/ccc2ebd9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é™ˆæ™“æ¶›</span>
  </div>
  <div class="_2_QraFYR_0">openapi-generatoræ˜¯ä¸ªéå¸¸ä¸é”™çš„é¡¹ç›®ï¼šhttps:&#47;&#47;github.com&#47;openapitools&#47;openapi-generatorï¼Œæ”¯æŒç”Ÿæˆå‡ åç§å®¢æˆ·ç«¯è¯­è¨€ï¼Œå®‰è£…ç®€å•ï¼Œä½¿ç”¨ç®€å•ï¼Œç”Ÿæˆçš„ä»£ç è´¨é‡é«˜ï¼Œè¿˜æœ‰ç‰¹åˆ«è¯¦ç»†çš„markdownä½¿ç”¨æ–‡æ¡£ï¼Œè¶…çº§æ¨è</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè°¢åˆ†äº«ï¼Œåé¢çœ‹ä¸‹èƒ½å¦åˆ‡æ¢åˆ°è¿™ç§æ–¹å¼</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-01-19 17:38:39</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/87/64/3882d90d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>yandongxiao</span>
  </div>
  <div class="_2_QraFYR_0">æ€»ç»“ï¼š<br>SDKçš„å‘½åè§„èŒƒã€ç›®å½•ç»“æ„ã€ä»¥åŠå„ä¸ªäº‘å‚å•†çš„é€»è¾‘æ¶æ„ã€‚<br>äº‘å‚å•†çš„SDKçš„å®ç°åˆ†ä¸ºä¸¤å±‚ï¼šAPIå±‚å’ŒåŸºç¡€å±‚ã€‚<br>API å±‚å®ç°ä¸€ä¸ªClientå¯¹è±¡ï¼Œæ¯ä¸ªæ–¹æ³•å¯¹åº”äº†ä¸€ä¸ªAPIæ¥å£<br>åŸºç¡€å±‚ï¼šä¸»è¦è´Ÿè´£ï¼Œè¯·æ±‚çš„Marshallã€Unmarshalã€ç­¾åç­‰åŠŸèƒ½ã€‚<br>API å±‚çš„ Client é€šè¿‡åŒ¿åçš„æ–¹å¼ç»§æ‰¿äº†åŸºç¡€å±‚çš„ Clientã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ€»ç»“çš„åˆ°ä½ï¼</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-12-04 13:40:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTKotsBr2icbYNYlRSlicGUD1H7lulSTQUAiclsEz9gnG5kCW9qeDwdYtlRMXic3V6sj9UrfKLPJnQojag/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ppd0705</span>
  </div>
  <div class="_2_QraFYR_0">äº‘å‚å•†pythonç‰ˆæœ¬sdkæ„Ÿè§‰ä»£ç è´¨é‡ucloudæœ€å¥½</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ„Ÿè°¢åˆ†äº«ï¼</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-10-31 18:43:35</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1d/9b/e5/bd0be5c3.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>â¶â‚†â¶â‚†â¶â‚†</span>
  </div>
  <div class="_2_QraFYR_0">ä½ è®²ä¹‰é‡Œé¢æä¾›çš„å®¢æˆ·ç«¯è°ƒç”¨ç¤ºä¾‹æ‰§è¡Œå¤±è´¥äº†ï¼Œä¹Ÿå°±æ˜¯ä½ https:&#47;&#47;github.com&#47;marmotedu&#47;medu-sdk-goé‡Œé¢æä¾›çš„é‚£ä¸ªç¤ºä¾‹ä»£ç ï¼Œé”™è¯¯æç¤ºå¦‚ä¸‹ï¼Œæç¤ºæ‰¾ä¸åˆ°å¯¹åº”çš„åŒ…ï¼Œä½†æ˜¯æ˜æ˜å·²ç»æ‹‰ä¸‹æ¥äº†å‘€ï¼Œæ²¡çœ‹å‡ºåŸå› ï¼Œå¸Œæœ›å¤§ä½¬èƒ½è§£ç­”ä¸‹ã€‚<br><br>[root@dev sdk]# go mod init sdk<br>go: creating new go.mod: module sdk<br>go: to add module requirements and sums:<br>        go mod tidy<br>[root@dev sdk]# go mod tidy<br>go: finding module for package github.com&#47;marmotedu&#47;medu-sdk-go&#47;services&#47;iam<br>go: finding module for package github.com&#47;marmotedu&#47;medu-sdk-go&#47;sdk<br>go: finding module for package github.com&#47;ory&#47;ladon<br>go: found github.com&#47;marmotedu&#47;medu-sdk-go&#47;sdk in github.com&#47;marmotedu&#47;medu-sdk-go v1.0.0<br>go: found github.com&#47;ory&#47;ladon in github.com&#47;ory&#47;ladon v1.2.0<br>go: finding module for package github.com&#47;marmotedu&#47;medu-sdk-go&#47;services&#47;iam<br>sdk imports<br>        github.com&#47;marmotedu&#47;medu-sdk-go&#47;services&#47;iam: module github.com&#47;marmotedu&#47;medu-sdk-go@latest found (v1.0.0), but does not contain package github.com&#47;marmotedu&#47;medu-sdk-go&#47;services&#47;iam<br>[root@dev sdk]#<br>[root@dev sdk]# ll &#47;root&#47;workspace&#47;golang&#47;pkg&#47;mod&#47;github.com&#47;marmotedu&#47;<br>total 8<br>dr-xr-xr-x  6 root root  185 Sep 16 01:16 api@v1.0.1<br>dr-xr-xr-x  3 root root  138 Sep 25 17:48 component-base@v0.0.2<br>dr-xr-xr-x  3 root root  138 Sep 22 22:43 component-base@v1.0.0<br>dr-xr-xr-x  3 root root  138 Sep 16 01:16 component-base@v1.0.1<br>dr-xr-xr-x  2 root root 4096 Sep 22 22:43 errors@v0.0.1<br>dr-xr-xr-x  2 root root 4096 Sep 16 01:16 errors@v1.0.2<br>dr-xr-xr-x 18 root root  257 Sep 15 22:57 gopractise-demo@v0.0.1<br>dr-xr-xr-x  5 root root  261 Sep 16 01:16 log@v0.0.1<br>dr-xr-xr-x  8 root root  233 Sep 16 01:18 marmotedu-sdk-go@v1.0.2-0.20210528170801-2c91b80cb4cf<br>dr-xr-xr-x  5 root root  112 Sep 25 17:48 medu-sdk-go@v1.0.0<br>[root@dev sdk]#<br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: go mod init sdk<br><br>ä¸Šé¢çš„å‘½ä»¤æ¢æˆï¼šgo mod init github.com&#47;marmotedu&#47;medu-sdk-go<br><br>å› ä¸ºä½ initçš„æŠ¥åæ˜¯sdkï¼Œæ‰€ä»¥æ‰¾ä¸åˆ°å½“å‰åŒ…ä¸‹çš„iamç›®å½•</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-09-25 18:17:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/iaxgvyIjNFomptQ9qBk4iaakYOS1XojYHDp48TXt1kX9DxTkKuR2UXGTyhG1liahib6E4BLF12ia6mic2pF0t4ECeZIQ/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Joeforfun</span>
  </div>
  <div class="_2_QraFYR_0">å¾ˆèµï¼Œå‡†å¤‡ç»™æ²¡æœ‰go-sdkçš„æŸäº‘å‚å•†å†™ä¸ªç®€å•çš„demo</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-08-31 15:32:57</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_d71d64</span>
  </div>
  <div class="_2_QraFYR_0">sdkçš„apiå’Œå‰ç«¯ç½‘é¡µçš„apiå¦‚ä½•åŒºåˆ†å¼€æ¥å‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: é€šè¿‡ UserAgent Header æ¥åŒºåˆ†</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-11-18 16:53:28</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/16/6b/af7c7745.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>tinyğŸŒ¾</span>
  </div>
  <div class="_2_QraFYR_0">å‰ç«¯æ¯”å¦‚å®‰å“çš„sdkä¹Ÿæ˜¯è¿™ä¸ªè®¾è®¡æ€è·¯å—</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æˆ‘ç†è§£æ€è·¯éƒ½æ˜¯ä¸€æ ·çš„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-10-26 22:54:44</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/2a/0a/e4/c576d62b.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é˜¿æ³¢ç½—å°¼æ–¯åœ†</span>
  </div>
  <div class="_2_QraFYR_0">doc.goæ˜¯å¹²å•¥çš„</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: doc.goä¸­ï¼Œæ˜¯åŒ…çº§åˆ«çš„æ³¨é‡Šï¼Œä¾‹å¦‚å¯ä»¥åœ¨é‡Œé¢å†™ä¸ŠåŒ…æ˜¯å¦‚ä½•ä½¿ç”¨çš„</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-10-17 11:26:38</div>
  </div>
</div>
</div>
</li>
</ul>