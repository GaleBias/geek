<audio title="50 _ æ¡ˆä¾‹ç¯‡ï¼šåŠ¨æ€è¿½è¸ªæ€ä¹ˆç”¨ï¼Ÿï¼ˆä¸Šï¼‰" src="https://static001.geekbang.org/resource/audio/c3/62/c331ddcb21e3bee79a4b0975e7984262.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘ä»¥ ksoftirqd CPU ä½¿ç”¨ç‡é«˜çš„é—®é¢˜ä¸ºä¾‹ï¼Œå¸¦ä½ ä¸€èµ·å­¦ä¹ äº†å†…æ ¸çº¿ç¨‹ CPU ä½¿ç”¨ç‡é«˜æ—¶çš„åˆ†ææ–¹æ³•ã€‚å…ˆç®€å•å›é¡¾ä¸€ä¸‹ã€‚</p><p>å½“ç¢°åˆ°å†…æ ¸çº¿ç¨‹çš„èµ„æºä½¿ç”¨å¼‚å¸¸æ—¶ï¼Œå¾ˆå¤šå¸¸ç”¨çš„è¿›ç¨‹çº§æ€§èƒ½å·¥å…·ï¼Œå¹¶ä¸èƒ½ç›´æ¥ç”¨åˆ°å†…æ ¸çº¿ç¨‹ä¸Šã€‚è¿™æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨å†…æ ¸è‡ªå¸¦çš„ perf æ¥è§‚å¯Ÿå®ƒä»¬çš„è¡Œä¸ºï¼Œæ‰¾å‡ºçƒ­ç‚¹å‡½æ•°ï¼Œè¿›ä¸€æ­¥å®šä½æ€§èƒ½ç“¶é¢ˆã€‚ä¸è¿‡ï¼Œperf äº§ç”Ÿçš„æ±‡æ€»æŠ¥å‘Šå¹¶ä¸ç›´è§‚ï¼Œæ‰€ä»¥æˆ‘é€šå¸¸ä¹Ÿæ¨èç”¨ç«ç„°å›¾æ¥ååŠ©æ’æŸ¥ã€‚</p><p>å…¶å®ï¼Œä½¿ç”¨ perf å¯¹ç³»ç»Ÿå†…æ ¸çº¿ç¨‹è¿›è¡Œåˆ†ææ—¶ï¼Œå†…æ ¸çº¿ç¨‹ä¾ç„¶è¿˜åœ¨æ­£å¸¸è¿è¡Œä¸­ï¼Œæ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿè¢«ç§°ä¸ºåŠ¨æ€è¿½è¸ªæŠ€æœ¯ã€‚</p><p><strong>åŠ¨æ€è¿½è¸ªæŠ€æœ¯ï¼Œé€šè¿‡æ¢é’ˆæœºåˆ¶ï¼Œæ¥é‡‡é›†å†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºçš„è¿è¡Œä¿¡æ¯ï¼Œä»è€Œå¯ä»¥ä¸ç”¨ä¿®æ”¹å†…æ ¸å’Œåº”ç”¨ç¨‹åºçš„ä»£ç ï¼Œå°±è·å¾—ä¸°å¯Œçš„ä¿¡æ¯ï¼Œå¸®ä½ åˆ†æã€å®šä½æƒ³è¦æ’æŸ¥çš„é—®é¢˜ã€‚</strong></p><p>ä»¥å¾€ï¼Œåœ¨æ’æŸ¥å’Œè°ƒè¯•æ€§èƒ½é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€éœ€è¦å…ˆä¸ºåº”ç”¨ç¨‹åºè®¾ç½®ä¸€ç³»åˆ—çš„æ–­ç‚¹ï¼ˆæ¯”å¦‚ä½¿ç”¨ GDBï¼‰ï¼Œç„¶åä»¥æ‰‹åŠ¨æˆ–è€…è„šæœ¬ï¼ˆæ¯”å¦‚ GDB çš„ Python æ‰©å±•ï¼‰çš„æ–¹å¼ï¼Œåœ¨è¿™äº›æ–­ç‚¹å¤„åˆ†æåº”ç”¨ç¨‹åºçš„çŠ¶æ€ã€‚æˆ–è€…ï¼Œå¢åŠ ä¸€ç³»åˆ—çš„æ—¥å¿—ï¼Œä»æ—¥å¿—ä¸­å¯»æ‰¾çº¿ç´¢ã€‚</p><p>ä¸è¿‡ï¼Œæ–­ç‚¹å¾€å¾€ä¼šä¸­æ–­åº”ç”¨çš„æ­£å¸¸è¿è¡Œï¼›è€Œå¢åŠ æ–°çš„æ—¥å¿—ï¼Œå¾€å¾€éœ€è¦é‡æ–°ç¼–è¯‘å’Œéƒ¨ç½²ã€‚è¿™äº›æ–¹æ³•è™½ç„¶åœ¨ä»Šå¤©ä¾ç„¶å¹¿æ³›ä½¿ç”¨ï¼Œä½†åœ¨æ’æŸ¥å¤æ‚çš„æ€§èƒ½é—®é¢˜æ—¶ï¼Œå¾€å¾€è€—æ—¶è€—åŠ›ï¼Œæ›´ä¼šå¯¹åº”ç”¨çš„æ­£å¸¸è¿è¡Œé€ æˆå·¨å¤§å½±å“ã€‚</p><!-- [[[read_end]]] --><p>æ­¤å¤–ï¼Œè¿™ç±»æ–¹å¼è¿˜æœ‰å¤§é‡çš„æ€§èƒ½é—®é¢˜ã€‚æ¯”å¦‚ï¼Œå‡ºç°çš„æ¦‚ç‡å°ï¼Œåªæœ‰çº¿ä¸Šç¯å¢ƒæ‰èƒ½ç¢°åˆ°ã€‚è¿™ç§éš¾ä»¥å¤ç°çš„é—®é¢˜ï¼Œäº¦æ˜¯ä¸€ä¸ªå·¨å¤§æŒ‘æˆ˜ã€‚</p><p>è€ŒåŠ¨æ€è¿½è¸ªæŠ€æœ¯çš„å‡ºç°ï¼Œå°±ä¸ºè¿™äº›é—®é¢˜æä¾›äº†å®Œç¾çš„æ–¹æ¡ˆï¼šå®ƒæ—¢ä¸éœ€è¦åœæ­¢æœåŠ¡ï¼Œä¹Ÿä¸éœ€è¦ä¿®æ”¹åº”ç”¨ç¨‹åºçš„ä»£ç ï¼›æ‰€æœ‰ä¸€åˆ‡è¿˜æŒ‰ç…§åŸæ¥çš„æ–¹å¼æ­£å¸¸è¿è¡Œæ—¶ï¼Œå°±å¯ä»¥å¸®ä½ åˆ†æå‡ºé—®é¢˜çš„æ ¹æºã€‚</p><p>åŒæ—¶ï¼Œç›¸æ¯”ä»¥å¾€çš„è¿›ç¨‹çº§è·Ÿè¸ªæ–¹æ³•ï¼ˆæ¯”å¦‚ ptraceï¼‰ï¼ŒåŠ¨æ€è¿½è¸ªå¾€å¾€åªä¼šå¸¦æ¥å¾ˆå°çš„æ€§èƒ½æŸè€—ï¼ˆé€šå¸¸åœ¨ 5% æˆ–è€…æ›´å°‘ï¼‰ã€‚</p><p>æ—¢ç„¶åŠ¨æ€è¿½è¸ªæœ‰è¿™ä¹ˆå¤šå¥½å¤„ï¼Œé‚£ä¹ˆï¼Œéƒ½æœ‰å“ªäº›åŠ¨æ€è¿½è¸ªçš„æ–¹æ³•ï¼Œåˆè¯¥å¦‚ä½•ä½¿ç”¨è¿™äº›åŠ¨æ€è¿½è¸ªæ–¹æ³•å‘¢ï¼Ÿä»Šå¤©ï¼Œæˆ‘å°±å¸¦ä½ ä¸€èµ·æ¥çœ‹çœ‹è¿™ä¸ªé—®é¢˜ã€‚ç”±äºåŠ¨æ€è¿½è¸ªæ¶‰åŠçš„çŸ¥è¯†æ¯”è¾ƒå¤šï¼Œæˆ‘å°†åˆ†ä¸ºä¸Šã€ä¸‹ä¸¤ç¯‡ä¸ºä½ è®²è§£ï¼Œå…ˆæ¥çœ‹ä»Šå¤©è¿™éƒ¨åˆ†å†…å®¹ã€‚</p><h2>åŠ¨æ€è¿½è¸ª</h2><p>è¯´åˆ°åŠ¨æ€è¿½è¸ªï¼ˆDynamic Tracingï¼‰ï¼Œå°±ä¸å¾—ä¸ææºäº Solaris ç³»ç»Ÿçš„ DTraceã€‚DTrace æ˜¯åŠ¨æ€è¿½è¸ªæŠ€æœ¯çš„é¼»ç¥–ï¼Œå®ƒæä¾›äº†ä¸€ä¸ªé€šç”¨çš„è§‚æµ‹æ¡†æ¶ï¼Œå¹¶å¯ä»¥ä½¿ç”¨ D è¯­è¨€è¿›è¡Œè‡ªç”±æ‰©å±•ã€‚</p><p>DTrace çš„å·¥ä½œåŸç†å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚<strong>å®ƒçš„è¿è¡Œå¸¸é©»åœ¨å†…æ ¸ä¸­ï¼Œç”¨æˆ·å¯ä»¥é€šè¿‡ dtrace å‘½ä»¤ï¼ŒæŠŠD è¯­è¨€ç¼–å†™çš„è¿½è¸ªè„šæœ¬ï¼Œæäº¤åˆ°å†…æ ¸ä¸­çš„è¿è¡Œæ—¶æ¥æ‰§è¡Œ</strong>ã€‚DTrace å¯ä»¥è·Ÿè¸ªç”¨æˆ·æ€å’Œå†…æ ¸æ€çš„æ‰€æœ‰äº‹ä»¶ï¼Œå¹¶é€šè¿‡ä¸€äº›åˆ—çš„ä¼˜åŒ–æªæ–½ï¼Œä¿è¯æœ€å°çš„æ€§èƒ½å¼€é”€ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/61/a6/6144b1947373bd5668010502bd0e45a6.png?wh=1798*1020" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="https://www.bsdcan.org/2017/schedule/attachments/433_dtrace_internals.html#(24)">BSDCan</a>ï¼‰</p><p>è™½ç„¶ç›´åˆ°ä»Šå¤©ï¼ŒDTrace æœ¬èº«ä¾ç„¶æ— æ³•åœ¨ Linux ä¸­è¿è¡Œï¼Œä½†å®ƒåŒæ ·å¯¹ Linux åŠ¨æ€è¿½è¸ªäº§ç”Ÿäº†å·¨å¤§çš„å½±å“ã€‚å¾ˆå¤šå·¥ç¨‹å¸ˆéƒ½å°è¯•è¿‡æŠŠ DTrace ç§»æ¤åˆ° Linux ä¸­ï¼Œè¿™å…¶ä¸­ï¼Œæœ€è‘—åçš„å°±æ˜¯ RedHat ä¸»æ¨çš„ SystemTapã€‚</p><p>åŒ DTrace ä¸€æ ·ï¼ŒSystemTap ä¹Ÿå®šä¹‰äº†ä¸€ç§ç±»ä¼¼çš„è„šæœ¬è¯­è¨€ï¼Œæ–¹ä¾¿ç”¨æˆ·æ ¹æ®éœ€è¦è‡ªç”±æ‰©å±•ã€‚ä¸è¿‡ï¼Œä¸åŒäº DTraceï¼ŒSystemTap å¹¶æ²¡æœ‰å¸¸é©»å†…æ ¸çš„è¿è¡Œæ—¶ï¼Œå®ƒéœ€è¦å…ˆæŠŠè„šæœ¬ç¼–è¯‘ä¸ºå†…æ ¸æ¨¡å—ï¼Œç„¶åå†æ’å…¥åˆ°å†…æ ¸ä¸­æ‰§è¡Œã€‚è¿™ä¹Ÿå¯¼è‡´ SystemTap å¯åŠ¨æ¯”è¾ƒç¼“æ…¢ï¼Œå¹¶ä¸”ä¾èµ–äºå®Œæ•´çš„è°ƒè¯•ç¬¦å·è¡¨ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/e0/db/e09aa4a00aee93f27f0d666a2bb1c4db.png?wh=888*422" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª<a href="https://openresty.org/posts/dynamic-tracing/">åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ¼«è°ˆ</a>ï¼‰</p><p>æ€»çš„æ¥è¯´ï¼Œä¸ºäº†è¿½è¸ªå†…æ ¸æˆ–ç”¨æˆ·ç©ºé—´çš„äº‹ä»¶ï¼ŒDtrace å’Œ SystemTap éƒ½ä¼šæŠŠç”¨æˆ·ä¼ å…¥çš„è¿½è¸ªå¤„ç†å‡½æ•°ï¼ˆä¸€èˆ¬ç§°ä¸º Actionï¼‰ï¼Œå…³è”åˆ°è¢«ç§°ä¸ºæ¢é’ˆçš„æ£€æµ‹ç‚¹ä¸Šã€‚è¿™äº›æ¢é’ˆï¼Œå®é™…ä¸Šä¹Ÿå°±æ˜¯å„ç§åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ‰€ä¾èµ–çš„äº‹ä»¶æºã€‚</p><h3>åŠ¨æ€è¿½è¸ªçš„äº‹ä»¶æº</h3><p>æ ¹æ®äº‹ä»¶ç±»å‹çš„ä¸åŒï¼Œ<strong>åŠ¨æ€è¿½è¸ªæ‰€ä½¿ç”¨çš„äº‹ä»¶æºï¼Œå¯ä»¥åˆ†ä¸ºé™æ€æ¢é’ˆã€åŠ¨æ€æ¢é’ˆä»¥åŠç¡¬ä»¶äº‹ä»¶ç­‰ä¸‰ç±»</strong>ã€‚å®ƒä»¬çš„å…³ç³»å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/ba/61/ba6c9ed0dcccc7f4f46bb19c69946e61.png?wh=1500*1050" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="http://www.brendangregg.com/perf.html#Events">Brendan Gregg Blog</a>ï¼‰</p><p>å…¶ä¸­ï¼Œ<strong>ç¡¬ä»¶äº‹ä»¶é€šå¸¸ç”±æ€§èƒ½ç›‘æ§è®¡æ•°å™¨ PMCï¼ˆPerformance Monitoring Counterï¼‰äº§ç”Ÿ</strong>ï¼ŒåŒ…æ‹¬äº†å„ç§ç¡¬ä»¶çš„æ€§èƒ½æƒ…å†µï¼Œæ¯”å¦‚ CPU çš„ç¼“å­˜ã€æŒ‡ä»¤å‘¨æœŸã€åˆ†æ”¯é¢„æµ‹ç­‰ç­‰ã€‚</p><p><strong>é™æ€æ¢é’ˆï¼Œæ˜¯æŒ‡äº‹å…ˆåœ¨ä»£ç ä¸­å®šä¹‰å¥½ï¼Œå¹¶ç¼–è¯‘åˆ°åº”ç”¨ç¨‹åºæˆ–è€…å†…æ ¸ä¸­çš„æ¢é’ˆ</strong>ã€‚è¿™äº›æ¢é’ˆåªæœ‰åœ¨å¼€å¯æ¢æµ‹åŠŸèƒ½æ—¶ï¼Œæ‰ä¼šè¢«æ‰§è¡Œåˆ°ï¼›æœªå¼€å¯æ—¶å¹¶ä¸ä¼šæ‰§è¡Œã€‚å¸¸è§çš„é™æ€æ¢é’ˆåŒ…æ‹¬å†…æ ¸ä¸­çš„è·Ÿè¸ªç‚¹ï¼ˆtracepointsï¼‰å’Œ USDTï¼ˆUserland Statically Defined Tracingï¼‰æ¢é’ˆã€‚</p><ul>
<li>
<p>è·Ÿè¸ªç‚¹ï¼ˆtracepointsï¼‰ï¼Œå®é™…ä¸Šå°±æ˜¯åœ¨æºç ä¸­æ’å…¥çš„ä¸€äº›å¸¦æœ‰æ§åˆ¶æ¡ä»¶çš„æ¢æµ‹ç‚¹ï¼Œè¿™äº›æ¢æµ‹ç‚¹å…è®¸äº‹åå†æ·»åŠ å¤„ç†å‡½æ•°ã€‚æ¯”å¦‚åœ¨å†…æ ¸ä¸­ï¼Œæœ€å¸¸è§çš„é™æ€è·Ÿè¸ªæ–¹æ³•å°±æ˜¯ printkï¼Œå³è¾“å‡ºæ—¥å¿—ã€‚Linux å†…æ ¸å®šä¹‰äº†å¤§é‡çš„è·Ÿè¸ªç‚¹ï¼Œå¯ä»¥é€šè¿‡å†…æ ¸ç¼–è¯‘é€‰é¡¹ï¼Œæ¥å¼€å¯æˆ–è€…å…³é—­ã€‚</p>
</li>
<li>
<p>USDT æ¢é’ˆï¼Œå…¨ç§°æ˜¯ç”¨æˆ·çº§é™æ€å®šä¹‰è·Ÿè¸ªï¼Œéœ€è¦åœ¨æºç ä¸­æ’å…¥ DTRACE_PROBE() ä»£ç ï¼Œå¹¶ç¼–è¯‘åˆ°åº”ç”¨ç¨‹åºä¸­ã€‚ä¸è¿‡ï¼Œä¹Ÿæœ‰å¾ˆå¤šåº”ç”¨ç¨‹åºå†…ç½®äº† USDT æ¢é’ˆï¼Œæ¯”å¦‚ MySQLã€PostgreSQL ç­‰ã€‚</p>
</li>
</ul><p><strong>åŠ¨æ€æ¢é’ˆï¼Œåˆ™æ˜¯æŒ‡æ²¡æœ‰äº‹å…ˆåœ¨ä»£ç ä¸­å®šä¹‰ï¼Œä½†å´å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€æ·»åŠ çš„æ¢é’ˆ</strong>ï¼Œæ¯”å¦‚å‡½æ•°çš„è°ƒç”¨å’Œè¿”å›ç­‰ã€‚åŠ¨æ€æ¢é’ˆæ”¯æŒæŒ‰éœ€åœ¨å†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºä¸­æ·»åŠ æ¢æµ‹ç‚¹ï¼Œå…·æœ‰æ›´é«˜çš„çµæ´»æ€§ã€‚å¸¸è§çš„åŠ¨æ€æ¢é’ˆæœ‰ä¸¤ç§ï¼Œå³ç”¨äºå†…æ ¸æ€çš„ kprobes å’Œç”¨äºç”¨æˆ·æ€çš„ uprobesã€‚</p><ul>
<li>
<p>kprobes ç”¨æ¥è·Ÿè¸ªå†…æ ¸æ€çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ç”¨äºå‡½æ•°è°ƒç”¨çš„ kprobe å’Œç”¨äºå‡½æ•°è¿”å›çš„ kretprobeã€‚</p>
</li>
<li>
<p>uprobes ç”¨æ¥è·Ÿè¸ªç”¨æˆ·æ€çš„å‡½æ•°ï¼ŒåŒ…æ‹¬ç”¨äºå‡½æ•°è°ƒç”¨çš„ uprobe å’Œç”¨äºå‡½æ•°è¿”å›çš„ uretprobeã€‚</p>
</li>
</ul><blockquote>
<p>æ³¨æ„ï¼Œkprobes éœ€è¦å†…æ ¸ç¼–è¯‘æ—¶å¼€å¯ CONFIG_KPROBE_EVENTSï¼›è€Œ uprobes åˆ™éœ€è¦å†…æ ¸ç¼–è¯‘æ—¶å¼€å¯ CONFIG_UPROBE_EVENTSã€‚</p>
</blockquote><h3>åŠ¨æ€è¿½è¸ªæœºåˆ¶</h3><p>è€Œåœ¨è¿™äº›æ¢é’ˆçš„åŸºç¡€ä¸Šï¼ŒLinux ä¹Ÿæä¾›äº†ä¸€ç³»åˆ—çš„åŠ¨æ€è¿½è¸ªæœºåˆ¶ï¼Œæ¯”å¦‚ ftraceã€perfã€eBPF ç­‰ã€‚</p><p><strong>ftrace</strong> æœ€æ—©ç”¨äºå‡½æ•°è·Ÿè¸ªï¼Œåæ¥åˆæ‰©å±•æ”¯æŒäº†å„ç§äº‹ä»¶è·Ÿè¸ªåŠŸèƒ½ã€‚ftrace çš„ä½¿ç”¨æ¥å£è·Ÿæˆ‘ä»¬ä¹‹å‰æåˆ°çš„ procfs ç±»ä¼¼ï¼Œå®ƒé€šè¿‡ debugfsï¼ˆ4.1 ä»¥åä¹Ÿæ”¯æŒ tracefsï¼‰ï¼Œä»¥æ™®é€šæ–‡ä»¶çš„å½¢å¼ï¼Œå‘ç”¨æˆ·ç©ºé—´æä¾›è®¿é—®æ¥å£ã€‚</p><p>è¿™æ ·ï¼Œä¸éœ€è¦é¢å¤–çš„å·¥å…·ï¼Œä½ å°±å¯ä»¥é€šè¿‡æŒ‚è½½ç‚¹ï¼ˆé€šå¸¸ä¸º /sys/kernel/debug/tracing ç›®å½•ï¼‰å†…çš„æ–‡ä»¶è¯»å†™ï¼Œæ¥è·Ÿ ftrace äº¤äº’ï¼Œè·Ÿè¸ªå†…æ ¸æˆ–è€…åº”ç”¨ç¨‹åºçš„è¿è¡Œäº‹ä»¶ã€‚</p><p><strong>perf</strong> æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹äº†ï¼Œæˆ‘ä»¬åœ¨å‰é¢çš„å¥½å¤šæ¡ˆä¾‹ä¸­ï¼Œéƒ½ä½¿ç”¨äº†å®ƒçš„äº‹ä»¶è®°å½•å’Œåˆ†æåŠŸèƒ½ï¼Œè¿™å®é™…ä¸Šåªæ˜¯ä¸€ç§æœ€ç®€å•çš„é™æ€è·Ÿè¸ªæœºåˆ¶ã€‚ä½ ä¹Ÿå¯ä»¥é€šè¿‡ perf ï¼Œæ¥è‡ªå®šä¹‰åŠ¨æ€äº‹ä»¶ï¼ˆperf probeï¼‰ï¼Œåªå…³æ³¨çœŸæ­£æ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚</p><p><strong>eBPF</strong> åˆ™åœ¨ BPFï¼ˆBerkeley Packet Filterï¼‰çš„åŸºç¡€ä¸Šæ‰©å±•è€Œæ¥ï¼Œä¸ä»…æ”¯æŒäº‹ä»¶è·Ÿè¸ªæœºåˆ¶ï¼Œè¿˜å¯ä»¥é€šè¿‡è‡ªå®šä¹‰çš„ BPF ä»£ç ï¼ˆä½¿ç”¨ C è¯­è¨€ï¼‰æ¥è‡ªç”±æ‰©å±•ã€‚æ‰€ä»¥ï¼ŒeBPF å®é™…ä¸Šå°±æ˜¯å¸¸é©»äºå†…æ ¸çš„è¿è¡Œæ—¶ï¼Œå¯ä»¥è¯´å°±æ˜¯ Linux ç‰ˆçš„ DTraceã€‚</p><p>é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰å¾ˆå¤šå†…æ ¸å¤–çš„å·¥å…·ï¼Œä¹Ÿæä¾›äº†ä¸°å¯Œçš„åŠ¨æ€è¿½è¸ªåŠŸèƒ½ã€‚æœ€å¸¸è§çš„å°±æ˜¯å‰é¢æåˆ°çš„ <strong>SystemTap</strong>ï¼Œæˆ‘ä»¬ä¹‹å‰å¤šæ¬¡ä½¿ç”¨è¿‡çš„ <strong>BCC</strong>ï¼ˆBPF Compiler Collectionï¼‰ï¼Œä»¥åŠå¸¸ç”¨äºå®¹å™¨æ€§èƒ½åˆ†æçš„ <strong>sysdig</strong> ç­‰ã€‚</p><p>è€Œåœ¨åˆ†æå¤§é‡äº‹ä»¶æ—¶ï¼Œä½¿ç”¨æˆ‘ä»¬ä¸ŠèŠ‚è¯¾æåˆ°çš„ç«ç„°å›¾ï¼Œå¯ä»¥å°†å¤§é‡æ•°æ®å¯è§†åŒ–å±•ç¤ºï¼Œè®©ä½ æ›´ç›´è§‚å‘ç°æ½œåœ¨çš„é—®é¢˜ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œæˆ‘å°±é€šè¿‡å‡ ä¸ªä¾‹å­ï¼Œå¸¦ä½ æ¥çœ‹çœ‹ï¼Œè¦æ€ä¹ˆä½¿ç”¨è¿™äº›æœºåˆ¶ï¼Œæ¥åŠ¨æ€è¿½è¸ªå†…æ ¸å’Œåº”ç”¨ç¨‹åºçš„æ‰§è¡Œæƒ…å†µã€‚ä»¥ä¸‹æ¡ˆä¾‹è¿˜æ˜¯åŸºäº Ubuntu 18.04 ç³»ç»Ÿï¼ŒåŒæ ·é€‚ç”¨äºå…¶ä»–ç³»ç»Ÿã€‚</p><blockquote>
<p>æ³¨æ„ï¼Œä»¥ä¸‹æ‰€æœ‰å‘½ä»¤éƒ½é»˜è®¤ä»¥ root ç”¨æˆ·è¿è¡Œï¼Œå¦‚æœä½ ç”¨æ™®é€šç”¨æˆ·èº«ä»½ç™»é™†ç³»ç»Ÿï¼Œè¯·è¿è¡Œ sudo su root å‘½ä»¤åˆ‡æ¢åˆ° root ç”¨æˆ·ã€‚</p>
</blockquote><h2>ftrace</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ ftraceã€‚åˆšåˆšæåˆ°è¿‡ï¼Œftrace é€šè¿‡ debugfsï¼ˆæˆ–è€… tracefsï¼‰ï¼Œä¸ºç”¨æˆ·ç©ºé—´æä¾›æ¥å£ã€‚æ‰€ä»¥ä½¿ç”¨ ftraceï¼Œå¾€å¾€æ˜¯ä»åˆ‡æ¢åˆ° debugfs çš„æŒ‚è½½ç‚¹å¼€å§‹ã€‚</p><pre><code>$ cd /sys/kernel/debug/tracing
$ ls
README                      instances            set_ftrace_notrace  trace_marker_raw
available_events            kprobe_events        set_ftrace_pid      trace_options
...
</code></pre><p>å¦‚æœè¿™ä¸ªç›®å½•ä¸å­˜åœ¨ï¼Œåˆ™è¯´æ˜ä½ çš„ç³»ç»Ÿè¿˜æ²¡æœ‰æŒ‚è½½ debugfsï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥æŒ‚è½½å®ƒï¼š</p><pre><code>$ mount -t debugfs nodev /sys/kernel/debug
</code></pre><p>ftrace æä¾›äº†å¤šä¸ªè·Ÿè¸ªå™¨ï¼Œç”¨äºè·Ÿè¸ªä¸åŒç±»å‹çš„ä¿¡æ¯ï¼Œæ¯”å¦‚å‡½æ•°è°ƒç”¨ã€ä¸­æ–­å…³é—­ã€è¿›ç¨‹è°ƒåº¦ç­‰ã€‚å…·ä½“æ”¯æŒçš„è·Ÿè¸ªå™¨å–å†³äºç³»ç»Ÿé…ç½®ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ¥æŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„è·Ÿè¸ªå™¨ï¼š</p><pre><code>$ cat available_tracers
hwlat blk mmiotrace function_graph wakeup_dl wakeup_rt wakeup function nop
</code></pre><p>è¿™å…¶ä¸­ï¼Œfunction è¡¨ç¤ºè·Ÿè¸ªå‡½æ•°çš„æ‰§è¡Œï¼Œfunction_graph åˆ™æ˜¯è·Ÿè¸ªå‡½æ•°çš„è°ƒç”¨å…³ç³»ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆç›´è§‚çš„è°ƒç”¨å…³ç³»å›¾ã€‚è¿™ä¾¿æ˜¯æœ€å¸¸ç”¨çš„ä¸¤ç§è·Ÿè¸ªå™¨ã€‚</p><p>é™¤äº†è·Ÿè¸ªå™¨å¤–ï¼Œä½¿ç”¨ ftrace å‰ï¼Œè¿˜éœ€è¦ç¡®è®¤è·Ÿè¸ªç›®æ ‡ï¼ŒåŒ…æ‹¬å†…æ ¸å‡½æ•°å’Œå†…æ ¸äº‹ä»¶ã€‚å…¶ä¸­ï¼Œ</p><ul>
<li>
<p>å‡½æ•°å°±æ˜¯å†…æ ¸ä¸­çš„å‡½æ•°åã€‚</p>
</li>
<li>
<p>è€Œäº‹ä»¶ï¼Œåˆ™æ˜¯å†…æ ¸æºç ä¸­é¢„å…ˆå®šä¹‰çš„è·Ÿè¸ªç‚¹ã€‚</p>
</li>
</ul><p>åŒæ ·åœ°ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ¥æŸ¥è¯¢æ”¯æŒçš„å‡½æ•°å’Œäº‹ä»¶ï¼š</p><pre><code>$ cat available_filter_functions
$ cat available_events
</code></pre><p>æ˜ç™½äº†è¿™äº›åŸºæœ¬ä¿¡æ¯ï¼Œæ¥ä¸‹æ¥ï¼Œæˆ‘å°±ä»¥ ls å‘½ä»¤ä¸ºä¾‹ï¼Œå¸¦ä½ ä¸€èµ·çœ‹çœ‹ ftrace çš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>ä¸ºäº†åˆ—å‡ºæ–‡ä»¶ï¼Œls å‘½ä»¤ä¼šé€šè¿‡ open ç³»ç»Ÿè°ƒç”¨æ‰“å¼€ç›®å½•æ–‡ä»¶ï¼Œè€Œ open åœ¨å†…æ ¸ä¸­å¯¹åº”çš„å‡½æ•°åä¸º do_sys_openã€‚ æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦åšçš„ç¬¬ä¸€æ­¥ï¼Œå°±æ˜¯æŠŠè¦è·Ÿè¸ªçš„å‡½æ•°è®¾ç½®ä¸º do_sys_openï¼š</p><pre><code>$ echo do_sys_open &gt; set_graph_function
</code></pre><p>æ¥ä¸‹æ¥ï¼Œç¬¬äºŒæ­¥ï¼Œé…ç½®è·Ÿè¸ªé€‰é¡¹ï¼Œå¼€å¯å‡½æ•°è°ƒç”¨è·Ÿè¸ªï¼Œå¹¶è·Ÿè¸ªè°ƒç”¨è¿›ç¨‹ï¼š</p><pre><code>$ echo function_graph &gt; current_tracer
$ echo funcgraph-proc &gt; trace_options
</code></pre><p>æ¥ç€ï¼Œç¬¬ä¸‰æ­¥ï¼Œä¹Ÿå°±æ˜¯å¼€å¯è·Ÿè¸ªï¼š</p><pre><code>$ echo 1 &gt; tracing_on
</code></pre><p>ç¬¬å››æ­¥ï¼Œæ‰§è¡Œä¸€ä¸ª ls å‘½ä»¤åï¼Œå†å…³é—­è·Ÿè¸ªï¼š</p><pre><code>$ ls
$ echo 0 &gt; tracing_on
</code></pre><p>ç¬¬äº”æ­¥ï¼Œä¹Ÿæ˜¯æœ€åä¸€æ­¥ï¼ŒæŸ¥çœ‹è·Ÿè¸ªç»“æœï¼š</p><pre><code>$ cat trace
# tracer: function_graph
#
# CPU  TASK/PID         DURATION                  FUNCTION CALLS
# |     |    |           |   |                     |   |   |   |
 0)    ls-12276    |               |  do_sys_open() {
 0)    ls-12276    |               |    getname() {
 0)    ls-12276    |               |      getname_flags() {
 0)    ls-12276    |               |        kmem_cache_alloc() {
 0)    ls-12276    |               |          _cond_resched() {
 0)    ls-12276    |   0.049 us    |            rcu_all_qs();
 0)    ls-12276    |   0.791 us    |          }
 0)    ls-12276    |   0.041 us    |          should_failslab();
 0)    ls-12276    |   0.040 us    |          prefetch_freepointer();
 0)    ls-12276    |   0.039 us    |          memcg_kmem_put_cache();
 0)    ls-12276    |   2.895 us    |        }
 0)    ls-12276    |               |        __check_object_size() {
 0)    ls-12276    |   0.067 us    |          __virt_addr_valid();
 0)    ls-12276    |   0.044 us    |          __check_heap_object();
 0)    ls-12276    |   0.039 us    |          check_stack_object();
 0)    ls-12276    |   1.570 us    |        }
 0)    ls-12276    |   5.790 us    |      }
 0)    ls-12276    |   6.325 us    |    }
...
</code></pre><p>åœ¨æœ€åå¾—åˆ°çš„è¾“å‡ºä¸­ï¼š</p><ul>
<li>
<p>ç¬¬ä¸€åˆ—è¡¨ç¤ºè¿è¡Œçš„ CPUï¼›</p>
</li>
<li>
<p>ç¬¬äºŒåˆ—æ˜¯ä»»åŠ¡åç§°å’Œè¿›ç¨‹ PIDï¼›</p>
</li>
<li>
<p>ç¬¬ä¸‰åˆ—æ˜¯å‡½æ•°æ‰§è¡Œå»¶è¿Ÿï¼›</p>
</li>
<li>
<p>æœ€åä¸€åˆ—ï¼Œåˆ™æ˜¯å‡½æ•°è°ƒç”¨å…³ç³»å›¾ã€‚</p>
</li>
</ul><p>ä½ å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°è°ƒç”¨å›¾ï¼Œé€šè¿‡ä¸åŒçº§åˆ«çš„ç¼©è¿›ï¼Œç›´è§‚å±•ç¤ºäº†å„å‡½æ•°é—´çš„è°ƒç”¨å…³ç³»ã€‚</p><p>å½“ç„¶ï¼Œæˆ‘æƒ³ä½ åº”è¯¥ä¹Ÿå‘ç°äº† ftrace çš„ä½¿ç”¨ç¼ºç‚¹â€”â€”äº”ä¸ªæ­¥éª¤å®åœ¨æ˜¯éº»çƒ¦ï¼Œç”¨èµ·æ¥å¹¶ä¸æ–¹ä¾¿ã€‚ä¸è¿‡ï¼Œä¸ç”¨æ‹…å¿ƒï¼Œ <a href="https://git.kernel.org/pub/scm/utils/trace-cmd/trace-cmd.git/">trace-cmd</a> å·²ç»å¸®ä½ æŠŠè¿™äº›æ­¥éª¤ç»™åŒ…è£…äº†èµ·æ¥ã€‚è¿™æ ·ï¼Œä½ å°±å¯ä»¥åœ¨åŒä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·é‡Œï¼Œå®Œæˆä¸Šè¿°æ‰€æœ‰è¿‡ç¨‹ã€‚</p><p>ä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œæ¥å®‰è£… trace-cmd ï¼š</p><pre><code># Ubuntu
$ apt-get install trace-cmd
# CentOS
$ yum install trace-cmd
</code></pre><p>å®‰è£…å¥½åï¼ŒåŸæœ¬çš„äº”æ­¥è·Ÿè¸ªè¿‡ç¨‹ï¼Œå°±å¯ä»¥ç®€åŒ–ä¸ºä¸‹é¢è¿™ä¸¤æ­¥ï¼š</p><pre><code>$ trace-cmd record -p function_graph -g do_sys_open -O funcgraph-proc ls
$ trace-cmd report
...
              ls-12418 [000] 85558.075341: funcgraph_entry:                   |  do_sys_open() {
              ls-12418 [000] 85558.075363: funcgraph_entry:                   |    getname() {
              ls-12418 [000] 85558.075364: funcgraph_entry:                   |      getname_flags() {
              ls-12418 [000] 85558.075364: funcgraph_entry:                   |        kmem_cache_alloc() {
              ls-12418 [000] 85558.075365: funcgraph_entry:                   |          _cond_resched() {
              ls-12418 [000] 85558.075365: funcgraph_entry:        0.074 us   |            rcu_all_qs();
              ls-12418 [000] 85558.075366: funcgraph_exit:         1.143 us   |          }
              ls-12418 [000] 85558.075366: funcgraph_entry:        0.064 us   |          should_failslab();
              ls-12418 [000] 85558.075367: funcgraph_entry:        0.075 us   |          prefetch_freepointer();
              ls-12418 [000] 85558.075368: funcgraph_entry:        0.085 us   |          memcg_kmem_put_cache();
              ls-12418 [000] 85558.075369: funcgraph_exit:         4.447 us   |        }
              ls-12418 [000] 85558.075369: funcgraph_entry:                   |        __check_object_size() {
              ls-12418 [000] 85558.075370: funcgraph_entry:        0.132 us   |          __virt_addr_valid();
              ls-12418 [000] 85558.075370: funcgraph_entry:        0.093 us   |          __check_heap_object();
              ls-12418 [000] 85558.075371: funcgraph_entry:        0.059 us   |          check_stack_object();
              ls-12418 [000] 85558.075372: funcgraph_exit:         2.323 us   |        }
              ls-12418 [000] 85558.075372: funcgraph_exit:         8.411 us   |      }
              ls-12418 [000] 85558.075373: funcgraph_exit:         9.195 us   |    }
...
</code></pre><p>ä½ ä¼šå‘ç°ï¼Œtrace-cmd çš„è¾“å‡ºï¼Œè·Ÿä¸Šè¿° cat trace çš„è¾“å‡ºæ˜¯ç±»ä¼¼çš„ã€‚</p><p>é€šè¿‡è¿™ä¸ªä¾‹å­æˆ‘ä»¬çŸ¥é“ï¼Œå½“ä½ æƒ³è¦äº†è§£æŸä¸ªå†…æ ¸å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹æ—¶ï¼Œä½¿ç”¨ ftrace ï¼Œå°±å¯ä»¥è·Ÿè¸ªåˆ°å®ƒçš„æ‰§è¡Œè¿‡ç¨‹ã€‚</p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘å¸¦ä½ ä¸€èµ·å­¦ä¹ äº†å¸¸è§çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•ã€‚æ‰€è°“åŠ¨æ€è¿½è¸ªï¼Œå°±æ˜¯åœ¨ç³»ç»Ÿæˆ–åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œæ—¶ï¼Œé€šè¿‡å†…æ ¸ä¸­æä¾›çš„æ¢é’ˆæ¥åŠ¨æ€è¿½è¸ªå®ƒä»¬çš„è¡Œä¸ºï¼Œä»è€Œè¾…åŠ©æ’æŸ¥å‡ºæ€§èƒ½ç“¶é¢ˆã€‚</p><p>è€Œåœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¸¸è§çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•åŒ…æ‹¬ ftraceã€perfã€eBPF ä»¥åŠ SystemTap ç­‰ã€‚å½“ä½ å·²ç»å®šä½äº†æŸä¸ªå†…æ ¸å‡½æ•°ï¼Œä½†ä¸æ¸…æ¥šå®ƒçš„å®ç°åŸç†æ—¶ï¼Œå°±å¯ä»¥ç”¨ ftrace æ¥è·Ÿè¸ªå®ƒçš„æ‰§è¡Œè¿‡ç¨‹ã€‚è‡³äºå…¶ä»–åŠ¨æ€è¿½è¸ªæ–¹æ³•ï¼Œæˆ‘å°†åœ¨ä¸‹èŠ‚è¯¾ç»§ç»­ä¸ºä½ è¯¦ç»†è§£è¯»ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œç»™ä½ ç•™ä¸€ä¸ªæ€è€ƒé¢˜ã€‚ä»Šå¤©çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨Linux å†…æ ¸æä¾›çš„ ftrace æœºåˆ¶ï¼Œæ¥äº†è§£å†…æ ¸å‡½æ•°çš„æ‰§è¡Œè¿‡ç¨‹ï¼›è€Œä¸ŠèŠ‚è¯¾æˆ‘ä»¬åˆ™ç”¨äº† perf å’Œç«ç„°å›¾ï¼Œæ¥è§‚å¯Ÿå†…æ ¸çš„è°ƒç”¨å †æ ˆã€‚</p><p>æ ¹æ®è¿™ä¸¤ä¸ªæ¡ˆä¾‹ï¼Œä½ è§‰å¾—è¿™ä¸¤ç§æ–¹æ³•æœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„åœ°æ–¹ï¼Ÿå½“éœ€è¦äº†è§£å†…æ ¸çš„è¡Œä¸ºæ—¶ï¼Œå¦‚ä½•åœ¨äºŒè€…ä¸­é€‰æ‹©ï¼Œæˆ–è€…è¯´ï¼Œè¿™ä¸¤ç§æ–¹æ³•åˆ†åˆ«é€‚ç”¨äºä»€ä¹ˆæ ·çš„åœºæ™¯å‘¢ï¼Ÿä½ å¯ä»¥ç»“åˆä»Šå¤©çš„å†…å®¹ï¼Œå’Œä½ è‡ªå·±çš„æ“ä½œè®°å½•ï¼Œæ¥æ€»ç»“æ€è·¯ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æˆ‘æ¥ä¹Ÿ</span>
  </div>
  <div class="_2_QraFYR_0">[D50æ‰“å¡]<br>è¯¾åæ€è€ƒé¢˜,æˆ‘çš„æ€è€ƒ,ä¸ä¸€å®šå‡†ç¡®.<br>æˆ‘è§‰å¾—æ˜¨å¤©çš„perfå’Œç«ç„°å›¾,æ˜¯é‡‡æ ·. è€Œä»Šå¤©çš„ftraceæ˜¯å®å®åœ¨åœ¨çš„åˆ†ææ¯æ¬¡ä¸€çš„è°ƒç”¨.<br>è™½ç„¶éƒ½å¯ä»¥çœ‹è°ƒç”¨å †æ ˆå’Œè€—æ—¶æ¯”ä¾‹. ä½†æ˜¯ftraceåº”è¯¥æ˜¯éå¸¸å‡†ç¡®,è€Œperfåªæ˜¯ä¸€ä¸ªé‡‡æ ·,æ¯”å¦‚é‡‡æ ·é¢‘ç‡1%.<br><br>æˆ‘è§‰å¾—æ‰¾å¤§æ–¹å‘æ—¶,ä½¿ç”¨perfå’Œç«ç„°å›¾, æ‰¾å…·ä½“é—®é¢˜æ—¶,ç”¨ftrace.æ¯•ç«Ÿftraceéœ€è¦çŸ¥é“è°ƒç”¨çš„ç³»ç»Ÿå‡½æ•°.<br>ftraceéœ€è¦è¿½è¸ªçš„ä¿¡æ¯å¯ä»¥æ¥æºäºperfçš„åˆ†æç»“æœ.</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å—¯å—¯ï¼Œéå¸¸å‡†ç¡®ã€‚å‡½æ•°è·Ÿè¸ªéœ€è¦å®ç°çŸ¥é“å‡½æ•°åï¼Œè€Œperf&#47;ç«ç„°å›¾å°±å¯ä»¥æ‰¾å‡ºçƒ­ç‚¹å‡½æ•°ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 11:27:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/15/2c/51/fdf460ba.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>lizh</span>
  </div>
  <div class="_2_QraFYR_0">æ—©äº›æ—¶é—´æ•´ç†è¿‡çš„ä¸€ç¯‡æ–‡ç« ï¼Œå’Œè¿™ä¸ªä¸»é¢˜å¾ˆmatchï¼Œåˆ†äº«åœ¨è¿™é‡Œ^_^ã€‚https:&#47;&#47;leezhenghui.github.io&#47;linux&#47;2019&#47;03&#47;05&#47;exploring-usdt-on-linux.html</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘è°¢è°¢åˆ†äº«</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 11:58:26</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/bd/ac/c9154dfe.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Huayra</span>
  </div>
  <div class="_2_QraFYR_0">å°†æ€§èƒ½ä¼˜åŒ–å¤§å¸ˆBrendan Greggçš„blogé˜…è¯»ä¸€éï¼Œå°±èƒ½å¤Ÿæ›´æ·±åˆ»åœ°ç†è§£è¿™ä¸€ç« ã€‚æ®è¯´ï¼ŒOpenRestyçš„ä½œè€…å¼ äº¦æ˜¥ä¹Ÿé˜…è¯»è¿‡Brendan Greggçš„æ‰€æœ‰åšå®¢ï¼Œä»–ç°åœ¨æ›´è¿›ä¸€æ­¥åœ°å¼€å‘äº†ä¸€ä¸ªå°†é«˜çº§ç¼–ç¨‹è¯­è¨€ç¼–è¯‘æˆåŠ¨æ€è¿½è¸ªè„šæœ¬çš„å·¥å…·</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 18:46:12</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/42/76/256bbd43.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ¾èŠ±çš®è›‹me</span>
  </div>
  <div class="_2_QraFYR_0">è¿™ç¯‡å®Œå…¨å¬ä¸æ‡‚</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 00:40:46</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/5b/ae/3d639ea4.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä½³</span>
  </div>
  <div class="_2_QraFYR_0">åœ¨å’ŒåŒäº‹è®¨è®ºnodejsä½¿ç”¨ä»thriftè½¬åŒ–åˆ°grpcæ—¶å€™ä¼šæ€§èƒ½ä¸‹é™é—®é¢˜å°±ç”¨è€å¸ˆä»‹ç»<br><br>strace -T -ttt -p pid<br><br>æ‰¾åˆ°æ ¹æºã€‚<br><br>grpc -nodeç‰ˆæœ¬å‘é€åˆ†ä¸¤æ¬¡writevç³»ç»Ÿè°ƒç”¨ï¼Œç¬¬ä¸€æ¬¡å‘é€ grpcè·¯å¾„ï¼Œç¬¬äºŒæ¬¡å‘é€å‚æ•°ã€‚æ¯”thriftåè®®ä¸€æ¬¡æ•ˆç‡ä¸€äº›ã€‚<br><br>å†å‘ç°nodeå¹¶å‘æ¬¡æ•°å¤šï¼Œå›è°ƒç®—æ—¶é—´å¾€å¾€æ˜¯å¤šä¸ªè°ƒç”¨æ‰€èŠ±çš„æ—¶é—´ã€‚è¿™äº›æ•ˆç‡éƒ½ç”¨straceçœ‹åˆ°ï¼Œåœ¨å‰é¢æ—¶é—´</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘è°¢è°¢åˆ†äº«</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-23 09:11:12</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/9b/ba/333b59e5.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Linuxer</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œç¢°åˆ°ä¸€ä¸ªé—®é¢˜æ€ä¹ˆé€‰æ‹©tracepointå’Œtracefunctionå‘¢ï¼Ÿç„¶åæ€ä¹ˆç»“åˆè¾“å‡ºåˆ†æé—®é¢˜å‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å…ˆè¦ç”¨å…¶ä»–å·¥å…·å®šä½å‡ºå¤§æ¦‚çš„ä½ç½®ï¼Œæ¯”å¦‚ç”¨perfæˆ–è€…bccç­‰ç­‰ã€‚æœ‰äº†å‡½æ•°ä¹‹åï¼Œå†å›æ¥è·Ÿè¸ªå‡½æ•°çš„å†…éƒ¨ã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 08:58:57</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/05/7f/d35ab9a1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>z.l</span>
  </div>
  <div class="_2_QraFYR_0">è¯·æ•™ä¸‹javaé‡Œå¸¸ç”¨çš„btraceå’Œä»Šå¤©è®²çš„å‡ ä¸ªå·¥å…·æ˜¯ä»€ä¹ˆå…³ç³»å•Š</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ä»Šå¤©ä»‹ç»çš„å·¥å…·éƒ½æ˜¯ç³»ç»Ÿçº§å·¥å…·ï¼Œå¯ä»¥ç”¨åœ¨ä»»ä½•åº”ç”¨ï¼›è€Œbtraceæ˜¯åº”ç”¨çº§çš„ï¼Œåªèƒ½ç”¨åœ¨Javaåº”ç”¨ä¸Šã€‚</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-21 22:51:25</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/8c/2b/3ab96998.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é’çŸ³</span>
  </div>
  <div class="_2_QraFYR_0">#echo function_graph &gt; current_trace<br>-bash: current_trace: Permission denied<br><br>æŠ¥ä¸Šé¢é”™è¯¯çš„åŒå­¦ï¼Œå¯ä»¥å°è¯•ä¸‹é¢çš„å‘½ä»¤ï¼Œç¯å¢ƒæ˜¯CentOS 7.6<br>$ echo function_graph &gt; current_tracer<br>$ echo funcgraph-proc &gt; trace_options</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è°¢è°¢åˆ†äº«</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-22 20:17:31</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/22/7e/cc/bab7c820.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æ˜“æ°´</span>
  </div>
  <div class="_2_QraFYR_0">æˆ‘çš„ç”¨çš„ç³»ç»Ÿå†…æ ¸è¾ƒæ–°,  echo do_sys_open &gt; set_graph_function çœ‹ä¸åˆ°ç»“æœ,æ¢æˆ<br>do_sys_openat2 å°±å¯ä»¥äº†,strace lsçœ‹äº†ä¸‹ æ–°kerneléƒ½ç”¨ openat æ‰“å¼€, è€kernelä½¿ç”¨openæ‰“å¼€</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-12-13 22:13:35</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/04/ae/0118c132.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è¾‰æ™–</span>
  </div>
  <div class="_2_QraFYR_0">æ‰§è¡Œè¿™å¥æœºå™¨å¡æ­»ï¼Œåªèƒ½å¼ºåˆ¶é‡å¯ï¼š<br>echo funcgraph-proc &gt; trace_options<br>æ‰§è¡Œè¿™å¥æŠ¥é”™ï¼š<br># trace-cmd record -p function_graph -g do_sys_open -O funcgraph-proc ls<br>  plugin &#39;function_graph&#39;<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>available_events	    events		      options		   set_ftrace_notrace  trace_clock	    tracing_thresh<br>available_filter_functions  free_buffer		      per_cpu		   set_ftrace_pid      trace_marker	    uprobe_events<br>available_tracers	    function_profile_enabled  printk_formats	   set_graph_function  trace_options	    uprobe_profile<br>buffer_size_kb		    hwlat_detector	      README		   snapshot	       trace_pipe<br>buffer_total_size_kb	    instances		      saved_cmdlines	   stack_max_size      trace_stat<br>current_tracer		    kprobe_events	      saved_cmdlines_size  stack_trace	       tracing_cpumask<br>dyn_ftrace_total_info	    kprobe_profile	      set_event		   stack_trace_filter  tracing_max_latency<br>enabled_functions	    max_graph_depth	      set_ftrace_filter    trace	       tracing_on<br>trace-cmd: Permission denied<br>  Error creating output file</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-11-25 18:11:42</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/14/2e/400913b1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é‡‘æ³¢</span>
  </div>
  <div class="_2_QraFYR_0">è¯·æ•™è€å¸ˆä¸ªé—®é¢˜ï¼Œé‡åˆ°ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒåµŒå…¥å¼linuxç³»ç»Ÿä¸Šï¼Œå‡ ç§’é’Ÿä¹‹å†…æŸä¸ªè¿›åŸçªç„¶å¯¼è‡´OOMã€‚<br>      è¯·é—®æœ‰æ²¡æœ‰ä»€ä¹ˆå¥½çš„æ–¹æ³•è°ƒæŸ¥æˆ–è€…æ•æ‰è°çŸ­æ—¶é—´å ç”¨å¤§é‡å†…å­˜å—ï¼Ÿ è„šæœ¬å‡ ç§’æ£€æµ‹mapsè¯•è¿‡ï¼Œæ•æ‰ä¸åˆ°ã€‚å†…å­˜é’©å­ä¸€æ˜¯ä¸çº¿ç¨‹å®‰å…¨ï¼Œå†å°±æ˜¯åº”è¯¥ç”¨äº†tcmallocï¼Œåº”è¯¥ä¹Ÿä¸è¡Œã€‚ valgrindå¤ªé‡é‡çº§ï¼Œå¤§ç¨‹åºè·‘ä¸åŠ¨ã€‚å¤šè°¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åŠ¨æ€è¿½è¸ªï¼ˆæ¯”å¦‚bccæˆ–è€…systemtapï¼‰åº”è¯¥æ˜¯æœ€å¥½ç”¨çš„æ–¹æ³•äº†ã€‚å¦‚æœå‘é€äº†OOMï¼Œä»ç³»ç»Ÿæ—¥å¿—é‡Œé¢ä¹Ÿå¯ä»¥æ‰¾åˆ°çº¿ç´¢</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-25 08:40:45</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>xfan</span>
  </div>
  <div class="_2_QraFYR_0">æˆ‘çš„æœºå™¨ä¸€è¿è¡Œ<br>echo function_graph &gt; current_traceæˆ–trace-cmdçš„å‘½ä»¤å°±å¡æ­»ï¼Œtty1ä¹Ÿè¾“å…¥ä¸äº†ï¼Œæˆ‘ç°åœ¨æ˜¯ubuntu18.04 åŒå¤„ç†å™¨ 1Gå†…å­˜ <br></div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è¿™ä¸ªé—®é¢˜æˆ‘ä¹Ÿæ˜¯ç¬¬ä¸€æ¬¡è§åˆ°ï¼Œæ£€æŸ¥ä¸‹ç³»ç»Ÿæ—¥å¿—é‡Œé¢æœ‰æ²¡æœ‰é”™è¯¯ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-22 10:26:37</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/9c/47/50cf2cab.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Chn.K</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œè¯·æ•™ä¸ªé—®é¢˜ï¼Œå¯¹äºè¸©å†…å­˜å¯¼è‡´çš„coredumpé—®é¢˜ï¼ˆä»coreæ–‡ä»¶å¤§è‡´èƒ½çœ‹å‡ºæ¥å†…å­˜å·²ç»ä¹±äº†ï¼Œä½†æ˜¯çœ‹ä¸å‡ºæ¥æ˜¯å“ªé‡ŒæŠŠå†…å­˜æä¹±äº†ï¼‰ï¼Œæœ‰æ²¡æœ‰å¥½çš„å®šä½æ–¹æ³•ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: coredumpæä¾›äº†é—®é¢˜çš„ç°åœºï¼Œä»coredumpåˆ†æï¼ˆæ¯”å¦‚ä½¿ç”¨GDBï¼‰åº”è¯¥å°±æ˜¯æœ€å¥½çš„æ–¹æ³•äº†ï¼Œ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 21:28:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJLm7IbU8V19ENfAnAaeibr4X5zQDw2yI8pHy1xtRgVC7S0YjdqI6jKlcQ0ueicuCaIkebSTNelRibsA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å…¨å¤§ç¥å•Š</span>
  </div>
  <div class="_2_QraFYR_0">è¿™ä¸ªä¸“æ å¾ˆä¸é”™ï¼Œå­¦äº†å¾ˆå¤šå¹²è´§ï¼Œè€å¸ˆæŒºè´Ÿè´£ä»»çš„ï¼Œå¸Œæœ›è€å¸ˆä»¥åå¤šå¤šå¼€ç‚¹ä¸“æ ï¼Œåˆ†äº«æ–°çŸ¥è¯†ï¼Œå¼€äº†è®°å¾—é€šçŸ¥ğŸ˜™</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: è°¢è°¢æ”¯æŒğŸ˜Š</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 08:51:37</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ninuxer</span>
  </div>
  <div class="_2_QraFYR_0">æ‰“å¡day53<br>ä¸ªäººè®¤ä¸ºperfçš„åŠŸèƒ½å…¨é¢ï¼Œå¯ç”¨äºç³»ç»Ÿå’Œå†…æ ¸çš„åˆ†æï¼Œftraceç”¨äºå†…æ ¸çº§åˆ«çš„åˆ†æï½</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-20 08:20:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>piboye</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆ, æˆ‘è¿˜æƒ³é—®ä¸€ä¸ªä¸œè¥¿,  openrest xray è¿™ä¸ªäº§å“è€å¸ˆè§‰å¾—æ€ä¹ˆæ ·,  å¯ä»¥æ›¿ä»£æˆ‘ä»¬çš„äººå·¥åˆ†æå—?</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-24 15:39:56</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/47/00/3202bdf0.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>piboye</span>
  </div>
  <div class="_2_QraFYR_0">è¿™é‡Œçš„æ—¶é—´æ˜¯å…·ä½“æŸæ¬¡è¿è¡Œçš„æ—¶é—´ï¼Œè¿˜æ˜¯ç»Ÿè®¡åå–å’Œçš„æ—¶é—´ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-02-24 14:50:46</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/fa/03/eba78e43.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>é£æ¸…æ‰¬</span>
  </div>
  <div class="_2_QraFYR_0">ä¸ºå•¥ubuntué‡Œtrace-cmdæ˜¾ç¤ºcpu x is empty.<br>root@52coder:~# trace-cmd record -p function_graph -g do_sys_open -O funcgraph-proc ls<br>  plugin &#39;function_graph&#39;<br>52coder      docker		    incubator-brpc  perf      redis-5.0.8  trace.dat	   trace.dat.cpu1  trace.dat.cpu3  yolanda<br>cpp-reflect  geektime_distrib_perf  k8s_study	    protobuf  snap	   trace.dat.cpu0  trace.dat.cpu2  workspace<br>CPU0 data recorded at offset=0x905000<br>    0 bytes in size<br>CPU1 data recorded at offset=0x905000<br>    0 bytes in size<br>CPU2 data recorded at offset=0x905000<br>    0 bytes in size<br>CPU3 data recorded at offset=0x905000<br>    0 bytes in size<br>root@52coder:~#<br>root@52coder:~# trace-cmd report<br>CPU 0 is empty<br>CPU 1 is empty<br>CPU 2 is empty<br>CPU 3 is empty<br>cpus=4<br>root@52coder:~#</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-01-22 11:45:01</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/18/b7/24/17f6c240.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>janey</span>
  </div>
  <div class="_2_QraFYR_0">Uprobeã€kprobeã€tracepointã€USDTè¿™4ç§æ¢é’ˆæœ‰ä¸¤ç§å½’ç±»æ–¹æ³•ï¼š<br>ä¸€æ˜¯æŒ‰ç…§åŠ¨é™åˆ†ï¼Œé™æ€è·Ÿè¸ªæœ‰tracepointå’ŒUSDTï¼›åŠ¨æ€è·Ÿè¸ªæœ‰kprobeå’ŒUprobeã€‚<br>äºŒæ˜¯æŒ‰ç…§ç”¨æˆ·æ€å†…æ ¸æ€åˆ†ï¼Œå†…æ ¸æ€æœ‰kprobeã€tracepointï¼›ç”¨æˆ·æ€æœ‰USDTå’ŒUprobeã€‚<br>è¿™æ ·ç†è§£å¯¹å—ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-07-29 15:35:49</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/7a/81/69874318.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ding</span>
  </div>
  <div class="_2_QraFYR_0">trace-cmdæŠ¥æ²¡æœ‰æƒé™<br><br>root@jamesdvm:&#47;sys&#47;kernel&#47;debug&#47;tracing# trace-cmd record -p function_graph -g do_sys_open -O funcgraph-proc ls<br>  plugin &#39;function_graph&#39;<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>trace-cmd: Permission denied<br>  can&#39;t create recorder<br>available_events            buffer_total_size_kb   events                    instances        options         saved_cmdlines       set_event_pid       set_graph_function  stack_trace         trace_marker      trace_stat           tracing_thresh<br>available_filter_functions  current_tracer         free_buffer               kprobe_events    per_cpu         saved_cmdlines_size  set_ftrace_filter   set_graph_notrace   stack_trace_filter  trace_marker_raw  tracing_cpumask      uprobe_events<br>available_tracers           dyn_ftrace_total_info  function_profile_enabled  kprobe_profile   printk_formats  saved_tgids          set_ftrace_notrace  snapshot            trace               trace_options     tracing_max_latency  uprobe_profile<br>buffer_size_kb              enabled_functions      hwlat_detector            max_graph_depth  README          set_event            set_ftrace_pid      stack_max_size      trace_clock         trace_pipe        tracing_on<br>trace-cmd: Permission denied<br>  Error creating output file</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-08-24 15:35:32</div>
  </div>
</div>
</div>
</li>
</ul>