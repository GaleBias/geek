<audio title="51 _ æ¡ˆä¾‹ç¯‡ï¼šåŠ¨æ€è¿½è¸ªæ€ä¹ˆç”¨ï¼Ÿï¼ˆä¸‹ï¼‰" src="https://static001.geekbang.org/resource/audio/a2/c3/a294305d88312740240a738c11dc4ac3.mp3" controls="controls"></audio> 
<p>ä½ å¥½ï¼Œæˆ‘æ˜¯å€ªæœ‹é£ã€‚</p><p>ä¸Šä¸€èŠ‚ï¼Œæˆ‘å¸¦ä½ ä¸€èµ·å­¦ä¹ äº†å¸¸è§çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•ã€‚æ‰€è°“åŠ¨æ€è¿½è¸ªï¼Œå°±æ˜¯åœ¨ç³»ç»Ÿæˆ–è€…åº”ç”¨ç¨‹åºæ­£å¸¸è¿è¡Œçš„æ—¶å€™ï¼Œé€šè¿‡å†…æ ¸ä¸­æä¾›çš„æ¢é’ˆï¼Œæ¥åŠ¨æ€è¿½è¸ªå®ƒä»¬çš„è¡Œä¸ºï¼Œä»è€Œè¾…åŠ©æ’æŸ¥å‡ºæ€§èƒ½é—®é¢˜çš„ç“¶é¢ˆã€‚</p><p>ä½¿ç”¨åŠ¨æ€è¿½è¸ªï¼Œå¯ä»¥åœ¨ä¸ä¿®æ”¹ä»£ç ã€ä¸é‡å¯æœåŠ¡çš„æƒ…å†µä¸‹ï¼ŒåŠ¨æ€äº†è§£åº”ç”¨ç¨‹åºæˆ–è€…å†…æ ¸çš„è¡Œä¸ºï¼Œè¿™å¯¹æ’æŸ¥çº¿ä¸Šé—®é¢˜ã€ç‰¹åˆ«æ˜¯ä¸å®¹æ˜“é‡ç°çš„é—®é¢˜å°¤å…¶æœ‰æ•ˆã€‚</p><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¸¸è§çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•åŒ…æ‹¬ ftraceã€perfã€eBPF ä»¥åŠ SystemTap ç­‰ã€‚ä¸ŠèŠ‚è¯¾ï¼Œæˆ‘ä»¬å…·ä½“å­¦ä¹ äº† ftrace çš„ä½¿ç”¨æ–¹æ³•ã€‚ä»Šå¤©ï¼Œæˆ‘ä»¬å†æ¥ä¸€èµ·çœ‹çœ‹å…¶ä»–å‡ ç§æ–¹æ³•ã€‚</p><h2>perf</h2><p>perf å·²ç»æ˜¯æˆ‘ä»¬çš„è€æœ‹å‹äº†ã€‚åœ¨å‰é¢çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡ç”¨åˆ°å®ƒï¼Œæ¥æŸ¥æ‰¾åº”ç”¨ç¨‹åºæˆ–è€…å†…æ ¸ä¸­çš„çƒ­ç‚¹å‡½æ•°ï¼Œä»è€Œå®šä½æ€§èƒ½ç“¶é¢ˆã€‚è€Œåœ¨å†…æ ¸çº¿ç¨‹ CPU é«˜çš„æ¡ˆä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿˜ä½¿ç”¨ç«ç„°å›¾åŠ¨æ€å±•ç¤º perf çš„äº‹ä»¶è®°å½•ï¼Œä»è€Œæ›´ç›´è§‚åœ°å‘ç°äº†é—®é¢˜ã€‚</p><p>ä¸è¿‡ï¼Œæˆ‘ä»¬å‰é¢ä½¿ç”¨ perf record/topæ—¶ï¼Œéƒ½æ˜¯å…ˆå¯¹äº‹ä»¶è¿›è¡Œé‡‡æ ·ï¼Œç„¶åå†æ ¹æ®é‡‡æ ·æ•°ï¼Œè¯„ä¼°å„ä¸ªå‡½æ•°çš„è°ƒç”¨é¢‘ç‡ã€‚å®é™…ä¸Šï¼Œperf çš„åŠŸèƒ½è¿œä¸æ­¢äºæ­¤ã€‚æ¯”å¦‚ï¼Œ</p><ul>
<li>
<p>perf å¯ä»¥ç”¨æ¥åˆ†æ CPU cacheã€CPU è¿ç§»ã€åˆ†æ”¯é¢„æµ‹ã€æŒ‡ä»¤å‘¨æœŸç­‰å„ç§ç¡¬ä»¶äº‹ä»¶ï¼›</p>
</li>
<li>
<p>perf ä¹Ÿå¯ä»¥åªå¯¹æ„Ÿå…´è¶£çš„äº‹ä»¶è¿›è¡ŒåŠ¨æ€è¿½è¸ªã€‚</p>
</li>
</ul><!-- [[[read_end]]] --><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥å†…æ ¸å‡½æ•° do_sys_openï¼Œä»¥åŠç”¨æˆ·ç©ºé—´å‡½æ•° readline ä¸ºä¾‹ï¼Œçœ‹ä¸€çœ‹ perf åŠ¨æ€è¿½è¸ªçš„ä½¿ç”¨æ–¹æ³•ã€‚</p><p>åŒ ftrace ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥é€šè¿‡ perf list ï¼ŒæŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„äº‹ä»¶ï¼š</p><pre><code>$ perf list
</code></pre><p>ç„¶åï¼Œåœ¨ perf çš„å„ä¸ªå­å‘½ä»¤ä¸­æ·»åŠ  --event é€‰é¡¹ï¼Œè®¾ç½®è¿½è¸ªæ„Ÿå…´è¶£çš„äº‹ä»¶ã€‚å¦‚æœè¿™äº›é¢„å®šä¹‰çš„äº‹ä»¶ä¸æ»¡è¶³å®é™…éœ€è¦ï¼Œä½ è¿˜å¯ä»¥ä½¿ç”¨ perf probe æ¥åŠ¨æ€æ·»åŠ ã€‚è€Œä¸”ï¼Œé™¤äº†è¿½è¸ªå†…æ ¸äº‹ä»¶å¤–ï¼Œperf è¿˜å¯ä»¥ç”¨æ¥è·Ÿè¸ªç”¨æˆ·ç©ºé—´çš„å‡½æ•°ã€‚</p><p><strong>æˆ‘ä»¬å…ˆæ¥çœ‹ç¬¬ä¸€ä¸ª perf ç¤ºä¾‹ï¼Œå†…æ ¸å‡½æ•° do_sys_open çš„ä¾‹å­</strong>ã€‚ä½ å¯ä»¥æ‰§è¡Œ perf probe å‘½ä»¤ï¼Œæ·»åŠ  do_sys_open æ¢é’ˆï¼š</p><pre><code>$ perf probe --add do_sys_open
Added new event:
  probe:do_sys_open    (on do_sys_open)
You can now use it in all perf tools, such as:
    perf record -e probe:do_sys_open -aR sleep 1
</code></pre><p>æ¢é’ˆæ·»åŠ æˆåŠŸåï¼Œå°±å¯ä»¥åœ¨æ‰€æœ‰çš„ perf å­å‘½ä»¤ä¸­ä½¿ç”¨ã€‚æ¯”å¦‚ï¼Œä¸Šè¿°è¾“å‡ºå°±æ˜¯ä¸€ä¸ª perf record çš„ç¤ºä¾‹ï¼Œæ‰§è¡Œå®ƒå°±å¯ä»¥å¯¹ 10s å†…çš„ do_sys_open è¿›è¡Œé‡‡æ ·ï¼š</p><pre><code>$ perf record -e probe:do_sys_open -aR sleep 10
[ perf record: Woken up 1 times to write data ]
[ perf record: Captured and wrote 0.148 MB perf.data (19 samples) ]
</code></pre><p>è€Œé‡‡æ ·æˆåŠŸåï¼Œå°±å¯ä»¥æ‰§è¡Œ perf script ï¼Œæ¥æŸ¥çœ‹é‡‡æ ·ç»“æœäº†ï¼š</p><pre><code>$ perf script
            perf 12886 [000] 89565.879875: probe:do_sys_open: (ffffffffa807b290)
           sleep 12889 [000] 89565.880362: probe:do_sys_open: (ffffffffa807b290)
           sleep 12889 [000] 89565.880382: probe:do_sys_open: (ffffffffa807b290)
           sleep 12889 [000] 89565.880635: probe:do_sys_open: (ffffffffa807b290)
           sleep 12889 [000] 89565.880669: probe:do_sys_open: (ffffffffa807b290)
</code></pre><p>è¾“å‡ºä¸­ï¼ŒåŒæ ·ä¹Ÿåˆ—å‡ºäº†è°ƒç”¨ do_sys_open çš„ä»»åŠ¡åç§°ã€è¿›ç¨‹ PID ä»¥åŠè¿è¡Œçš„ CPU ç­‰ä¿¡æ¯ã€‚ä¸è¿‡ï¼Œå¯¹äº open ç³»ç»Ÿè°ƒç”¨æ¥è¯´ï¼ŒåªçŸ¥é“å®ƒè¢«è°ƒç”¨äº†å¹¶ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦çŸ¥é“çš„æ˜¯ï¼Œè¿›ç¨‹åˆ°åº•åœ¨æ‰“å¼€å“ªäº›æ–‡ä»¶ã€‚æ‰€ä»¥ï¼Œå®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬è¿˜å¸Œæœ›è¿½è¸ªæ—¶èƒ½æ˜¾ç¤ºè¿™äº›å‡½æ•°çš„å‚æ•°ã€‚</p><p>å¯¹äºå†…æ ¸å‡½æ•°æ¥è¯´ï¼Œä½ å½“ç„¶å¯ä»¥å»æŸ¥çœ‹å†…æ ¸æºç ï¼Œæ‰¾å‡ºå®ƒçš„æ‰€æœ‰å‚æ•°ã€‚ä¸è¿‡è¿˜æœ‰æ›´ç®€å•çš„æ–¹æ³•ï¼Œé‚£å°±æ˜¯ç›´æ¥ä»è°ƒè¯•ç¬¦å·è¡¨ä¸­æŸ¥è¯¢ã€‚æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œä½ å°±å¯ä»¥çŸ¥é“ do_sys_open çš„æ‰€æœ‰å‚æ•°ï¼š</p><pre><code>$ perf probe -V do_sys_open
Available variables at do_sys_open
        @&lt;do_sys_open+0&gt;
                char*   filename
                int     dfd
                int     flags
                struct open_flags       op
                umode_t mode
</code></pre><p>ä»è¿™å„¿å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬å…³å¿ƒçš„æ–‡ä»¶è·¯å¾„ï¼Œå°±æ˜¯ç¬¬ä¸€ä¸ªå­—ç¬¦æŒ‡é’ˆå‚æ•°ï¼ˆä¹Ÿå°±æ˜¯å­—ç¬¦ä¸²ï¼‰ï¼Œå‚æ•°åç§°ä¸º filenameã€‚å¦‚æœè¿™ä¸ªå‘½ä»¤æ‰§è¡Œå¤±è´¥ï¼Œå°±è¯´æ˜è°ƒè¯•ç¬¦å·è¡¨è¿˜æ²¡æœ‰å®‰è£…ã€‚é‚£ä¹ˆï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå®‰è£…è°ƒè¯•ä¿¡æ¯åé‡è¯•ï¼š</p><pre><code># Ubuntu
$ apt-get install linux-image-`uname -r`-dbgsym
# CentOS
$ yum --enablerepo=base-debuginfo install -y kernel-debuginfo-$(uname -r)

</code></pre><p>æ‰¾å‡ºå‚æ•°åç§°å’Œç±»å‹åï¼Œå°±å¯ä»¥æŠŠå‚æ•°åŠ åˆ°æ¢é’ˆä¸­äº†ã€‚ä¸è¿‡ç”±äºæˆ‘ä»¬å·²ç»æ·»åŠ è¿‡åŒåæ¢é’ˆï¼Œæ‰€ä»¥åœ¨è¿™æ¬¡æ·»åŠ å‰ï¼Œéœ€è¦å…ˆæŠŠæ—§æ¢é’ˆç»™åˆ æ‰ï¼š</p><pre><code># å…ˆåˆ é™¤æ—§çš„æ¢é’ˆ
perf probe --del probe:do_sys_open

# æ·»åŠ å¸¦å‚æ•°çš„æ¢é’ˆ
$ perf probe --add 'do_sys_open filename:string'
Added new event:
  probe:do_sys_open    (on do_sys_open with filename:string)
You can now use it in all perf tools, such as:
    perf record -e probe:do_sys_open -aR sleep 1
</code></pre><p>æ–°çš„æ¢é’ˆæ·»åŠ åï¼Œé‡æ–°æ‰§è¡Œ record å’Œ script å­å‘½ä»¤ï¼Œé‡‡æ ·å¹¶æŸ¥çœ‹è®°å½•ï¼š</p><pre><code># é‡æ–°é‡‡æ ·è®°å½•
$ perf record -e probe:do_sys_open -aR ls

# æŸ¥çœ‹ç»“æœ
$ perf script
            perf 13593 [000] 91846.053622: probe:do_sys_open: (ffffffffa807b290) filename_string=&quot;/proc/13596/status&quot;
              ls 13596 [000] 91846.053995: probe:do_sys_open: (ffffffffa807b290) filename_string=&quot;/etc/ld.so.cache&quot;
              ls 13596 [000] 91846.054011: probe:do_sys_open: (ffffffffa807b290) filename_string=&quot;/lib/x86_64-linux-gnu/libselinux.so.1&quot;
              ls 13596 [000] 91846.054066: probe:do_sys_open: (ffffffffa807b290) filename_string=&quot;/lib/x86_64-linux-gnu/libc.so.6â€
              ...
# ä½¿ç”¨å®Œæˆåä¸è¦å¿˜è®°åˆ é™¤æ¢é’ˆ
$ perf probe --del probe:do_sys_open
</code></pre><p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥çœ‹åˆ°æ¯æ¬¡è°ƒç”¨ open æ—¶æ‰“å¼€çš„æ–‡ä»¶äº†ã€‚ä¸è¿‡ï¼Œè¿™ä¸ªç»“æœæ˜¯ä¸æ˜¯çœ‹ç€å¾ˆç†Ÿæ‚‰å‘¢ï¼Ÿ</p><p>å…¶å®ï¼Œåœ¨æˆ‘ä»¬ä½¿ç”¨ strace è·Ÿè¸ªè¿›ç¨‹çš„ç³»ç»Ÿè°ƒç”¨æ—¶ï¼Œä¹Ÿç»å¸¸ä¼šçœ‹åˆ°è¿™äº›åŠ¨æ€åº“çš„å½±å­ã€‚æ¯”å¦‚ï¼Œä½¿ç”¨ strace è·Ÿè¸ª ls æ—¶ï¼Œä½ å¯ä»¥å¾—åˆ°ä¸‹é¢çš„ç»“æœï¼š</p><pre><code>$ strace ls
...
access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)
access(&quot;/etc/ld.so.preload&quot;, R_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, &quot;/etc/ld.so.cache&quot;, O_RDONLY|O_CLOEXEC) = 3
...
access(&quot;/etc/ld.so.nohwcap&quot;, F_OK)      = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, &quot;/lib/x86_64-linux-gnu/libselinux.so.1&quot;, O_RDONLY|O_CLOEXEC) = 3
...
</code></pre><p>ä½ ä¼°è®¡åœ¨æƒ³ï¼Œæ—¢ç„¶strace ä¹Ÿèƒ½å¾—åˆ°ç±»ä¼¼ç»“æœï¼Œæœ¬èº«åˆå®¹æ˜“æ“ä½œï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬è¿˜è¦ç”¨perf å‘¢ï¼Ÿ</p><p>å®é™…ä¸Šï¼Œå¾ˆå¤šäººåªçœ‹åˆ°äº† strace ç®€å•æ˜“ç”¨çš„å¥½å¤„ï¼Œå´å¿½ç•¥äº†å®ƒå¯¹è¿›ç¨‹æ€§èƒ½å¸¦æ¥çš„å½±å“ã€‚ä»åŸç†ä¸Šæ¥è¯´ï¼Œ<strong>strace åŸºäºç³»ç»Ÿè°ƒç”¨ ptrace å®ç°</strong>ï¼Œè¿™å°±å¸¦æ¥äº†ä¸¤ä¸ªé—®é¢˜ã€‚</p><ul>
<li>
<p>ç”±äºptrace æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œå°±éœ€è¦åœ¨å†…æ ¸æ€å’Œç”¨æˆ·æ€åˆ‡æ¢ã€‚å½“äº‹ä»¶æ•°é‡æ¯”è¾ƒå¤šæ—¶ï¼Œç¹å¿™çš„åˆ‡æ¢å¿…ç„¶ä¼šå½±å“åŸæœ‰æœåŠ¡çš„æ€§èƒ½ï¼›</p>
</li>
<li>
<p>ptrace éœ€è¦å€ŸåŠ© SIGSTOP ä¿¡å·æŒ‚èµ·ç›®æ ‡è¿›ç¨‹ã€‚è¿™ç§ä¿¡å·æ§åˆ¶å’Œè¿›ç¨‹æŒ‚èµ·ï¼Œä¼šå½±å“ç›®æ ‡è¿›ç¨‹çš„è¡Œä¸ºã€‚</p>
</li>
</ul><p>æ‰€ä»¥ï¼Œåœ¨æ€§èƒ½æ•æ„Ÿçš„åº”ç”¨ï¼ˆæ¯”å¦‚æ•°æ®åº“ï¼‰ä¸­ï¼Œæˆ‘å¹¶ä¸æ¨èä½ ç”¨ strace ï¼ˆæˆ–è€…å…¶ä»–åŸºäº ptrace çš„æ€§èƒ½å·¥å…·ï¼‰å»æ’æŸ¥å’Œè°ƒè¯•ã€‚</p><p>åœ¨ strace çš„å¯å‘ä¸‹ï¼Œç»“åˆå†…æ ¸ä¸­çš„ utrace æœºåˆ¶ï¼Œ perf ä¹Ÿæä¾›äº†ä¸€ä¸ª trace å­å‘½ä»¤ï¼Œæ˜¯å–ä»£ strace çš„é¦–é€‰å·¥å…·ã€‚ç›¸å¯¹äº ptrace æœºåˆ¶æ¥è¯´ï¼Œperf trace åŸºäºå†…æ ¸äº‹ä»¶ï¼Œè‡ªç„¶è¦æ¯”è¿›ç¨‹è·Ÿè¸ªçš„æ€§èƒ½å¥½å¾ˆå¤šã€‚</p><p>perf trace çš„ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹æ‰€ç¤ºï¼Œè·Ÿ strace å…¶å®å¾ˆåƒï¼š</p><pre><code>$ perf trace ls
         ? (         ): ls/14234  ... [continued]: execve()) = 0
     0.177 ( 0.013 ms): ls/14234 brk(                                                                  ) = 0x555d96be7000
     0.224 ( 0.014 ms): ls/14234 access(filename: 0xad98082                                            ) = -1 ENOENT No such file or directory
     0.248 ( 0.009 ms): ls/14234 access(filename: 0xad9add0, mode: R                                   ) = -1 ENOENT No such file or directory
     0.267 ( 0.012 ms): ls/14234 openat(dfd: CWD, filename: 0xad98428, flags: CLOEXEC                  ) = 3
     0.288 ( 0.009 ms): ls/14234 fstat(fd: 3&lt;/usr/lib/locale/C.UTF-8/LC_NAME&gt;, statbuf: 0x7ffd2015f230 ) = 0
     0.305 ( 0.011 ms): ls/14234 mmap(len: 45560, prot: READ, flags: PRIVATE, fd: 3                    ) = 0x7efe0af92000
     0.324 Dockerfile  test.sh
( 0.008 ms): ls/14234 close(fd: 3&lt;/usr/lib/locale/C.UTF-8/LC_NAME&gt;                          ) = 0
     ...
</code></pre><p>ä¸è¿‡ï¼Œperf trace è¿˜å¯ä»¥è¿›è¡Œç³»ç»Ÿçº§çš„ç³»ç»Ÿè°ƒç”¨è·Ÿè¸ªï¼ˆå³è·Ÿè¸ªæ‰€æœ‰è¿›ç¨‹ï¼‰ï¼Œè€Œ strace åªèƒ½è·Ÿè¸ªç‰¹å®šçš„è¿›ç¨‹ã€‚</p><p><strong>ç¬¬äºŒä¸ª perf çš„ä¾‹å­æ˜¯ç”¨æˆ·ç©ºé—´çš„åº“å‡½æ•°</strong>ã€‚ä»¥ bash è°ƒç”¨çš„åº“å‡½æ•° readline ä¸ºä¾‹ï¼Œä½¿ç”¨ç±»ä¼¼çš„æ–¹æ³•ï¼Œå¯ä»¥è·Ÿè¸ªåº“å‡½æ•°çš„è°ƒç”¨ï¼ˆåŸºäº uprobesï¼‰ã€‚</p><p>readline çš„ä½œç”¨ï¼Œæ˜¯ä»ç»ˆç«¯ä¸­è¯»å–ç”¨æˆ·è¾“å…¥ï¼Œå¹¶æŠŠè¿™äº›æ•°æ®è¿”å›è°ƒç”¨æ–¹ã€‚æ‰€ä»¥ï¼Œè·Ÿ open ç³»ç»Ÿè°ƒç”¨ä¸åŒçš„æ˜¯ï¼Œæˆ‘ä»¬æ›´å…³æ³¨ readline çš„è°ƒç”¨ç»“æœã€‚</p><p>æˆ‘ä»¬æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œé€šè¿‡ -x æŒ‡å®š bash äºŒè¿›åˆ¶æ–‡ä»¶çš„è·¯å¾„ï¼Œå°±å¯ä»¥åŠ¨æ€è·Ÿè¸ªåº“å‡½æ•°ã€‚è¿™å…¶å®å°±æ˜¯è·Ÿè¸ªäº†æ‰€æœ‰ç”¨æˆ·åœ¨ bash ä¸­æ‰§è¡Œçš„å‘½ä»¤ï¼š</p><pre><code># ä¸º/bin/bashæ·»åŠ readlineæ¢é’ˆ
$ perf probe -x /bin/bash 'readline%return +0($retval):stringâ€™

# é‡‡æ ·è®°å½•
$ perf record -e probe_bash:readline__return -aR sleep 5

# æŸ¥çœ‹ç»“æœ
$ perf script
    bash 13348 [000] 93939.142576: probe_bash:readline__return: (5626ffac1610 &lt;- 5626ffa46739) arg1=&quot;ls&quot;

# è·Ÿè¸ªå®Œæˆååˆ é™¤æ¢é’ˆ
$ perf probe --del probe_bash:readline__return
</code></pre><p>å½“ç„¶ï¼Œå¦‚æœä½ ä¸ç¡®å®šæ¢é’ˆæ ¼å¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡ä¸‹é¢çš„å‘½ä»¤ï¼ŒæŸ¥è¯¢æ‰€æœ‰æ”¯æŒçš„å‡½æ•°å’Œå‡½æ•°å‚æ•°ï¼š</p><pre><code># æŸ¥è¯¢æ‰€æœ‰çš„å‡½æ•°
$ perf probe -x /bin/bash â€”funcs

# æŸ¥è¯¢å‡½æ•°çš„å‚æ•°
$ perf probe -x /bin/bash -V readline
Available variables at readline
        @&lt;readline+0&gt;
                char*   prompt
</code></pre><p>è·Ÿå†…æ ¸å‡½æ•°ç±»ä¼¼ï¼Œå¦‚æœä½ æƒ³è¦æŸ¥çœ‹æ™®é€šåº”ç”¨çš„å‡½æ•°åç§°å’Œå‚æ•°ï¼Œé‚£ä¹ˆåœ¨åº”ç”¨ç¨‹åºçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼ŒåŒæ ·éœ€è¦åŒ…å«è°ƒè¯•ä¿¡æ¯ã€‚</p><h2>eBPF å’Œ BCC</h2><p>ftrace å’Œ perf çš„åŠŸèƒ½å·²ç»æ¯”è¾ƒä¸°å¯Œäº†ï¼Œä¸è¿‡ï¼Œå®ƒä»¬æœ‰ä¸€ä¸ªå…±åŒçš„ç¼ºé™·ï¼Œé‚£å°±æ˜¯ä¸å¤Ÿçµæ´»ï¼Œæ²¡æ³•åƒ DTrace é‚£æ ·é€šè¿‡è„šæœ¬è‡ªç”±æ‰©å±•ã€‚</p><p>è€Œ eBPF å°±æ˜¯ Linux ç‰ˆçš„ DTraceï¼Œå¯ä»¥é€šè¿‡C è¯­è¨€è‡ªç”±æ‰©å±•ï¼ˆè¿™äº›æ‰©å±•é€šè¿‡ LLVM è½¬æ¢ä¸º BPF å­—èŠ‚ç åï¼ŒåŠ è½½åˆ°å†…æ ¸ä¸­æ‰§è¡Œï¼‰ã€‚ä¸‹é¢è¿™å¼ å›¾ï¼Œå°±è¡¨ç¤ºäº† eBPF è¿½è¸ªçš„å·¥ä½œåŸç†ï¼š</p><p><img src="https://static001.geekbang.org/resource/image/a3/e9/a3547f2ac1d4d75b850a02a2735560e9.png?wh=580*325" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="https://thenewstack.io/long-last-linux-gets-dynamic-tracing/">THE NEW STACK</a>ï¼‰</p><p>ä»å›¾ä¸­ä½ å¯ä»¥çœ‹åˆ°ï¼ŒeBPF çš„æ‰§è¡Œéœ€è¦ä¸‰æ­¥ï¼š</p><ul>
<li>
<p>ä»ç”¨æˆ·è·Ÿè¸ªç¨‹åºç”Ÿæˆ BPF å­—èŠ‚ç ï¼›</p>
</li>
<li>
<p>åŠ è½½åˆ°å†…æ ¸ä¸­è¿è¡Œï¼›</p>
</li>
<li>
<p>å‘ç”¨æˆ·ç©ºé—´è¾“å‡ºç»“æœã€‚</p>
</li>
</ul><p>æ‰€ä»¥ï¼Œä»ä½¿ç”¨ä¸Šæ¥è¯´ï¼ŒeBPF è¦æ¯”æˆ‘ä»¬å‰é¢çœ‹åˆ°çš„ ftrace å’Œ perf ï¼Œéƒ½æ›´åŠ ç¹æ‚ã€‚</p><p>å®é™…ä¸Šï¼Œåœ¨ eBPF æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œç¼–è¯‘ã€åŠ è½½è¿˜æœ‰ maps ç­‰æ“ä½œï¼Œå¯¹æ‰€æœ‰çš„è·Ÿè¸ªç¨‹åºæ¥è¯´éƒ½æ˜¯é€šç”¨çš„ã€‚æŠŠè¿™äº›è¿‡ç¨‹é€šè¿‡ Python æŠ½è±¡èµ·æ¥ï¼Œä¹Ÿå°±è¯ç”Ÿäº† BCCï¼ˆBPF Compiler Collectionï¼‰ã€‚</p><p>BCC æŠŠ eBPF ä¸­çš„å„ç§äº‹ä»¶æºï¼ˆæ¯”å¦‚ kprobeã€uprobeã€tracepoint ç­‰ï¼‰å’Œæ•°æ®æ“ä½œï¼ˆç§°ä¸º Mapsï¼‰ï¼Œä¹Ÿéƒ½è½¬æ¢æˆäº† Python æ¥å£ï¼ˆä¹Ÿæ”¯æŒ luaï¼‰ã€‚è¿™æ ·ï¼Œä½¿ç”¨ BCC è¿›è¡ŒåŠ¨æ€è¿½è¸ªæ—¶ï¼Œç¼–å†™ç®€å•çš„è„šæœ¬å°±å¯ä»¥äº†ã€‚</p><p>ä¸è¿‡è¦æ³¨æ„ï¼Œå› ä¸ºéœ€è¦è·Ÿå†…æ ¸ä¸­çš„æ•°æ®ç»“æ„äº¤äº’ï¼ŒçœŸæ­£æ ¸å¿ƒçš„äº‹ä»¶å¤„ç†é€»è¾‘ï¼Œè¿˜æ˜¯éœ€è¦æˆ‘ä»¬ç”¨ C è¯­è¨€æ¥ç¼–å†™ã€‚</p><p>è‡³äº BCC çš„å®‰è£…æ–¹æ³•ï¼Œåœ¨å†…å­˜æ¨¡å—çš„<a href="https://time.geekbang.org/column/article/0?cid=140">ç¼“å­˜æ¡ˆä¾‹</a>ä¸­ï¼Œæˆ‘å°±å·²ç»ä»‹ç»è¿‡äº†ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰å®‰è£…è¿‡ï¼Œå¯ä»¥æ‰§è¡Œä¸‹é¢çš„å‘½ä»¤æ¥å®‰è£…ï¼ˆå…¶ä»–ç³»ç»Ÿçš„å®‰è£…è¯·å‚è€ƒ<a href="https://github.com/iovisor/bcc/blob/master/INSTALL.md">è¿™é‡Œ</a>ï¼‰ï¼š</p><pre><code># Ubuntu
sudo apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 4052245BD4284CDD
echo &quot;deb https://repo.iovisor.org/apt/$(lsb_release -cs) $(lsb_release -cs) main&quot; | sudo tee /etc/apt/sources.list.d/iovisor.list
sudo apt-get update
sudo apt-get install bcc-tools libbcc-examples linux-headers-$(uname -r)

# REHL 7.6
yum install bcc-tools
</code></pre><p>å®‰è£…åï¼ŒBCC ä¼šæŠŠæ‰€æœ‰ç¤ºä¾‹ï¼ˆåŒ…æ‹¬ Python å’Œ luaï¼‰ï¼Œæ”¾åˆ° /usr/share/bcc/examples ç›®å½•ä¸­ï¼š</p><pre><code>$ ls /usr/share/bcc/examples
hello_world.py  lua  networking  tracing
</code></pre><p>æ¥ä¸‹æ¥ï¼Œè¿˜æ˜¯ä»¥ do_sys_open ä¸ºä¾‹ï¼Œæˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ï¼Œå¦‚ä½•ç”¨ eBPF å’Œ BCC å®ç°åŒæ ·çš„åŠ¨æ€è·Ÿè¸ªã€‚</p><p>é€šå¸¸ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠ BCC åº”ç”¨ï¼Œæ‹†åˆ†ä¸ºä¸‹é¢è¿™å››ä¸ªæ­¥éª¤ã€‚</p><p>ç¬¬ä¸€ï¼Œè·Ÿæ‰€æœ‰çš„ Python æ¨¡å—ä½¿ç”¨æ–¹æ³•ä¸€æ ·ï¼Œåœ¨ä½¿ç”¨ä¹‹å‰ï¼Œå…ˆå¯¼å…¥è¦ç”¨åˆ°çš„æ¨¡å—ï¼š</p><pre><code>from bcc import BPF
</code></pre><p>ç¬¬äºŒï¼Œéœ€è¦å®šä¹‰äº‹ä»¶ä»¥åŠå¤„ç†äº‹ä»¶çš„å‡½æ•°ã€‚è¿™ä¸ªå‡½æ•°éœ€è¦ç”¨ C è¯­è¨€æ¥ç¼–å†™ï¼Œä½œç”¨æ˜¯åˆå§‹åŒ–åˆšæ‰å¯¼å…¥çš„ BPF å¯¹è±¡ã€‚è¿™äº›ç”¨ C è¯­è¨€ç¼–å†™çš„å¤„ç†å‡½æ•°ï¼Œè¦ä»¥å­—ç¬¦ä¸²çš„å½¢å¼é€åˆ° BPF æ¨¡å—ä¸­å¤„ç†ï¼š</p><pre><code># define BPF program (&quot;&quot;&quot; is used for multi-line string).
# '#' indicates comments for python, while '//' indicates comments for C.
prog = &quot;&quot;&quot;
#include &lt;uapi/linux/ptrace.h&gt;
#include &lt;uapi/linux/limits.h&gt;
#include &lt;linux/sched.h&gt;
// define output data structure in C
struct data_t {
    u32 pid;
    u64 ts;
    char comm[TASK_COMM_LEN];
    char fname[NAME_MAX];
};
BPF_PERF_OUTPUT(events);

// define the handler for do_sys_open.
// ctx is required, while other params depends on traced function.
int hello(struct pt_regs *ctx, int dfd, const char __user *filename, int flags){
    struct data_t data = {};
    data.pid = bpf_get_current_pid_tgid();
    data.ts = bpf_ktime_get_ns();
    if (bpf_get_current_comm(&amp;data.comm, sizeof(data.comm)) == 0) {
        bpf_probe_read(&amp;data.fname, sizeof(data.fname), (void *)filename);
    }
    events.perf_submit(ctx, &amp;data, sizeof(data));
    return 0;
}
&quot;&quot;&quot;
# load BPF program
b = BPF(text=prog)
# attach the kprobe for do_sys_open, and set handler to hello
b.attach_kprobe(event=&quot;do_sys_open&quot;, fn_name=&quot;hello&quot;)
</code></pre><p>ç¬¬ä¸‰æ­¥ï¼Œæ˜¯å®šä¹‰ä¸€ä¸ªè¾“å‡ºå‡½æ•°ï¼Œå¹¶æŠŠè¾“å‡ºå‡½æ•°è·Ÿ BPF äº‹ä»¶ç»‘å®šï¼š</p><pre><code># process event
start = 0
def print_event(cpu, data, size):
    global start
    # eventâ€™s type is data_t
    event = b[&quot;events&quot;].event(data)
    if start == 0:
            start = event.ts
    time_s = (float(event.ts - start)) / 1000000000
    print(&quot;%-18.9f %-16s %-6d %-16s&quot; % (time_s, event.comm, event.pid, event.fname))

# loop with callback to print_event
b[&quot;events&quot;].open_perf_buffer(print_event)
</code></pre><p>æœ€åä¸€æ­¥ï¼Œå°±æ˜¯æ‰§è¡Œäº‹ä»¶å¾ªç¯ï¼Œå¼€å§‹è¿½è¸ª do_sys_open çš„è°ƒç”¨ï¼š</p><pre><code># print header
print(&quot;%-18s %-16s %-6s %-16s&quot; % (&quot;TIME(s)&quot;, &quot;COMM&quot;, &quot;PID&quot;, &quot;FILEâ€))
# start the event polling loop
while 1:
    try:
        b.perf_buffer_poll()
    except KeyboardInterrupt:
        exit()
</code></pre><p>æˆ‘ä»¬æŠŠä¸Šé¢å‡ ä¸ªæ­¥éª¤çš„ä»£ç ï¼Œä¿å­˜åˆ°æ–‡ä»¶ trace-open.py ä¸­ï¼Œç„¶åå°±å¯ä»¥ç”¨ Python æ¥è¿è¡Œäº†ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œä½ å¯ä»¥çœ‹åˆ°å¦‚ä¸‹è¾“å‡ºï¼š</p><pre><code>$ python trace-open.py
TIME(s)            COMM             PID    FILE
0.000000000        irqbalance       1073   /proc/interrupts
0.000175401        irqbalance       1073   /proc/stat
0.000258802        irqbalance       1073   /proc/irq/9/smp_affinity
0.000290102        irqbalance       1073   /proc/irq/0/smp_affinity
</code></pre><p>ä»è¾“å‡ºä¸­ï¼Œä½ å¯ä»¥çœ‹åˆ° irqbalance è¿›ç¨‹ï¼ˆä½ çš„ç¯å¢ƒä¸­å¯èƒ½è¿˜ä¼šæœ‰å…¶ä»–è¿›ç¨‹ï¼‰æ­£åœ¨æ‰“å¼€å¾ˆå¤šæ–‡ä»¶ï¼Œè€Œ irqbalance ä¾èµ–è¿™äº›æ–‡ä»¶ä¸­è¯»å–çš„å†…å®¹ï¼Œæ¥æ‰§è¡Œä¸­æ–­è´Ÿè½½å‡è¡¡ã€‚</p><p>é€šè¿‡è¿™ä¸ªç®€å•çš„ç¤ºä¾‹ï¼Œä½ ä¹Ÿå¯ä»¥å‘ç°ï¼ŒeBPF å’Œ BCC çš„ä½¿ç”¨ï¼Œå…¶å®æ¯” ftrace å’Œ perf æœ‰æ›´é«˜çš„é—¨æ§›ã€‚æƒ³ç”¨ BCC å¼€å‘è‡ªå·±çš„åŠ¨æ€è·Ÿè¸ªç¨‹åºï¼Œè‡³å°‘è¦ç†Ÿæ‚‰ C è¯­è¨€ã€Python è¯­è¨€ã€è¢«è·Ÿè¸ªäº‹ä»¶æˆ–å‡½æ•°çš„ç‰¹å¾ï¼ˆæ¯”å¦‚å†…æ ¸å‡½æ•°çš„å‚æ•°å’Œè¿”å›æ ¼å¼ï¼‰ä»¥åŠ eBPF æä¾›çš„å„ç§æ•°æ®æ“ä½œæ–¹æ³•ã€‚</p><p>ä¸è¿‡ï¼Œå› ä¸ºå¼ºå¤§çš„çµæ´»æ€§ï¼Œè™½ç„¶ eBPF åœ¨ä½¿ç”¨ä¸Šæœ‰ä¸€å®šçš„é—¨æ§›ï¼Œå´ä¹Ÿæ— æ³•é˜»æ­¢å®ƒæˆä¸ºç›®å‰æœ€çƒ­é—¨ã€æœ€å—å…³æ³¨çš„åŠ¨æ€è¿½è¸ªæŠ€æœ¯ã€‚</p><p>å½“ç„¶ï¼ŒBCC è½¯ä»¶åŒ…ä¹Ÿå†…ç½®äº†å¾ˆå¤šå·²ç»å¼€å‘å¥½çš„å®ç”¨å·¥å…·ï¼Œé»˜è®¤å®‰è£…åˆ° /usr/share/bcc/tools/ ç›®å½•ä¸­ï¼Œå®ƒä»¬çš„ä½¿ç”¨åœºæ™¯å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://static001.geekbang.org/resource/image/fc/21/fc5f387a982db98c49c7cefb77342c21.png?wh=1500*1050" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="http://www.brendangregg.com/ebpf.html#bcc">Linux Extended BPF (eBPF) Tracing Tools</a>ï¼‰</p><p>è¿™äº›å·¥å…·ï¼Œä¸€èˆ¬éƒ½å¯ä»¥ç›´æ¥æ‹¿æ¥ç”¨ã€‚è€Œåœ¨ç¼–å†™å…¶ä»–çš„åŠ¨æ€è¿½è¸ªè„šæœ¬æ—¶ï¼Œå®ƒä»¬ä¹Ÿæ˜¯æœ€å¥½çš„å‚è€ƒèµ„æ–™ã€‚ä¸è¿‡ï¼Œæœ‰ä¸€ç‚¹éœ€è¦ä½ ç‰¹åˆ«æ³¨æ„ï¼Œå¾ˆå¤š eBPF çš„æ–°ç‰¹æ€§ï¼Œéƒ½éœ€è¦æ¯”è¾ƒæ–°çš„<a href="https://github.com/iovisor/bcc/blob/master/docs/kernel-versions.md">å†…æ ¸ç‰ˆæœ¬</a>ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚å¦‚æœæŸäº›å·¥å…·æ— æ³•è¿è¡Œï¼Œå¾ˆå¯èƒ½å°±æ˜¯å› ä¸ºä½¿ç”¨äº†å½“å‰å†…æ ¸ä¸æ”¯æŒçš„ç‰¹æ€§ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/61/e8/61abce1affc770a15dae7d489e50a8e8.png?wh=1500*1050" alt=""></p><p>ï¼ˆå›¾ç‰‡æ¥è‡ª <a href="http://www.brendangregg.com/ebpf.html#bcc">Linux Extended BPF (eBPF) Tracing Tools</a>ï¼‰</p><h2>SystemTap å’Œ sysdig</h2><p>é™¤äº†å‰é¢æåˆ°çš„ ftraceã€perfã€eBPF å’Œ BCC å¤–ï¼ŒSystemTap å’Œ sysdig ä¹Ÿæ˜¯å¸¸ç”¨çš„åŠ¨æ€è¿½è¸ªå·¥å…·ã€‚</p><p><strong>SystemTap</strong> ä¹Ÿæ˜¯ä¸€ç§å¯ä»¥é€šè¿‡è„šæœ¬è¿›è¡Œè‡ªç”±æ‰©å±•çš„åŠ¨æ€è¿½è¸ªæŠ€æœ¯ã€‚åœ¨ eBPF å‡ºç°ä¹‹å‰ï¼ŒSystemTap æ˜¯Linux ç³»ç»Ÿä¸­ï¼ŒåŠŸèƒ½æœ€æ¥è¿‘ DTrace çš„åŠ¨æ€è¿½è¸ªæœºåˆ¶ã€‚ä¸è¿‡è¦æ³¨æ„ï¼ŒSystemTap åœ¨å¾ˆé•¿æ—¶é—´ä»¥æ¥éƒ½æ¸¸ç¦»äºå†…æ ¸ä¹‹å¤–ï¼ˆè€Œ eBPF è‡ªè¯ç”Ÿä»¥æ¥ï¼Œä¸€ç›´æ ¹æ¤åœ¨å†…æ ¸ä¸­ï¼‰ã€‚</p><p>æ‰€ä»¥ï¼Œä»ç¨³å®šæ€§ä¸Šæ¥è¯´ï¼ŒSystemTap åªåœ¨ RHEL ç³»ç»Ÿä¸­å¥½ç”¨ï¼Œåœ¨å…¶ä»–ç³»ç»Ÿä¸­åˆ™å®¹æ˜“å‡ºç°å„ç§å¼‚å¸¸é—®é¢˜ã€‚å½“ç„¶ï¼Œåè¿‡æ¥è¯´ï¼Œæ”¯æŒ 3.x ç­‰æ—§ç‰ˆæœ¬çš„å†…æ ¸ï¼Œä¹Ÿæ˜¯ SystemTap ç›¸å¯¹äº eBPF çš„ä¸€ä¸ªå·¨å¤§ä¼˜åŠ¿ã€‚</p><p><strong>sysdig</strong> åˆ™æ˜¯éšç€å®¹å™¨æŠ€æœ¯çš„æ™®åŠè€Œè¯ç”Ÿçš„ï¼Œä¸»è¦ç”¨äºå®¹å™¨çš„åŠ¨æ€è¿½è¸ªã€‚sysdig æ±‡é›†äº†ä¸€äº›åˆ—æ€§èƒ½å·¥å…·çš„ä¼˜åŠ¿ï¼Œå¯ä»¥è¯´æ˜¯é›†ç™¾å®¶ä¹‹æ‰€é•¿ã€‚æˆ‘ä¹ æƒ¯ç”¨è¿™ä¸ªå…¬å¼æ¥è¡¨ç¤ºsysdigçš„ç‰¹ç‚¹ï¼š sysdig = strace + tcpdump + htop + iftop + lsof + docker inspectã€‚</p><p>è€Œåœ¨æœ€æ–°çš„ç‰ˆæœ¬ä¸­ï¼ˆå†…æ ¸ç‰ˆæœ¬ &gt;= 4.14ï¼‰ï¼Œsysdig è¿˜å¯ä»¥é€šè¿‡ eBPF æ¥è¿›è¡Œæ‰©å±•ï¼Œæ‰€ä»¥ï¼Œä¹Ÿå¯ä»¥ç”¨æ¥è¿½è¸ªå†…æ ¸ä¸­çš„å„ç§å‡½æ•°å’Œäº‹ä»¶ã€‚</p><h2>å¦‚ä½•é€‰æ‹©è¿½è¸ªå·¥å…·</h2><p>åˆ°è¿™é‡Œï¼Œä½ å¯èƒ½åˆè§‰å¾—å¤´å¤§äº†ï¼Œè¿™ä¹ˆå¤šåŠ¨æ€è¿½è¸ªå·¥å…·ï¼Œåœ¨å®é™…åœºæ™¯ä¸­åˆ°åº•è¯¥æ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿè¿˜æ˜¯é‚£å¥è¯ï¼Œå…·ä½“æ€§èƒ½å·¥å…·çš„é€‰æ‹©ï¼Œå°±è¦ä»å…·ä½“çš„å·¥ä½œåŸç†æ¥å…¥æ‰‹ã€‚</p><p>è¿™ä¸¤èŠ‚è¯¾ï¼Œæˆ‘ä»¬å·²ç»æŠŠå¸¸è§å·¥å…·çš„åŸç†å’Œç‰¹ç‚¹éƒ½ä»‹ç»è¿‡äº†ï¼Œä½ å¯ä»¥å…ˆè‡ªå·±æ€è€ƒåŒºåˆ†ä¸€ä¸‹ï¼Œä¸åŒåœºæ™¯çš„å·¥å…·é€‰æ‹©é—®é¢˜ã€‚æ¯”å¦‚ï¼š</p><ul>
<li>
<p>åœ¨ä¸éœ€è¦å¾ˆé«˜çµæ´»æ€§çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨ perf å¯¹æ€§èƒ½äº‹ä»¶è¿›è¡Œé‡‡æ ·ï¼Œç„¶åå†é…åˆç«ç„°å›¾è¾…åŠ©åˆ†æï¼Œå°±æ˜¯æœ€å¸¸ç”¨çš„ä¸€ç§æ–¹æ³•ï¼›</p>
</li>
<li>
<p>è€Œéœ€è¦å¯¹äº‹ä»¶æˆ–å‡½æ•°è°ƒç”¨è¿›è¡Œç»Ÿè®¡åˆ†æï¼ˆæ¯”å¦‚è§‚å¯Ÿä¸åŒå¤§å°çš„ I/O åˆ†å¸ƒï¼‰æ—¶ï¼Œå°±è¦ç”¨ SystemTap æˆ–è€… eBPFï¼Œé€šè¿‡ä¸€äº›è‡ªå®šä¹‰çš„è„šæœ¬æ¥è¿›è¡Œæ•°æ®å¤„ç†ã€‚</p>
</li>
</ul><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä¹Ÿæ€»ç»“äº†å‡ ä¸ªå¸¸è§çš„åŠ¨æ€è¿½è¸ªä½¿ç”¨åœºæ™¯ï¼Œå¹¶ä¸”åˆ†åˆ«æ¨èäº†é€‚åˆçš„å·¥å…·ã€‚ä½ å¯ä»¥ä¿å­˜è¿™ä¸ªè¡¨æ ¼ï¼Œæ–¹ä¾¿è‡ªå·±æŸ¥æ‰¾å¹¶ä½¿ç”¨ã€‚</p><p><img src="https://static001.geekbang.org/resource/image/5a/25/5a2b2550547d5eaee850bfb806f76625.png?wh=1659*872" alt=""></p><h2>å°ç»“</h2><p>ä»Šå¤©ï¼Œæˆ‘ä¸»è¦å¸¦ä½ å­¦ä¹ äº† perfã€eBPF å’Œ BCC ç­‰åŠ¨æ€è¿½è¸ªæ–¹æ³•ï¼Œå¹¶æ€»ç»“äº†ä¸åŒåœºæ™¯ä¸­å¦‚ä½•é€‰æ‹©åŠ¨æ€è¿½è¸ªæ–¹æ³•ã€‚</p><p>åœ¨ Linux ç³»ç»Ÿä¸­ï¼Œå¸¸è§çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•ï¼ŒåŒ…æ‹¬ ftraceã€perfã€eBPF ä»¥åŠ SystemTap ç­‰ã€‚åœ¨å¤§å¤šæ•°æ€§èƒ½é—®é¢˜ä¸­ï¼Œä½¿ç”¨ perf é…åˆç«ç„°å›¾æ˜¯ä¸€ä¸ªä¸é”™çš„æ–¹æ³•ã€‚å¦‚æœè¿™æ»¡è¶³ä¸äº†ä½ çš„è¦æ±‚ï¼Œé‚£ä¹ˆï¼š</p><ul>
<li>
<p>åœ¨æ–°ç‰ˆçš„å†…æ ¸ä¸­ï¼ŒeBPF å’Œ BCC æ˜¯æœ€çµæ´»çš„åŠ¨æ€è¿½è¸ªæ–¹æ³•ï¼›</p>
</li>
<li>
<p>è€Œåœ¨æ—§ç‰ˆæœ¬å†…æ ¸ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨ RHEL ç³»ç»Ÿä¸­ï¼Œç”±äº eBPF æ”¯æŒå—é™ï¼ŒSystemTap å¾€å¾€æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p>
</li>
</ul><p>æ­¤å¤–ï¼Œåœ¨ä½¿ç”¨åŠ¨æ€è¿½è¸ªæŠ€æœ¯æ—¶ï¼Œä¸ºäº†å¾—åˆ°åˆ†æç›®æ ‡çš„è¯¦ç»†ä¿¡æ¯ï¼Œä¸€èˆ¬éœ€è¦å†…æ ¸ä»¥åŠåº”ç”¨ç¨‹åºçš„è°ƒè¯•ç¬¦å·è¡¨ã€‚åŠ¨æ€è¿½è¸ªå®é™…ä¸Šä¹Ÿæ˜¯åœ¨è¿™äº›ç¬¦å·ï¼ˆåŒ…æ‹¬å‡½æ•°å’Œäº‹ä»¶ï¼‰ä¸Šè¿›è¡Œçš„ï¼Œæ‰€ä»¥æ˜“è¯»æ˜“ç†è§£çš„ç¬¦å·ï¼Œæœ‰åŠ©äºåŠ å¿«åŠ¨æ€è¿½è¸ªçš„è¿‡ç¨‹ã€‚</p><h2>æ€è€ƒ</h2><p>æœ€åï¼Œæˆ‘æƒ³é‚€è¯·ä½ ä¸€èµ·æ¥èŠèŠï¼Œä½ æ‰€ç†è§£çš„åŠ¨æ€è¿½è¸ªæŠ€æœ¯ã€‚ä½ æœ‰æ²¡æœ‰åœ¨å®é™…ç¯å¢ƒä¸­ç”¨è¿‡åŠ¨æ€è¿½è¸ªå‘¢ï¼Ÿè¿™ä¹ˆå¤šçš„åŠ¨æ€è¿½è¸ªæ–¹æ³•ï¼Œä½ ä¸€èˆ¬ä¼šæ€ä¹ˆé€‰æ‹©å‘¢ï¼Ÿä½ å¯ä»¥ç»“åˆä»Šå¤©çš„å†…å®¹ï¼Œå’Œä½ è‡ªå·±çš„æ“ä½œè®°å½•ï¼Œæ¥æ€»ç»“æ€è·¯ã€‚</p><p>æ¬¢è¿åœ¨ç•™è¨€åŒºå’Œæˆ‘è®¨è®ºï¼Œä¹Ÿæ¬¢è¿æŠŠè¿™ç¯‡æ–‡ç« åˆ†äº«ç»™ä½ çš„åŒäº‹ã€æœ‹å‹ã€‚æˆ‘ä»¬ä¸€èµ·åœ¨å®æˆ˜ä¸­æ¼”ç»ƒï¼Œåœ¨äº¤æµä¸­è¿›æ­¥ã€‚</p><p></p>
<style>
    ul {
      list-style: none;
      display: block;
      list-style-type: disc;
      margin-block-start: 1em;
      margin-block-end: 1em;
      margin-inline-start: 0px;
      margin-inline-end: 0px;
      padding-inline-start: 40px;
    }
    li {
      display: list-item;
      text-align: -webkit-match-parent;
    }
    ._2sjJGcOH_0 {
      list-style-position: inside;
      width: 100%;
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      margin-top: 26px;
      border-bottom: 1px solid rgba(233,233,233,0.6);
    }
    ._2sjJGcOH_0 ._3FLYR4bF_0 {
      width: 34px;
      height: 34px;
      -ms-flex-negative: 0;
      flex-shrink: 0;
      border-radius: 50%;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 {
      margin-left: 0.5rem;
      -webkit-box-flex: 1;
      -ms-flex-positive: 1;
      flex-grow: 1;
      padding-bottom: 20px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2zFoi7sd_0 {
      font-size: 16px;
      color: #3d464d;
      font-weight: 500;
      -webkit-font-smoothing: antialiased;
      line-height: 34px;
    }
    ._2sjJGcOH_0 ._36ChpWj4_0 ._2_QraFYR_0 {
      margin-top: 12px;
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-all;
      line-height: 24px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 {
      margin-top: 18px;
      border-radius: 4px;
      background-color: #f6f7fb;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._10o3OAxT_0 ._3KxQPN3V_0 {
      color: #505050;
      -webkit-font-smoothing: antialiased;
      font-size: 14px;
      font-weight: 400;
      white-space: normal;
      word-break: break-word;
      padding: 20px 20px 20px 24px;
    }
    ._2sjJGcOH_0 ._3klNVc4Z_0 {
      display: -webkit-box;
      display: -ms-flexbox;
      display: flex;
      -webkit-box-orient: horizontal;
      -webkit-box-direction: normal;
      -ms-flex-direction: row;
      flex-direction: row;
      -webkit-box-pack: justify;
      -ms-flex-pack: justify;
      justify-content: space-between;
      -webkit-box-align: center;
      -ms-flex-align: center;
      align-items: center;
      margin-top: 15px;
    }
    ._2sjJGcOH_0 ._3Hkula0k_0 {
      color: #b2b2b2;
      font-size: 14px;
    }
</style><ul><li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/12/64/05/6989dce6.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>æˆ‘æ¥ä¹Ÿ</span>
  </div>
  <div class="_2_QraFYR_0">[D51æ‰“å¡]<br>é•¿è§è¯†äº†ã€‚<br>è¿˜æ˜¯å…ˆæŠŠperf å’Œ ç«ç„°å›¾ç”¨èµ·æ¥å§ã€‚<br>çŸ¥é“è¿˜æœ‰æ›´å¥½çš„å·¥å…·åœ¨å†…æ ¸æ”¶é›†ä¿¡æ¯å°±è¡Œäº†ã€‚æœ‰éœ€è¦äº†å†æ¥é’ˆå¯¹æ€§çš„ çœ‹å§ã€‚ğŸ¤¦â€â™‚ï¸</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-22 22:48:14</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/11/4b/fa64f061.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>xfan</span>
  </div>
  <div class="_2_QraFYR_0">æˆ‘æƒ³çŸ¥é“ebpfç¨‹åºç¼–å†™æœ‰ä»€ä¹ˆå¥½ç‚¹çš„å­¦ä¹ èµ„æºå—ï¼Œæœ‰ç§å¿ƒæœ‰ä½™è€ŒåŠ›ä¸è¶³çš„æ„Ÿè§‰</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡æ¡£ï¼šhttps:&#47;&#47;docs.cilium.io&#47;en&#47;stable&#47;bpf&#47;</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-26 09:45:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/0c/30/bb4bfe9d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>lyonger</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæœ€è¿‘kvmè™šæ‹Ÿæœºå™¨ï¼Œxfsæ–‡ä»¶ç³»ç»Ÿä¸‹ä½¿ç”¨devmapperçš„é©±åŠ¨ï¼Œæ¯æ¬¡ä½¿ç”¨dockerè·‘ä»»åŠ¡ci buildçš„æ—¶å€™ï¼Œç”¨iotopæŸ¥çœ‹å‘ç°runneræœºå™¨çš„[loop1]ã€[loop2]ã€[kworker&#47;u32:2]çš„io 99%ï¼Œä»»åŠ¡ä¸­æ­¢äº†ä»¥åå°±æ²¡æœ‰å‘ç°å¼‚å¸¸äº†ã€‚æˆ‘ç”¨perfå®šä½åˆ°äº†çƒ­ç‚¹å‡½æ•°æ˜¯xfsaildã€xfs_inode_item_pushã€‚ç”¨ftraceå’Œtrace-cmdè¦å…ˆçŸ¥é“è¿è¡Œçš„å‘½ä»¤ã€‚é‚£ä¹ˆ2ä¸ªç–‘é—®ï¼š<br>1ã€æœ‰åŠæ³•ç›´æ¥æŸ¥çœ‹æŸä¸ªçƒ­ç‚¹å‡½æ•°é‡Œçš„æ‰§è¡Œé€»è¾‘å—ï¼Ÿåœ¨ä¸çŸ¥é“æ‰§è¡Œä»€ä¹ˆå‘½ä»¤çš„æƒ…å†µä¸‹ï¼Œæˆ‘åªçŸ¥é“æŸä¸ªçƒ­ç‚¹å‡½æ•°åç§°<br>2ã€å¯ä»¥ä½¿ç”¨çš„æ¢é’ˆæœ‰å“ªäº›ï¼Œæ˜¯æ€ä¹ˆæŸ¥çœ‹å‘¢ï¼Ÿ<br><br>æœŸå¾…æ‚¨çš„å›å¤ï¼Œå¤šè°¢ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: 1. å¯ä»¥å…ˆè¯•è¯•ç«ç„°å›¾ï¼Œç„¶åè·Ÿç€ç«ç„°å›¾è°ƒç”¨å †æ ˆå»æŸ¥è¯¢å†…æ ¸æºç ã€‚<br>2. æ¢é’ˆçš„è¯ï¼Œå·¥å…·é‡Œé¢éƒ½æä¾›äº†æ¢é’ˆæŸ¥è¯¢çš„å‘½ä»¤ï¼Œæ¯”å¦‚ perf list</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-07-10 20:15:07</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/16/63/2e/e49116d1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_007</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆä½ å¥½ï¼Œæˆ‘åœ¨ä½¿ç”¨ perf trace å‘½ä»¤æ—¶å‘ç°ï¼Œperf trace è¿½è¸ªæ—¶ï¼Œä¸èƒ½æ‰“å°å‡ºæ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶åï¼Œå°½ç®¡æˆ‘å·²ç»ä½¿ç”¨ perf probe å°†filename åŠ å…¥ï¼Œä½†æ˜¯ä¾ç„¶æ— æ³•æ‰“å°å‡ºæ–‡ä»¶åã€‚å¦å¤–æˆ‘ä½¿ç”¨ perf trace -e probe:do_sys_open ,ä¾ç„¶è¿˜æ˜¯è®°å½•æ‰€æœ‰çš„äº‹ä»¶ï¼Œè¯·é—®è€å¸ˆï¼Œæ˜¯æˆ‘ä½¿ç”¨çš„æœ‰é—®é¢˜ï¼Ÿè¿˜æ˜¯å…¶ä»–é—®é¢˜ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: åº”è¯¥æ˜¯ perf trace -e fs:do_sys_open</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-04-14 14:15:17</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/e2/d8/f0562ede.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>manatee</span>
  </div>
  <div class="_2_QraFYR_0">æƒ³è¯·æ•™ä¸‹è€å¸ˆï¼Œåœ¨å®¹å™¨ç¯å¢ƒä¸‹ä½¿ç”¨ä»¥ä¸ŠåŠ¨æ€è¿½è¸ªæŠ€æœ¯æœ‰å“ªäº›æ³¨æ„ç‚¹å’Œå‘å‘¢</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æœ€ä¸»è¦çš„æ˜¯è°ƒè¯•ä¿¡æ¯é—®é¢˜ï¼Œå®¹å™¨è¿›ç¨‹å’Œä¾èµ–ç¯å¢ƒè·Ÿä¸»æœºåœ¨ä¸åŒnamespaceä¸­ï¼Œå¾ˆå¤šå·¥å…·å¯èƒ½æ— æ³•æ­£ç¡®æ‰¾å‡ºç›¸åº”çš„ç¬¦å·è¡¨</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-06-06 08:03:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/a7/6d/19bff1f9.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ichen</span>
  </div>
  <div class="_2_QraFYR_0"># perf probe<br>perf: &#39;probe&#39; is not a perf-command. See &#39;perf --help&#39;.</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å‡çº§ç‰ˆæœ¬è¯•è¯•ï¼Ÿ</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-23 04:41:19</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/PiajxSqBRaEKQMM4m7NHuicr55aRiblTSEWIYe0QqbpyHweaoAbG7j2v7UUElqqeP3Ihrm3UfDPDRb1Hv8LvPwXqA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ninuxer</span>
  </div>
  <div class="_2_QraFYR_0">æ‰“å¡day54<br>æ•´ä¸ªåŠ¨æ€è¿½è¸ªéƒ½æ¯”è¾ƒæ‡µé€¼ï¼Œå¸¸ç”¨çš„ä¹Ÿå°±æ˜¯traceå’Œperfå¾ˆç®€å•çš„ç”¨æ³•ï¼Œç­‰å•ƒå®Œå†…æ ¸çš„ä¹¦å†å›è¿‡å¤´æ¥çœ‹æ–‡ç« ï¼Œä¼°è®¡å®¹æ˜“æ¶ˆåŒ–ç‚¹ï½</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-03-22 08:12:08</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/16/cd/db/7467ad23.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Bachue Zhou</span>
  </div>
  <div class="_2_QraFYR_0">è¯·é—®ç”¨ perf trace å’Œ ebpf ç›¸æ¯”ï¼Œå“ªç§æŠ€æœ¯è¿½è¸ªæ•ˆç‡æ›´é«˜ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2023-04-12 20:22:26</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/99/7a/558666a5.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>AceslupK</span>
  </div>
  <div class="_2_QraFYR_0">åŠ¨æ€è¿½è¸ªå¥½éš¾</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: å¯ä»¥ç»§ç»­çœ‹ä¸€ä¸‹eBPFä¸“æ ğŸ˜Š</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2022-02-28 17:04:53</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqtXSgThiaEiaEqqic5YIJ7v469nCM3VXiccOJ4SxbYjW91ciczuYYEzcTVtYWaWXaokZqShuLdKsXjnFA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_b85295</span>
  </div>
  <div class="_2_QraFYR_0">apt-get install linux-image-`uname -r`-dbgsym  <br>è¿™å¥è¯æ‰§è¡Œç‰¹åˆ«æ…¢æ€ä¹ˆåŠï¼Œå®‰è£…åŒ…éå¸¸å¤§ï¼Œæœ‰å›½å†…çš„æºæ›¿ä»£æºå—ï¼ŒæŠŠä¸‹é¢ä¸¤ä¸ªæ›¿æ¢æ‰<br>deb http:&#47;&#47;ddebs.ubuntu.com&#47; bionic main<br>deb http:&#47;&#47;ddebs.ubuntu.com&#47; bionic-updates main<br></div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-06-18 16:27:41</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://wx.qlogo.cn/mmopen/vi_32/DYAIOgq83eqtXSgThiaEiaEqqic5YIJ7v469nCM3VXiccOJ4SxbYjW91ciczuYYEzcTVtYWaWXaokZqShuLdKsXjnFA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Geek_b85295</span>
  </div>
  <div class="_2_QraFYR_0">apt-get install linux-image-`uname -r`-dbgsym  </div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-06-18 16:26:03</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/c5/54/a9b1d9f1.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>bruceyk</span>
  </div>
  <div class="_2_QraFYR_0">é—®ä¸‹è€å¸ˆï¼Œåº”ç”¨ç¨‹åºå®‰è£…ç¬¦å·è¡¨ï¼Œæ˜¯éœ€è¦å¼€å¯â€“gé€‰é¡¹ç¼–è¯‘å—ï¼Œä¼šä¸ä¼šæœ¬èº«å½±å“ç¨‹åºçš„æ€§èƒ½ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2021-05-10 19:48:30</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/11/13/00/a4a2065f.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Michael</span>
  </div>
  <div class="_2_QraFYR_0">è°ƒè¯•ç¬¦å·è¡¨å®‰è£…ä¸äº†<br><br>root@iZ94lcu45k0Z:~# apt-get install linux-image-`uname -r`-dbgsym<br>Reading package lists... Done<br>Building dependency tree<br>Reading state information... Done<br>E: Unable to locate package linux-image-4.15.0-72-generic-dbgsym<br>E: Couldn&#39;t find any package by glob &#39;linux-image-4.15.0-72-generic-dbgsym&#39;<br>E: Couldn&#39;t find any package by regex &#39;linux-image-4.15.0-72-generic-dbgsym&#39;</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: æ˜¯Ubuntuç³»ç»Ÿå—ï¼Ÿå¦‚æœæ˜¯çš„è¯ï¼Œå¯ä»¥å‚è€ƒå®ƒçš„å®˜æ–¹æ–‡æ¡£ https:&#47;&#47;wiki.ubuntu.com&#47;Debug%20Symbol%20Packages</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-07-18 14:05:29</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/10/08/46/7103cbdc.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>ä»˜é’±</span>
  </div>
  <div class="_2_QraFYR_0">$ apt-get install linux-image-`uname -r`-dbgsym<br>è¿™ä¸ªå‘½ä»¤ä¹Ÿè¿è¡Œå¤±è´¥äº†ï¼Œæç¤ºæ‰¾ä¸åˆ°package</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-06-01 14:28:39</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/13/73/f5/29138f17.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>å‡³å­</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆï¼Œæƒ³é—®ä¸‹ï¼Œåœ¨k8sä¸Šï¼Œå¦‚æœåœ¨ä¸€ä¸ªå®¹å™¨å†…ä½¿ç”¨eBPFè¿½è¸ªsyscallï¼Œæ˜¯ä¸æ˜¯ä¼šå½±å“å®¿ä¸»æœºä¸Šçš„æ‰€æœ‰å®¹å™¨ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-04-10 15:21:40</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/1b/83/fb/621adceb.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>linker</span>
  </div>
  <div class="_2_QraFYR_0">ä¹‹å‰ä½¿ç”¨ftraceä¸trace-cmdå®šä½å¤šè°ƒåº¦å»¶è¿Ÿçš„é—®é¢˜ï¼Œæ‰“å°å‡ºçš„æŠ¥å‘Šæ¯”è¾ƒå¤šï¼Œè¿˜å¾—æ‰‹åŠ¨å†™è„šæœ¬åˆ†æé‚£ä¸ªå‡½æ•°å»¶è¿Ÿå¤§</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-04-03 22:17:50</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src=""
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>201200986</span>
  </div>
  <div class="_2_QraFYR_0">ebpfç›¸å…³çš„å†…å®¹æœ‰æ²¡æœ‰æ›´å¤šææ–™æ¨èå‘¢ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-21 20:26:36</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="http://thirdwx.qlogo.cn/mmopen/vi_32/Q0j4TwGTfTJGMphabeneYRlxs1biaO9oKic6Dwgbe312561lE56V93uUHgXXAsGmK1pH18mvpElygoJh8SUtQPUA/132"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>è‘£çš‹</span>
  </div>
  <div class="_2_QraFYR_0">æ‰“å¡</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2020-03-21 11:26:55</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/0f/ca/3b/6dd2b1e2.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>Cloudfull</span>
  </div>
  <div class="_2_QraFYR_0">è€å¸ˆ perf probe -a æ·»åŠ è‡ªå®šä¹‰æ¢é’ˆæ—¶  å¦‚ä½•æŸ¥çœ‹é‡Œé¢çš„ struct ç±»å‹çš„å˜é‡ï¼Ÿ</div>
  <div class="_10o3OAxT_0">
    
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-11-01 15:23:13</div>
  </div>
</div>
</div>
</li>
<li>
<div class="_2sjJGcOH_0"><img src="https://static001.geekbang.org/account/avatar/00/14/0c/30/bb4bfe9d.jpg"
  class="_3FLYR4bF_0">
<div class="_36ChpWj4_0">
  <div class="_2zFoi7sd_0"><span>lyonger</span>
  </div>
  <div class="_2_QraFYR_0">æˆ‘æ˜¨å¤©æŸ¥åˆ°äº†é—®é¢˜æ ¹æºï¼Œå‘ç°dockerå¯¹äºä½¿ç”¨å­˜å‚¨é©±åŠ¨æœ‰é€‰æ‹©æ¨èçš„è¯´æ˜ï¼Œé‚£ä¸ªé—®é¢˜æ˜¯å­˜å‚¨é©±åŠ¨é—®é¢˜å¯¼è‡´ï¼Œé€šè¿‡çƒ­ç‚¹å‡½æ•°å’Œè°ƒè¯•å‘ç°æ”¹æˆoverlay2åloopå†…æ ¸çº¿ç¨‹çš„ioå‡ ä¹æ²¡æœ‰äº†ã€‚ä¸šåŠ¡ä¹Ÿæ­£å¸¸äº†ã€‚ä½†æ˜¯é‚£2ä¸ªé—®é¢˜ï¼ŒæœŸå¾…è€å¸ˆæœ‰ç©ºåç»™äºˆè§£ç­”ï¼Œå¤šè°¢ã€‚</div>
  <div class="_10o3OAxT_0">
    <p class="_3KxQPN3V_0">ä½œè€…å›å¤: ğŸ‘</p>
  </div>
  <div class="_3klNVc4Z_0">
    <div class="_3Hkula0k_0">2019-07-11 08:44:26</div>
  </div>
</div>
</div>
</li>
</ul>